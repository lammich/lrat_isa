<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Select_Solve</title>
</head>


<body>
<div class="head">
<h1>Theory Select_Solve</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><a href="Select_Solve.html"><span>Select_Solve</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> </span><a href="../../HOL/HOL/Main.html"><span>Main</span></a><span> </span><a href="Refine_Util.html"><span>Refine_Util</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="comment1"><span>(*
  Focus on subgoal, respect schematic variable instantiations.
  *** Be aware that this seems to be slower then to work with
    big subgoals! ***

*)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Select_Solve.retrofit_with_prems|fact"><span class="entity_def" id="Select_Solve.retrofit_with_prems|thm"><span>retrofit_with_prems</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>TAG</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>prop</span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_273..274">1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><span>==&gt;</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>Q</span></span><span>"</span></span></span><span> </span><span class="comment1"><span>(* Original goal state *)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_332..333">2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>==&gt;</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>TAG</span></span><span> </span><span class="main"><span>&amp;&amp;&amp;</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span> </span><span class="comment1"><span>(* Result of first subgoal *)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>==&gt;</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>Q</span></span><span>"</span></span></span><span> </span><span class="comment1"><span>(* New goal state with &amp;&amp;&amp;*)</span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_465..471">assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Select_Solve.html#offset_465..471"><span>this</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="Select_Solve.html#offset_332..333"><span>2</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><span>conjunctionD2</span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>with</span></span></span><span> </span><a class="entity_ref" href="Select_Solve.html#offset_273..274"><span>1</span></a><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>Q</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Select_Solve.retrofit_no_prems|fact"><span class="entity_def" id="Select_Solve.retrofit_no_prems|thm"><span>retrofit_no_prems</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>TAG</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>prop</span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_628..629">1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><span>==&gt;</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>Q</span></span><span>"</span></span></span><span> </span><span class="comment1"><span>(* Original goal state *)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_687..688">2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>TAG</span></span><span> </span><span class="main"><span>&amp;&amp;&amp;</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span> </span><span class="comment1"><span>(* Result of first subgoal *)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>Q</span></span><span>"</span></span></span><span> </span><span class="comment1"><span>(* New goal state *)</span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Select_Solve.html#offset_687..688"><span>2</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><span>conjunctionD2</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>Q</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Select_Solve.html#offset_628..629"><span>1</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>consts</span></span></span><span> </span><span class="entity_def" id="Select_Solve.NO_TAG|const"><span>NO_TAG</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>prop</span><span>"</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>ML</span></span></span><span> </span><span class="quoted"><span>‹
</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>SELECT_SOLVE</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> PREFER_SOLVED</span><span class="main"><span>:</span></span><span> </span><span>tactic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> IF_SUBGOAL_SOLVED</span><span class="main"><span>:</span></span><span> </span><span>tactic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> TRY_SOLVE_FWD</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> SELECT_FIRST</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> AS_FIRSTGOAL</span><span class="main"><span>:</span></span><span> </span><span>tactic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tactic'</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> REPEAT_SOLVE_FWD_SELECT</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tactic'</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tactic'</span></span><span> 
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Select_Solve</span></span><span> </span><span class="main"><span>:</span></span><span class="entity"><span>SELECT_SOLVE</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>PREFER_SOLVED</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.nprems_of</span><span> </span><span class="entity"><span>st</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>res</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>st</span></span><span>
    </span><span class="comment1"><span>(*val res' = Seq.append 
      (Seq.filter (has_fewer_prems n) res)
      (Seq.filter (not o has_fewer_prems n) res)*)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>res'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Seq.filter</span><span> </span><span class="main"><span>(</span></span><span>has_fewer_prems</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>res</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>res'</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>IF_SUBGOAL_SOLVED</span></span><span> </span><span class="entity"><span>tac1</span></span><span> </span><span class="entity"><span>then_tac</span></span><span> </span><span class="entity"><span>else_tac</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.nprems_of</span><span> </span><span class="entity"><span>st</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>tac1</span></span><span> </span><span>THEN</span><span> </span><span>COND</span><span> </span><span class="main"><span>(</span></span><span>has_fewer_prems</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>then_tac</span></span><span> </span><span class="entity"><span>else_tac</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>st</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>TRY_SOLVE_FWD</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>&lt;=</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> 
      </span><span>Seq.single</span><span> </span><span class="entity"><span>st</span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span>IF_UNSOLVED</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>IF_SUBGOAL_SOLVED</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TRY_SOLVE_FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tac</span></span><span class="main"><span>)</span></span><span> </span><span>all_tac</span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>st</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>TRY_SOLVE_ALL_NEW_FWD</span></span><span> </span><span class="entity"><span>tac1</span></span><span> </span><span class="entity"><span>tac2</span></span><span> </span><span class="entity"><span>tac3</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.nprems_of</span><span> </span><span class="entity"><span>st</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> 
    </span><span class="main"><span>(</span></span><span>
      </span><span class="entity"><span>tac1</span></span><span> </span><span>THEN_ELSE</span><span> 
        </span><span class="main"><span>(</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>st'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.nprems_of</span><span> </span><span class="entity"><span>st'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>TRY_SOLVE_FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n'</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tac2</span></span><span> </span><span class="entity"><span>st'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>tac3</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>st</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>SELECT_FIRST</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Thm.nprems_of</span><span> </span><span class="entity"><span>st</span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>st</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="comment1"><span>(*val _ = print_tac "Focusing" st*)</span></span><span>

    </span><span class="comment1"><span>(* Extract first subgoal *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>P</span></span><span class="main"><span>,</span></span><span class="entity"><span>Q</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_implies</span><span> </span><span class="main"><span>(</span></span><span>Thm.cprop_of</span><span> </span><span class="entity"><span>st</span></span><span class="main"><span>)</span></span><span>

    </span><span class="comment1"><span>(*val _ = "Extracted: " ^ @{make_string} P |&gt; tracing*)</span></span><span>

    </span><span class="comment1"><span>(* Prepare tag *)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span> 
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>intr_bal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><span class="quoted"><span>‹</span><span class="keyword1"><span>TERM</span></span><span> </span><a class="entity_ref" href="Select_Solve.html#Select_Solve.NO_TAG|const"><span>NO_TAG</span></a><span>›</span></span><span class="antiquote"><span>}</span></span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>intr_bal</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Conjunction.intr_balanced</span><span> </span><span class="entity"><span>l</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>P</span></span><span> 

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.add_vars</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.add_tvars</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vtvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Term.add_tvarsT</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>subtract</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vtvars</span></span><span> </span><span class="entity"><span>tvars</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tvars_tag</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tvars</span></span><span>
        </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Drule.mk_term</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>o</span><span> </span><span>Logic.mk_type</span><span> </span><span>o</span><span> </span><span>TVar</span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>intr_bal</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars_tag</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vars</span></span><span>
        </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Drule.mk_term</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>o</span><span> </span><span>Var</span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>intr_bal</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tag_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Conjunction.intr</span><span> </span><span class="entity"><span>tvars_tag</span></span><span> </span><span class="entity"><span>vars_tag</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TAG</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.cprop_of</span><span> </span><span class="entity"><span>tag_thm</span></span><span>

    </span><span class="comment1"><span>(* Prepare new proof state *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>st'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Conjunction.mk_conjunction</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TAG</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>P</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Goal.init</span><span>
      </span><span>|&gt;</span><span> </span><span>Conjunction.curry_balanced</span><span> </span><span class="inner_numeral"><span>2</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Thm.elim_implies</span><span> </span><span class="entity"><span>tag_thm</span></span><span>

    </span><span class="comment1"><span>(*val _ = "New proof state: " ^ @{make_string} st' |&gt; tracing*)</span></span><span>

    </span><span class="comment1"><span>(*val _ = print_tac "New state" st'*)</span></span><span>

    </span><span class="comment1"><span>(* Apply proof *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>seq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>st'</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>elim_implies</span></span><span> </span><span class="entity"><span>thA</span></span><span> </span><span class="entity"><span>thAB</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>try</span><span> </span><span>Thm.dest_implies</span><span> </span><span class="main"><span>(</span></span><span>Thm.cprop_of</span><span> </span><span class="entity"><span>thAB</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> 
        </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>A</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>A</span></span><span> </span><span>aconvc</span><span> </span><span>Thm.cprop_of</span><span> </span><span class="entity"><span>thA</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="comment1"><span>(*tracing (@{make_string} (term_of A));
              tracing (@{make_string} (prop_of thA));*)</span></span><span>
              </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"implies_elim: No aconv"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>A</span></span><span class="main"><span>,</span></span><span>Thm.cprop_of</span><span> </span><span class="entity"><span>thA</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span>Thm.elim_implies</span><span> </span><span class="entity"><span>thA</span></span><span> </span><span class="entity"><span>thAB</span></span><span>
        </span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"implies_elim: No impl"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>thAB</span></span><span class="main"><span>,</span></span><span class="entity"><span>thA</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>retrofit</span></span><span> </span><span class="entity"><span>st'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>st'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.incr_indexes</span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="entity"><span>st'</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.nprems_of</span><span> </span><span class="entity"><span>st'</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Conjunction.uncurry_balanced</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>st'</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Goal.conclude</span><span>
        </span><span>|&gt;</span><span> </span><span>Conv.fconv_rule</span><span> </span><span class="main"><span>(</span></span><span>Thm.beta_conversion</span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
      </span><span class="comment1"><span>(*val _ = "Proved: " ^ @{make_string} thm |&gt; tracing*)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>=</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> 
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TAG'</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Conjunction.dest_conjunction</span><span> </span><span class="main"><span>(</span></span><span>Thm.cprop_of</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.match</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TAG</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TAG'</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.instantiate</span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>st</span></span><span> 
            </span><span>|&gt;</span><span> </span><span>Conv.fconv_rule</span><span> </span><span class="main"><span>(</span></span><span>Thm.beta_conversion</span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.instantiate_cterm</span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>P</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Q</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.instantiate_cterm</span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>Q</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Select_Solve.html#Select_Solve.retrofit_no_prems|fact"><span>retrofit_no_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.instantiate'</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>P</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>Q</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>TAG'</span></span><span class="main"><span>]</span></span><span> 
          </span><span>|&gt;</span><span> </span><span>Conv.fconv_rule</span><span> </span><span class="main"><span>(</span></span><span>Thm.beta_conversion</span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>elim_implies</span></span><span> </span><span class="entity"><span>st</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>elim_implies</span></span><span> </span><span class="entity"><span>thm</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> 
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span class="entity"><span>TP'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_implies</span><span> </span><span class="main"><span>(</span></span><span>Thm.cprop_of</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TAG'</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Conjunction.dest_conjunction</span><span> </span><span class="entity"><span>TP'</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.match</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TAG</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TAG'</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.instantiate</span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>st</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Conv.fconv_rule</span><span> </span><span class="main"><span>(</span></span><span>Thm.beta_conversion</span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.instantiate_cterm</span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>P</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Q</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.instantiate_cterm</span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>Q</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> 
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Select_Solve.html#Select_Solve.retrofit_with_prems|fact"><span>retrofit_with_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.instantiate'</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>P</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>Q</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>TAG'</span></span><span class="main"><span>]</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Conv.fconv_rule</span><span> </span><span class="main"><span>(</span></span><span>Thm.beta_conversion</span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>elim_implies</span></span><span> </span><span class="entity"><span>st</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>elim_implies</span></span><span> </span><span class="entity"><span>thm</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Conjunction.curry_balanced</span><span> </span><span class="entity"><span>n</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>Seq.map</span><span> </span><span class="entity"><span>retrofit</span></span><span> </span><span class="entity"><span>seq</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>AS_FIRSTGOAL</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>&lt;=</span><span> </span><span>Thm.nprems_of</span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="main"><span>(</span></span><span>PRIMITIVE</span><span> </span><span class="main"><span>(</span></span><span>Thm.permute_prems</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 
      </span><span>THEN</span><span> </span><span class="entity"><span>tac</span></span><span> 
      </span><span>THEN</span><span> </span><span>PRIMITIVE</span><span> </span><span class="main"><span>(</span></span><span>Thm.permute_prems</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span>-</span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>st</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Seq.empty</span><span>

  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>REPEAT_SOLVE_FWD_SELECT</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>bias</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>BIASED_SELECT</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Thm.nprems_of</span><span> </span><span class="entity"><span>st</span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>st</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.size_of_thm</span><span> </span><span class="entity"><span>st</span></span><span>
        </span><span class="comment1"><span>(*val _ = if s&gt;100 then string_of_int s |&gt; tracing else ()*)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>&lt;</span><span> </span><span class="entity"><span>bias</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> 
          </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>st</span></span><span> 
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.dest_implies</span><span> </span><span class="main"><span>(</span></span><span>Thm.prop_of</span><span> </span><span class="entity"><span>st</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>|&gt;</span><span> </span><span>size_of_term</span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="inner_numeral"><span>5</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>s1</span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="entity"><span>SELECT_FIRST</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>st</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>st</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>sg_rec</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>IF_UNSOLVED</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BIASED_SELECT</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>PREFER_SOLVED</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>TRY_SOLVE_ALL_NEW_FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tac</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sg_rec</span></span><span> </span><span>all_tac</span><span>
        </span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>st</span></span><span>

  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>AS_FIRSTGOAL</span></span><span> </span><span class="entity"><span>sg_rec</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

›</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>