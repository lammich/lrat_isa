<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Defer_Slot</title>
</head>


<body>
<div class="head">
<h1>Theory Defer_Slot</h1>
</div>

<pre class="source"><span class="comment1"><span>(*
  Utility to defer subgoals into an isolated part of the proof state, 
  and recover them later.
*)</span></span><span>
</span><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><a href="Defer_Slot.html"><span>Defer_Slot</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> </span><a href="Basic_Imports.html"><span>Basic_Imports</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Defer_Slot.DEFER_SLOT_def|fact"><span class="entity_def" id="Defer_Slot.DEFER_SLOT_def|thm"><span class="entity_def" id="Defer_Slot.DEFER_SLOT_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Defer_Slot.DEFER_SLOT|const"><span>DEFER_SLOT</span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>::</span></span><span>prop</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Defer_Slot.DEFER_SLOT_cong|fact"><span class="entity_def" id="Defer_Slot.DEFER_SLOT_cong|thm"><span>DEFER_SLOT_cong</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>cong</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.DEFER_SLOT|const"><span>DEFER_SLOT</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.DEFER_SLOT|const"><span>DEFER_SLOT</span></a><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="comment1"><span>(* TODO: Find something better than True to put in empty slot! Perhaps "A⟹A" *)</span></span><span>
</span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Defer_Slot.EMPTY_DEFER_SLOT|const"><span>EMPTY_DEFER_SLOT</span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.DEFER_SLOT|const"><span>DEFER_SLOT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_409..414">lemma</span></span></span><span> </span><span class="entity_def" id="Defer_Slot.insert_slot_rl1|fact"><span class="entity_def" id="Defer_Slot.insert_slot_rl1|thm"><span>insert_slot_rl1</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.EMPTY_DEFER_SLOT|const"><span>EMPTY_DEFER_SLOT</span></a><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>Q</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.DEFER_SLOT|const"><span>DEFER_SLOT</span></a><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>P</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>Q</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Defer_Slot.html#offset_409..414"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.DEFER_SLOT_def|fact"><span>DEFER_SLOT_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_578..583">lemma</span></span></span><span> </span><span class="entity_def" id="Defer_Slot.insert_slot_rl2|fact"><span class="entity_def" id="Defer_Slot.insert_slot_rl2|thm"><span>insert_slot_rl2</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.DEFER_SLOT|const"><span>DEFER_SLOT</span></a><span> </span><span class="free"><span>S</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>Q</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.DEFER_SLOT|const"><span>DEFER_SLOT</span></a><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>&amp;&amp;&amp;</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>P</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>Q</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Defer_Slot.html#offset_578..583"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.DEFER_SLOT_def|fact"><span>DEFER_SLOT_def</span></a><span> </span><span>conjunction_def</span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Defer_Slot.remove_slot|fact"><span class="entity_def" id="Defer_Slot.remove_slot|thm"><span>remove_slot</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.EMPTY_DEFER_SLOT|const"><span>EMPTY_DEFER_SLOT</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.DEFER_SLOT_def|fact"><span>DEFER_SLOT_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="Defer_Slot.split_constraint_rls|fact"><span class="entity_def" id="Defer_Slot.split_constraint_rls(4)|thm"><span class="entity_def" id="Defer_Slot.split_constraint_rls(3)|thm"><span class="entity_def" id="Defer_Slot.split_constraint_rls(2)|thm"><span class="entity_def" id="Defer_Slot.split_constraint_rls(1)|thm"><span>split_constraint_rls</span></span></span></span></span></span><span> 
    </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.atomize_conj|fact"><span>atomize_conj</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../Pure/Pure/Pure.html#Pure.imp_conjunction|fact"><span>imp_conjunction</span></a><span> </span><a class="entity_ref" href="../../Pure/Pure/Pure.html#Pure.all_conjunction|fact"><span>all_conjunction</span></a><span> </span><a class="entity_ref" href="../../Pure/Pure/Pure.html#Pure.conjunction_imp|fact"><span>conjunction_imp</span></a><span>

</span><span class="keyword1"><span class="command"><span>ML</span></span></span><span> </span><span class="quoted"><span>‹
  </span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>DEFER_SLOT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
    </span><span class="comment1"><span>(******** Defer Slot *)</span></span><span>
    </span><span class="comment1"><span>(* Tactic with slot subgoal *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> WITH_SLOT</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tactic'</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>
    </span><span class="comment1"><span>(* Process all goals in slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> ON_SLOT</span><span class="main"><span>:</span></span><span> </span><span>tactic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>
    </span><span class="comment1"><span>(* Create slot as last subgoal. Fail if slot already present. *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> create_slot_tac</span><span class="main"><span>:</span></span><span> </span><span>tactic</span><span>
    </span><span class="comment1"><span>(* Create slot if there isn't one already *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> ensure_slot_tac</span><span class="main"><span>:</span></span><span> </span><span>tactic</span><span>
    </span><span class="comment1"><span>(* Remove empty slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> remove_slot_tac</span><span class="main"><span>:</span></span><span> </span><span>tactic</span><span>
    </span><span class="comment1"><span>(* Move slot to first subgoal *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> prefer_slot_tac</span><span class="main"><span>:</span></span><span> </span><span>tactic</span><span>
    </span><span class="comment1"><span>(* Destruct slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> dest_slot_tac</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tactic'</span></span><span>
    </span><span class="comment1"><span>(* Check if goal state has slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> has_slot</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
    </span><span class="comment1"><span>(* Defer subgoal to slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> to_slot_tac</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tactic'</span></span><span>
    </span><span class="comment1"><span>(* Print slot contents *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> print_slot_tac</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>

    </span><span class="comment1"><span>(* Focus on goals in slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> focus</span><span class="main"><span>:</span></span><span> </span><span>tactic</span><span>
    </span><span class="comment1"><span>(* Unfocus goals in slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> unfocus</span><span class="main"><span>:</span></span><span> </span><span>tactic</span><span>
    </span><span class="comment1"><span>(* Unfocus goals, and insert them as first subgoals *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> unfocus_ins</span><span class="main"><span>:</span></span><span>tactic</span><span>

    </span><span class="comment1"><span>(* Focus on some goals in slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> cond_focus</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>
    </span><span class="comment1"><span>(* Move some goals to slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> some_to_slot_tac</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>

  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


  </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Defer_Slot</span></span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>DEFER_SLOT</span></span><span>  </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_slot_goal</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.DEFER_SLOT|const"><span>DEFER_SLOT</span></a><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_slot_goal</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>slot_goal_num</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>find_index</span><span> </span><span class="entity"><span>is_slot_goal</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.prems_of</span><span> </span><span class="entity"><span>st</span></span><span class="main"><span>)</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="entity"><span>i</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>has_slot</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>slot_goal_num</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>WITH_SLOT</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>si</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>slot_goal_num</span></span><span> </span><span class="entity"><span>st</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>si</span></span><span>&gt;</span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>si</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Thm.nprems_of</span><span> </span><span class="entity"><span>st</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>warning</span><span> </span><span class="inner_quoted"><span>"No defer slot"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> 
        </span><span>Seq.empty</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>to_slot_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>IF_EXGOAL</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>WITH_SLOT</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>si</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> 
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span>&lt;</span><span class="entity"><span>si</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="entity"><span>prefer_tac</span></span><span> </span><span class="entity"><span>si</span></span><span> </span><span>THEN</span><span> </span><span class="entity"><span>prefer_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
        </span><span>THEN</span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>PRIMITIVE</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Drule.comp_no_flatten</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>st</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.insert_slot_rl1|fact"><span>insert_slot_rl1</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> 
          </span><span>ORELSE</span><span> </span><span>PRIMITIVE</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Drule.comp_no_flatten</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>st</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.insert_slot_rl2|fact"><span>insert_slot_rl2</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span>
        </span><span>THEN</span><span> </span><span>defer_tac</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>no_tac</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>create_slot_tac</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span>COND</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>has_slot</span></span><span class="main"><span>)</span></span><span> </span><span>no_tac</span><span>
        </span><span class="main"><span>(</span></span><span>PRIMITIVE</span><span> </span><span class="main"><span>(</span></span><span>Thm.implies_intr</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>cterm</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.EMPTY_DEFER_SLOT|const"><span>EMPTY_DEFER_SLOT</span></a><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> 
        </span><span>THEN</span><span> </span><span>defer_tac</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
        
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ensure_slot_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>TRY</span><span> </span><span class="entity"><span>create_slot_tac</span></span><span>
          
      
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prefer_slot_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>WITH_SLOT</span></span><span> </span><span class="entity"><span>prefer_tac</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dest_slot_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>
      </span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span>CONVERSION</span><span> </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.DEFER_SLOT_def|fact"><span>DEFER_SLOT_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> 
        </span><span>THEN'</span><span> </span><span>Goal.conjunction_tac</span><span>
        </span><span>THEN'</span><span> </span><span>TRY</span><span> </span><span>o</span><span> </span><span>resolve0_tac</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
      </span><span>THEN</span><span> </span><span>distinct_subgoals_tac</span><span>
    </span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>remove_slot_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>WITH_SLOT</span></span><span> </span><span class="main"><span>(</span></span><span>resolve0_tac</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.remove_slot|fact"><span>remove_slot</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>focus</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>WITH_SLOT</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> 
      </span><span>PRIMITIVE</span><span> </span><span class="main"><span>(</span></span><span>Goal.restrict</span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> 
      </span><span>THEN</span><span> </span><span>ALLGOALS</span><span> </span><span class="entity"><span>dest_slot_tac</span></span><span>
      </span><span>THEN</span><span> </span><span class="entity"><span>create_slot_tac</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unfocus_ins</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span>PRIMITIVE</span><span> </span><span class="main"><span>(</span></span><span>Goal.unrestrict</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
      </span><span>THEN</span><span> </span><span class="entity"><span>WITH_SLOT</span></span><span> </span><span>defer_tac</span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>some_to_slot_tac</span></span><span> </span><span class="entity"><span>cond</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>COND'</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>is_slot_goal</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cond</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>ORELSE'</span><span> </span><span class="entity"><span>to_slot_tac</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unfocus</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span class="entity"><span>some_to_slot_tac</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
      </span><span>THEN</span><span> </span><span class="entity"><span>unfocus_ins</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cond_focus</span></span><span> </span><span class="entity"><span>cond</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>focus</span></span><span> 
      </span><span>THEN</span><span> </span><span class="entity"><span>some_to_slot_tac</span></span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span>o</span><span> </span><span class="entity"><span>cond</span></span><span class="main"><span>)</span></span><span>


    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ON_SLOT</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>focus</span></span><span> </span><span>THEN</span><span> </span><span class="entity"><span>tac</span></span><span> </span><span>THEN</span><span> </span><span class="entity"><span>unfocus</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_slot_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ON_SLOT</span></span><span> </span><span class="main"><span>(</span></span><span>print_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="inner_quoted"><span>"SLOT:"</span></span><span class="main"><span>)</span></span><span>


  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
›</span></span><span>

</span><span class="keyword1"><span class="command"><span>method_setup</span></span></span><span> </span><span class="entity_def" id="Defer_Slot.defer_slot_print|method"><span>defer_slot_print</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SIMPLE_METHOD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Defer_Slot.print_slot_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>
</span><span class="keyword1"><span class="command"><span>method_setup</span></span></span><span> </span><span class="entity_def" id="Defer_Slot.defer_slot_ensure|method"><span>defer_slot_ensure</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SIMPLE_METHOD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Defer_Slot.ensure_slot_tac</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>
</span><span class="keyword1"><span class="command"><span>method_setup</span></span></span><span> </span><span class="entity_def" id="Defer_Slot.defer_slot_defer|method"><span>defer_slot_defer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SIMPLE_METHOD'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Defer_Slot.to_slot_tac</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>
</span><span class="keyword1"><span class="command"><span>method_setup</span></span></span><span> </span><span class="entity_def" id="Defer_Slot.defer_slot_dest|method"><span>defer_slot_dest</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SIMPLE_METHOD'</span></span><span> </span><span class="entity"><span>Defer_Slot.dest_slot_tac</span></span><span class="main"><span>)</span></span><span>›</span></span><span>
</span><span class="keyword1"><span class="command"><span>method_setup</span></span></span><span> </span><span class="entity_def" id="Defer_Slot.defer_slot_dest&apos;|method"><span>defer_slot_dest'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SIMPLE_METHOD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Defer_Slot.prefer_slot_tac</span></span><span> </span><span>THEN</span><span> </span><span>FIRSTGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Defer_Slot.dest_slot_tac</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>



</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>