<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Sepref_Translate</title>
</head>


<body>
<div class="head">
<h1>Theory Sepref_Translate</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Translation›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><a href="Sepref_Translate.html"><span>Sepref_Translate</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> 
  </span><a href="Sepref_Monadify.html"><span>Sepref_Monadify</span></a><span> 
  </span><a href="Sepref_Constraints.html"><span>Sepref_Constraints</span></a><span> 
  </span><a href="Sepref_Conc_Post.html"><span>Sepref_Conc_Post</span></a><span>
  </span><a href="Sepref_Frame.html"><span>Sepref_Frame</span></a><span> 
  </span><a href="Sepref_Rules.html"><span>Sepref_Rules</span></a><span> 
  </span><a href="Sepref_Combinator_Setup.html"><span>Sepref_Combinator_Setup</span></a><span>
  </span><span class="quoted"><span>"</span><a href="More_Eisbach_Tools.html"><span>../lib/More_Eisbach_Tools</span></a><span>"</span></span><span>
  </span><span class="quoted"><span>"</span><a href="User_Smashing.html"><span>Lib/User_Smashing</span></a><span>"</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹
  This theory defines the translation phase.
  
  The main functionality of the translation phase is to
  apply refinement rules. Thereby, the linearity information is
  exploited to create copies of parameters that are still required, but
  would be destroyed by a synthesized operation.
  These \emph{frame-based} rules are in the named theorem collection
  </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>text</span></span><span> </span><span class="raw_text"><span>sepref_fr_rules</span></span><span class="antiquote"><span>}</span></span></span><span>, and the collection </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>text</span></span><span> </span><span class="raw_text"><span>sepref_copy_rules</span></span><span class="antiquote"><span>}</span></span></span><span>
  contains rules to handle copying of parameters.

  Apart from the frame-based rules described above, there is also a set of
  rules for combinators, in the collection </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>text</span></span><span> </span><span class="raw_text"><span>sepref_comb_rules</span></span><span class="antiquote"><span>}</span></span></span><span>, 
  where no automatic copying of parameters is applied.

  Moreover, this theory contains 
  \begin{itemize}
    \item A setup for the  basic monad combinators and recursion.
    \item A tool to import parametricity theorems.
    \item Some setup to identify pure refinement relations, i.e., those not
      involving the heap.
    \item A preprocessor that identifies parameters in refinement goals,
      and flags them with a special tag, that allows their correct handling.
  \end{itemize}
›</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Tag to keep track of abstract bindings. 
  Required to recover information for side-condition solving.›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Translate.bind_ref_tag_def|fact"><span class="entity_def" id="Sepref_Translate.bind_ref_tag_def|thm"><span class="entity_def" id="Sepref_Translate.bind_ref_tag_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Translate.bind_ref_tag|const"><span>bind_ref_tag</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>m</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>m</span></span></span></span><span>"</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Tag to keep track of preconditions in assertions›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Translate.vassn_tag_def|fact"><span class="entity_def" id="Sepref_Translate.vassn_tag_def|thm"><span class="entity_def" id="Sepref_Translate.vassn_tag_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Translate.vassn_tag|const"><span>vassn_tag</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Γ</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span class="bound"><span>h</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Γ</span></span></span></span><span> </span><span class="bound"><span>h</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.vassn_tagI|fact"><span class="entity_def" id="Sepref_Translate.vassn_tagI|thm"><span>vassn_tagI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Γ</span></span><span> </span><span class="free"><span>h</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag|const"><span>vassn_tag</span></a><span> </span><span class="free"><span>Γ</span></span><span>"</span></span></span><span> 
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag_def|fact"><span>vassn_tag_def</span></a><span> </span><span class="keyword1"><span class="command"><span>..</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.vassn_dest|fact"><span class="entity_def" id="Sepref_Translate.vassn_dest(3)|thm"><span class="entity_def" id="Sepref_Translate.vassn_dest(2)|thm"><span class="entity_def" id="Sepref_Translate.vassn_dest(1)|thm"><span>vassn_dest</span></span></span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.dest|attribute"><span class="operator"><span>dest</span></span></a><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span>!</span></span></span></span></span></span></span></span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag|const"><span>vassn_tag</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>Γ<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>Γ<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag|const"><span>vassn_tag</span></a><span> </span><span class="free"><span>Γ<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag|const"><span>vassn_tag</span></a><span> </span><span class="free"><span>Γ<span class="hidden">⇩</span><sub>2</sub></span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag|const"><span>vassn_tag</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="free"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.rdomp|const"><span>rdomp</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag|const"><span>vassn_tag</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="free"><span>Φ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag_def|fact"><span>vassn_tag_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.rdomp_def|fact"><span>rdomp_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>abs_def</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj_def|fact"><span>sep_conj_def</span></a><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift_extract_simps|fact"><span>pred_lift_extract_simps</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_1945..1950">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.entails_preI|fact"><span class="entity_def" id="Sepref_Translate.entails_preI|thm"><span>entails_preI</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag|const"><span>vassn_tag</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><span class="free"><span>B</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><span class="free"><span>B</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_1945..1950"><span>assms</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails_def|fact"><span>entails_def</span></a><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag_def|fact"><span>vassn_tag_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.invalid_assn_const|fact"><span class="entity_def" id="Sepref_Translate.invalid_assn_const|thm"><span>invalid_assn_const</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.invalid_assn|const"><span>invalid_assn</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag|const"><span>vassn_tag</span></a><span> </span><span class="free"><span>P</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp_all</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.invalid_assn_def|fact"><span>invalid_assn_def</span></a><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag_def|fact"><span>vassn_tag_def</span></a><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pure_part_def|fact"><span>pure_part_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.vassn_tag_simps|fact"><span class="entity_def" id="Sepref_Translate.vassn_tag_simps(2)|thm"><span class="entity_def" id="Sepref_Translate.vassn_tag_simps(1)|thm"><span>vassn_tag_simps</span></span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag|const"><span>vassn_tag</span></a><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_empty|const"><span>□</span></a></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag|const"><span>vassn_tag</span></a><span> </span><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_true|const"><span>sep_true</span></a><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag_def|fact"><span>vassn_tag_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.hn_refine_vassn_tagI|fact"><span class="entity_def" id="Sepref_Translate.hn_refine_vassn_tagI|thm"><span>hn_refine_vassn_tagI</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag|const"><span>vassn_tag</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Γ'</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Γ'</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>  
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_preI|fact"><span>hn_refine_preI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag_def|fact"><span>vassn_tag_def</span></a><span class="main"><span>)</span></span><span>
  
  
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Translate.GEN_ALGO_def|fact"><span class="entity_def" id="Sepref_Translate.GEN_ALGO_def|thm"><span class="entity_def" id="Sepref_Translate.GEN_ALGO_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Translate.GEN_ALGO|const"><span>GEN_ALGO</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span>"</span></span></span><span>
</span><span class="comment1"><span>― ‹Tag to synthesize </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span class="free"><span>f</span></span></span><span class="antiquote"><span>}</span></span></span><span> with property </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span class="free"><span>Φ</span></span></span><span class="antiquote"><span>}</span></span></span><span>.›</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.is_GEN_ALGO|fact"><span class="entity_def" id="Sepref_Translate.is_GEN_ALGO|thm"><span>is_GEN_ALGO</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.GEN_ALGO|const"><span>GEN_ALGO</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.GEN_ALGO|const"><span>GEN_ALGO</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>Φ</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>named_theorems_rev</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.sepref_gen_algo_rules|attribute"><span class="entity_def" id="Sepref_Translate.sepref_gen_algo_rules|fact"><span>sepref_gen_algo_rules</span></span></span><span> </span><span class="quoted"><span>‹Sepref: Generic algorithm rules›</span></span><span>


</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Tag for side-condition solver to discharge by assumption›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Translate.RPREM_def|fact"><span class="entity_def" id="Sepref_Translate.RPREM_def|thm"><span class="entity_def" id="Sepref_Translate.RPREM_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Translate.RPREM|const"><span>RPREM</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>RPREM</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.RPREMI|fact"><span class="entity_def" id="Sepref_Translate.RPREMI|thm"><span>RPREMI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.RPREM|const"><span>RPREM</span></a><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_2869..2874">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.trans_frame_rule|fact"><span class="entity_def" id="Sepref_Translate.trans_frame_rule|thm"><span>trans_frame_rule</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Frame.html#Sepref_Frame.RECOVER_PURE|const"><span>RECOVER_PURE</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="free"><span>Γ'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag|const"><span>vassn_tag</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>Γ'</span></span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>Γ'</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Γ''</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>Γ</span></span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>Γ''</span></span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.hn_refine_vassn_tagI|fact"><span>hn_refine_vassn_tagI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_frame|fact"><span>hn_refine_frame</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails_refl|fact"><span>entails_refl</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>applyF</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_cons_pre|fact"><span>hn_refine_cons_pre</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>focus</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_2869..2874"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Frame.html#Sepref_Frame.RECOVER_PURE_def|fact"><span>RECOVER_PURE_def</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>assumption</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>solved</span></span></span></span></span><span>
    
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply1</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_2869..2874"><span>assms</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>applyS</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Sepref_Frame.html#Sepref_Frame.RECOVER_PURE_def|fact"><span>RECOVER_PURE_def</span></a><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_2869..2874"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails_eq_iff|fact"><span>entails_eq_iff</span></a><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.entails_preI|fact"><span>entails_preI</span></a><span> </span><a class="entity_ref" href="Sepref_Frame.html#Sepref_Frame.frame_thms|fact"><span>frame_thms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>solved</span></span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_3356..3361">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.recover_pure_cons|fact"><span class="entity_def" id="Sepref_Translate.recover_pure_cons|thm"><span>recover_pure_cons</span></span></span><span class="main"><span>:</span></span><span> </span><span class="comment1"><span>― ‹Used for debugging›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Frame.html#Sepref_Frame.RECOVER_PURE|const"><span>RECOVER_PURE</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="free"><span>Γ'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>Γ'</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Γ''</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>Γ</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>Γ''</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.trans_frame_rule|fact"><span>trans_frame_rule</span></a><span class="main"><span>[</span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> F</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_empty|const"><span>□</span></a></span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_3356..3361"><span>assms</span></a><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>


</span><span class="comment1"><span>― ‹Tag to align structure of refinement assertions for consequence rule›</span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Translate.CPR_TAG_def|fact"><span class="entity_def" id="Sepref_Translate.CPR_TAG_def|thm"><span class="entity_def" id="Sepref_Translate.CPR_TAG_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Translate.CPR_TAG|const"><span>CPR_TAG</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>CPR_TAG</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.CPR_TAG_starI|fact"><span class="entity_def" id="Sepref_Translate.CPR_TAG_starI|thm"><span>CPR_TAG_starI</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.CPR_TAG|const"><span>CPR_TAG</span></a><span> </span><span class="free"><span>P1</span></span><span> </span><span class="free"><span>Q1</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.CPR_TAG|const"><span>CPR_TAG</span></a><span> </span><span class="free"><span>P2</span></span><span> </span><span class="free"><span>Q2</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.CPR_TAG|const"><span>CPR_TAG</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>P1</span></span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span class="free"><span>P2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>Q1</span></span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span class="free"><span>Q2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.CPR_tag_ctxtI|fact"><span class="entity_def" id="Sepref_Translate.CPR_tag_ctxtI|thm"><span>CPR_tag_ctxtI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.CPR_TAG|const"><span>CPR_TAG</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>xi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>R'</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>xi</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.CPR_tag_fallbackI|fact"><span class="entity_def" id="Sepref_Translate.CPR_tag_fallbackI|thm"><span>CPR_tag_fallbackI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.CPR_TAG|const"><span>CPR_TAG</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>Q</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.CPR_TAG_rules|fact"><span class="entity_def" id="Sepref_Translate.CPR_TAG_rules(3)|thm"><span class="entity_def" id="Sepref_Translate.CPR_TAG_rules(2)|thm"><span class="entity_def" id="Sepref_Translate.CPR_TAG_rules(1)|thm"><span>CPR_TAG_rules</span></span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.CPR_TAG_starI|fact"><span>CPR_TAG_starI</span></a><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.CPR_tag_ctxtI|fact"><span>CPR_tag_ctxtI</span></a><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.CPR_tag_fallbackI|fact"><span>CPR_tag_fallbackI</span></a><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_4029..4034">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.cons_pre_rule|fact"><span class="entity_def" id="Sepref_Translate.cons_pre_rule|thm"><span>cons_pre_rule</span></span></span><span class="main"><span>:</span></span><span> </span><span class="comment1"><span>― ‹Consequence rule to be applied if no direct operation rule matches›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.CPR_TAG|const"><span>CPR_TAG</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>P'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><span class="free"><span>P'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>P'</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>m</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>m</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_4029..4034"><span>assms</span></a><span class="main"><span>(</span></span><span>2-</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_cons_pre|fact"><span>hn_refine_cons_pre</span></a><span class="main"><span>)</span></span><span>


</span><span class="comment1"><span>― ‹Bounds-Solver›</span></span><span>

</span><span class="keyword1"><span class="command"><span>named_theorems_rev</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.sepref_bounds_dest|attribute"><span class="entity_def" id="Sepref_Translate.sepref_bounds_dest|fact"><span>sepref_bounds_dest</span></span></span><span> </span><span class="quoted"><span>‹Bounds solver drules›</span></span><span>
</span><span class="keyword1"><span class="command"><span>named_theorems_rev</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.sepref_bounds_simps|attribute"><span class="entity_def" id="Sepref_Translate.sepref_bounds_simps|fact"><span>sepref_bounds_simps</span></span></span><span> </span><span class="quoted"><span>‹Bounds solver simp rules›</span></span><span>

</span><span class="keyword1"><span class="command"><span>ML</span></span></span><span> </span><span class="quoted"><span>‹

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Sepref_Translate</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cfg_debug</span></span><span> </span><span class="main"><span>=</span></span><span> 
    </span><span class="entity"><span>Attrib.setup_config_bool</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> </span><span class="entity_def" id="Sepref_Translate.sepref_debug_translate|attribute"><span>sepref_debug_translate</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>false</span><span class="main"><span>)</span></span><span>
  
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dbg_msg_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sepref_Debugging.dbg_msg_tac</span></span><span> </span><span class="entity"><span>cfg_debug</span></span><span>  

  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>check_side_conds</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Sepref_Basic</span><span>
    </span><span class="comment1"><span>(* Check that term is no binary operator on assertions *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_atomic</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>typ</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>⇒</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>⇒</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span>"</span></span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_atomic</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_atomic_star_list</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Expected atoms separated by star"</span></span><span class="main"><span>,</span></span><span>forall</span><span> </span><span class="entity"><span>is_atomic</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>strip_star</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_trueprop</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Expected Trueprop conclusion"</span></span><span class="main"><span>,</span></span><span>can</span><span> </span><span class="entity"><span>HOLogic.dest_Trueprop</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>assert</span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>msg</span></span><span class="main"><span>,</span></span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span class="main"><span>(</span></span><span class="entity"><span>msg</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>t'</span></span><span class="main"><span>,</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>chk_prem</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>assert</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>assert</span></span><span> </span><span class="entity"><span>t</span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>chk</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.MERGE|const"><span>MERGE</span></a><span> </span><span class="var"><span>?l</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="var"><span>?r</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="var"><span>?m</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="entity"><span>assert</span></span><span> </span><span class="entity"><span>is_atomic_star_list</span></span><span> </span><span class="entity"><span>l</span></span><span class="main"><span>;</span></span><span>
            </span><span class="entity"><span>assert</span></span><span> </span><span class="entity"><span>is_atomic_star_list</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>;</span></span><span>
            </span><span class="entity"><span>assert</span></span><span> </span><span class="entity"><span>is_atomic_star_list</span></span><span> </span><span class="entity"><span>m</span></span><span>
          </span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>chk</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><span class="var"><span>?l</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><span class="var"><span>?r</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="entity"><span>assert</span></span><span> </span><span class="entity"><span>is_atomic_star_list</span></span><span> </span><span class="entity"><span>l</span></span><span class="main"><span>;</span></span><span>
            </span><span class="entity"><span>assert</span></span><span> </span><span class="entity"><span>is_atomic_star_list</span></span><span> </span><span class="entity"><span>r</span></span><span>
          </span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>chk</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>  

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.strip_assums_concl</span><span> </span><span class="entity"><span>t</span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="entity"><span>assert</span></span><span> </span><span class="entity"><span>is_trueprop</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>;</span></span><span>
      </span><span class="entity"><span>chk</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.dest_Trueprop</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>    

  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>map</span><span> </span><span class="entity"><span>chk_prem</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.prems_of</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>sepref_comb_rules</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Sorted_Thms</span></span><span> </span><span class="main"><span>(</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> "</span><span class="entity_def" id="Sepref_Translate.sepref_comb_rules|attribute"><span class="entity_def" id="Sepref_Translate.sepref_comb_rules|fact"><span>sepref_comb_rules</span></span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>description</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Sepref: Combinator rules"</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sort</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>K</span><span> </span><span>I</span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>transform</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>check_side_conds</span></span><span> </span><span class="entity"><span>thm</span></span><span>  
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>sepref_fr_rules</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Sorted_Thms</span></span><span> </span><span class="main"><span>(</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> "</span><span class="entity_def" id="Sepref_Translate.sepref_fr_rules|attribute"><span class="entity_def" id="Sepref_Translate.sepref_fr_rules|fact"><span>sepref_fr_rules</span></span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>description</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Sepref: Frame-based rules"</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sort</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>K</span><span> </span><span>I</span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>transform</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Context.proof_of</span><span> </span><span class="entity"><span>context</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sepref_Rules.ensure_hnr</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Conv.fconv_rule</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sepref_Frame.align_rl_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>check_side_conds</span></span><span> </span><span class="entity"><span>thm</span></span><span>  
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sepref_Rules.analyze_hnr</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> 
          </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>(</span></span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"hnr-analysis failed"</span></span><span class="main"><span>,</span></span><span> 
              </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>,</span></span><span> 
              </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> 
              </span><span>Thm.pretty_thm</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Pretty.string_of</span><span> </span><span>|&gt;</span><span> </span><span>error</span><span>  
        </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>ana</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sepref_Combinator_Setup.is_valid_abs_op</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ahead </span><span class="entity"><span>ana</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>
                </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"Invalid abstract head:"</span></span><span class="main"><span>,</span></span><span>
                </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>
                </span><span>Pretty.enclose</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="main"><span>[</span></span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ahead </span><span class="entity"><span>ana</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>
                </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"in thm"</span></span><span class="main"><span>,</span></span><span>
                </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>
                </span><span>Thm.pretty_thm</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span>                
              </span><span class="main"><span>]</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Pretty.string_of</span><span> </span><span>|&gt;</span><span> </span><span>error</span><span>  
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="main"><span>)</span></span><span>

  </span><span class="comment1"><span>(***** Side Condition Solving *)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
    </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Sepref_Basic</span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
  
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>side_unfold_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="comment1"><span>(*val ctxt = put_simpset HOL_basic_ss ctxt
        addsimps sepref_prep_side_simps.get ctxt*)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span>CONVERSION</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Id_Op.unprotect_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span>THEN'</span><span> </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold0_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.bind_ref_tag_def|fact"><span>bind_ref_tag_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
      </span><span>THEN'</span><span> </span><span>TRY</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span class="comment1"><span>(*THEN' asm_full_simp_tac ctxt*)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  
    </span><span class="comment1"><span>(* TODO: Not accessible as single ML function? *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>linarith_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span class="entity"><span>Method.insert_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>rev</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">named_theorems</span><span class="hidden">&gt;</span></span></span><span>‹arith›</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>THEN'</span><span> </span><span class="entity"><span>Lin_Arith.tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>bounds_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
        </span><span class="entity"><span>addSDs</span></span><span> </span><span class="entity"><span>Named_Theorems_Rev.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems_rev</span></span><span> sepref_bounds_dest</span><span class="antiquote"><span>}</span></span></span><span>
        </span><span>addsimps</span><span> </span><span class="entity"><span>Named_Theorems_Rev.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems_rev</span></span><span> sepref_bounds_simps</span><span class="antiquote"><span>}</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="entity"><span>TRADE</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> 
        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>auto_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
        </span><span>THEN_ALL_NEW</span><span> </span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>linarith_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>side_fallback_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span class="entity"><span>side_unfold_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
      </span><span>THEN'</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>TRADE</span></span><span> </span><span class="main"><span>(</span></span><span>SELECT_GOAL</span><span> </span><span>o</span><span> </span><span class="entity"><span>auto_tac</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span>THEN_ALL_NEW</span><span> </span><span class="main"><span>(</span></span><span>TRY</span><span> </span><span>o</span><span> </span><span>SOLVED'</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bounds_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span>
  
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>side_frame_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sepref_Frame.frame_tac</span></span><span> </span><span class="entity"><span>side_fallback_tac</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>side_merge_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sepref_Frame.merge_tac</span></span><span> </span><span class="entity"><span>side_fallback_tac</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>side_free_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sepref_Frame.free_tac</span></span><span> </span><span class="entity"><span>side_fallback_tac</span></span><span>
    
    
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>side_constraint_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sepref_Constraints.constraint_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pf_mono_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Subgoal.FOCUS_PREMS</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>CHANGED</span><span> </span><span class="main"><span>(</span></span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Partial_Function.mono_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>side_mono_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>side_unfold_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>TRADE</span></span><span> </span><span class="entity"><span>pf_mono_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
  
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>side_gen_algo_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span class="entity"><span>side_unfold_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span>THEN'</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Theorems_Rev.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems_rev</span></span><span> sepref_gen_algo_rules</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span>
  
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>side_pref_def_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span class="entity"><span>side_unfold_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN'</span><span> 
      </span><span class="entity"><span>TRADE</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> 
        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Fix_Rel.html#Autoref_Fix_Rel.PREFER_tagI|fact"><span>PREFER_tagI</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Fix_Rel.html#Autoref_Fix_Rel.DEFER_tagI|fact"><span>DEFER_tagI</span></a><span class="antiquote"><span>}</span></span></span></span><span> 
        </span><span>THEN'</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sepref_Debugging.warning_tac'</span></span><span> </span><span class="inner_quoted"><span>"Obsolete PREFER/DEFER side condition"</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>Tagged_Solver.solve_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>


    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>side_rprem_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.RPREMI|fact"><span>RPREMI</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>Refine_Util.rprems_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span>THEN'</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>smash_new_rule</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

    </span><span class="comment1"><span>(*
      Solve side condition, or invoke hnr_tac on hn_refine goal.

      In debug mode, side-condition solvers are allowed to not completely solve 
      the side condition, but must change the goal.
    *)</span></span><span>  
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>side_cond_dispatch_tac</span></span><span> </span><span class="entity"><span>dbg</span></span><span> </span><span class="entity"><span>hnr_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>MK</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>dbg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>CHANGED</span><span> </span><span>o</span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>SOLVED'</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t_merge</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MK</span></span><span> </span><span class="entity"><span>side_merge_tac</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t_frame</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MK</span></span><span> </span><span class="entity"><span>side_frame_tac</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t_free</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MK</span></span><span> </span><span class="entity"><span>side_free_tac</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t_indep</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MK</span></span><span> </span><span class="entity"><span>Indep_Vars.indep_tac</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t_constraint</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MK</span></span><span> </span><span class="entity"><span>side_constraint_tac</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t_mono</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MK</span></span><span> </span><span class="entity"><span>side_mono_tac</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t_pref_def</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MK</span></span><span> </span><span class="entity"><span>side_pref_def_tac</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t_rprem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MK</span></span><span> </span><span class="entity"><span>side_rprem_tac</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t_gen_algo</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>side_gen_algo_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t_cp_cond</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MK</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>apply_method_noargs</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>method</span></span><span> </span><a class="entity_ref" href="Sepref_Conc_Post.html#Sepref_Conc_Post.cp_solve_cond|method"><span>cp_solve_cond</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t_cp_simplify</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MK</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>apply_method_noargs</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>method</span></span><span> </span><a class="entity_ref" href="Sepref_Conc_Post.html#Sepref_Conc_Post.cp_simplify|method"><span>cp_simplify</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t_fallback</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MK</span></span><span> </span><span class="entity"><span>side_fallback_tac</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="entity"><span>WITH_concl</span></span><span> 
        </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="var"><span>?t</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
              </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.MERGE|const"><span>MERGE</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t_merge</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.MK_FREE|const"><span>MK_FREE</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t_free</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>_</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t_frame</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Indep_Vars.html#Indep_Vars.INDEP|const"><span>INDEP</span></a><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t_indep</span></span><span>     </span><span class="comment1"><span>(* TODO: Get rid of this!? *)</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT|const"><span>CONSTRAINT</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t_constraint</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.monotone|const"><span>monotone</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t_mono</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.monotone|const"><span>monotone</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t_mono</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Fix_Rel.html#Autoref_Fix_Rel.PREFER_tag|const"><span>PREFER_tag</span></a><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t_pref_def</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Fix_Rel.html#Autoref_Fix_Rel.DEFER_tag|const"><span>DEFER_tag</span></a><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t_pref_def</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.RPREM|const"><span>RPREM</span></a><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t_rprem</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.GEN_ALGO|const"><span>GEN_ALGO</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t_gen_algo</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Conc_Post.html#Sepref_Conc_Post.CP_cond|const"><span>CP_cond</span></a><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t_cp_cond</span></span><span>           
            </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Conc_Post.html#Sepref_Conc_Post.CP_simplify|const"><span>CP_simplify</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t_cp_simplify</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>hnr_tac</span></span><span> 
            </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t_fallback</span></span><span>
          </span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>K</span><span> </span><span>no_tac</span><span>  
      </span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>  

  </span><span class="comment1"><span>(***** Main Translation Tactic *)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
    </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Sepref_Basic</span><span> </span><span>STactical</span><span>

    </span><span class="comment1"><span>(* ATTENTION: Beware of evaluation order, as some initialization operations on
      context are expensive, and should not be repeated during proof search! *)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>


    </span><span class="comment1"><span>(* Translate combinator, yields new translation goals and side conditions
      which must be processed in order. *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>trans_comb_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>comb_rl_net</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sepref_comb_rules.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Tactic.build_net</span><span>

    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span>DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span>resolve_from_net_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>comb_rl_net</span></span><span> 
        </span><span class="comment1"><span>(*ORELSE' (
          Sepref_Frame.norm_goal_pre_tac ctxt 
          THEN' resolve_from_net_tac ctxt comb_rl_net
        )*)</span></span><span>
      </span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="comment1"><span>(* Translate operator. Only succeeds if it finds an operator rule such that
      all resulting side conditions can be solved. Takes the first such rule.

      In debug mode, it returns a sequence of the unsolved side conditions of
      each applicable rule.
    *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_trans_op_tac</span></span><span> </span><span class="entity"><span>dbg</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fr_rl_net</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sepref_fr_rules.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>|&gt;</span><span> </span><span>Tactic.build_net</span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fr_rl_tac</span></span><span> </span><span class="main"><span>=</span></span><span> 
        </span><span>resolve_from_net_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>fr_rl_net</span></span><span> </span><span class="comment1"><span>(* Try direct match *)</span></span><span>
        </span><span>ORELSE'</span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>Sepref_Frame.norm_goal_pre_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="comment1"><span>(* Normalize precondition *)</span></span><span> 
          </span><span>THEN'</span><span> </span><span class="main"><span>(</span></span><span>
            </span><span>resolve_from_net_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>fr_rl_net</span></span><span>
            </span><span>ORELSE'</span><span> </span><span class="main"><span>(</span></span><span>
              </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.cons_pre_rule|fact"><span>cons_pre_rule</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="comment1"><span>(* Finally, generate a frame condition *)</span></span><span>
              </span><span class="entity"><span>THEN_ALL_NEW_LIST</span></span><span> </span><span class="main"><span>[</span></span><span>
                </span><span>SOLVED'</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>REPEAT_ALL_NEW_FWD</span></span><span> </span><span class="main"><span>(</span></span><span>DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.CPR_TAG_rules|fact"><span>CPR_TAG_rules</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>K</span><span> </span><span>all_tac</span><span class="main"><span>,</span></span><span>  </span><span class="comment1"><span>(* Frame remains unchanged as first goal, even if fr_rl creates side-conditions *)</span></span><span>
                </span><span>resolve_from_net_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>fr_rl_net</span></span><span>
              </span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span>  
        </span><span class="main"><span>)</span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>side_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>REPEAT_ALL_NEW_FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>side_cond_dispatch_tac</span></span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>no_tac</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fr_tac</span></span><span> </span><span class="main"><span>=</span></span><span> 
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>dbg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="comment1"><span>(* Present all possibilities with (partially resolved) side conditions *)</span></span><span>
          </span><span class="entity"><span>fr_rl_tac</span></span><span> </span><span class="entity"><span>THEN_ALL_NEW_FWD</span></span><span> </span><span class="main"><span>(</span></span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>side_tac</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="comment1"><span>(* Choose first rule that solves all side conditions *)</span></span><span>
          </span><span>DETERM</span><span> </span><span>o</span><span> </span><span>SOLVED'</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fr_rl_tac</span></span><span> </span><span class="entity"><span>THEN_ALL_NEW_FWD</span></span><span> </span><span class="main"><span>(</span></span><span>SOLVED'</span><span> </span><span class="entity"><span>side_tac</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="entity"><span>PHASES'</span></span><span> </span><span class="main"><span>[</span></span><span>
        </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Align goal"</span></span><span class="main"><span>,</span></span><span class="entity"><span>Sepref_Frame.align_goal_tac</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Frame rule"</span></span><span class="main"><span>,</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.trans_frame_rule|fact"><span>trans_frame_rule</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="comment1"><span>(* RECOVER_PURE goal *)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Recover pure"</span></span><span class="main"><span>,</span></span><span class="entity"><span>Sepref_Frame.recover_pure_tac</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="comment1"><span>(* hn-refine goal with stripped precondition *)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Apply rule"</span></span><span class="main"><span>,</span></span><span>K</span><span> </span><span class="entity"><span>fr_tac</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>flag_phases_ctrl</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>dbg</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="comment1"><span>(* Translate combinator, operator, or side condition. *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_trans_step_tac</span></span><span> </span><span class="entity"><span>dbg</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>side_cond_dispatch_tac</span></span><span> </span><span class="entity"><span>dbg</span></span><span>
      </span><span class="main"><span>(</span></span><span> </span><span class="entity"><span>Sepref_Frame.norm_goal_pre_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
        </span><span>THEN'</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>trans_comb_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>ORELSE'</span><span> </span><span class="entity"><span>gen_trans_op_tac</span></span><span> </span><span class="entity"><span>dbg</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>ctxt</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>trans_step_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_trans_step_tac</span></span><span> </span><span>false</span><span>  
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>trans_step_keep_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_trans_step_tac</span></span><span> </span><span>true</span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_trans_tac</span></span><span> </span><span class="entity"><span>dbg</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span class="entity"><span>PHASES'</span></span><span> </span><span class="main"><span>[</span></span><span>
        </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Translation steps"</span></span><span class="main"><span>,</span></span><span class="entity"><span>REPEAT_DETERM'</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>trans_step_tac</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Constraint solving"</span></span><span class="main"><span>,</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Sepref_Constraints.process_constraint_slot</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>flag_phases_ctrl</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>dbg</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>trans_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_trans_tac</span></span><span> </span><span>false</span><span>  
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>trans_keep_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_trans_tac</span></span><span> </span><span>true</span><span>


  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>setup</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>I</span><span>
    </span><span>#&gt;</span><span> </span><span class="entity"><span>sepref_fr_rules.setup</span></span><span>
    </span><span>#&gt;</span><span> </span><span class="entity"><span>sepref_comb_rules.setup</span></span><span>


</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

›</span></span><span>

</span><span class="keyword1"><span class="command"><span>setup</span></span></span><span> </span><span class="entity"><span>Sepref_Translate.setup</span></span><span>

</span><span class="keyword1"><span class="command"><span>method_setup</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.sepref_bounds|method"><span>sepref_bounds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span class="entity"><span>SIMPLE_METHOD_NOPARAM'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sepref_Translate.bounds_tac</span></span><span class="main"><span>)</span></span><span>›</span></span><span>


</span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Basic Setup›</span></span></span><span>
              
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.hn_pass|fact"><span class="entity_def" id="Sepref_Translate.hn_pass|thm"><span>hn_pass</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.sepref_fr_rules|attribute"><span class="operator"><span>sepref_fr_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>x'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="free"><span>x'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_invalid|const"><span>hn_invalid</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>x'</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>x'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.PASS|const"><span>PASS</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/eqsubst.ML.html#HOL.subst|method"><span class="operator"><span>subst</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.invalidate_clone&apos;|fact"><span>invalidate_clone'</span></a><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg|method"><span class="operator"><span>vcg</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="comment1"><span>(*lemma hn_pass_pure[sepref_fr_rules]:
  shows "hn_refine (hn_val P x x') (return x') (hn_val P x x') (pure P) (PASS$x)"
  by rule (sep_auto simp: hn_ctxt_def pure_def)
*)</span></span><span>

</span><span class="keyword1"><span class="command"><span>thm</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hnr_bind|fact"><span>hnr_bind</span></a><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_15229..15234">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.hn_bind|fact"><span class="entity_def" id="Sepref_Translate.hn_bind|thm"><span>hn_bind</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.sepref_comb_rules|attribute"><span class="operator"><span>sepref_comb_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>D1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="free"><span>m'</span></span><span> </span><span class="free"><span>Γ1</span></span><span> </span><span class="free"><span>Rh</span></span><span> </span><span class="free"><span>CP<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="free"><span>m</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>D2</span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.bind_ref_tag|const"><span>bind_ref_tag</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Conc_Post.html#Sepref_Conc_Post.CP_assm|const"><span>CP_assm</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span>
      </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rh</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>Γ1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>Γ2</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP<span class="hidden">⇩</span><sub>2</sub></span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>IMP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>Γ2</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>Γ'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.MK_FREE|const"><span>MK_FREE</span></a><span> </span><span class="free"><span>Rx</span></span><span> </span><span class="free"><span>fr</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>←</span></span><span class="free"><span>m'</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><span>←</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>fr</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>r</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>Γ'</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Conc_Post.html#Sepref_Conc_Post.CP_SEQ|const"><span>CP_SEQ</span></a><span> </span><span class="free"><span>CP<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="free"><span>CP<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>m</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_15229..15234"><span>assms</span></a><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP_def|fact"><span>APP_def</span></a><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PROTECT2_def|fact"><span>PROTECT2_def</span></a><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.bind_ref_tag_def|fact"><span>bind_ref_tag_def</span></a><span> </span><a class="entity_ref" href="Sepref_Conc_Post.html#Sepref_Conc_Post.CP_defs|fact"><span class="dynamic"><span class="dynamic"><span>CP_defs</span></span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hnr_bind|fact"><span>hnr_bind</span></a><span class="main"><span>)</span></span><span>


</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.hn_RECT&apos;|fact"><span class="entity_def" id="Sepref_Translate.hn_RECT&apos;|thm"><span>hn_RECT'</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.sepref_comb_rules|attribute"><span class="operator"><span>sepref_comb_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Indep_Vars.html#Indep_Vars.INDEP|const"><span>INDEP</span></a><span> </span><span class="free"><span>Ry</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Indep_Vars.html#Indep_Vars.INDEP|const"><span>INDEP</span></a><span> </span><span class="free"><span>Rx</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Indep_Vars.html#Indep_Vars.INDEP|const"><span>INDEP</span></a><span> </span><span class="free"><span>Rx'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_15834..15836">FR</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx</span></span><span> </span><span class="free"><span>ax</span></span><span> </span><span class="free"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_15876..15877">S</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>cf</span></span><span> </span><span class="bound"><span>af</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span>
    </span><span class="main"><span>⋀</span></span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>cf</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx'</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>Ry</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.RCALL|const"><span>RCALL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>af</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>ax</span></span><span class="main"><span>)</span></span><span class="main"><span>⟧</span></span><span> 
    </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>cB</span></span><span> </span><span class="bound"><span>cf</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>F'</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>Ry</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="free"><span>aB</span></span><span> </span><span class="bound"><span>af</span></span><span> </span><span class="bound"><span>ax</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_16116..16119">FR'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F'</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx'</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>M</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.M_mono_body|const"><span>M_mono_body</span></a><span> </span><span class="free"><span>cB</span></span><span>"</span></span></span><span>
  </span><span class="comment1"><span>(*assumes PREC[unfolded CONSTRAINT_def]: "CONSTRAINT precise Ry"*)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> 
    </span><span class="main"><span>(</span></span><span class="free"><span>P</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="MMonad.html#MMonad.REC|const"><span>MMonad.REC</span></a><span> </span><span class="free"><span>cB</span></span><span> </span><span class="free"><span>px</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx'</span></span><span> </span><span class="free"><span>ax</span></span><span> </span><span class="free"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>Ry</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>px</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/RefineG_Recursion.html#RefineG_Recursion.RECT|const"><span>RECT</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>D</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="free"><span>aB</span></span><span> </span><span class="bound"><span>D</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>ax</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP_def|fact"><span>APP_def</span></a><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PROTECT2_def|fact"><span>PROTECT2_def</span></a><span> 
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_cons_pre|fact"><span>hn_refine_cons_pre</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_15834..15836"><span>FR</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hnr_RECT|fact"><span>hnr_RECT</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_cons_post|fact"><span>hn_refine_cons_post</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="Sepref_Translate.html#offset_16116..16119"><span>FR'</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_cons_cp_only|fact"><span>hn_refine_cons_cp_only</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_15876..15877"><span>S</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.RCALL_def|fact"><span>RCALL_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP_def|fact"><span>APP_def</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_cons_cp_only|fact"><span>hn_refine_cons_cp_only</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>assumption</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>assumption</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>fact</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_16721..16726">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.hn_RCALL|fact"><span class="entity_def" id="Sepref_Translate.hn_RCALL|thm"><span>hn_RCALL</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.sepref_comb_rules|attribute"><span class="operator"><span>sepref_comb_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.RPREM|const"><span>RPREM</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>P'</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Q'</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.RCALL|const"><span>RCALL</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span> </span><span class="free"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><span class="free"><span>P'</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>Q'</span></span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.RCALL|const"><span>RCALL</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span> </span><span class="free"><span>b</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_16721..16726"><span>assms</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_frame|fact"><span>hn_refine_frame</span></a><span class="main"><span>[</span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> m</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.RCALL|const"><span>RCALL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>a</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>b</span></span><span>"</span></span></span><span class="main"><span>]</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

  
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Translate.RECT_cp_annot_def|fact"><span class="entity_def" id="Sepref_Translate.RECT_cp_annot_def|thm"><span class="entity_def" id="Sepref_Translate.RECT_cp_annot_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Translate.RECT_cp_annot|const"><span>RECT_cp_annot</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'ai</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'bi</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span>"</span></span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>RECT_cp_annot</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>CP</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/RefineG_Recursion.html#RefineG_Recursion.RECT|const"><span>RECT</span></a><span>"</span></span></span><span>    

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.RECT_cp_annot|fact"><span class="entity_def" id="Sepref_Translate.RECT_cp_annot|thm"><span>RECT_cp_annot</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/RefineG_Recursion.html#RefineG_Recursion.RECT|const"><span>RECT</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.RECT_cp_annot|const"><span>RECT_cp_annot</span></a><span> </span><span class="free"><span>CP</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.RECT_cp_annot_def|fact"><span>RECT_cp_annot_def</span></a><span> </span><span class="keyword1"><span class="command"><span>..</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.RECT_cp_annot_pat|fact"><span class="entity_def" id="Sepref_Translate.RECT_cp_annot_pat|thm"><span>RECT_cp_annot_pat</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.def_pat_rules|attribute"><span class="operator"><span>def_pat_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.RECT_cp_annot|const"><span>RECT_cp_annot</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>CP</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.UNPROTECT|const"><span>UNPROTECT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.RECT_cp_annot|const"><span>RECT_cp_annot</span></a><span> </span><span class="free"><span>CP</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.RECT_cp_annot_arity|fact"><span class="entity_def" id="Sepref_Translate.RECT_cp_annot_arity|thm"><span>RECT_cp_annot_arity</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.sepref_monadify_arity|attribute"><span class="operator"><span>sepref_monadify_arity</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.RECT_cp_annot|const"><span>RECT_cp_annot</span></a><span> </span><span class="free"><span>CP</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>B</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.RECT_cp_annot|const"><span>RECT_cp_annot</span></a><span> </span><span class="free"><span>CP</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>D</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="bound"><span>B</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.RCALL|const"><span>RCALL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>D</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span>"</span></span></span><span> 
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp_all</span></span><span class="main"><span>)</span></span><span>


</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.RECT_cp_annot_comb|fact"><span class="entity_def" id="Sepref_Translate.RECT_cp_annot_comb|thm"><span>RECT_cp_annot_comb</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.sepref_monadify_comb|attribute"><span class="operator"><span>sepref_monadify_comb</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>B</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.RECT_cp_annot|const"><span>RECT_cp_annot</span></a><span> </span><span class="free"><span>CP</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>B</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.RECT_cp_annot|const"><span>RECT_cp_annot</span></a><span> </span><span class="free"><span>CP</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>B</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp_all</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.RECT_cp_annot_id|fact"><span class="entity_def" id="Sepref_Translate.RECT_cp_annot_id|thm"><span>RECT_cp_annot_id</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.id_rules|attribute"><span class="operator"><span>id_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.RECT_cp_annot|const"><span>RECT_cp_annot</span></a><span> </span><span class="free"><span>CP</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.intf_type|const"><span>::<span class="hidden">⇩</span><sub>i</sub></span></a></span><span> </span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'c</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'d</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'c</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'d</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'c</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'d</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  
  
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.hn_RECT_cp_annot|fact"><span class="entity_def" id="Sepref_Translate.hn_RECT_cp_annot|thm"><span>hn_RECT_cp_annot</span></span></span><span class="comment1"><span>(*[sepref_comb_rules]*)</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Indep_Vars.html#Indep_Vars.INDEP|const"><span>INDEP</span></a><span> </span><span class="free"><span>Ry</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Indep_Vars.html#Indep_Vars.INDEP|const"><span>INDEP</span></a><span> </span><span class="free"><span>Rx</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Indep_Vars.html#Indep_Vars.INDEP|const"><span>INDEP</span></a><span> </span><span class="free"><span>Rx'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_17877..17879">FR</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx</span></span><span> </span><span class="free"><span>ax</span></span><span> </span><span class="free"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_17919..17920">S</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>cf</span></span><span> </span><span class="bound"><span>af</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span>
    </span><span class="main"><span>⋀</span></span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>cf</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx'</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>Ry</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.RCALL|const"><span>RCALL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>af</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>ax</span></span><span class="main"><span>)</span></span><span class="main"><span>⟧</span></span><span> 
    </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>cB</span></span><span> </span><span class="bound"><span>cf</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>F'</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>Ry</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP'</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="free"><span>aB</span></span><span> </span><span class="bound"><span>af</span></span><span> </span><span class="bound"><span>ax</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_18157..18159">CP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>px</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Sepref_Conc_Post.html#Sepref_Conc_Post.CP_assm|const"><span>CP_assm</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP'</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Conc_Post.html#Sepref_Conc_Post.CP_cond|const"><span>CP_cond</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>        
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_18227..18230">FR'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F'</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx'</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>M</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.M_mono_body|const"><span>M_mono_body</span></a><span> </span><span class="free"><span>cB</span></span><span>"</span></span></span><span>
  </span><span class="comment1"><span>(*assumes PREC[unfolded CONSTRAINT_def]: "CONSTRAINT precise Ry"*)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> 
    </span><span class="main"><span>(</span></span><span class="free"><span>P</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="MMonad.html#MMonad.REC|const"><span>MMonad.REC</span></a><span> </span><span class="free"><span>cB</span></span><span> </span><span class="free"><span>px</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx'</span></span><span> </span><span class="free"><span>ax</span></span><span> </span><span class="free"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>Ry</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>px</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.RECT_cp_annot|const"><span>RECT_cp_annot</span></a><span> </span><span class="free"><span>CP</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>D</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="free"><span>aB</span></span><span> </span><span class="bound"><span>D</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>ax</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP_def|fact"><span>APP_def</span></a><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PROTECT2_def|fact"><span>PROTECT2_def</span></a><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.RECT_cp_annot_def|fact"><span>RECT_cp_annot_def</span></a><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST_def|fact"><span>PR_CONST_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_cons_pre|fact"><span>hn_refine_cons_pre</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_17877..17879"><span>FR</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>thm</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hnr_RECT|fact"><span>hnr_RECT</span></a><span>
  
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hnr_RECT|fact"><span>hnr_RECT</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_cons_post|fact"><span>hn_refine_cons_post</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="Sepref_Translate.html#offset_18227..18230"><span>FR'</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_cons_cp_only|fact"><span>hn_refine_cons_cp_only</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_17919..17920"><span>S</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.RCALL_def|fact"><span>RCALL_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP_def|fact"><span>APP_def</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_cons_cp_only|fact"><span>hn_refine_cons_cp_only</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>applyS</span></span></span></span></span><span> </span><span class="operator"><span>assumption</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>applyS</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_18157..18159"><span>CP</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Conc_Post.html#Sepref_Conc_Post.CP_defs|fact"><span class="dynamic"><span class="dynamic"><span>CP_defs</span></span></span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>applyS</span></span></span></span></span><span> </span><span class="operator"><span>fact</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_18932..18937">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.hn_RECT_cp_annot_noframe|fact"><span class="entity_def" id="Sepref_Translate.hn_RECT_cp_annot_noframe|thm"><span>hn_RECT_cp_annot_noframe</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Indep_Vars.html#Indep_Vars.INDEP|const"><span>INDEP</span></a><span> </span><span class="free"><span>Ry</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Indep_Vars.html#Indep_Vars.INDEP|const"><span>INDEP</span></a><span> </span><span class="free"><span>Rx</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Indep_Vars.html#Indep_Vars.INDEP|const"><span>INDEP</span></a><span> </span><span class="free"><span>Rx'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_19018..19020">FR</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx</span></span><span> </span><span class="free"><span>ax</span></span><span> </span><span class="free"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_19060..19061">S</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>cf</span></span><span> </span><span class="bound"><span>af</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span>
    </span><span class="main"><span>⋀</span></span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>cf</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx'</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>Ry</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.RCALL|const"><span>RCALL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>af</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>ax</span></span><span class="main"><span>)</span></span><span class="main"><span>⟧</span></span><span> 
    </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>cB</span></span><span> </span><span class="bound"><span>cf</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>F'</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>Ry</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP'</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="free"><span>aB</span></span><span> </span><span class="bound"><span>af</span></span><span> </span><span class="bound"><span>ax</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>CP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>px</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Sepref_Conc_Post.html#Sepref_Conc_Post.CP_assm|const"><span>CP_assm</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP'</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Conc_Post.html#Sepref_Conc_Post.CP_cond|const"><span>CP_cond</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>        
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>FR'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F'</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx'</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>M</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.M_mono_body|const"><span>M_mono_body</span></a><span> </span><span class="free"><span>cB</span></span><span>"</span></span></span><span>
  </span><span class="comment1"><span>(*assumes PREC[unfolded CONSTRAINT_def]: "CONSTRAINT precise Ry"*)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> 
    </span><span class="main"><span>(</span></span><span class="free"><span>P</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="MMonad.html#MMonad.REC|const"><span>MMonad.REC</span></a><span> </span><span class="free"><span>cB</span></span><span> </span><span class="free"><span>px</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx'</span></span><span> </span><span class="free"><span>ax</span></span><span> </span><span class="free"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>Ry</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>px</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.RECT_cp_annot|const"><span>RECT_cp_annot</span></a><span> </span><span class="free"><span>CP</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>D</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="free"><span>aB</span></span><span> </span><span class="bound"><span>D</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>ax</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
        
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_cons_post|fact"><span>hn_refine_cons_post</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_frame|fact"><span>hn_refine_frame</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> F</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="free"><span>F</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>    
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.hn_RECT_cp_annot|fact"><span>hn_RECT_cp_annot</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> F</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_empty|const"><span>□</span></a></span></span><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_18932..18937"><span>assms</span></a><span class="main"><span class="main"><span class="main"><span>(</span></span></span></span><span>1</span><span class="main"><span class="main"><span class="main"><span>,</span></span></span></span><span>2</span><span class="main"><span class="main"><span class="main"><span>,</span></span></span></span><span>3</span><span class="main"><span class="main"><span class="main"><span>)</span></span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>  
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>applyS</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails_refl|fact"><span>entails_refl</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>focus</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_19060..19061"><span>S</span></a><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>solved</span></span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>applyS</span></span></span></span></span><span> </span><span class="operator"><span>fact</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>focus</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>fact</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>solved</span></span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>applyS</span></span></span></span></span><span> </span><span class="operator"><span>fact</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>focus</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_19018..19020"><span>FR</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>solved</span></span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>applyS</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
  
  
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.hn_RECT&apos;_cp|fact"><span class="entity_def" id="Sepref_Translate.hn_RECT&apos;_cp|thm"><span>hn_RECT'_cp</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.sepref_comb_rules|attribute"><span class="operator"><span>sepref_comb_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Indep_Vars.html#Indep_Vars.INDEP|const"><span>INDEP</span></a><span> </span><span class="free"><span>Ry</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Indep_Vars.html#Indep_Vars.INDEP|const"><span>INDEP</span></a><span> </span><span class="free"><span>Rx</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Indep_Vars.html#Indep_Vars.INDEP|const"><span>INDEP</span></a><span> </span><span class="free"><span>Rx'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_20132..20134">FR</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx</span></span><span> </span><span class="free"><span>ax</span></span><span> </span><span class="free"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_20174..20175">S</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>cf</span></span><span> </span><span class="bound"><span>af</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span>
    </span><span class="main"><span>⋀</span></span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>cf</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx'</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>Ry</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.RCALL|const"><span>RCALL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>af</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>ax</span></span><span class="main"><span>)</span></span><span class="main"><span>⟧</span></span><span> 
    </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>cB</span></span><span> </span><span class="bound"><span>cf</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>F'</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>Ry</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP'</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="free"><span>aB</span></span><span> </span><span class="bound"><span>af</span></span><span> </span><span class="bound"><span>ax</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_20412..20414">CP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>px</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Sepref_Conc_Post.html#Sepref_Conc_Post.CP_assm|const"><span>CP_assm</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP'</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Conc_Post.html#Sepref_Conc_Post.CP_cond|const"><span>CP_cond</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>        
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_20482..20485">FR'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F'</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx'</span></span><span> </span><span class="bound"><span>ax</span></span><span> </span><span class="bound"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>M</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.M_mono_body|const"><span>M_mono_body</span></a><span> </span><span class="free"><span>cB</span></span><span>"</span></span></span><span>
  </span><span class="comment1"><span>(*assumes PREC[unfolded CONSTRAINT_def]: "CONSTRAINT precise Ry"*)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> 
    </span><span class="main"><span>(</span></span><span class="free"><span>P</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="MMonad.html#MMonad.REC|const"><span>MMonad.REC</span></a><span> </span><span class="free"><span>cB</span></span><span> </span><span class="free"><span>px</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>Rx'</span></span><span> </span><span class="free"><span>ax</span></span><span> </span><span class="free"><span>px</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>Ry</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>px</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.RECT_cp_annot|const"><span>RECT_cp_annot</span></a><span> </span><span class="free"><span>CP</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>D</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="free"><span>aB</span></span><span> </span><span class="bound"><span>D</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>ax</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP_def|fact"><span>APP_def</span></a><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PROTECT2_def|fact"><span>PROTECT2_def</span></a><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.RECT_cp_annot_def|fact"><span>RECT_cp_annot_def</span></a><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST_def|fact"><span>PR_CONST_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_cons_pre|fact"><span>hn_refine_cons_pre</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_20132..20134"><span>FR</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hnr_RECT|fact"><span>hnr_RECT</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_cons_post|fact"><span>hn_refine_cons_post</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="Sepref_Translate.html#offset_20482..20485"><span>FR'</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_cons_cp_only|fact"><span>hn_refine_cons_cp_only</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_20174..20175"><span>S</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.RCALL_def|fact"><span>RCALL_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP_def|fact"><span>APP_def</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_cons_cp_only|fact"><span>hn_refine_cons_cp_only</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>assumption</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_20412..20414"><span>CP</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Conc_Post.html#Sepref_Conc_Post.CP_defs|fact"><span class="dynamic"><span class="dynamic"><span>CP_defs</span></span></span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>fact</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
  
  
  
  
</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_21174..21179">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.hn_refine_synthI|fact"><span class="entity_def" id="Sepref_Translate.hn_refine_synthI|thm"><span>hn_refine_synthI</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Γ'</span></span><span> </span><span class="free"><span>R'</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>m</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>c</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>c'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>R'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>R''</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Γ'</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><span class="free"><span>Γ''</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="free"><span>Γ''</span></span><span> </span><span class="free"><span>R''</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>m</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_21174..21179"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_cons_post|fact"><span>hn_refine_cons_post</span></a><span class="main"><span>)</span></span><span>
  
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.hn_refine_extract_pre_val|fact"><span class="entity_def" id="Sepref_Translate.hn_refine_extract_pre_val|thm"><span>hn_refine_extract_pre_val</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_val|const"><span>hn_val</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>xa</span></span><span> </span><span class="free"><span>xc</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>Γ</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Γ'</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span>xc</span></span><span class="main"><span>,</span></span><span class="free"><span>xa</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Γ'</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>m</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_def|fact"><span>hn_refine_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure_def|fact"><span>pure_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>xc</span></span><span class="main"><span>,</span></span><span class="free"><span>xa</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>
  
</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_21625..21630">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.hnr_freeI|fact"><span class="entity_def" id="Sepref_Translate.hnr_freeI|thm"><span>hnr_freeI</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.MK_FREE|const"><span>MK_FREE</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>fr</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Γ'</span></span><span> </span><span class="free"><span>R'</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>m</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>Γ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="free"><span>fr</span></span><span> </span><span class="free"><span>y</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>Γ'</span></span><span> </span><span class="free"><span>R'</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>m</span></span><span>"</span></span></span><span>  
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_nofailI|fact"><span>hn_refine_nofailI</span></a><span class="main"><span>)</span></span><span>  
  </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nofail|const"><span>nofail</span></a><span> </span><span class="free"><span>m</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_rules|attribute"><span class="operator"><span>vcg_rules</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.MK_FREED|fact"><span>MK_FREED</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_21625..21630"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refineD|fact"><span>hn_refineD</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_21625..21630"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nofail|const"><span>nofail</span></a><span> </span><span class="free"><span>m</span></span><span>›</span></span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg|method"><span class="operator"><span>vcg</span></span></a><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>  
  
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.drop_hn_val|fact"><span class="entity_def" id="Sepref_Translate.drop_hn_val|thm"><span>drop_hn_val</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_val|const"><span>hn_val</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_empty|const"><span>□</span></a></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure_def|fact"><span>pure_def</span></a><span> </span><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails_def|fact"><span>entails_def</span></a><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift_extract_simps|fact"><span>pred_lift_extract_simps</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.drop_hn_invalid|fact"><span class="entity_def" id="Sepref_Translate.drop_hn_invalid|thm"><span>drop_hn_invalid</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_invalid|const"><span>hn_invalid</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_empty|const"><span>□</span></a></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.invalid_assn_def|fact"><span>invalid_assn_def</span></a><span> </span><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails_def|fact"><span>entails_def</span></a><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift_extract_simps|fact"><span>pred_lift_extract_simps</span></a><span class="main"><span>)</span></span><span>

  
  
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Translate.op_ASSERT_bind_def|fact"><span class="entity_def" id="Sepref_Translate.op_ASSERT_bind_def|thm"><span class="entity_def" id="Sepref_Translate.op_ASSERT_bind_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Translate.op_ASSERT_bind|const"><span>op_ASSERT_bind</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>I</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>m</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>I</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>m</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.pat_ASSERT_bind|fact"><span class="entity_def" id="Sepref_Translate.pat_ASSERT_bind|thm"><span>pat_ASSERT_bind</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.def_pat_rules|attribute"><span class="operator"><span>def_pat_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="free"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.UNPROTECT|const"><span>UNPROTECT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.op_ASSERT_bind|const"><span>op_ASSERT_bind</span></a><span> </span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>m</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span>term</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.op_ASSERT_bind|const"><span>op_ASSERT_bind</span></a><span> </span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.id_op_ASSERT_bind|fact"><span class="entity_def" id="Sepref_Translate.id_op_ASSERT_bind|thm"><span>id_op_ASSERT_bind</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.id_rules|attribute"><span class="operator"><span>id_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.op_ASSERT_bind|const"><span>op_ASSERT_bind</span></a><span> </span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.intf_type|const"><span>::<span class="hidden">⇩</span><sub>i</sub></span></a></span><span> </span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.arity_ASSERT_bind|fact"><span class="entity_def" id="Sepref_Translate.arity_ASSERT_bind|thm"><span>arity_ASSERT_bind</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.sepref_monadify_arity|attribute"><span class="operator"><span>sepref_monadify_arity</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.op_ASSERT_bind|const"><span>op_ASSERT_bind</span></a><span> </span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>m</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.op_ASSERT_bind|const"><span>op_ASSERT_bind</span></a><span> </span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>m</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq_reflection|fact"><span>eq_reflection</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_22723..22728">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.hn_ASSERT_bind|fact"><span class="entity_def" id="Sepref_Translate.hn_ASSERT_bind|thm"><span>hn_ASSERT_bind</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.sepref_comb_rules|attribute"><span class="operator"><span>sepref_comb_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Γ'</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>m</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Γ'</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.op_ASSERT_bind|const"><span>op_ASSERT_bind</span></a><span> </span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>m</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_22723..22728"><span>assms</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="free"><span>I</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Translate.op_ASSUME_bind_def|fact"><span class="entity_def" id="Sepref_Translate.op_ASSUME_bind_def|thm"><span class="entity_def" id="Sepref_Translate.op_ASSUME_bind_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Translate.op_ASSUME_bind|const"><span>op_ASSUME_bind</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>I</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>m</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSUME|const"><span>ASSUME</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>I</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>m</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.pat_ASSUME_bind|fact"><span class="entity_def" id="Sepref_Translate.pat_ASSUME_bind|thm"><span>pat_ASSUME_bind</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.def_pat_rules|attribute"><span class="operator"><span>def_pat_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSUME|const"><span>ASSUME</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="free"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.UNPROTECT|const"><span>UNPROTECT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.op_ASSUME_bind|const"><span>op_ASSUME_bind</span></a><span> </span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>m</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.id_op_ASSUME_bind|fact"><span class="entity_def" id="Sepref_Translate.id_op_ASSUME_bind|thm"><span>id_op_ASSUME_bind</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.id_rules|attribute"><span class="operator"><span>id_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.op_ASSUME_bind|const"><span>op_ASSUME_bind</span></a><span> </span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.intf_type|const"><span>::<span class="hidden">⇩</span><sub>i</sub></span></a></span><span> </span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.arity_ASSUME_bind|fact"><span class="entity_def" id="Sepref_Translate.arity_ASSUME_bind|thm"><span>arity_ASSUME_bind</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.sepref_monadify_arity|attribute"><span class="operator"><span>sepref_monadify_arity</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.op_ASSUME_bind|const"><span>op_ASSUME_bind</span></a><span> </span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>m</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.op_ASSUME_bind|const"><span>op_ASSUME_bind</span></a><span> </span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>m</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq_reflection|fact"><span>eq_reflection</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_23397..23402">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.hn_ASSUME_bind|fact"><span class="entity_def" id="Sepref_Translate.hn_ASSUME_bind|thm"><span>hn_ASSUME_bind</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.sepref_comb_rules|attribute"><span class="operator"><span>sepref_comb_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag|const"><span>vassn_tag</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Γ'</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>m</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Γ'</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.op_ASSUME_bind|const"><span>op_ASSUME_bind</span></a><span> </span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>m</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_preI|fact"><span>hn_refine_preI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_23397..23402"><span>assms</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="free"><span>I</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag_def|fact"><span>vassn_tag_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
    
</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Manual deallocation. Frees data before its variable goes out of scope›</span></span></span><span>  
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Translate.mop_free_def|fact"><span class="entity_def" id="Sepref_Translate.mop_free_def|thm"><span class="entity_def" id="Sepref_Translate.mop_free_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Translate.mop_free|const"><span>mop_free</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Unity|const"><span>()</span></a></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Translate.mop_free.mcomb|fact"><span class="entity_def" id="Sepref_Translate.mop_free.arity|fact"><span class="entity_def" id="Sepref_Translate.mop_free.itype|fact"><span class="entity_def" id="Sepref_Translate.mop_free.mcomb|thm"><span class="entity_def" id="Sepref_Translate.mop_free.arity|thm"><span class="entity_def" id="Sepref_Translate.mop_free.itype|thm"><span>sepref_register</span></span></span></span></span></span></span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.mop_free|const"><span>mop_free</span></a></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_23821..23826">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.mop_free_hnr|fact"><span class="entity_def" id="Sepref_Translate.mop_free_hnr|thm"><span>mop_free_hnr</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.sepref_fr_rules|attribute"><span class="operator"><span>sepref_fr_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.MK_FREE|const"><span>MK_FREE</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>f</span></span><span>"</span></span></span><span>  
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.mop_free|const"><span>mop_free</span></a><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfdrop|const"><span><span class="hidden">⇧</span><sup>d</sup></span></a></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfreftt|const"><span>→<span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub></span></a></span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.unit_assn|const"><span>unit_assn</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.mop_free_def|fact"><span>mop_free_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefI|fact"><span>hfrefI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refineI|fact"><span>hn_refineI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.htriple_pure_preI|fact"><span>htriple_pure_preI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span> 
    </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure_def|fact"><span>pure_def</span></a><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.invalid_assn_def|fact"><span>invalid_assn_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>supply</span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_rules|attribute"><span class="operator"><span>vcg_rules</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.MK_FREED|fact"><span>MK_FREED</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_23821..23826"><span>assms</span></a><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg|method"><span class="operator"><span>vcg</span></span></a><span>
    
</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>"Import of Parametricity Theorems"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_24225..24230">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.pure_hn_refineI|fact"><span class="entity_def" id="Sepref_Translate.pure_hn_refineI|thm"><span>pure_hn_refineI</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Q</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>c</span></span><span class="main"><span>,</span></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="comment1"><span>(* TODO: Weak CP copied from Sep-Imp-HOL. *)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="free"><span>Q</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="free"><span>Q</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure|const"><span>pure</span></a><span> </span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_def|fact"><span>hn_refine_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure_def|fact"><span>pure_def</span></a><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_24225..24230"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg|method"><span class="operator"><span>vcg</span></span></a><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_24447..24452">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.pure_hn_refineI_no_asm|fact"><span class="entity_def" id="Sepref_Translate.pure_hn_refineI_no_asm|thm"><span>pure_hn_refineI_no_asm</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>c</span></span><span class="main"><span>,</span></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="comment1"><span>(* TODO: Weak CP copied from Sep-Imp-HOL. *)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_empty|const"><span>□</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_empty|const"><span>□</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure|const"><span>pure</span></a><span> </span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_def|fact"><span>hn_refine_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure_def|fact"><span>pure_def</span></a><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_24447..24452"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg|method"><span class="operator"><span>vcg</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.import_param_0|fact"><span class="entity_def" id="Sepref_Translate.import_param_0|thm"><span>import_param_0</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>P</span></span><span class="main"><span>⟹</span></span><span class="free"><span>Q</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.PROTECT|const"><span>PROTECT</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>Q</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.import_param_1|fact"><span class="entity_def" id="Sepref_Translate.import_param_1(5)|thm"><span class="entity_def" id="Sepref_Translate.import_param_1(4)|thm"><span class="entity_def" id="Sepref_Translate.import_param_1(3)|thm"><span class="entity_def" id="Sepref_Translate.import_param_1(2)|thm"><span class="entity_def" id="Sepref_Translate.import_param_1(1)|thm"><span>import_param_1</span></span></span></span></span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>P</span></span><span class="main"><span>⟹</span></span><span class="free"><span>Q</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>P</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span class="free"><span>Q</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>P</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span class="free"><span>Q</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>P</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span class="free"><span>Q</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.PROTECT|const"><span>PROTECT</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Q</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.PROTECT|const"><span>PROTECT</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.PROTECT|const"><span>PROTECT</span></a><span> </span><span class="free"><span>Q</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Q</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>a</span></span><span class="main"><span>,</span></span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>Rel</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.PROTECT|const"><span>PROTECT</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.PROTECT|const"><span>PROTECT</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>a</span></span><span class="main"><span>,</span></span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>Rel</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.import_param_2|fact"><span class="entity_def" id="Sepref_Translate.import_param_2|thm"><span>import_param_2</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.PROTECT|const"><span>PROTECT</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>P</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Q</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.import_param_3|fact"><span class="entity_def" id="Sepref_Translate.import_param_3(2)|thm"><span class="entity_def" id="Sepref_Translate.import_param_3(1)|thm"><span>import_param_3</span></span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Q</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="free"><span>P</span></span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span class="main"><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="free"><span>Q</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span>c</span></span><span class="main"><span>,</span></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_val|const"><span>hn_val</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="free"><span>c</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp_all</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure_def|fact"><span>pure_def</span></a><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>named_theorems_rev</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.sepref_import_rewrite|attribute"><span class="entity_def" id="Sepref_Translate.sepref_import_rewrite|fact"><span>sepref_import_rewrite</span></span></span><span> </span><span class="quoted"><span>‹Rewrite rules on importing parametricity theorems›</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_25312..25317">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.to_import_frefD|fact"><span class="entity_def" id="Sepref_Translate.to_import_frefD|thm"><span>to_import_frefD</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.PROTECT|const"><span>PROTECT</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>P</span></span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>x</span></span><span class="main"><span>,</span></span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>g</span></span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>S</span></span><span> </span><span class="free"><span>y</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#offset_25312..25317"><span>assms</span></a><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_def|fact"><span>fref_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.add_PR_CONST|fact"><span class="entity_def" id="Sepref_Translate.add_PR_CONST|thm"><span>add_PR_CONST</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>c</span></span><span class="main"><span>,</span></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>c</span></span><span class="main"><span>,</span></span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span>ML</span></span></span><span> </span><span class="quoted"><span>‹
</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Sepref_Import_Param</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

  </span><span class="comment1"><span>(* TODO: Almost clone of Sepref_Rules.to_foparam*)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>to_import_fo</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unf_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> 
      </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.split_tupled_all|fact"><span>split_tupled_all</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_simp|fact"><span>prod_rel_simp</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry_apply|fact"><span>uncurry_apply</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.cnv_conj_to_meta|fact"><span>cnv_conj_to_meta</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.split|fact"><span>Product_Type.split</span></a><span class="antiquote"><span>}</span></span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.concl_of</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.to_import_frefD|fact"><span>to_import_frefD</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.forall_intr_vars</span><span>
        </span><span>|&gt;</span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>unf_thms</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Variable.gen_all</span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="entity"><span>Parametricity.fo_rule</span></span><span> </span><span class="entity"><span>thm</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Expected parametricity or fref theorem"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_PR_CONST</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.concl_of</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="comment1"><span>(* TODO: Hack. Need clean interfaces for fref and param rules. Also add PR_CONST to fref rules! *)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="var"><span>?a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>is_Const</span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>is_Free</span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>is_Var</span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="entity"><span>thm</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.add_PR_CONST|fact"><span>add_PR_CONST</span></a><span class="antiquote"><span>}</span></span></span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span>  


  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>import</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Sepref_Basic</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Conv.fconv_rule</span><span> </span><span>Thm.eta_conversion</span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>add_PR_CONST</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.import_param_0|fact"><span>import_param_0</span></a><span class="antiquote"><span>}</span></span></span></span><span>
      </span><span>|&gt;</span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.imp_to_meta|fact"><span>imp_to_meta</span></a><span class="antiquote"><span>}</span></span></span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>to_import_fo</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.import_param_1|fact"><span>import_param_1</span></a><span class="antiquote"><span>}</span></span></span></span><span>
      </span><span>|&gt;</span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.import_param_2|fact"><span>import_param_2</span></a><span class="antiquote"><span>}</span></span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.concl_of</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.pure_hn_refineI|fact"><span>pure_hn_refineI</span></a><span class="antiquote"><span>}</span></span></span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.pure_hn_refineI_no_asm|fact"><span>pure_hn_refineI_no_asm</span></a><span class="antiquote"><span>}</span></span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.import_param_3|fact"><span>import_param_3</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>thm</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Conv.fconv_rule</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>hn_refine_concl_conv_a</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Id_Op.protect_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Theorems_Rev.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems_rev</span></span><span> sepref_import_rewrite</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sepref_Rules.add_pure_constraints_rule</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>thm</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>import_attr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span>Thm.mixed_attribute</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>context</span></span><span class="main"><span>,</span></span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>import</span></span><span> </span><span class="main"><span>(</span></span><span>Context.proof_of</span><span> </span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sepref_Translate.sepref_fr_rules.add_thm</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="entity"><span>context</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>context</span></span><span class="main"><span>,</span></span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>import_attr_rl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span>Thm.rule_attribute</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="entity"><span>import</span></span><span> </span><span class="main"><span>(</span></span><span>Context.proof_of</span><span> </span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>Sepref_Rules.ensure_hfref</span></span><span> </span><span class="main"><span>(</span></span><span>Context.proof_of</span><span> </span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>setup</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>I</span><span>
    </span><span>#&gt;</span><span> </span><span class="entity"><span>Attrib.setup</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> </span><span class="entity_def" id="Sepref_Translate.sepref_import_param|attribute"><span>sepref_import_param</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>import_attr</span></span><span>
        </span><span class="inner_quoted"><span>"Sepref: Import parametricity rule"</span></span><span>
    </span><span>#&gt;</span><span> </span><span class="entity"><span>Attrib.setup</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> </span><span class="entity_def" id="Sepref_Translate.sepref_param|attribute"><span>sepref_param</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>import_attr_rl</span></span><span>
        </span><span class="inner_quoted"><span>"Sepref: Transform parametricity rule to sepref rule"</span></span><span>
    </span><span>#&gt;</span><span> </span><span class="entity"><span>Attrib.setup</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> </span><span class="entity_def" id="Sepref_Translate.sepref_dbg_import_rl_only|attribute"><span>sepref_dbg_import_rl_only</span></span><span class="antiquote"><span>}</span></span></span></span><span> 
        </span><span class="main"><span>(</span></span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span>Thm.rule_attribute</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>import</span></span><span> </span><span>o</span><span> </span><span>Context.proof_of</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="inner_quoted"><span>"Sepref: Parametricity to hnr-rule, no conversion to hfref"</span></span><span>    

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
›</span></span><span>

</span><span class="keyword1"><span class="command"><span>setup</span></span></span><span> </span><span class="entity"><span>Sepref_Import_Param.setup</span></span><span>


</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>"Purity"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Translate.import_rel1_def|fact"><span class="entity_def" id="Sepref_Translate.import_rel1_def|thm"><span class="entity_def" id="Sepref_Translate.import_rel1_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Translate.import_rel1|const"><span>import_rel1</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>c</span></span><span> </span><span class="bound"><span>ci</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.is_pure|const"><span>is_pure</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>ci</span></span><span class="main"><span>,</span></span><span class="bound"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.the_pure|const"><span>the_pure</span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>⟩</span></span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Translate.import_rel2_def|fact"><span class="entity_def" id="Sepref_Translate.import_rel2_def|thm"><span class="entity_def" id="Sepref_Translate.import_rel2_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Translate.import_rel2|const"><span>import_rel2</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="bound"><span>c</span></span><span> </span><span class="bound"><span>ci</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.is_pure|const"><span>is_pure</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.is_pure|const"><span>is_pure</span></a><span> </span><span class="bound"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>ci</span></span><span class="main"><span>,</span></span><span class="bound"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.the_pure|const"><span>the_pure</span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.the_pure|const"><span>the_pure</span></a><span> </span><span class="bound"><span>B</span></span><span class="main"><span>⟩</span></span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.import_rel1_pure_conv|fact"><span class="entity_def" id="Sepref_Translate.import_rel1_pure_conv|thm"><span>import_rel1_pure_conv</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.import_rel1|const"><span>import_rel1</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure|const"><span>pure</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure|const"><span>pure</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>⟨</span></span><span class="free"><span>A</span></span><span class="main"><span>⟩</span></span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.import_rel1_def|fact"><span>import_rel1_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure_def|fact"><span>pure_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Translate.import_rel2_pure_conv|fact"><span class="entity_def" id="Sepref_Translate.import_rel2_pure_conv|thm"><span>import_rel2_pure_conv</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.import_rel2|const"><span>import_rel2</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure|const"><span>pure</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure|const"><span>pure</span></a><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure|const"><span>pure</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>⟨</span></span><span class="free"><span>A</span></span><span class="main"><span>,</span></span><span class="free"><span>B</span></span><span class="main"><span>⟩</span></span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.import_rel2_def|fact"><span>import_rel2_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure_def|fact"><span>pure_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="comment1"><span>(*  
lemma precise_pure[constraint_rules]: "single_valued R ⟹ precise (pure R)"
  unfolding precise_def pure_def
  by (auto dest: single_valuedD)

lemma precise_pure_iff_sv: "precise (pure R) ⟷ single_valued R"          
  apply (auto simp: precise_pure)
  using preciseD[where R="pure R" and F=emp and F'=emp]
  by (sep_auto simp: mod_and_dist intro: single_valuedI)

lemma pure_precise_iff_sv: "⟦is_pure R⟧ 
  ⟹ precise R ⟷ single_valued (the_pure R)"
  by (auto simp: is_pure_conv precise_pure_iff_sv)
*)</span></span><span>


</span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.safe_constraint_rules|attribute"><span class="operator"><span>safe_constraint_rules</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.single_valued_Id|fact"><span>single_valued_Id</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.br_sv|fact"><span>br_sv</span></a><span>


</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span></pre>
</body>

</html>