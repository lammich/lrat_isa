<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Sepref_Monadify</title>
</head>


<body>
<div class="head">
<h1>Theory Sepref_Monadify</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Monadify›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><a href="Sepref_Monadify.html"><span>Sepref_Monadify</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> </span><a href="Sepref_Basic.html"><span>Sepref_Basic</span></a><span> </span><a href="Sepref_Id_Op.html"><span>Sepref_Id_Op</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹
  In this phase, a monadic program is converted to complete monadic form,
  that is, computation of compound expressions are made visible as top-level 
  operations in the monad.

  The monadify process is separated into 2 steps.
  \begin{enumerate}
    \item In a first step, eta-expansion is used to add missing operands 
      to operations and combinators. This way, operators and combinators
      always occur with the same arity, which simplifies further processing.

    \item In a second step, computation of compound operands is flattened,
      introducing new bindings for the intermediate values. 
  \end{enumerate}
›</span></span></span><span>


</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Monadify.SP_def|fact"><span class="entity_def" id="Sepref_Monadify.SP_def|thm"><span class="entity_def" id="Sepref_Monadify.SP_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Monadify.SP|const"><span>SP</span></span></span><span> </span><span class="comment1"><span>― ‹Tag to protect content from further application of arity 
  and combinator equations›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>SP</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Monadify.SP_cong|fact"><span class="entity_def" id="Sepref_Monadify.SP_cong|thm"><span>SP_cong</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>cong</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Monadify.PR_CONST_cong|fact"><span class="entity_def" id="Sepref_Monadify.PR_CONST_cong|thm"><span>PR_CONST_cong</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>cong</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Monadify.RCALL_def|fact"><span class="entity_def" id="Sepref_Monadify.RCALL_def|thm"><span class="entity_def" id="Sepref_Monadify.RCALL_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Monadify.RCALL|const"><span>RCALL</span></span></span><span> </span><span class="comment1"><span>― ‹Tag that marks recursive call›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>RCALL</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>D</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>D</span></span></span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Monadify.EVAL_def|fact"><span class="entity_def" id="Sepref_Monadify.EVAL_def|thm"><span class="entity_def" id="Sepref_Monadify.EVAL_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Monadify.EVAL|const"><span>EVAL</span></span></span><span> </span><span class="comment1"><span>― ‹Tag that marks evaluation of plain expression for monadify phase›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>EVAL</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹
  Internally, the package first applies rewriting rules from 
  </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>text</span></span><span> </span><span class="raw_text"><span>sepref_monadify_arity</span></span><span class="antiquote"><span>}</span></span></span><span>, which use eta-expansion to ensure that
  every combinator has enough actual parameters. Moreover, this phase will
  mark recursive calls by the tag </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const</span></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.RCALL|const"><span>RCALL</span></a><span class="antiquote"><span>}</span></span></span><span>.

  Next, rewriting rules from </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>text</span></span><span> </span><span class="raw_text"><span>sepref_monadify_comb</span></span><span class="antiquote"><span>}</span></span></span><span> are used to
  add </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const</span></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="antiquote"><span>}</span></span></span><span>-tags to plain expressions that should be evaluated
  in the monad. The </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const</span></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="antiquote"><span>}</span></span></span><span> tags are flattened using a default simproc 
  that generates left-to-right argument order.
›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Monadify.monadify_simps|fact"><span class="entity_def" id="Sepref_Monadify.monadify_simps(2)|thm"><span class="entity_def" id="Sepref_Monadify.monadify_simps(1)|thm"><span>monadify_simps</span></span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Monadify.PASS_def|fact"><span class="entity_def" id="Sepref_Monadify.PASS_def|thm"><span class="entity_def" id="Sepref_Monadify.PASS_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Monadify.PASS|const"><span>PASS</span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span>"</span></span></span><span>
  </span><span class="comment1"><span>― ‹Pass on value, invalidating old one›</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Monadify.remove_pass_simps|fact"><span class="entity_def" id="Sepref_Monadify.remove_pass_simps(2)|thm"><span class="entity_def" id="Sepref_Monadify.remove_pass_simps(1)|thm"><span>remove_pass_simps</span></span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.PASS|const"><span>PASS</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>m</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.PASS|const"><span>PASS</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span>m</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span>


</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Monadify.COPY_def|fact"><span class="entity_def" id="Sepref_Monadify.COPY_def|thm"><span class="entity_def" id="Sepref_Monadify.COPY_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Monadify.COPY|const"><span>COPY</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span>"</span></span></span><span> 
  </span><span class="comment1"><span>― ‹Marks required copying of parameter›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>COPY</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Monadify.RET_COPY_PASS_eq|fact"><span class="entity_def" id="Sepref_Monadify.RET_COPY_PASS_eq|thm"><span>RET_COPY_PASS_eq</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.COPY|const"><span>COPY</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.PASS|const"><span>PASS</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>p</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>


</span><span class="keyword1"><span class="command"><span>named_theorems_rev</span></span></span><span> </span><span class="entity_def" id="Sepref_Monadify.sepref_monadify_arity|attribute"><span class="entity_def" id="Sepref_Monadify.sepref_monadify_arity|fact"><span>sepref_monadify_arity</span></span></span><span> </span><span class="quoted"><span>"Sepref.Monadify: Arity alignment equations"</span></span><span>
</span><span class="keyword1"><span class="command"><span>named_theorems_rev</span></span></span><span> </span><span class="entity_def" id="Sepref_Monadify.sepref_monadify_comb|attribute"><span class="entity_def" id="Sepref_Monadify.sepref_monadify_comb|fact"><span>sepref_monadify_comb</span></span></span><span> </span><span class="quoted"><span>"Sepref.Monadify: Combinator equations"</span></span><span>

</span><span class="keyword1"><span class="command"><span>ML</span></span></span><span> </span><span class="quoted"><span>‹
  </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Sepref_Monadify</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cr_var</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"v"</span></span><span>^</span><span>string_of_int</span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"__v"</span></span><span>^</span><span>string_of_int</span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lambda2_name</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PROTECT2|const"><span>PROTECT2</span></a><span> </span><span class="var"><span>?t</span></span><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.DUMMY|const"><span>DUMMY</span></a><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Term.lambda_name</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>t</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> 
        </span><span class="entity"><span>bind_args</span></span><span> </span><span class="entity"><span>exp0</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>exp0</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>bind_args</span></span><span> </span><span class="entity"><span>exp0</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span class="entity"><span>m</span></span><span class="main"><span>)</span></span><span>::</span><span class="entity"><span>xms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bind_args</span></span><span> </span><span class="entity"><span>exp0</span></span><span> </span><span class="entity"><span>xms</span></span><span> 
            </span><span>|&gt;</span><span> </span><span>incr_boundvars</span><span> </span><span class="inner_numeral"><span>1</span></span><span> 
            </span><span>|&gt;</span><span> </span><span class="entity"><span>lambda2_name</span></span><span> </span><span class="entity"><span>x</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="var"><span>?m</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="var"><span>?lr</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>monadify</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Autoref_Tagging.strip_app</span></span><span> </span><span class="entity"><span>t</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_Abs</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> 
          </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"monadify: higher-order"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>argTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>args</span></span><span>
        </span><span class="comment1"><span>(*val args = map monadify args*)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="var"><span>?a</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span>

        </span><span class="comment1"><span>(*val fT = fastype_of f
        val argTs = binder_types fT*)</span></span><span>
  
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>argVs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>tag_list</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="entity"><span>argTs</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>cr_var</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>res0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Autoref_Tagging.list_APP</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span class="entity"><span>argVs</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> 
          </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="var"><span>?x</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>res</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bind_args</span></span><span> </span><span class="entity"><span>res0</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>argVs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>res</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>monadify_conv_aux</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.monadify_simps|fact"><span>monadify_simps</span></a><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP_def|fact"><span>SP_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>simp_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="comment1"><span>(*Refine_Util.monitor_conv "monadify"*)</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>Refine_Util.f_tac_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>dest_comb</span><span> </span><span>#&gt;</span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>monadify</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tac</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ct</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"monadify_conv"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

      </span><span class="comment1"><span>(*fun extract_comb_conv ctxt = Conv.rewrs_conv 
        (Named_Theorems_Rev.get ctxt @{named_theorems_rev sepref_monadify_evalcomb})
      *)</span></span><span>  
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="comment1"><span>(*
      val monadify_conv = Conv.top_conv 
        (fn ctxt =&gt; 
          Conv.try_conv (
            extract_comb_conv ctxt else_conv monadify_conv_aux ctxt
          )
        )
      *)</span></span><span>  

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>monadify_simproc</span></span><span> </span><span class="main"><span>=</span></span><span> 
        </span><span class="entity"><span>Simplifier.make_simproc</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>context</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="inner_quoted"><span>"monadify_simproc"</span></span><span>
         </span><span class="main"><span>{</span></span><span>lhss </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>[</span></span><span>Logic.varify_global</span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>a</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          proc </span><span class="main"><span>=</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span>o</span><span> </span><span class="entity"><span>monadify_conv_aux</span></span><span class="main"><span>)</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
      </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Sepref_Basic</span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mark_params</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>P</span></span><span class="main"><span>,</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span class="entity"><span>Q</span></span><span class="main"><span>,</span></span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span class="entity"><span>CP</span></span><span class="main"><span>,</span></span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_hn_refine</span></span><span> </span><span class="entity"><span>t</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_star</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span>|&gt;</span><span> </span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_hn_ctxt_opt</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>map_option</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tr</span></span><span> </span><span class="entity"><span>env</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="var"><span>?x</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> 
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>is_Bound</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pps</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> env</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.PASS|const"><span>PASS</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="var"><span>?x</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span></span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>t</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tr</span></span><span> </span><span class="entity"><span>env</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span>$</span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tr</span></span><span> </span><span class="entity"><span>env</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>tr</span></span><span> </span><span class="entity"><span>env</span></span><span> </span><span class="entity"><span>t2</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tr</span></span><span> </span><span class="entity"><span>env</span></span><span> </span><span class="main"><span>(</span></span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span class="entity"><span>tr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span>::</span><span class="entity"><span>env</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tr</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tr</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>a</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_hn_refine</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>P</span></span><span class="main"><span>,</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span class="entity"><span>Q</span></span><span class="main"><span>,</span></span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span class="entity"><span>CP</span></span><span class="main"><span>,</span></span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>  
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mark_params_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Refine_Util.f_tac_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
      </span><span class="main"><span>(</span></span><span class="entity"><span>mark_params</span></span><span class="main"><span>)</span></span><span> 
      </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.PASS_def|fact"><span>PASS_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>  

    </span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>

      </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Sepref_Basic</span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dp</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.PASS|const"><span>PASS</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="var"><span>?p</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="var"><span>?t'</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Mpat_Antiquot.html#Mpat_Antiquot.mpaq_AS_PAT|const"><span>AS<span class="hidden">⇩</span><sub>p</sub></span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PROTECT2|const"><span>PROTECT2</span></a><span> </span><span class="main"><span>_</span></span><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.DUMMY|const"><span>DUMMY</span></a><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> 
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t'</span></span><span class="main"><span>,</span></span><span class="entity"><span>ps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>t'</span></span><span class="main"><span>,</span></span><span class="entity"><span>rc</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_lambda_rc</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t'</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PROTECT2|const"><span>PROTECT2</span></a><span> </span><span class="var"><span>?f</span></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Match</span><span> 
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span class="entity"><span>ps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dp</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>f</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PROTECT2|const"><span>PROTECT2</span></a><span> </span><span class="var"><span>?f</span></span><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.DUMMY|const"><span>DUMMY</span></a><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rc</span></span><span> </span><span class="entity"><span>t'</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>t'</span></span><span class="main"><span>,</span></span><span class="entity"><span>ps</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dup</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>p</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>dup</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.COPY|const"><span>COPY</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="var"><span>?p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="var"><span>?t'</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.PASS|const"><span>PASS</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="var"><span>?p</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="var"><span>?t'</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span class="entity"><span>p</span></span><span>::</span><span class="entity"><span>ps</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dp</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span>$</span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dp</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dp</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dp</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span>Abs</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>apply_under_lambda</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>dp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dp</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dp_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Refine_Util.f_tac_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
        </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>dp</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> 
        </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.RET_COPY_PASS_eq|fact"><span>RET_COPY_PASS_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 


    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dup_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>CONVERSION</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sepref_Basic.hn_refine_concl_conv_a</span></span><span> </span><span class="entity"><span>dp_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>arity_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>arity1_ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
        </span><span>addsimps</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Named_Theorems_Rev.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems_rev</span></span><span> sepref_monadify_arity</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>Simplifier.add_cong</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP_cong|fact"><span>SP_cong</span></a><span class="antiquote"><span>}</span></span></span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>Simplifier.add_cong</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.PR_CONST_cong|fact"><span>PR_CONST_cong</span></a><span class="antiquote"><span>}</span></span></span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>arity2_ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
        </span><span>addsimps</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.beta|fact"><span>beta</span></a><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP_def|fact"><span>SP_def</span></a><span class="antiquote"><span>}</span></span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="entity"><span>simp_tac</span></span><span> </span><span class="entity"><span>arity1_ss</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>simp_tac</span></span><span> </span><span class="entity"><span>arity2_ss</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>comb_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>comb1_ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
        </span><span>addsimps</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Theorems_Rev.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems_rev</span></span><span> sepref_monadify_comb</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="comment1"><span>(*addsimps (Named_Theorems_Rev.get ctxt @{named_theorems_rev sepref_monadify_evalcomb})*)</span></span><span>
        </span><span>addsimprocs</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>monadify_simproc</span></span><span class="main"><span>]</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>Simplifier.add_cong</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP_cong|fact"><span>SP_cong</span></a><span class="antiquote"><span>}</span></span></span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>Simplifier.add_cong</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.PR_CONST_cong|fact"><span>PR_CONST_cong</span></a><span class="antiquote"><span>}</span></span></span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>comb2_ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
        </span><span>addsimps</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP_def|fact"><span>SP_def</span></a><span class="antiquote"><span>}</span></span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="entity"><span>simp_tac</span></span><span> </span><span class="entity"><span>comb1_ss</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>simp_tac</span></span><span> </span><span class="entity"><span>comb2_ss</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="comment1"><span>(*fun ops_tac ctxt = CONVERSION (
      Sepref_Basic.hn_refine_concl_conv_a monadify_conv ctxt)*)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mark_params_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>CONVERSION</span><span> </span><span class="main"><span>(</span></span><span>
      </span><span class="entity"><span>Refine_Util.HOL_concl_conv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mark_params_conv</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>contains_eval</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="var"><span>?a</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>=</span></span><span>   
      </span><span>Term.exists_subterm</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>a</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>contains_eval</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"contains_eval"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>  

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>remove_pass_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span class="entity"><span>simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.remove_pass_simps|fact"><span>remove_pass_simps</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>monadify_tac</span></span><span> </span><span class="entity"><span>dbg</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Sepref_Basic</span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="entity"><span>PHASES'</span></span><span> </span><span class="main"><span>[</span></span><span>
        </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"arity"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arity_tac</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"comb"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>comb_tac</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="comment1"><span>(*("ops", ops_tac, 0),*)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"check_EVAL"</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>CONCL_COND'</span></span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span>o</span><span> </span><span class="entity"><span>contains_eval</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"mark_params"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mark_params_tac</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"dup"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dup_tac</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"remove_pass"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>remove_pass_tac</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>flag_phases_ctrl</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>dbg</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
›</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Monadify.dflt_arity|fact"><span class="entity_def" id="Sepref_Monadify.dflt_arity(7)|thm"><span class="entity_def" id="Sepref_Monadify.dflt_arity(6)|thm"><span class="entity_def" id="Sepref_Monadify.dflt_arity(5)|thm"><span class="entity_def" id="Sepref_Monadify.dflt_arity(4)|thm"><span class="entity_def" id="Sepref_Monadify.dflt_arity(3)|thm"><span class="entity_def" id="Sepref_Monadify.dflt_arity(2)|thm"><span class="entity_def" id="Sepref_Monadify.dflt_arity(1)|thm"><span>dflt_arity</span></span></span></span></span></span></span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.sepref_monadify_arity|attribute"><span class="operator"><span>sepref_monadify_arity</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span>"</span></span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/RefineG_Recursion.html#RefineG_Recursion.RECT|const"><span>RECT</span></a><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>B</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/RefineG_Recursion.html#RefineG_Recursion.RECT|const"><span>RECT</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>D</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="bound"><span>B</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.RCALL|const"><span>RCALL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>D</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span>"</span></span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.case_list|const"><span>case_list</span></a><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>fn</span></span><span> </span><span class="bound"><span>fc</span></span><span> </span><span class="bound"><span>l</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.case_list|const"><span>case_list</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>fn</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>xs</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="bound"><span>fc</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>l</span></span><span>"</span></span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case_prod|const"><span>case_prod</span></a><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>fp</span></span><span> </span><span class="bound"><span>p</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case_prod|const"><span>case_prod</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="bound"><span>fp</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>a</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>p</span></span><span>"</span></span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.case_option|const"><span>case_option</span></a><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>fn</span></span><span> </span><span class="bound"><span>fs</span></span><span> </span><span class="bound"><span>ov</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.case_option|const"><span>case_option</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>fn</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="bound"><span>fs</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>ov</span></span><span>"</span></span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>If</span></a><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>t</span></span><span> </span><span class="bound"><span>e</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>If</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>t</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>e</span></span><span>"</span></span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let|const"><span>Let</span></a><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>f</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let|const"><span>Let</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="bound"><span>f</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp_all</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP_def|fact"><span>SP_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP_def|fact"><span>APP_def</span></a><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PROTECT2_def|fact"><span>PROTECT2_def</span></a><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.RCALL_def|fact"><span>RCALL_def</span></a><span class="main"><span>)</span></span><span>


</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Monadify.dflt_comb|fact"><span class="entity_def" id="Sepref_Monadify.dflt_comb(8)|thm"><span class="entity_def" id="Sepref_Monadify.dflt_comb(7)|thm"><span class="entity_def" id="Sepref_Monadify.dflt_comb(6)|thm"><span class="entity_def" id="Sepref_Monadify.dflt_comb(5)|thm"><span class="entity_def" id="Sepref_Monadify.dflt_comb(4)|thm"><span class="entity_def" id="Sepref_Monadify.dflt_comb(3)|thm"><span class="entity_def" id="Sepref_Monadify.dflt_comb(2)|thm"><span class="entity_def" id="Sepref_Monadify.dflt_comb(1)|thm"><span>dflt_comb</span></span></span></span></span></span></span></span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.sepref_monadify_comb|attribute"><span class="operator"><span>sepref_monadify_comb</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>B</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/RefineG_Recursion.html#RefineG_Recursion.RECT|const"><span>RECT</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>B</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/RefineG_Recursion.html#RefineG_Recursion.RECT|const"><span>RECT</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>B</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>D</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.RCALL|const"><span>RCALL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>D</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.RCALL|const"><span>RCALL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>D</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>fn</span></span><span> </span><span class="bound"><span>fc</span></span><span> </span><span class="bound"><span>l</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.case_list|const"><span>case_list</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>fn</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>fc</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>l</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>l</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.case_list|const"><span>case_list</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>fn</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>fc</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>fp</span></span><span> </span><span class="bound"><span>p</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case_prod|const"><span>case_prod</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>fp</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>p</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>p</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case_prod|const"><span>case_prod</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>fp</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>fn</span></span><span> </span><span class="bound"><span>fs</span></span><span> </span><span class="bound"><span>ov</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.case_option|const"><span>case_option</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>fn</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>fs</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>ov</span></span><span> 
    </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>ov</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>ov</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.case_option|const"><span>case_option</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>fn</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>fs</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>ov</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>t</span></span><span> </span><span class="bound"><span>e</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>If</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>t</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>e</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>If</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>t</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>e</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let|const"><span>Let</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>f</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let|const"><span>Let</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp_all</span></span><span class="main"><span>)</span></span><span>


</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Monadify.dflt_plain_comb|fact"><span class="entity_def" id="Sepref_Monadify.dflt_plain_comb(5)|thm"><span class="entity_def" id="Sepref_Monadify.dflt_plain_comb(4)|thm"><span class="entity_def" id="Sepref_Monadify.dflt_plain_comb(3)|thm"><span class="entity_def" id="Sepref_Monadify.dflt_plain_comb(2)|thm"><span class="entity_def" id="Sepref_Monadify.dflt_plain_comb(1)|thm"><span>dflt_plain_comb</span></span></span></span></span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.sepref_monadify_comb|attribute"><span class="operator"><span>sepref_monadify_comb</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>If</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>b</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>t</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>e</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>If</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>e</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.case_list|const"><span>case_list</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>fn</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>xs</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="free"><span>fc</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> 
    </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>l</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.case_list|const"><span>case_list</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>fn</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>xs</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="free"><span>fc</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>l</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case_prod|const"><span>case_prod</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="free"><span>fp</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> 
    </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>p</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case_prod|const"><span>case_prod</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="free"><span>fp</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>p</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.case_option|const"><span>case_option</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>fn</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="free"><span>fs</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>ov</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> 
    </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.bind|const"><span>Refine_Basic.bind</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>ov</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>ov</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.case_option|const"><span>case_option</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>fn</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="free"><span>fs</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>ov</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let|const"><span>Let</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Monad_Syntax.html#Monad_Syntax.bind|const"><span>(⤜)</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span> </span><span class="free"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>λ<span class="hidden">⇩</span><sub>2</sub></span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.ABS2|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq_reflection|fact"><span>eq_reflection</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.split|fact"><span>list.split</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.split|fact"><span>prod.split</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.split|fact"><span>option.split</span></a><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Monadify.evalcomb_PR_CONST|fact"><span class="entity_def" id="Sepref_Monadify.evalcomb_PR_CONST|thm"><span>evalcomb_PR_CONST</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.sepref_monadify_comb|attribute"><span class="operator"><span>sepref_monadify_comb</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.EVAL|const"><span>EVAL</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Sepref_Monadify.html#Sepref_Monadify.SP|const"><span>SP</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>


</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>