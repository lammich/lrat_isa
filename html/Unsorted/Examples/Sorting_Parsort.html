<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Sorting_Parsort</title>
</head>


<body>
<div class="head">
<h1>Theory Sorting_Parsort</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Parallel Quicksort›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><a href="Sorting_Parsort.html"><span>Sorting_Parsort</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> </span><a href="Sorting_Introsort.html"><span>Sorting_Introsort</span></a><span> </span><a href="Sorting_PDQ.html"><span>Sorting_PDQ</span></a><span> </span><a href="Sorting_Par_Partition.html"><span>Sorting_Par_Partition</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>



</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_122..129">context</span></span></span><span> </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.weak_ordering|locale"><span>weak_ordering</span></a><span> </span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Abstract Algorithm›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹We use a few straightforward refinement steps to develop the abstract parallel 
    quicksort algorithm›</span></span></span><span>
          
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sorting_Parsort.weak_ordering.bad_partition_def|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.bad_partition_def|thm"><span class="entity_def" id="Sorting_Parsort.weak_ordering.bad_partition_def_raw|axiom"><span class="entity_def" id="offset_311..321">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sorting_Parsort.weak_ordering.bad_partition|const"><span>bad_partition</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>bad_partition</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>m</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>m</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>m</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.divide_class.divide|const"><span>div</span></a></span><span> </span><span class="numeral"><span>8</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="free"><span class="bound"><span class="entity"><span>m</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.divide_class.divide|const"><span>div</span></a></span><span> </span><span class="numeral"><span>8</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.weak_ordering.bad_partition_triv|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.bad_partition_triv|thm"><span class="entity_def" id="offset_471..489">bad_partition_triv</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>m</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span class="free"><span>n</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#Sorting_Parsort.weak_ordering.bad_partition|const"><span>bad_partition</span></a><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_311..321"><span>bad_partition_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_seq_threshold|const"><span>par_sort_seq_threshold</span></span></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>≡</span></span><span> </span><span class="numeral"><span>100000</span></span><span>"</span></span></span><span>  
  </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppar_chunk_size|const"><span>ppar_chunk_size</span></span></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>≡</span></span><span> </span><span class="numeral"><span>1000000</span></span><span>"</span></span></span><span>  
    
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux_def|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux_def|thm"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux_def_raw|axiom"><span class="entity_def" id="offset_716..726">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux.cong|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux.cong|thm"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux|const"><span class="entity_def" id="offset_728..740">par_sort_aux</span></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>d</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/RefineG_Recursion.html#RefineG_Recursion.RECT|const"><span>RECT</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><span class="bound"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><a class="entity_ref" href="Sorting_Parsort.html#Sorting_Parsort.weak_ordering.par_sort_seq_threshold|const"><span>par_sort_seq_threshold</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span>
      </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.slice_sort_spec|const"><span>slice_sort_spec</span></a><span> </span><span class="main"><span class="free"><span>(<span class="hidden">❙</span><b>&lt;</b>)</span></span></span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="bound"><span>n</span></span><span>
    </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><span class="main"><span>(</span></span><span class="bound"><span>xs'</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span>partition3_spec</span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>bad</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#Sorting_Parsort.weak_ordering.bad_partition|const"><span>bad_partition</span></a><span> </span><span class="bound"><span>m</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>;</span></span><span>
      
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>,</span></span><span class="bound"><span>xs''</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/IICF_Array.html#IICF_Array.WITH_SPLIT|const"><span>WITH_SPLIT</span></a><span> </span><span class="bound"><span>m</span></span><span> </span><span class="bound"><span>xs'</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub>'</span></span><span class="main"><span>,</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub>'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>bad</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
          </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub>'</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub>'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub>'</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub>'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub>'</span></span><span class="main"><span>,</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub>'</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>}</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
          </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub>'</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub>'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub>'</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub>'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub>'</span></span><span class="main"><span>,</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub>'</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Unity|const"><span>()</span></a></span><span class="main"><span>,</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub>'</span></span><span class="main"><span>,</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub>'</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>xs''</span></span><span>
    </span><span class="main"><span>}</span></span><span>
  </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span class="main"><span>,</span></span><span class="free"><span class="bound"><span class="entity"><span>d</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux_correct|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux_correct|thm"><span class="entity_def" id="offset_1718..1738">par_sort_aux_correct</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sorting_Parsort.html#offset_728..740"><span>par_sort_aux</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>d</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.slice_sort_spec|const"><span>slice_sort_spec</span></a><span> </span><span class="main"><span class="free"><span>(<span class="hidden">❙</span><b>&lt;</b>)</span></span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_716..726"><span>par_sort_aux_def</span></a><span> 
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/eqsubst.ML.html#HOL.subst|method"><span class="operator"><span>subst</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.if_cancel|fact"><span>if_cancel</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/RefineG_Recursion.html#RefineG_Recursion.RECT_rule_arb|fact"><span>RECT_rule_arb</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> V</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Wellfounded.html#Wellfounded.measure|const"><span>measure</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>d</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span>and</span></span></span></span></span><span> pre</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="bound"><span>xss</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>xss</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>xs</span></span><span>"</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span>2</span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.slice_sort_spec_def|fact"><span>slice_sort_spec_def</span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_122..129"><span>partition3_spec_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_471..489"><span>bad_partition_triv</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span> 
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><span>slice_eq_mset_all</span><span> </span><a class="entity_ref" href="Sorting_Misc.html#Sorting_Misc.slice_eq_mset_def|fact"><span>slice_eq_mset_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Refine_Util.html#Refine_Util.rprems|method"><span class="operator"><span>rprems</span></span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Refine_Util.html#Refine_Util.rprems|method"><span class="operator"><span>rprems</span></span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Refine_Util.html#Refine_Util.clarsimp_all|method"><span class="operator"><span>clarsimp_all</span></span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> xs' xs<span class="hidden">⇩</span><sub>2</sub>' xs<span class="hidden">⇩</span><sub>1</sub> xs<span class="hidden">⇩</span><sub>2</sub> xc x1b
      
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.sort_spec_def|fact"><span>sort_spec_def</span></a><span> </span><a class="entity_ref" href="Sorting_Misc.html#Sorting_Misc.slice_eq_mset_def|fact"><span>slice_eq_mset_def</span></a><span> </span><a class="entity_ref" href="Sorting_Partially_Sorted.html#Sorting_Partially_Sorted.slice_LT_def|fact"><span>slice_LT_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sorting_Quicksort_Scheme.html#Sorting_Quicksort_Scheme.slice_complete&apos;|fact"><span>slice_complete'</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.sorted_wrt_append|fact"><span>sorted_wrt_append</span></a><span> </span><span>le_by_lt</span><span> </span><a class="entity_ref" href="Sorting_Quicksort_Scheme.html#Sorting_Quicksort_Scheme.slice_append1&apos;|fact"><span>slice_append1'</span></a><span> </span><a class="entity_ref" href="Sorting_Quicksort_Scheme.html#Sorting_Quicksort_Scheme.slice_append2&apos;|fact"><span>slice_append2'</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/HOL-Library.Multiset.html#Multiset.set_mset_mset|fact"><span>set_mset_mset</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
    
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Introducing explicit parameter for list length›</span></span></span><span>  
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux2_def|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux2_def|thm"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux2_def_raw|axiom"><span class="entity_def" id="offset_2701..2711">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux2.cong|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux2.cong|thm"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux2|const"><span class="entity_def" id="offset_2713..2726">par_sort_aux2</span></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>d</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/RefineG_Recursion.html#RefineG_Recursion.RECT|const"><span>RECT</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span class="bound"><span>n</span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><span class="bound"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><a class="entity_ref" href="Sorting_Parsort.html#Sorting_Parsort.weak_ordering.par_sort_seq_threshold|const"><span>par_sort_seq_threshold</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span>
      </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.slice_sort_spec|const"><span>slice_sort_spec</span></a><span> </span><span class="main"><span class="free"><span>(<span class="hidden">❙</span><b>&lt;</b>)</span></span></span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="bound"><span>n</span></span><span>
    </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><span class="main"><span>(</span></span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span>partition3_spec</span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>bad</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#Sorting_Parsort.weak_ordering.bad_partition|const"><span>bad_partition</span></a><span> </span><span class="bound"><span>m</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>;</span></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>,</span></span><span class="bound"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/IICF_Array.html#IICF_Array.WITH_SPLIT|const"><span>WITH_SPLIT</span></a><span> </span><span class="bound"><span>m</span></span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>bad</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
          </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>m</span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>}</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
          </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Parallel.html#Sepref_Parallel.nres_par|const"><span>nres_par</span></a><span> </span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>m</span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Unity|const"><span>()</span></a></span><span class="main"><span>,</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>xs</span></span><span>
    </span><span class="main"><span>}</span></span><span>
  </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span class="main"><span>,</span></span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><span>,</span></span><span class="free"><span class="bound"><span class="entity"><span>d</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux2_refine|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux2_refine|thm"><span class="entity_def" id="offset_3438..3458">par_sort_aux2_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_2713..2726"><span>par_sort_aux2</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>d</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><span class="main"><span>⟨</span></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.list_rel|const"><span>list_rel</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Parsort.html#offset_728..740"><span>par_sort_aux</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>d</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_2701..2711"><span>par_sort_aux2_def</span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_716..726"><span>par_sort_aux_def</span></a><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Parallel.html#Sepref_Parallel.nres_par_def|fact"><span>nres_par_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>supply</span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Heuristics.html#Refine_Heuristics.refine_dref_RELATES|attribute"><span class="operator"><span>refine_dref_RELATES</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Heuristics.html#Refine_Heuristics.RELATESI|fact"><span>RELATESI</span></a><span class="main"><span>[</span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> R</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span class="bound"><span>n</span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>xs'</span></span><span class="main"><span>,</span></span><span class="bound"><span>d'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>xs'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="bound"><span>d'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>d</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>n</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Heuristics.html#Refine_Heuristics.refine_dref_type|method"><span class="operator"><span>refine_dref_type</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp_all</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span class="quasi_keyword"><span>no_asm_use</span></span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span> </span><span class="comment1"><span>(* TODO: This is a hack against a yet unidentified simplifier loop *)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>



  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Fixing concrete algorithms to be used›</span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Version with sequential partitioner›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux3_def|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux3_def|thm"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux3_def_raw|axiom"><span class="entity_def" id="offset_3982..3992">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux3.cong|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux3.cong|thm"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux3|const"><span class="entity_def" id="offset_3994..4007">par_sort_aux3</span></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>d</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/RefineG_Recursion.html#RefineG_Recursion.RECT|const"><span>RECT</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span class="bound"><span>n</span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><span class="bound"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><a class="entity_ref" href="Sorting_Parsort.html#Sorting_Parsort.weak_ordering.par_sort_seq_threshold|const"><span>par_sort_seq_threshold</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span>
      </span><span>pdqsort</span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="bound"><span>n</span></span><span>
    </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><span class="main"><span>(</span></span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span>partition_pivot_sample</span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>bad</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#Sorting_Parsort.weak_ordering.bad_partition|const"><span>bad_partition</span></a><span> </span><span class="bound"><span>m</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>;</span></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>,</span></span><span class="bound"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/IICF_Array.html#IICF_Array.WITH_SPLIT|const"><span>WITH_SPLIT</span></a><span> </span><span class="bound"><span>m</span></span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>bad</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
          </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>m</span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>}</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
          </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Parallel.html#Sepref_Parallel.nres_par|const"><span>nres_par</span></a><span> </span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>m</span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>
          
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Unity|const"><span>()</span></a></span><span class="main"><span>,</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>xs</span></span><span>
    </span><span class="main"><span>}</span></span><span>
  </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span class="main"><span>,</span></span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><span>,</span></span><span class="free"><span class="bound"><span class="entity"><span>d</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

  
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Version with parallel partitioner›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppar_sort_aux3_def|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppar_sort_aux3_def|thm"><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppar_sort_aux3_def_raw|axiom"><span class="entity_def" id="offset_4781..4791">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppar_sort_aux3.cong|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppar_sort_aux3.cong|thm"><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppar_sort_aux3|const"><span class="entity_def" id="offset_4793..4807">ppar_sort_aux3</span></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>d</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/RefineG_Recursion.html#RefineG_Recursion.RECT|const"><span>RECT</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span class="bound"><span>n</span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><span class="bound"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><a class="entity_ref" href="Sorting_Parsort.html#Sorting_Parsort.weak_ordering.par_sort_seq_threshold|const"><span>par_sort_seq_threshold</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span>
      </span><span>pdqsort</span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="bound"><span>n</span></span><span>
    </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><span class="main"><span>(</span></span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span>ppart_partition_pivot</span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#Sorting_Parsort.weak_ordering.ppar_chunk_size|const"><span>ppar_chunk_size</span></a><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>bad</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#Sorting_Parsort.weak_ordering.bad_partition|const"><span>bad_partition</span></a><span> </span><span class="bound"><span>m</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>;</span></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>,</span></span><span class="bound"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/IICF_Array.html#IICF_Array.WITH_SPLIT|const"><span>WITH_SPLIT</span></a><span> </span><span class="bound"><span>m</span></span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>bad</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
          </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>m</span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>}</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
          </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Parallel.html#Sepref_Parallel.nres_par|const"><span>nres_par</span></a><span> </span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="bound"><span>par_sort_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>m</span></span><span class="main"><span>,</span></span><span class="bound"><span>d</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>
          
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Unity|const"><span>()</span></a></span><span class="main"><span>,</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>,</span></span><span class="bound"><span>xs<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>xs</span></span><span>
    </span><span class="main"><span>}</span></span><span>
  </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span class="main"><span>,</span></span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><span>,</span></span><span class="free"><span class="bound"><span class="entity"><span>d</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  

  </span><span class="comment1"><span>(* TODO: Move *)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.weak_ordering.introsort4_refines_spec|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.introsort4_refines_spec|thm"><span class="entity_def" id="offset_5578..5601">introsort4_refines_spec</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span class="main"><span>(</span></span><span class="free"><span>xs'</span></span><span class="main"><span>,</span></span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.list_rel|const"><span>list_rel</span></a><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>l'</span></span><span class="main"><span>,</span></span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.nat_rel|const"><span>nat_rel</span></a><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>h'</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.nat_rel|const"><span>nat_rel</span></a><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span>introsort4</span><span> </span><span class="free"><span>xs'</span></span><span> </span><span class="free"><span>l'</span></span><span> </span><span class="free"><span>h'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.slice_sort_spec|const"><span>slice_sort_spec</span></a><span> </span><span class="main"><span class="free"><span>(<span class="hidden">❙</span><b>&lt;</b>)</span></span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>introsort4_correct</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.weak_ordering.pdqsort_refines_spec|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.pdqsort_refines_spec|thm"><span class="entity_def" id="offset_5769..5789">pdqsort_refines_spec</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span class="main"><span>(</span></span><span class="free"><span>xs'</span></span><span class="main"><span>,</span></span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.list_rel|const"><span>list_rel</span></a><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>l'</span></span><span class="main"><span>,</span></span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.nat_rel|const"><span>nat_rel</span></a><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>h'</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.nat_rel|const"><span>nat_rel</span></a><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span>pdqsort</span><span> </span><span class="free"><span>xs'</span></span><span> </span><span class="free"><span>l'</span></span><span> </span><span class="free"><span>h'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.slice_sort_spec|const"><span>slice_sort_spec</span></a><span> </span><span class="main"><span class="free"><span>(<span class="hidden">❙</span><b>&lt;</b>)</span></span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>pdqsort_correct</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux3_refine|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux3_refine|thm"><span class="entity_def" id="offset_5951..5971">par_sort_aux3_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sorting_Parsort.html#offset_3994..4007"><span>par_sort_aux3</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>d</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Parsort.html#offset_2713..2726"><span>par_sort_aux2</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>d</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_3982..3992"><span>par_sort_aux3_def</span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_2701..2711"><span>par_sort_aux2_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>thm</span></span></span><span> </span><span>partition_pivot_correct</span><span> </span><span>partition_pivot_sample_correct</span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span> </span><span>partition_pivot_sample_correct</span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_5578..5601"><span>introsort4_refines_spec</span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_5769..5789"><span>pdqsort_refines_spec</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Heuristics.html#Refine_Heuristics.refine_dref_type|method"><span class="operator"><span>refine_dref_type</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>    

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppart_partition_pivot_refines_part3&apos;|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppart_partition_pivot_refines_part3&apos;|thm"><span class="entity_def" id="offset_6288..6324">ppart_partition_pivot_refines_part3'</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span class="free"><span>d'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>xs</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>xs'</span></span><span class="main"><span>,</span></span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>n'</span></span><span class="main"><span>,</span></span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>;</span></span><span> </span><span class="free"><span>l</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>⟧</span></span><span> 
    </span><span class="main"><span>⟹</span></span><span> </span><span>ppart_partition_pivot</span><span> </span><span class="free"><span>d'</span></span><span> </span><span class="free"><span>xs'</span></span><span> </span><span class="free"><span>n'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><span>(</span></span><span>partition3_spec</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>ppart_partition_pivot_refines_part3</span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="main"><span>)</span></span><span> 
    
    
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppar_sort_aux3_refine|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppar_sort_aux3_refine|thm"><span class="entity_def" id="offset_6532..6553">ppar_sort_aux3_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sorting_Parsort.html#offset_4793..4807"><span>ppar_sort_aux3</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>d</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Parsort.html#offset_2713..2726"><span>par_sort_aux2</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>d</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_4781..4791"><span>ppar_sort_aux3_def</span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_2701..2711"><span>par_sort_aux2_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>find_theorems</span></span></span><span> </span><span class="quoted"><span>ppart_partition_pivot</span></span><span>
    </span><span class="keyword1"><span class="command"><span>thm</span></span></span><span> </span><span>ppart_partition_pivot_refines_part3</span><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_IdI|fact"><span>refine_IdI</span></a><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_6288..6324"><span>ppart_partition_pivot_refines_part3'</span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_5578..5601"><span>introsort4_refines_spec</span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_5769..5789"><span>pdqsort_refines_spec</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Heuristics.html#Refine_Heuristics.refine_dref_type|method"><span class="operator"><span>refine_dref_type</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>    
    
        
  </span><span class="comment1"><span>(* TODO: Move *)</span></span><span>  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.weak_ordering.slice_sort_spec_complete|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.slice_sort_spec_complete|thm"><span class="entity_def" id="offset_6950..6974">slice_sort_spec_complete</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.slice_sort_spec|const"><span>slice_sort_spec</span></a><span> </span><span class="free"><span>lt</span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.sort_spec|const"><span>sort_spec</span></a><span> </span><span class="free"><span>lt</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.slice_sort_spec_def|fact"><span>slice_sort_spec_def</span></a><span> </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.sort_spec_def|fact"><span>sort_spec_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.le_refl|fact"><span>le_refl</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/HOL-Library.Multiset.html#Multiset.mset_eq_length|fact"><span>mset_eq_length</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.slice_complete|fact"><span>slice_complete</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_7164..7169">lemma</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux2_correct|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux2_correct|thm"><span class="entity_def" id="offset_7170..7191">par_sort_aux2_correct</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span>  
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sorting_Parsort.html#offset_2713..2726"><span>par_sort_aux2</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>d</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.sort_spec|const"><span>sort_spec</span></a><span> </span><span class="main"><span class="free"><span>(<span class="hidden">❙</span><b>&lt;</b>)</span></span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_3438..3458"><span>par_sort_aux2_refine</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_7164..7169"><span>assms</span></a><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_1718..1738"><span>par_sort_aux_correct</span></a><span>
    </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_6950..6974"><span>slice_sort_spec_complete</span></a><span>
    </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
    
        
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_7461..7466">lemma</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux3_correct|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_aux3_correct|thm"><span class="entity_def" id="offset_7467..7488">par_sort_aux3_correct</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span>  
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sorting_Parsort.html#offset_3994..4007"><span>par_sort_aux3</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>d</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.sort_spec|const"><span>sort_spec</span></a><span> </span><span class="main"><span class="free"><span>(<span class="hidden">❙</span><b>&lt;</b>)</span></span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_5951..5971"><span>par_sort_aux3_refine</span></a><span class="main"><span>[</span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> d</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="free"><span>d</span></span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_7170..7191"><span>par_sort_aux2_correct</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_7461..7466"><span>assms</span></a><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_7718..7723">lemma</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppar_sort_aux3_correct|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppar_sort_aux3_correct|thm"><span class="entity_def" id="offset_7724..7746">ppar_sort_aux3_correct</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span>  
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sorting_Parsort.html#offset_4793..4807"><span>ppar_sort_aux3</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>d</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.sort_spec|const"><span>sort_spec</span></a><span> </span><span class="main"><span class="free"><span>(<span class="hidden">❙</span><b>&lt;</b>)</span></span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_6532..6553"><span>ppar_sort_aux3_refine</span></a><span class="main"><span>[</span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> d</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="free"><span>d</span></span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_7170..7191"><span>par_sort_aux2_correct</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_7718..7723"><span>assms</span></a><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
      
  
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Initializing depth bound›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_def|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_def|thm"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_def_raw|axiom"><span class="entity_def" id="offset_8021..8031">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort.cong|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort.cong|thm"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort|const"><span class="entity_def" id="offset_8033..8041">par_sort</span></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><a class="entity_ref" href="Sorting_Parsort.html#offset_3994..4007"><span>par_sort_aux3</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="HOL-Library.Discrete.html#Discrete.log|const"><span>Discrete.log</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>}</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span>
  </span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_correct|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.par_sort_correct|thm"><span class="entity_def" id="offset_8160..8176">par_sort_correct</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_8033..8041"><span>par_sort</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.sort_spec|const"><span>sort_spec</span></a><span> </span><span class="main"><span class="free"><span>(<span class="hidden">❙</span><b>&lt;</b>)</span></span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_8021..8031"><span>par_sort_def</span></a><span> 
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_7467..7488"><span>par_sort_aux3_correct</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.sort_spec_def|fact"><span>sort_spec_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.sorted_wrt01|fact"><span>sorted_wrt01</span></a><span class="main"><span>)</span></span><span>

    
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppar_sort_def|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppar_sort_def|thm"><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppar_sort_def_raw|axiom"><span class="entity_def" id="offset_8362..8372">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppar_sort.cong|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppar_sort.cong|thm"><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppar_sort|const"><span class="entity_def" id="offset_8374..8383">ppar_sort</span></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><a class="entity_ref" href="Sorting_Parsort.html#offset_4793..4807"><span>ppar_sort_aux3</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="HOL-Library.Discrete.html#Discrete.log|const"><span>Discrete.log</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>}</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span>
  </span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppar_sort_correct|fact"><span class="entity_def" id="Sorting_Parsort.weak_ordering.ppar_sort_correct|thm"><span class="entity_def" id="offset_8503..8520">ppar_sort_correct</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_8374..8383"><span>ppar_sort</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.sort_spec|const"><span>sort_spec</span></a><span> </span><span class="main"><span class="free"><span>(<span class="hidden">❙</span><b>&lt;</b>)</span></span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_8362..8372"><span>ppar_sort_def</span></a><span> 
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_7724..7746"><span>ppar_sort_aux3_correct</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.sort_spec_def|fact"><span>sort_spec_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.sorted_wrt01|fact"><span>sorted_wrt01</span></a><span class="main"><span>)</span></span><span>
            
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>    
    
</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Refining to LLVM›</span></span></span><span>


</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_8759..8766">context</span></span></span><span> </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.sort_impl_context|locale"><span>sort_impl_context</span></a><span> </span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.bad_partition.mcomb|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.bad_partition.arity|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.bad_partition.itype|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.bad_partition.mcomb|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.bad_partition.arity|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.bad_partition.itype|thm"><span>sepref_register</span></span></span></span></span></span></span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="Sorting_Parsort.html#Sorting_Parsort.weak_ordering.bad_partition|const"><span>bad_partition</span></a></span><span>
  </span><span class="keyword1"><span class="command"><span>sepref_def</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.bad_partition_impl|const"><span>bad_partition_impl</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../Isabelle_LLVM/LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_inline|attribute"><span class="operator"><span>llvm_inline</span></span></a><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#Sorting_Parsort.weak_ordering.bad_partition|const"><span>bad_partition</span></a><span>"</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.size_assn|const"><span>size_assn</span></a><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfkeep|const"><span><span class="hidden">⇧</span><sup>k</sup></span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.size_assn|const"><span>size_assn</span></a><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfkeep|const"><span><span class="hidden">⇧</span><sup>k</sup></span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefttnd|const"><span>→<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_HOL_Bindings.html#Sepref_HOL_Bindings.bool1_assn|const"><span>bool1_assn</span></a><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_8759..8766"><span>bad_partition_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_HOL_Bindings.html#Sepref_HOL_Bindings.annot_snat_const|method"><span class="operator"><span>annot_snat_const</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.size_t|type"><span>size_t</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.bad_partition_impl.refine|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.bad_partition_impl_def|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.bad_partition_impl.refine_raw|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.bad_partition_impl.refine|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.bad_partition_impl_def|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.bad_partition_impl.refine_raw|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.bad_partition_impl_def_raw|axiom"><span>by</span></span></span></span></span></span></span></span></span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Tool.html#Sepref_Tool.sepref|method"><span class="operator"><span>sepref</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_aux3.mcomb|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_aux3.arity|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_aux3.itype|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_aux3.pat|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_aux3.mcomb|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_aux3.arity|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_aux3.itype|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_aux3.pat|thm"><span>sepref_register</span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="Sorting_Parsort.html#offset_3994..4007"><span>par_sort_aux3</span></a></span><span>
  
  </span><span class="keyword1"><span class="command"><span>sepref_def</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_aux_impl.cong|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_aux_impl.cong|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_aux_impl|const"><span>par_sort_aux_impl</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Misc.html#Sepref_Misc.uncurry2|const"><span>uncurry2</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_3994..4007"><span>par_sort_aux3</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>[</span></a></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="main"><span>(</span></span><span>arr_assn</span><span class="main"><span>)</span></span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfdrop|const"><span><span class="hidden">⇧</span><sup>d</sup></span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.size_assn|const"><span>size_assn</span></a><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfkeep|const"><span><span class="hidden">⇧</span><sup>k</sup></span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.size_assn|const"><span>size_assn</span></a><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfkeep|const"><span><span class="hidden">⇧</span><sup>k</sup></span></a></span><span>  
    </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>→</span></a></span><span> </span><span>arr_assn</span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>[</span></a></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>ai</span></span><span class="main"><span>,</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>ai</span></span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_8759..8766"><span>par_sort_aux3_def</span></a><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST_def|fact"><span>PR_CONST_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>supply</span></span></span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="operator"><span>goals_limit</span></span><span> </span><span class="main"><span class="main"><span>=</span></span></span><span> 1</span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_HOL_Bindings.html#Sepref_HOL_Bindings.annot_snat_const|method"><span class="operator"><span>annot_snat_const</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.size_t|type"><span>size_t</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Isabelle_LLVM/ISABELLE_HOME/src/HOL/Library/rewrite.ML.html#Rewrite.rewrite|method"><span class="operator"><span>rewrite</span></span></a><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Translate.html#Sepref_Translate.RECT_cp_annot|fact"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Translate.html#Sepref_Translate.RECT_cp_annot|fact"><span>RECT_cp_annot</span></a></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> CP</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>ai</span></span><span class="main"><span>,</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>,</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>ai</span></span><span>"</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>supply</span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Translate.html#Sepref_Translate.sepref_comb_rules|attribute"><span class="operator"><span>sepref_comb_rules</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Translate.html#Sepref_Translate.hn_RECT_cp_annot_noframe|fact"><span>hn_RECT_cp_annot_noframe</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Tool.html#Sepref_Tool.sepref|method"><span class="operator"><span>sepref</span></span></a><span>
</span><span class="comment1"><span>(* 
  (* debugging boilerplate: *)
  apply sepref_dbg_preproc
  apply sepref_dbg_cons_init
  apply sepref_dbg_id
  apply sepref_dbg_monadify
  apply sepref_dbg_opt_init
  apply sepref_dbg_trans
  apply sepref_dbg_opt
  apply sepref_dbg_cons_solve
  apply sepref_dbg_cons_solve
  apply sepref_dbg_cons_solve_cp
  apply sepref_dbg_constraints
*)</span></span><span>  
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_aux_impl.refine|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_aux_impl_def|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_aux_impl.refine_raw|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_aux_impl.refine|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_aux_impl_def|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_aux_impl.refine_raw|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_aux_impl_def_raw|axiom"><span>done</span></span></span></span></span></span></span></span></span></span></span></span><span>
  

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort.mcomb|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort.arity|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort.itype|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort.pat|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort.mcomb|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort.arity|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort.itype|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort.pat|thm"><span>sepref_register</span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="Sorting_Parsort.html#offset_8033..8041"><span>par_sort</span></a></span><span>
  </span><span class="keyword1"><span class="command"><span>sepref_def</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_impl.cong|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_impl.cong|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_impl|const"><span class="entity_def" id="offset_9899..9912">par_sort_impl</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_8033..8041"><span>par_sort</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>[</span></a></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="main"><span>(</span></span><span>arr_assn</span><span class="main"><span>)</span></span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfdrop|const"><span><span class="hidden">⇧</span><sup>d</sup></span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.size_assn|const"><span>size_assn</span></a><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfkeep|const"><span><span class="hidden">⇧</span><sup>k</sup></span></a></span><span>  
    </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>→</span></a></span><span> </span><span>arr_assn</span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>[</span></a></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>ai</span></span><span class="main"><span>,</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>ai</span></span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_8759..8766"><span>par_sort_def</span></a><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST_def|fact"><span>PR_CONST_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_HOL_Bindings.html#Sepref_HOL_Bindings.annot_snat_const|method"><span class="operator"><span>annot_snat_const</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.size_t|type"><span>size_t</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>supply</span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.intro|attribute"><span class="operator"><span>intro</span></span></a><span class="main"><span class="main"><span>!</span></span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sorting_Introsort.html#Sorting_Introsort.introsort_depth_limit_in_bounds_aux|fact"><span>introsort_depth_limit_in_bounds_aux</span></a><span> 
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_impl.refine|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_impl_def|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_impl.refine_raw|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_impl.refine|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_impl_def|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_impl.refine_raw|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_impl_def_raw|axiom"><span class="entity_def" id="offset_10182..10184">by</span></span></span></span></span></span></span></span></span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Tool.html#Sepref_Tool.sepref|method"><span class="operator"><span>sepref</span></span></a><span>
  
  </span><span class="keyword1"><span class="command"><span>thm</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_10182..10184"><span>par_sort_impl.refine</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.to_hnr|attribute"><span class="operator"><span>to_hnr</span></span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>xs</span></span></span><span> </span><span class="quoted"><span class="free"><span>xsi</span></span></span><span> </span><span class="quoted"><span class="free"><span>n</span></span></span><span> </span><span class="quoted"><span class="free"><span>ni</span></span></span><span class="main"><span>]</span></span><span>
      
  </span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Final Correctness Theorem as Hoare-Triple›</span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_refine_aux|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_refine_aux|thm"><span class="entity_def" id="offset_10343..10362">par_sort_refine_aux</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_8033..8041"><span>par_sort</span></a><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>xs</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.sort_spec|const"><span>sort_spec</span></a><span> </span><span class="main"><span class="free"><span>(<span class="hidden">❙</span><b>&lt;</b>)</span></span></span><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_8160..8176"><span>par_sort_correct</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pw_nres_rel_iff|fact"><span>pw_nres_rel_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pw_le_iff|fact"><span>pw_le_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span class="main"><span>)</span></span><span>
        
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹We unfold the definition of </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>‹</span></span><span>hnr›</span></span></span><span>, to extract a correctness statement as Hoare-Triple›</span></span></span><span>  
  </span><span class="keyword1"><span class="command"><span>theorem</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_impl_correct|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_impl_correct|thm"><span class="entity_def" id="offset_10700..10721">par_sort_impl_correct</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Isabelle_LLVM/LLVM_Shallow_RS.html#LLVM_Shallow_RS.llvm_htriple|const"><span>llvm_htriple</span></a><span> </span><span class="main"><span>(</span></span><span>arr_assn</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>xsi</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_HOL_Bindings.html#Sepref_HOL_Bindings.snat_assn|const"><span>snat_assn</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>ni</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 
    </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Parsort.html#offset_9899..9912"><span>par_sort_impl</span></a><span> </span><span class="free"><span>xsi</span></span><span> </span><span class="free"><span>ni</span></span><span class="main"><span>)</span></span><span> 
    </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><span class="bound"><span>r</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>xsi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.pred_ex|const"><span>EXS</span></a></span><span> </span><span class="bound"><span>xs'</span></span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.pred_ex|const"><span>.</span></a></span><span> </span><span>arr_assn</span><span> </span><span class="bound"><span>xs'</span></span><span> </span><span class="free"><span>xsi</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.sort_spec|const"><span>sort_spec</span></a><span> </span><span class="main"><span class="free"><span>(<span class="hidden">❙</span><b>&lt;</b>)</span></span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="bound"><span>xs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../Isabelle_LLVM/LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.cons_rule|fact"><span>cons_rule</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>supply</span></span></span></span></span><span> </span><span class="entity_def" id="offset_10977..10978">R</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_10182..10184"><span>par_sort_impl.refine</span></a><span class="main"><span>[</span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST_def|fact"><span>PR_CONST_def</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.FCOMP|attribute"><span class="operator"><span>FCOMP</span></span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_10343..10362"><span>par_sort_refine_aux</span></a><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.to_hnr|attribute"><span class="operator"><span>to_hnr</span></span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>simplified</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>supply</span></span></span></span></span><span> </span><span class="entity_def" id="offset_11082..11083">R</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_10977..10978"><span>R</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>xs</span></span></span><span> </span><span class="quoted"><span class="free"><span>xsi</span></span></span><span> </span><span class="quoted"><span class="free"><span>n</span></span></span><span> </span><span class="quoted"><span class="free"><span>ni</span></span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_11082..11083"><span>R</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Basic.html#Sepref_Basic.hn_refineD|fact"><span>hn_refineD</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Basic.html#Sepref_Basic.pure_def|fact"><span>pure_def</span></a><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Basic.html#Sepref_Basic.invalid_assn_def|fact"><span>invalid_assn_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹With the sorting specification unfolded, too. 
    Note that </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/HOL-Library.Multiset.html#Multiset.mset|const"><span>mset</span></a><span>›</span></span><span> and </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.sorted_wrt|const"><span>sorted_wrt</span></a><span>›</span></span><span> are standard concepts from Isabelle's library.
  ›</span></span></span><span>  
  </span><span class="keyword1"><span class="command"><span>theorem</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_impl_correct&apos;|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_context.par_sort_impl_correct&apos;|thm"><span>par_sort_impl_correct'</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Isabelle_LLVM/LLVM_Shallow_RS.html#LLVM_Shallow_RS.llvm_htriple|const"><span>llvm_htriple</span></a><span> </span><span class="main"><span>(</span></span><span>arr_assn</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>xsi</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_HOL_Bindings.html#Sepref_HOL_Bindings.snat_assn|const"><span>snat_assn</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>ni</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 
    </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Parsort.html#offset_9899..9912"><span>par_sort_impl</span></a><span> </span><span class="free"><span>xsi</span></span><span> </span><span class="free"><span>ni</span></span><span class="main"><span>)</span></span><span> 
    </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><span class="bound"><span>r</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>xsi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.pred_ex|const"><span>EXS</span></a></span><span> </span><span class="bound"><span>xs'</span></span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.pred_ex|const"><span>.</span></a></span><span> </span><span>arr_assn</span><span> </span><span class="bound"><span>xs'</span></span><span> </span><span class="free"><span>xsi</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/HOL-Library.Multiset.html#Multiset.mset|const"><span>mset</span></a><span> </span><span class="bound"><span>xs'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/HOL-Library.Multiset.html#Multiset.mset|const"><span>mset</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.sorted_wrt|const"><span>sorted_wrt</span></a><span> </span><span class="main"><span class="free"><span>(<span class="hidden">❙</span><b>≤</b>)</span></span></span><span> </span><span class="bound"><span>xs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../Isabelle_LLVM/LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.cons_rule|fact"><span>cons_rule</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_10700..10721"><span>par_sort_impl_correct</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.sort_spec_def|fact"><span>sort_spec_def</span></a><span> </span><span>le_by_lt</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
    
    

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_11872..11879">context</span></span></span><span> </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.sort_impl_copy_context|locale"><span>sort_impl_copy_context</span></a><span> </span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_aux3.mcomb|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_aux3.arity|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_aux3.itype|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_aux3.pat|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_aux3.mcomb|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_aux3.arity|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_aux3.itype|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_aux3.pat|thm"><span>sepref_register</span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="Sorting_Parsort.html#offset_4793..4807"><span>ppar_sort_aux3</span></a></span><span>
  </span><span class="keyword1"><span class="command"><span>sepref_def</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_aux_impl.cong|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_aux_impl.cong|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_aux_impl|const"><span>ppar_sort_aux_impl</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Misc.html#Sepref_Misc.uncurry2|const"><span>uncurry2</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_4793..4807"><span>ppar_sort_aux3</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>[</span></a></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="main"><span>(</span></span><span>arr_assn</span><span class="main"><span>)</span></span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfdrop|const"><span><span class="hidden">⇧</span><sup>d</sup></span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.size_assn|const"><span>size_assn</span></a><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfkeep|const"><span><span class="hidden">⇧</span><sup>k</sup></span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.size_assn|const"><span>size_assn</span></a><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfkeep|const"><span><span class="hidden">⇧</span><sup>k</sup></span></a></span><span>  
    </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>→</span></a></span><span> </span><span>arr_assn</span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>[</span></a></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>ai</span></span><span class="main"><span>,</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>ai</span></span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_11872..11879"><span>ppar_sort_aux3_def</span></a><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST_def|fact"><span>PR_CONST_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>supply</span></span></span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="operator"><span>goals_limit</span></span><span> </span><span class="main"><span class="main"><span>=</span></span></span><span> 1</span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_HOL_Bindings.html#Sepref_HOL_Bindings.annot_snat_const|method"><span class="operator"><span>annot_snat_const</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.size_t|type"><span>size_t</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Isabelle_LLVM/ISABELLE_HOME/src/HOL/Library/rewrite.ML.html#Rewrite.rewrite|method"><span class="operator"><span>rewrite</span></span></a><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Translate.html#Sepref_Translate.RECT_cp_annot|fact"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Translate.html#Sepref_Translate.RECT_cp_annot|fact"><span>RECT_cp_annot</span></a></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> CP</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>ai</span></span><span class="main"><span>,</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>,</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>ai</span></span><span>"</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>supply</span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Translate.html#Sepref_Translate.sepref_comb_rules|attribute"><span class="operator"><span>sepref_comb_rules</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Translate.html#Sepref_Translate.hn_RECT_cp_annot_noframe|fact"><span>hn_RECT_cp_annot_noframe</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Tool.html#Sepref_Tool.sepref|method"><span class="operator"><span>sepref</span></span></a><span>
</span><span class="comment1"><span>(* 
  (* debugging boilerplate: *)
  apply sepref_dbg_preproc
  apply sepref_dbg_cons_init
  apply sepref_dbg_id
  apply sepref_dbg_monadify
  apply sepref_dbg_opt_init
  apply sepref_dbg_trans
  apply sepref_dbg_opt
  apply sepref_dbg_cons_solve
  apply sepref_dbg_cons_solve
  apply sepref_dbg_cons_solve_cp
  apply sepref_dbg_constraints
*)</span></span><span>  
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_aux_impl.refine|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_aux_impl_def|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_aux_impl.refine_raw|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_aux_impl.refine|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_aux_impl_def|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_aux_impl.refine_raw|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_aux_impl_def_raw|axiom"><span>done</span></span></span></span></span></span></span></span></span></span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort.mcomb|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort.arity|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort.itype|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort.pat|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort.mcomb|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort.arity|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort.itype|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort.pat|thm"><span>sepref_register</span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="Sorting_Parsort.html#offset_8374..8383"><span>ppar_sort</span></a></span><span>
  </span><span class="keyword1"><span class="command"><span>sepref_def</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_impl.cong|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_impl.cong|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_impl|const"><span class="entity_def" id="offset_12771..12785">ppar_sort_impl</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_8374..8383"><span>ppar_sort</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>[</span></a></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="main"><span>(</span></span><span>arr_assn</span><span class="main"><span>)</span></span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfdrop|const"><span><span class="hidden">⇧</span><sup>d</sup></span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.size_assn|const"><span>size_assn</span></a><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfkeep|const"><span><span class="hidden">⇧</span><sup>k</sup></span></a></span><span>  
    </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>→</span></a></span><span> </span><span>arr_assn</span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>[</span></a></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>ai</span></span><span class="main"><span>,</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>ai</span></span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.hfrefptnd|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_11872..11879"><span>ppar_sort_def</span></a><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST_def|fact"><span>PR_CONST_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_HOL_Bindings.html#Sepref_HOL_Bindings.annot_snat_const|method"><span class="operator"><span>annot_snat_const</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.size_t|type"><span>size_t</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>supply</span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.intro|attribute"><span class="operator"><span>intro</span></span></a><span class="main"><span class="main"><span>!</span></span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sorting_Introsort.html#Sorting_Introsort.introsort_depth_limit_in_bounds_aux|fact"><span>introsort_depth_limit_in_bounds_aux</span></a><span> 
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_impl.refine|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_impl_def|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_impl.refine_raw|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_impl.refine|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_impl_def|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_impl.refine_raw|thm"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_impl_def_raw|axiom"><span class="entity_def" id="offset_13057..13059">by</span></span></span></span></span></span></span></span></span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Tool.html#Sepref_Tool.sepref|method"><span class="operator"><span>sepref</span></span></a><span>
  
  </span><span class="keyword1"><span class="command"><span>thm</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_13057..13059"><span>ppar_sort_impl.refine</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.to_hnr|attribute"><span class="operator"><span>to_hnr</span></span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>xs</span></span></span><span> </span><span class="quoted"><span class="free"><span>xsi</span></span></span><span> </span><span class="quoted"><span class="free"><span>n</span></span></span><span> </span><span class="quoted"><span class="free"><span>ni</span></span></span><span class="main"><span>]</span></span><span>
      
  </span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Final Correctness Theorem as Hoare-Triple›</span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_refine_aux|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_refine_aux|thm"><span class="entity_def" id="offset_13219..13239">ppar_sort_refine_aux</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_8374..8383"><span>ppar_sort</span></a><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>xs</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.sort_spec|const"><span>sort_spec</span></a><span> </span><span class="main"><span class="free"><span>(<span class="hidden">❙</span><b>&lt;</b>)</span></span></span><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_8503..8520"><span>ppar_sort_correct</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pw_nres_rel_iff|fact"><span>pw_nres_rel_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pw_le_iff|fact"><span>pw_le_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span class="main"><span>)</span></span><span>
        
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹We unfold the definition of </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>‹</span></span><span>hnr›</span></span></span><span>, to extract a correctness statement as Hoare-Triple›</span></span></span><span>  
  </span><span class="keyword1"><span class="command"><span>theorem</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_impl_correct|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_impl_correct|thm"><span class="entity_def" id="offset_13579..13601">ppar_sort_impl_correct</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Isabelle_LLVM/LLVM_Shallow_RS.html#LLVM_Shallow_RS.llvm_htriple|const"><span>llvm_htriple</span></a><span> </span><span class="main"><span>(</span></span><span>arr_assn</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>xsi</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_HOL_Bindings.html#Sepref_HOL_Bindings.snat_assn|const"><span>snat_assn</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>ni</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 
    </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Parsort.html#offset_12771..12785"><span>ppar_sort_impl</span></a><span> </span><span class="free"><span>xsi</span></span><span> </span><span class="free"><span>ni</span></span><span class="main"><span>)</span></span><span> 
    </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><span class="bound"><span>r</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>xsi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.pred_ex|const"><span>EXS</span></a></span><span> </span><span class="bound"><span>xs'</span></span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.pred_ex|const"><span>.</span></a></span><span> </span><span>arr_assn</span><span> </span><span class="bound"><span>xs'</span></span><span> </span><span class="free"><span>xsi</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.sort_spec|const"><span>sort_spec</span></a><span> </span><span class="main"><span class="free"><span>(<span class="hidden">❙</span><b>&lt;</b>)</span></span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="bound"><span>xs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../Isabelle_LLVM/LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.cons_rule|fact"><span>cons_rule</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>supply</span></span></span></span></span><span> </span><span class="entity_def" id="offset_13858..13859">R</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_13057..13059"><span>ppar_sort_impl.refine</span></a><span class="main"><span>[</span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST_def|fact"><span>PR_CONST_def</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.FCOMP|attribute"><span class="operator"><span>FCOMP</span></span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_13219..13239"><span>ppar_sort_refine_aux</span></a><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Rules.html#Sepref_Rules.to_hnr|attribute"><span class="operator"><span>to_hnr</span></span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>simplified</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>supply</span></span></span></span></span><span> </span><span class="entity_def" id="offset_13965..13966">R</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_13858..13859"><span>R</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>xs</span></span></span><span> </span><span class="quoted"><span class="free"><span>xsi</span></span></span><span> </span><span class="quoted"><span class="free"><span>n</span></span></span><span> </span><span class="quoted"><span class="free"><span>ni</span></span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_13965..13966"><span>R</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Basic.html#Sepref_Basic.hn_refineD|fact"><span>hn_refineD</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Basic.html#Sepref_Basic.pure_def|fact"><span>pure_def</span></a><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_Basic.html#Sepref_Basic.invalid_assn_def|fact"><span>invalid_assn_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹With the sorting specification unfolded, too. 
    Note that </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/HOL-Library.Multiset.html#Multiset.mset|const"><span>mset</span></a><span>›</span></span><span> and </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.sorted_wrt|const"><span>sorted_wrt</span></a><span>›</span></span><span> are standard concepts from Isabelle's library.
  ›</span></span></span><span>  
  </span><span class="keyword1"><span class="command"><span>theorem</span></span></span><span> </span><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_impl_correct&apos;|fact"><span class="entity_def" id="Sorting_Parsort.sort_impl_copy_context.ppar_sort_impl_correct&apos;|thm"><span>ppar_sort_impl_correct'</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Isabelle_LLVM/LLVM_Shallow_RS.html#LLVM_Shallow_RS.llvm_htriple|const"><span>llvm_htriple</span></a><span> </span><span class="main"><span>(</span></span><span>arr_assn</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>xsi</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sepref_HOL_Bindings.html#Sepref_HOL_Bindings.snat_assn|const"><span>snat_assn</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>ni</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 
    </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sorting_Parsort.html#offset_12771..12785"><span>ppar_sort_impl</span></a><span> </span><span class="free"><span>xsi</span></span><span> </span><span class="free"><span>ni</span></span><span class="main"><span>)</span></span><span> 
    </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><span class="bound"><span>r</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>xsi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.pred_ex|const"><span>EXS</span></a></span><span> </span><span class="bound"><span>xs'</span></span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.pred_ex|const"><span>.</span></a></span><span> </span><span>arr_assn</span><span> </span><span class="bound"><span>xs'</span></span><span> </span><span class="free"><span>xsi</span></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../Isabelle_LLVM/Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/HOL-Library.Multiset.html#Multiset.mset|const"><span>mset</span></a><span> </span><span class="bound"><span>xs'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/HOL-Library.Multiset.html#Multiset.mset|const"><span>mset</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.sorted_wrt|const"><span>sorted_wrt</span></a><span> </span><span class="main"><span class="free"><span>(<span class="hidden">❙</span><b>≤</b>)</span></span></span><span> </span><span class="bound"><span>xs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../Isabelle_LLVM/LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.cons_rule|fact"><span>cons_rule</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sorting_Parsort.html#offset_13579..13601"><span>ppar_sort_impl_correct</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Isabelle_LLVM/Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sorting_Setup.html#Sorting_Setup.sort_spec_def|fact"><span>sort_spec_def</span></a><span> </span><span>le_by_lt</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
    
    

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>