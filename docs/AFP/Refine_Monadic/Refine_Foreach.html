<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Refine_Foreach</title>
</head>


<body>
<div class="head">
<h1>Theory Refine_Foreach</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Foreach Loops›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><a href="Refine_Foreach.html"><span>Refine_Foreach</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> 
  </span><a href="Refine_While.html"><span>Refine_While</span></a><span> 
  </span><a href="Refine_Pfun.html"><span>Refine_Pfun</span></a><span> 
  </span><a href="Refine_Transfer.html"><span>Refine_Transfer</span></a><span> 
  </span><a href="Refine_Heuristics.html"><span>Refine_Heuristics</span></a><span>
  </span><span class="comment1"><span>(*"../Collections/Lib/SetIterator"
  "../Collections/Lib/Proper_Iterator"*)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹
  A common pattern for loop usage is iteration over the elements of a set.
  This theory provides the </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>‹</span></span><span>FOREACH›</span></span></span><span>-combinator, that iterates over 
  each element of a set.
›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Auxilliary Lemmas›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹The following lemma is commonly used when reasoning about iterator
  invariants.
  It helps converting the set of elements that remain to be iterated over to
  the set of elements already iterated over.›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.it_step_insert_iff|fact"><span class="entity_def" id="Refine_Foreach.it_step_insert_iff|thm"><span>it_step_insert_iff</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>it</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>it</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>S</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>(</span></span><span class="free"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="free"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert|const"><span>insert</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>S</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="free"><span>it</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Definition›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹
  Foreach-loops come in different versions, depending on whether they have an 
  annotated invariant (I), a termination condition (C), and an order (O).

  Note that asserting that the set is finite is not necessary to guarantee
  termination. However, we currently provide only iteration over finite sets,
  as this also matches the ICF concept of iterators.
›</span></span></span><span>
   
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.FOREACH_body_def|fact"><span class="entity_def" id="Refine_Foreach.FOREACH_body_def|thm"><span class="entity_def" id="Refine_Foreach.FOREACH_body_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Refine_Foreach.FOREACH_body|const"><span>FOREACH_body</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
  </span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.hd|const"><span>hd</span></a><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>←</span></span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.tl|const"><span>tl</span></a><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.FOREACH_cond_def|fact"><span class="entity_def" id="Refine_Foreach.FOREACH_cond_def|thm"><span class="entity_def" id="Refine_Foreach.FOREACH_cond_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Refine_Foreach.FOREACH_cond|const"><span>FOREACH_cond</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>FOREACH_cond</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>xs</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Foreach with continuation condition, order and annotated invariant:›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.FOREACHoci_def|fact"><span class="entity_def" id="Refine_Foreach.FOREACHoci_def|thm"><span class="entity_def" id="Refine_Foreach.FOREACHoci_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></span></span><span> </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword1"><span>FOREACH<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>C</sub>⇗</span></span><span>_</span><span class="keyword1"><span>,</span></span><span>_</span><span class="keyword1"><span>⇖</span></span><span>"</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>FOREACHoci</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>σ0</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
  </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>xs</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.distinct|const"><span>distinct</span></a><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.sorted_wrt|const"><span>sorted_wrt</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="main"><span>(</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="Refine_While.html#Refine_While.WHILEIT|const"><span>WHILEIT</span></a><span> 
    </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span class="bound"><span>xs'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="bound"><span>xs'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>it</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond|const"><span>FOREACH_cond</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_body|const"><span>FOREACH_body</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span class="free"><span class="bound"><span class="entity"><span>σ0</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> 
  </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Foreach with continuation condition and annotated invariant:›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.FOREACHci_def|fact"><span class="entity_def" id="Refine_Foreach.FOREACHci_def|thm"><span class="entity_def" id="Refine_Foreach.FOREACHci_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Refine_Foreach.FOREACHci|const"><span>FOREACHci</span></span></span><span> </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword1"><span>FOREACH<span class="hidden">⇩</span><sub>C</sub>⇗</span></span><span>_</span><span class="keyword1"><span>⇖</span></span><span>"</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>FOREACHci</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Foreach with continuation condition:›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.FOREACHc_def|fact"><span class="entity_def" id="Refine_Foreach.FOREACHc_def|thm"><span class="entity_def" id="Refine_Foreach.FOREACHc_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Refine_Foreach.FOREACHc|const"><span>FOREACHc</span></span></span><span> </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword1"><span>FOREACH<span class="hidden">⇩</span><sub>C</sub></span></span><span>"</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>FOREACHc</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci|const"><span>FOREACHci</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Foreach with annotated invariant:›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.FOREACHi_def|fact"><span class="entity_def" id="Refine_Foreach.FOREACHi_def|thm"><span class="entity_def" id="Refine_Foreach.FOREACHi_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Refine_Foreach.FOREACHi|const"><span>FOREACHi</span></span></span><span> </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword1"><span>FOREACH⇗</span></span><span>_</span><span class="keyword1"><span>⇖</span></span><span>"</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>FOREACHi</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci|const"><span>FOREACHci</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Foreach with annotated invariant and order:›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.FOREACHoi_def|fact"><span class="entity_def" id="Refine_Foreach.FOREACHoi_def|thm"><span class="entity_def" id="Refine_Foreach.FOREACHoi_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Refine_Foreach.FOREACHoi|const"><span>FOREACHoi</span></span></span><span> </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword1"><span>FOREACH<span class="hidden">⇩</span><sub>O</sub>⇗</span></span><span>_</span><span class="keyword1"><span>,</span></span><span>_</span><span class="keyword1"><span>⇖</span></span><span>"</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>FOREACHoi</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Basic foreach›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.FOREACH_def|fact"><span class="entity_def" id="Refine_Foreach.FOREACH_def|thm"><span class="entity_def" id="Refine_Foreach.FOREACH_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Refine_Foreach.FOREACH|const"><span>FOREACH</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc|const"><span>FOREACHc</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACH_to_oci_unfold|fact"><span class="entity_def" id="Refine_Foreach.FOREACH_to_oci_unfold(5)|thm"><span class="entity_def" id="Refine_Foreach.FOREACH_to_oci_unfold(4)|thm"><span class="entity_def" id="Refine_Foreach.FOREACH_to_oci_unfold(3)|thm"><span class="entity_def" id="Refine_Foreach.FOREACH_to_oci_unfold(2)|thm"><span class="entity_def" id="Refine_Foreach.FOREACH_to_oci_unfold(1)|thm"><span>FOREACH_to_oci_unfold</span></span></span></span></span></span></span><span>
  </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_def|fact"><span>FOREACHci_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc_def|fact"><span>FOREACHc_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi_def|fact"><span>FOREACHi_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoi_def|fact"><span>FOREACHoi_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_def|fact"><span>FOREACH_def</span></a><span>

</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Proof Rules›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHoci_rule|fact"><span class="entity_def" id="Refine_Foreach.FOREACHoci_rule|thm"><span>FOREACHoci_rule</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_vcg|attribute"><span class="operator"><span>refine_vcg</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_2440..2443">FIN</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_2466..2468">I0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>σ0</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_2489..2491">IP</span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span>
                </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="bound"><span>it</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_2629..2632">II1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_2665..2668">II2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span>
                         </span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="bound"><span>it</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_def|fact"><span>FOREACHoci_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_vcg|fact"><span class="dynamic"><span class="dynamic"><span>refine_vcg</span></span></span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_2440..2443"><span>FIN</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subgoal_tac</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Wellfounded.html#Wellfounded.wf|const"><span>wf</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Wellfounded.html#Wellfounded.measure|const"><span>measure</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>assumption</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>insert</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_2466..2468"><span>I0</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_2466..2468"><span>I0</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_body_def|fact"><span>FOREACH_body_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond_def|fact"><span>FOREACH_cond_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_vcg|fact"><span class="dynamic"><span class="dynamic"><span>refine_vcg</span></span></span></a><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>elim</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjE|fact"><span>conjE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.exE|fact"><span>exE</span></a><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rename_tac</span></span><span> xs'' s xs' σ xs</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>defer</span></span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>elim</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjE|fact"><span>conjE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.exE|fact"><span>exE</span></a><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rename_tac</span></span><span> x s xs' σ xs</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>defer</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>xs'</span></span><span> </span><span class="skolem"><span>σ</span></span><span> </span><span class="skolem"><span>xs</span></span><span>

  </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="entity_def" id="offset_3274..3279">I_xs'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>xs'</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>σ</span></span><span>"</span></span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_3306..3319">sorted_xs_xs'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.sorted_wrt|const"><span>sorted_wrt</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span> </span><span class="skolem"><span>xs'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_3356..3360">dist</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.distinct|const"><span>distinct</span></a><span> </span><span class="skolem"><span>xs</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.distinct|const"><span>distinct</span></a><span> </span><span class="skolem"><span>xs'</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.inter|const"><span>∩</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>xs'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span>"</span></span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_3424..3428">S_eq</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>xs'</span></span><span>"</span></span></span><span> 

  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_3424..3428"><span>S_eq</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>xs'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_3356..3360"><span>dist</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_3424..3428"><span>S_eq</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_3516..3522">S_diff</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>xs'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>xs</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span>{</span></span></span><span> </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>xs'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>c</span></span><span> </span><span class="skolem"><span>σ</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="skolem"><span>xs'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span>›</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>x</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>xs''</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_3625..3631">xs'_eq</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>xs'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span> </span><span class="skolem"><span>xs''</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>xs'</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_3681..3689">x_in_xs'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>xs'</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_3709..3719">x_nin_xs''</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>∉</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>xs''</span></span><span>"</span></span></span><span> 
       </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.distinct|const"><span>distinct</span></a><span> </span><span class="skolem"><span>xs'</span></span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_3625..3631"><span>xs'_eq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span>
  
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_2489..2491"><span>IP</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>σ</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>x</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>xs'</span></span><span>"</span></span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>c</span></span><span> </span><span class="skolem"><span>σ</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_3681..3689"><span>x_in_xs'</span></a><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>xs'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span> </span><span class="free"><span>S</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>I</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>xs'</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>σ</span></span><span>›</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_3709..3719"><span>x_nin_xs''</span></a><span>
         </span><a class="entity_ref" href="Refine_Foreach.html#offset_3306..3319"><span>sorted_xs_xs'</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_3516..3522"><span>S_diff</span></a><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.hd|const"><span>hd</span></a><span> </span><span class="skolem"><span>xs'</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span class="bound"><span>xs'a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span> </span><span class="skolem"><span>xs'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="bound"><span>xs'a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.tl|const"><span>tl</span></a><span> </span><span class="skolem"><span>xs'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span>
                 </span><span class="free"><span>I</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.tl|const"><span>tl</span></a><span> </span><span class="skolem"><span>xs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_3625..3631"><span>xs'_eq</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.sorted_wrt_append|fact"><span>sorted_wrt_append</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>}</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>{</span></span></span><span> </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>xs'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="main"><span>(</span></span><span class="free"><span>c</span></span><span> </span><span class="skolem"><span>σ</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="skolem"><span>σ</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>xs'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>True</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="skolem"><span>σ</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>I</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>xs'</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>σ</span></span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_2629..2632"><span>II1</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_4284..4288">case</span></span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="entity_def" id="offset_4300..4311">xs'_neq_nil</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_4284..4288"><span>this</span></a><span>
      </span><span class="keyword1"><span class="command"><span>with</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="skolem"><span>xs'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="skolem"><span>σ</span></span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="skolem"><span>σ</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
 
      </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_2665..2668"><span>II2</span></a><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>xs'</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>σ</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_3516..3522"><span>S_diff</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_3306..3319"><span>sorted_xs_xs'</span></a><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="skolem"><span>σ</span></span><span>"</span></span></span><span> 
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_4300..4311"><span>xs'_neq_nil</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_3424..3428"><span>S_eq</span></a><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="skolem"><span>σ</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_3274..3279"><span>I_xs'</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.sorted_wrt_append|fact"><span>sorted_wrt_append</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>}</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_4572..4577">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHoi_rule|fact"><span class="entity_def" id="Refine_Foreach.FOREACHoi_rule|thm"><span>FOREACHoi_rule</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_vcg|attribute"><span class="operator"><span>refine_vcg</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>FIN</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>I0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>σ0</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>IP</span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span>
                </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="bound"><span>it</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>II1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoi|const"><span>FOREACHoi</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoi_def|fact"><span>FOREACHoi_def</span></a><span> 
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_rule|fact"><span>FOREACHoci_rule</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp_all</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_4572..4577"><span>assms</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_4944..4949">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHci_rule|fact"><span class="entity_def" id="Refine_Foreach.FOREACHci_rule|thm"><span>FOREACHci_rule</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_vcg|attribute"><span class="operator"><span>refine_vcg</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>FIN</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>I0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>σ0</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>IP</span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>II1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>II2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci|const"><span>FOREACHci</span></a><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_def|fact"><span>FOREACHci_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_rule|fact"><span>FOREACHoci_rule</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp_all</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_4944..4949"><span>assms</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Refinement:›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹
  Refinement rule using a coupling invariant over sets of remaining
  items and the state.
›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHoci_refine_genR|fact"><span class="entity_def" id="Refine_Foreach.FOREACHoci_refine_genR|thm"><span>FOREACHoci_refine_genR</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span> </span><span class="comment1"><span>― ‹Abstraction mapping of elements›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span> </span><span class="comment1"><span>― ‹Concrete set›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span> </span><span class="comment1"><span>― ‹Abstract set›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>σ0'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'σa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'σa</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_5729..5732">INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_5758..5762">REFS</span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_5791..5796">RR_OK</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_5857..5861">REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span>S</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_5898..5902">REFC</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> 
    </span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="free"><span>S</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="free"><span>S'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it'</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_6079..6085">REFPHI</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="free"><span>S</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="free"><span>S'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it'</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_6248..6255">REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span>
    </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="free"><span>S</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="free"><span>S'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it'</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y'</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x'</span></span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>y'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x'</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_6580..6590">REF_R_DONE</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>⟧</span></span><span> 
    </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_6669..6678">REF_R_BRK</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="free"><span>S</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="free"><span>S'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it'</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="free"><span>RR</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R'</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="comment1"><span>(* TODO: Clean up this mess !!! *)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>supply</span></span></span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="operator"><span>simproc</span></span><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>defined_all</span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_def|fact"><span>FOREACHoci_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span> </span><a class="entity_ref" href="Refine_While.html#Refine_While.WHILEIT_refine_genR|fact"><span>WHILEIT_refine_genR</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> 
    R'</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>xs'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>.</span></span><span> 
      </span><span class="bound"><span>xs'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.map|const"><span>map</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> 
      </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>xs'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>xs'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>xs'</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>xs'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>}</span></span><span>"</span></span></span><span>
    </span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_5758..5762"><span>REFS</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_5729..5732"><span>INJ</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>dest</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite_imageD|fact"><span>finite_imageD</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.intro_prgR|fact"><span>intro_prgR</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> R</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span class="bound"><span>xs'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>xs'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.map|const"><span>map</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><span>}</span></span><span>"</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC_refine|fact"><span>SPEC_refine</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_5729..5732"><span>INJ</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_5791..5796"><span>RR_OK</span></a><span> 
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> 
    </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.distinct_map|fact"><span>distinct_map</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.sorted_wrt_map|fact"><span>sorted_wrt_map</span></a><span> 
    </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.sorted_wrt_mono_rel|fact"><span>sorted_wrt_mono_rel</span></a><span class="main"><span class="main"><span>[</span></span></span><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><span class="free"><span>RR</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_5857..5861"><span>REF0</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_5729..5732"><span>INJ</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>erule</span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Misc.html#Misc.map_eq_appendE|fact"><span>map_eq_appendE</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule_tac</span></span><span> x</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="improper"><span>l</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>in</span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.exI|fact"><span>exI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/eqsubst.ML.html#HOL.subst|method"><span class="operator"><span>subst</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.inj_on_map_eq_map|fact"><span>inj_on_map_eq_map</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> f</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="free"><span>α</span></span></span><span class="main"><span class="main"><span>,</span></span></span><span class="operator"><span>symmetric</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.subset_inj_on|fact"><span>subset_inj_on</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>assumption</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>assumption</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.split_asm|fact"><span>prod.split_asm</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>elim</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjE|fact"><span>conjE</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_6079..6085"><span>REFPHI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond_def|fact"><span>FOREACH_cond_def</span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.split|fact"><span>prod.split</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.split_asm|fact"><span>prod.split_asm</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> 
    </span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.allI|fact"><span>allI</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.impI|fact"><span>impI</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj_cong|fact"><span>conj_cong</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_5898..5902"><span>REFC</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_body_def|fact"><span>FOREACH_body_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_6248..6255"><span>REFSTEP</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>prefer</span></span></span></span></span><span> 3 </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>prefer</span></span></span></span></span><span> 3 </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span class="main"><span class="keyword3"><span>[</span></span></span><span>13</span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rename_tac</span></span><span> a b d e f g h i</span><span class="main"><span>)</span></span><span> 
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct_tacs.ML.html#HOL.case_tac|method"><span class="operator"><span>case_tac</span></span></a><span> </span><span class="quoted"><span class="improper"><span>h</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond_def|fact"><span>FOREACH_cond_def</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond_def|fact"><span>FOREACH_cond_def</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond_def|fact"><span>FOREACH_cond_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.ccontr|fact"><span>ccontr</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rename_tac</span></span><span> a b d e f</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct_tacs.ML.html#HOL.case_tac|method"><span class="operator"><span>case_tac</span></span></a><span> </span><span class="quoted"><span class="improper"><span>b</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.sorted_wrt_append|fact"><span>sorted_wrt_append</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span>2</span><span class="main"><span class="keyword3"><span>]</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond_def|fact"><span>FOREACH_cond_def</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rename_tac</span></span><span> a b d e</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct_tacs.ML.html#HOL.case_tac|method"><span class="operator"><span>case_tac</span></span></a><span> </span><span class="quoted"><span class="improper"><span>b</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span>2</span><span class="main"><span class="keyword3"><span>]</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond_def|fact"><span>FOREACH_cond_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.ccontr|fact"><span>ccontr</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rename_tac</span></span><span> a b d e f</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct_tacs.ML.html#HOL.case_tac|method"><span class="operator"><span>case_tac</span></span></a><span> </span><span class="quoted"><span class="improper"><span>b</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.sorted_wrt_append|fact"><span>sorted_wrt_append</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span>2</span><span class="main"><span class="keyword3"><span>]</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond_def|fact"><span>FOREACH_cond_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond_def|fact"><span>FOREACH_cond_def</span></a><span class="main"><span>)</span></span><span>
 
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.map_tl|fact"><span>map_tl</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rename_tac</span></span><span> a b d e f g</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct_tacs.ML.html#HOL.case_tac|method"><span class="operator"><span>case_tac</span></span></a><span> </span><span class="quoted"><span class="improper"><span>b</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rename_tac</span></span><span> a b d e f g</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct_tacs.ML.html#HOL.case_tac|method"><span class="operator"><span>case_tac</span></span></a><span> </span><span class="quoted"><span class="improper"><span>b</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rename_tac</span></span><span> a b d e f g</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct_tacs.ML.html#HOL.case_tac|method"><span class="operator"><span>case_tac</span></span></a><span> </span><span class="quoted"><span class="improper"><span>b</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.sorted_wrt_append|fact"><span>sorted_wrt_append</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rename_tac</span></span><span> a b d e f g</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct_tacs.ML.html#HOL.case_tac|method"><span class="operator"><span>case_tac</span></span></a><span> </span><span class="quoted"><span class="improper"><span>b</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.sorted_wrt_append|fact"><span>sorted_wrt_append</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rename_tac</span></span><span> a b d e f g</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct_tacs.ML.html#HOL.case_tac|method"><span class="operator"><span>case_tac</span></span></a><span> </span><span class="quoted"><span class="improper"><span>b</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.introR|fact"><span>introR</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> R</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>xs'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> 
      </span><span class="bound"><span>xs'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.map|const"><span>map</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>xs'</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span>
      </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>xs'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>xs'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>xs'</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>xs'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span>
      </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond|const"><span>FOREACH_cond</span></a><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond|const"><span>FOREACH_cond</span></a><span> </span><span class="free"><span>c'</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>}</span></span><span>
    "</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond_def|fact"><span>FOREACH_cond_def</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>elim</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjE|fact"><span>conjE</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>elim</span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Misc.html#Misc.disjE1|fact"><span>disjE1</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_6580..6590"><span>REF_R_DONE</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_6669..6678"><span>REF_R_BRK</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHoci_refine|fact"><span class="entity_def" id="Refine_Foreach.FOREACHoci_refine|thm"><span>FOREACHoci_refine</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFS</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_10041..10045">REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>σ0</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>RR_OK</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_10136..10143">REFPHI0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Φ''</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>σ0'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_10176..10180">REFC</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>  </span><span class="free"><span>Φ''</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_10303..10309">REFPHI</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ''</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_10418..10425">REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span> 
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>  </span><span class="free"><span>Φ''</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Φ''</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>x'</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="free"><span>RR</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_refine_genR|fact"><span>FOREACHoci_refine_genR</span></a><span class="main"><span class="main"><span>[</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> R </span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Φ''</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
    </span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>fact</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>fact</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>fact</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_10041..10045"><span>REF0</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_10136..10143"><span>REFPHI0</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_10176..10180"><span>REFC</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_10303..10309"><span>REFPHI</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_10418..10425"><span>REFSTEP</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
 
</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_11058..11063">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHoci_refine_rcg|fact"><span class="entity_def" id="Refine_Foreach.FOREACHoci_refine_rcg|thm"><span>FOREACHoci_refine_rcg</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFS</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>σ0</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>RR_OK</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFC</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFPHI</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="free"><span>RR</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_refine|fact"><span>FOREACHoci_refine</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> Φ''</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>"</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_11058..11063"><span>assms</span></a><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_11058..11063"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHoci_weaken|fact"><span class="entity_def" id="Refine_Foreach.FOREACHoci_weaken|thm"><span>FOREACHoci_weaken</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_11927..11931">IREF</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>I'</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="free"><span>RR</span></span><span> </span><span class="free"><span>I'</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="free"><span>RR</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_refine_rcg|fact"><span>FOREACHoci_refine_rcg</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> α</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.id|const"><span>id</span></a></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span>and</span></span></span></span></span><span> R</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a></span><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>simplified</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_11927..11931"><span>IREF</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHoci_weaken_order|fact"><span class="entity_def" id="Refine_Foreach.FOREACHoci_weaken_order|thm"><span>FOREACHoci_weaken_order</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_12175..12180">RRREF</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="free"><span>RR</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_refine_rcg|fact"><span>FOREACHoci_refine_rcg</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> α</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.id|const"><span>id</span></a></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span>and</span></span></span></span></span><span> R</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a></span><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>simplified</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_12175..12180"><span>RRREF</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>


</span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Rules for Derived Constructs›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHoi_refine_genR|fact"><span class="entity_def" id="Refine_Foreach.FOREACHoi_refine_genR|thm"><span>FOREACHoi_refine_genR</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span> </span><span class="comment1"><span>― ‹Abstraction mapping of elements›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span> </span><span class="comment1"><span>― ‹Concrete set›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span> </span><span class="comment1"><span>― ‹Abstract set›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>σ0'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'σa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'σa</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFS</span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>RR_OK</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span>S</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFPHI</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="free"><span>S</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="free"><span>S'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it'</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_13049..13056">REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span>
    </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="free"><span>S</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="free"><span>S'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it'</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y'</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x'</span></span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>y'</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x'</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REF_R_DONE</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>⟧</span></span><span> 
    </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoi|const"><span>FOREACHoi</span></a><span> </span><span class="free"><span>RR</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R'</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoi|const"><span>FOREACHoi</span></a><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoi_def|fact"><span>FOREACHoi_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_refine_genR|fact"><span>FOREACHoci_refine_genR</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>fact</span></span><span> </span><span class="main"><span class="keyword3"><span>|</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_13049..13056"><span>REFSTEP</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>fact</span></span><span> </span><span class="main"><span class="keyword3"><span>|</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_13659..13664">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHoi_refine|fact"><span class="entity_def" id="Refine_Foreach.FOREACHoi_refine|thm"><span>FOREACHoi_refine</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFS</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>σ0</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>RR_OK</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFPHI0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Φ''</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>σ0'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFPHI</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ''</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span> 
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>  </span><span class="free"><span>Φ''</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Φ''</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>x'</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoi|const"><span>FOREACHoi</span></a><span> </span><span class="free"><span>RR</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoi|const"><span>FOREACHoi</span></a><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoi_def|fact"><span>FOREACHoi_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_refine|fact"><span>FOREACHoci_refine</span></a><span> </span><span class="main"><span class="main"><span>[</span></span></span><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>α</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><span class="free"><span>Φ''</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp_all</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_13659..13664"><span>assms</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_14496..14501">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHoi_refine_rcg|fact"><span class="entity_def" id="Refine_Foreach.FOREACHoi_refine_rcg|thm"><span>FOREACHoi_refine_rcg</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFS</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>σ0</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>RR_OK</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFPHI</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoi|const"><span>FOREACHoi</span></a><span> </span><span class="free"><span>RR</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoi|const"><span>FOREACHoi</span></a><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoi_refine|fact"><span>FOREACHoi_refine</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> Φ''</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>"</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_14496..14501"><span>assms</span></a><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_14496..14501"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHci_refine_genR|fact"><span class="entity_def" id="Refine_Foreach.FOREACHci_refine_genR|thm"><span>FOREACHci_refine_genR</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span> </span><span class="comment1"><span>― ‹Abstraction mapping of elements›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span> </span><span class="comment1"><span>― ‹Concrete set›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span> </span><span class="comment1"><span>― ‹Abstract set›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>σ0'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'σa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'σa</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFS</span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span>S</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_15571..15575">REFC</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> 
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_15696..15702">REFPHI</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_15809..15816">REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span>
    </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x'</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REF_R_DONE</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>⟧</span></span><span> 
    </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_16126..16135">REF_R_BRK</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci|const"><span>FOREACHci</span></a><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R'</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci|const"><span>FOREACHci</span></a><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_def|fact"><span>FOREACHci_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_refine_genR|fact"><span>FOREACHoci_refine_genR</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>fact</span></span><span class="main"><span class="keyword3"><span>|</span></span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_15571..15575"><span>REFC</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_15696..15702"><span>REFPHI</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_15809..15816"><span>REFSTEP</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>fact</span></span><span class="main"><span class="keyword3"><span>|</span></span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_16126..16135"><span>REF_R_BRK</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_16577..16582">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHci_refine|fact"><span class="entity_def" id="Refine_Foreach.FOREACHci_refine|thm"><span>FOREACHci_refine</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFS</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>σ0</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFPHI0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Φ''</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>σ0'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFC</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>  </span><span class="free"><span>Φ''</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFPHI</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ''</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>  </span><span class="free"><span>Φ''</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Φ''</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>x'</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci|const"><span>FOREACHci</span></a><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci|const"><span>FOREACHci</span></a><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_def|fact"><span>FOREACHci_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_refine|fact"><span>FOREACHoci_refine</span></a><span> </span><span class="main"><span class="main"><span>[</span></span></span><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>α</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><span class="free"><span>Φ''</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp_all</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_16577..16582"><span>assms</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_17471..17476">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHci_refine_rcg|fact"><span class="entity_def" id="Refine_Foreach.FOREACHci_refine_rcg|thm"><span>FOREACHci_refine_rcg</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFS</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>σ0</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFC</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFPHI</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci|const"><span>FOREACHci</span></a><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci|const"><span>FOREACHci</span></a><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_refine|fact"><span>FOREACHci_refine</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> Φ''</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>"</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_17471..17476"><span>assms</span></a><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_17471..17476"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHci_weaken|fact"><span class="entity_def" id="Refine_Foreach.FOREACHci_weaken|thm"><span>FOREACHci_weaken</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_18240..18244">IREF</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>I'</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci|const"><span>FOREACHci</span></a><span> </span><span class="free"><span>I'</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci|const"><span>FOREACHci</span></a><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_refine_rcg|fact"><span>FOREACHci_refine_rcg</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> α</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.id|const"><span>id</span></a></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span>and</span></span></span></span></span><span> R</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a></span><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>simplified</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_18240..18244"><span>IREF</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_18438..18443">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHi_rule|fact"><span class="entity_def" id="Refine_Foreach.FOREACHi_rule|thm"><span>FOREACHi_rule</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_vcg|attribute"><span class="operator"><span>refine_vcg</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>FIN</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>I0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>σ0</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>IP</span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>II</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi|const"><span>FOREACHi</span></a><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi_def|fact"><span>FOREACHi_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_rule|fact"><span>FOREACHci_rule</span></a><span class="main"><span class="main"><span>[</span></span></span><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>S</span></span></span><span> </span><span class="quoted"><span class="free"><span>I</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_18438..18443"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_18759..18764">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHc_rule|fact"><span class="entity_def" id="Refine_Foreach.FOREACHc_rule|thm"><span>FOREACHc_rule</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>FIN</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>I0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>σ0</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>IP</span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>II1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>II2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc|const"><span>FOREACHc</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc_def|fact"><span>FOREACHc_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_weaken|fact"><span>FOREACHci_weaken</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_rule|fact"><span>FOREACHci_rule</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> I</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="free"><span>I</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_18759..18764"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_19197..19202">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACH_rule|fact"><span class="entity_def" id="Refine_Foreach.FOREACH_rule|thm"><span>FOREACH_rule</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>FIN</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>I0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>σ0</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>IP</span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>II</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH|const"><span>FOREACH</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_def|fact"><span>FOREACH_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc_def|fact"><span>FOREACHc_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_weaken|fact"><span>FOREACHci_weaken</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_rule|fact"><span>FOREACHci_rule</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> I</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="free"><span>I</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_19197..19202"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>


</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHc_refine_genR|fact"><span class="entity_def" id="Refine_Foreach.FOREACHc_refine_genR|thm"><span>FOREACHc_refine_genR</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span> </span><span class="comment1"><span>― ‹Abstraction mapping of elements›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span> </span><span class="comment1"><span>― ‹Concrete set›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span> </span><span class="comment1"><span>― ‹Abstract set›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>σ0'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'σa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'σa</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFS</span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span>S</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_19952..19956">REFC</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> 
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_20058..20065">REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span>
    </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> 
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x'</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_20268..20278">REF_R_DONE</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>⟧</span></span><span> 
    </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_20339..20348">REF_R_BRK</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> 
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc|const"><span>FOREACHc</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R'</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc|const"><span>FOREACHc</span></a><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc_def|fact"><span>FOREACHc_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_refine_genR|fact"><span>FOREACHci_refine_genR</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>fact</span></span><span class="main"><span class="keyword3"><span>|</span></span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_19952..19956"><span>REFC</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_20058..20065"><span>REFSTEP</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_20268..20278"><span>REF_R_DONE</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_20339..20348"><span>REF_R_BRK</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHc_refine|fact"><span class="entity_def" id="Refine_Foreach.FOREACHc_refine|thm"><span>FOREACHc_refine</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_20866..20869">INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_20894..20898">REFS</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_20921..20925">REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>σ0</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_20950..20957">REFPHI0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Φ''</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>σ0'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_20990..20994">REFC</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ''</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_21097..21104">REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span>Φ''</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Φ''</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>x'</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc|const"><span>FOREACHc</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc|const"><span>FOREACHc</span></a><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc_def|fact"><span>FOREACHc_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_refine|fact"><span>FOREACHci_refine</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> Φ''</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="free"><span>Φ''</span></span></span><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_20866..20869"><span>INJ</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_20894..20898"><span>REFS</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_20921..20925"><span>REF0</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_20950..20957"><span>REFPHI0</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>erule</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_20990..20994"><span>REFC</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>erule</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>9</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_21097..21104"><span>REFSTEP</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_21550..21555">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHc_refine_rcg|fact"><span class="entity_def" id="Refine_Foreach.FOREACHc_refine_rcg|thm"><span>FOREACHc_refine_rcg</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFS</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>σ0</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFC</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc|const"><span>FOREACHc</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc|const"><span>FOREACHc</span></a><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc_def|fact"><span>FOREACHc_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_refine_rcg|fact"><span>FOREACHci_refine_rcg</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_21550..21555"><span>assms</span></a><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_21550..21555"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHi_refine_genR|fact"><span class="entity_def" id="Refine_Foreach.FOREACHi_refine_genR|thm"><span>FOREACHi_refine_genR</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span> </span><span class="comment1"><span>― ‹Abstraction mapping of elements›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span> </span><span class="comment1"><span>― ‹Concrete set›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span> </span><span class="comment1"><span>― ‹Abstract set›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>σ0'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'σa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'σa</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFS</span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span>S</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFPHI</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_22625..22632">REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span>
    </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x'</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REF_R_DONE</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>⟧</span></span><span> 
    </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi|const"><span>FOREACHi</span></a><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R'</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi|const"><span>FOREACHi</span></a><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi_def|fact"><span>FOREACHi_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_refine_genR|fact"><span>FOREACHci_refine_genR</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>fact</span></span><span class="main"><span class="keyword3"><span>|</span></span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_22625..22632"><span>REFSTEP</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>fact</span></span><span class="main"><span class="keyword3"><span>|</span></span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHi_refine|fact"><span class="entity_def" id="Refine_Foreach.FOREACHi_refine|thm"><span>FOREACHi_refine</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_23219..23222">INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_23247..23251">REFS</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_23274..23278">REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>σ0</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_23303..23310">REFPHI0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Φ''</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>σ0'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_23343..23349">REFPHI</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ''</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_23458..23465">REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>  </span><span class="free"><span>Φ''</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Φ''</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>x'</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi|const"><span>FOREACHi</span></a><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi|const"><span>FOREACHi</span></a><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi_def|fact"><span>FOREACHi_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_refine|fact"><span>FOREACHci_refine</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> Φ''</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="free"><span>Φ''</span></span></span><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_23219..23222"><span>INJ</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_23247..23251"><span>REFS</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_23274..23278"><span>REF0</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_23303..23310"><span>REFPHI0</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>erule</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>5</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_23343..23349"><span>REFPHI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>erule</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>9</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_23458..23465"><span>REFSTEP</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_23924..23929">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHi_refine_rcg|fact"><span class="entity_def" id="Refine_Foreach.FOREACHi_refine_rcg|thm"><span>FOREACHi_refine_rcg</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFS</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>σ0</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFPHI</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi|const"><span>FOREACHi</span></a><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi|const"><span>FOREACHi</span></a><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi_def|fact"><span>FOREACHi_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_refine_rcg|fact"><span>FOREACHci_refine_rcg</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_23924..23929"><span>assms</span></a><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_23924..23929"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACH_refine_genR|fact"><span class="entity_def" id="Refine_Foreach.FOREACH_refine_genR|thm"><span>FOREACH_refine_genR</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span> </span><span class="comment1"><span>― ‹Abstraction mapping of elements›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span> </span><span class="comment1"><span>― ‹Concrete set›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span> </span><span class="comment1"><span>― ‹Abstract set›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>σ0'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'σa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'σa</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFS</span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span>S</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_24914..24921">REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span>
    </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x'</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REF_R_DONE</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>⟧</span></span><span> 
    </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH|const"><span>FOREACH</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R'</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH|const"><span>FOREACH</span></a><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_def|fact"><span>FOREACH_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc_refine_genR|fact"><span>FOREACHc_refine_genR</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>fact</span></span><span class="main"><span class="keyword3"><span>|</span></span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_24914..24921"><span>REFSTEP</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>fact</span></span><span class="main"><span class="keyword3"><span>|</span></span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACH_refine|fact"><span class="entity_def" id="Refine_Foreach.FOREACH_refine|thm"><span>FOREACH_refine</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_25461..25464">INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_25489..25493">REFS</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_25516..25520">REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>σ0</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_25545..25552">REFPHI0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Φ''</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>σ0'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_25585..25592">REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span>Φ''</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Φ''</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>x'</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH|const"><span>FOREACH</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH|const"><span>FOREACH</span></a><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_def|fact"><span>FOREACH_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc_refine|fact"><span>FOREACHc_refine</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> Φ''</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="free"><span>Φ''</span></span></span><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_25461..25464"><span>INJ</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_25489..25493"><span>REFS</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_25516..25520"><span>REF0</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_25545..25552"><span>REFPHI0</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>erule</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>7</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_25585..25592"><span>REFSTEP</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_25991..25996">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACH_refine_rcg|fact"><span class="entity_def" id="Refine_Foreach.FOREACH_refine_rcg|thm"><span>FOREACH_refine_rcg</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFS</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>σ0</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH|const"><span>FOREACH</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH|const"><span>FOREACH</span></a><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_def|fact"><span>FOREACH_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc_refine_rcg|fact"><span>FOREACHc_refine_rcg</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_25991..25996"><span>assms</span></a><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_25991..25996"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_26467..26472">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHci_refine_rcg&apos;|fact"><span class="entity_def" id="Refine_Foreach.FOREACHci_refine_rcg&apos;|thm"><span>FOREACHci_refine_rcg'</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFS</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>σ0</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_26668..26672">REFC</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_26769..26776">REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc|const"><span>FOREACHc</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci|const"><span>FOREACHci</span></a><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc_def|fact"><span>FOREACHc_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_refine_rcg|fact"><span>FOREACHci_refine_rcg</span></a><span class="main"><span>)</span></span><span> 
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_26467..26472"><span>assms</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_26467..26472"><span>assms</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_26467..26472"><span>assms</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>erule</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_26668..26672"><span>REFC</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_26769..26776"><span>REFSTEP</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>assumption</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_27196..27201">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHi_refine_rcg&apos;|fact"><span class="entity_def" id="Refine_Foreach.FOREACHi_refine_rcg&apos;|thm"><span>FOREACHi_refine_rcg'</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>α</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'Sa</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'S</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'Sa</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>INJ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REFS</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>REF0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>σ0</span></span><span class="main"><span>,</span></span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_27396..27403">REFSTEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> 
    </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it'</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span>Φ'</span></span><span> </span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="bound"><span>σ</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>
  </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH|const"><span>FOREACH</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi|const"><span>FOREACHi</span></a><span> </span><span class="free"><span>Φ'</span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ0'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_def|fact"><span>FOREACH_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi_def|fact"><span>FOREACHi_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_refine_rcg&apos;|fact"><span>FOREACHci_refine_rcg'</span></a><span class="main"><span>)</span></span><span> 
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_27196..27201"><span>assms</span></a><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_27396..27403"><span>REFSTEP</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>assumption</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Alternative set of FOREACHc-rules›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Here, we provide an alternative set of FOREACH rules with 
  interruption. In some cases, they are easier to use, as they avoid 
  redundancy between the final cases for interruption and non-interruption›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHoci_rule&apos;|fact"><span class="entity_def" id="Refine_Foreach.FOREACHoci_rule&apos;|thm"><span>FOREACHoci_rule'</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_28039..28042">FIN</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_28065..28067">I0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>σ0</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_28088..28090">IP</span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span>
                </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="bound"><span>it</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_28228..28231">II1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_28269..28272">II2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span>
                         </span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="bound"><span>it</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span>y</span></span><span class="main"><span>∈</span></span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="bound"><span>it</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_rule|fact"><span>FOREACHoci_rule</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_28039..28042"><span>FIN</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> I</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="free"><span>I</span></span></span><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_28065..28067"><span>I0</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_28088..28090"><span>IP</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>assumption</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct_tacs.ML.html#HOL.case_tac|method"><span class="operator"><span>case_tac</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>c</span></span><span> </span><span class="improper"><span>σ</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_28228..28231"><span>II1</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_28269..28272"><span>II2</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_28269..28272"><span>II2</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
  
</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_28609..28614">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHci_rule&apos;|fact"><span class="entity_def" id="Refine_Foreach.FOREACHci_rule&apos;|thm"><span>FOREACHci_rule'</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_vcg|attribute"><span class="operator"><span>refine_vcg</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>FIN</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>I0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>σ0</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>IP</span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>II1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>II2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci|const"><span>FOREACHci</span></a><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_def|fact"><span>FOREACHci_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_rule&apos;|fact"><span>FOREACHoci_rule'</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp_all</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_28609..28614"><span>assms</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_28991..28996">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHc_rule&apos;|fact"><span class="entity_def" id="Refine_Foreach.FOREACHc_rule&apos;|thm"><span>FOREACHc_rule'</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>FIN</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>I0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>σ0</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>IP</span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>II1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>II2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="bound"><span>it</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc|const"><span>FOREACHc</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc_def|fact"><span>FOREACHc_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_weaken|fact"><span>FOREACHci_weaken</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_rule&apos;|fact"><span>FOREACHci_rule'</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> I</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="free"><span>I</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_28991..28996"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>



</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹FOREACH with empty sets›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHoci_emp|fact"><span class="entity_def" id="Refine_Foreach.FOREACHoci_emp|thm"><span>FOREACHoci_emp</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>Φ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="free"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span>σ</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_def|fact"><span>FOREACHoci_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond_def|fact"><span>FOREACH_cond_def</span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.bind_RES|fact"><span>bind_RES</span></a><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_While.html#Refine_While.while.WHILEIT_unfold|fact"><span>WHILEIT_unfold</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHoi_emp|fact"><span class="entity_def" id="Refine_Foreach.FOREACHoi_emp|thm"><span>FOREACHoi_emp</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoi|const"><span>FOREACHoi</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>Φ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="free"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span>σ</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoi_def|fact"><span>FOREACHoi_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHci_emp|fact"><span class="entity_def" id="Refine_Foreach.FOREACHci_emp|thm"><span>FOREACHci_emp</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci|const"><span>FOREACHci</span></a><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>Φ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="free"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span>σ</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_def|fact"><span>FOREACHci_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHc_emp|fact"><span class="entity_def" id="Refine_Foreach.FOREACHc_emp|thm"><span>FOREACHc_emp</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc|const"><span>FOREACHc</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span>σ</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc_def|fact"><span>FOREACHc_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACH_emp|fact"><span class="entity_def" id="Refine_Foreach.FOREACH_emp|thm"><span>FOREACH_emp</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH|const"><span>FOREACH</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span>σ</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_def|fact"><span>FOREACH_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHi_emp|fact"><span class="entity_def" id="Refine_Foreach.FOREACHi_emp|thm"><span>FOREACHi_emp</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi|const"><span>FOREACHi</span></a><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>Φ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="free"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span>σ</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi_def|fact"><span>FOREACHi_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>"Monotonicity"</span></span></span><span>

</span><span class="comment1"><span>(* TODO: Move to RefineG_Domain *)</span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.lift_refl_def|fact"><span class="entity_def" id="Refine_Foreach.lift_refl_def|thm"><span class="entity_def" id="Refine_Foreach.lift_refl_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Refine_Foreach.lift_refl|const"><span>lift_refl</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>g</span></span></span></span><span> </span><span class="main"><span>==</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>g</span></span></span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.lift_mono_def|fact"><span class="entity_def" id="Refine_Foreach.lift_mono_def|thm"><span class="entity_def" id="Refine_Foreach.lift_mono_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Refine_Foreach.lift_mono|const"><span>lift_mono</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>g</span></span></span></span><span> </span><span class="main"><span>==</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>g</span></span></span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.lift_mono1_def|fact"><span class="entity_def" id="Refine_Foreach.lift_mono1_def|thm"><span class="entity_def" id="Refine_Foreach.lift_mono1_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Refine_Foreach.lift_mono1|const"><span>lift_mono1</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>g</span></span></span></span><span> </span><span class="main"><span>==</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>y</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>g</span></span></span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.lift_mono2_def|fact"><span class="entity_def" id="Refine_Foreach.lift_mono2_def|thm"><span class="entity_def" id="Refine_Foreach.lift_mono2_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Refine_Foreach.lift_mono2|const"><span>lift_mono2</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>g</span></span></span></span><span> </span><span class="main"><span>==</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>y</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>g</span></span></span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.trimono_spec_def|fact"><span class="entity_def" id="Refine_Foreach.trimono_spec_def|thm"><span class="entity_def" id="Refine_Foreach.trimono_spec_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Refine_Foreach.trimono_spec|const"><span>trimono_spec</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="main"><span>==</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.id|const"><span>id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>(≤)</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.id|const"><span>id</span></a><span> </span><a class="entity_ref" href="RefineG_Domain.html#RefineG_Domain.flat_ge|const"><span>flat_ge</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.trimono_atomize|fact"><span class="entity_def" id="Refine_Foreach.trimono_atomize(3)|thm"><span class="entity_def" id="Refine_Foreach.trimono_atomize(2)|thm"><span class="entity_def" id="Refine_Foreach.trimono_atomize(1)|thm"><span>trimono_atomize</span></span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.atomize_imp|fact"><span>atomize_imp</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.atomize_conj|fact"><span>atomize_conj</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.atomize_all|fact"><span>atomize_all</span></a><span>
</span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.trimono_deatomize|fact"><span class="entity_def" id="Refine_Foreach.trimono_deatomize(3)|thm"><span class="entity_def" id="Refine_Foreach.trimono_deatomize(2)|thm"><span class="entity_def" id="Refine_Foreach.trimono_deatomize(1)|thm"><span>trimono_deatomize</span></span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_atomize|fact"><span>trimono_atomize</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.trimono_spec_defs|fact"><span class="entity_def" id="Refine_Foreach.trimono_spec_defs(10)|thm"><span class="entity_def" id="Refine_Foreach.trimono_spec_defs(9)|thm"><span class="entity_def" id="Refine_Foreach.trimono_spec_defs(8)|thm"><span class="entity_def" id="Refine_Foreach.trimono_spec_defs(4)|thm"><span class="entity_def" id="Refine_Foreach.trimono_spec_defs(3)|thm"><span class="entity_def" id="Refine_Foreach.trimono_spec_defs(1)|thm"><span class="entity_def" id="Refine_Foreach.trimono_spec_defs(7)|thm"><span class="entity_def" id="Refine_Foreach.trimono_spec_defs(6)|thm"><span class="entity_def" id="Refine_Foreach.trimono_spec_defs(5)|thm"><span class="entity_def" id="Refine_Foreach.trimono_spec_defs(2)|thm"><span>trimono_spec_defs</span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_def|fact"><span>trimono_spec_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.lift_refl_def|fact"><span>lift_refl_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>abs_def</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.id_def|fact"><span>id_def</span></a><span>
    </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.lift_mono_def|fact"><span>lift_mono_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>abs_def</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.lift_mono1_def|fact"><span>lift_mono1_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>abs_def</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.lift_mono2_def|fact"><span>lift_mono2_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>abs_def</span></span><span class="main"><span>]</span></span><span>
    </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_deatomize|fact"><span>trimono_deatomize</span></a><span>

</span><span class="keyword1"><span class="command"><span>locale</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.trimono_spec|locale"><span>trimono_spec</span></span><span> </span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Refine_Foreach.trimono_spec.R|const"><span>R</span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.lift_refl|const"><span>lift_refl</span></a><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Refine_Foreach.trimono_spec.M|const"><span>M</span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.lift_mono|const"><span>lift_mono</span></a><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Refine_Foreach.trimono_spec.M1|const"><span>M1</span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.lift_mono1|const"><span>lift_mono1</span></a><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Refine_Foreach.trimono_spec.M2|const"><span>M2</span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.lift_mono2|const"><span>lift_mono2</span></a><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>context</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span> </span><span class="keyword1"><span class="command"><span>interpretation</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec|locale"><span>trimono_spec</span></a><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHoci_mono|fact"><span class="entity_def" id="Refine_Foreach.FOREACHoci_mono(6)|thm"><span class="entity_def" id="Refine_Foreach.FOREACHoci_mono(5)|thm"><span class="entity_def" id="Refine_Foreach.FOREACHoci_mono(4)|thm"><span class="entity_def" id="Refine_Foreach.FOREACHoci_mono(3)|thm"><span class="entity_def" id="Refine_Foreach.FOREACHoci_mono(2)|thm"><span class="entity_def" id="Refine_Foreach.FOREACHoci_mono(1)|thm"><span>FOREACHoci_mono</span></span></span></span></span></span></span></span><span class="main"><span>[</span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><span>trimono_spec_defs</span></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a><span class="main"><span>,</span></span><a class="entity_ref" href="AFP/Refine_Monadic/refine_mono_prover.ML.html#Refine_Mono_Prover.refine_mono|attribute"><span class="operator"><span>refine_mono</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec|const"><span>trimono_spec</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.M2|const"><span>M2</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec|const"><span>trimono_spec</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.M2|const"><span>M2</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoi|const"><span>FOREACHoi</span></a><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec|const"><span>trimono_spec</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.M2|const"><span>M2</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci|const"><span>FOREACHci</span></a><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec|const"><span>trimono_spec</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.M2|const"><span>M2</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc|const"><span>FOREACHc</span></a><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec|const"><span>trimono_spec</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.M2|const"><span>M2</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi|const"><span>FOREACHi</span></a><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec|const"><span>trimono_spec</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.M2|const"><span>M2</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH|const"><span>FOREACH</span></a><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>unfold</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><span>trimono_spec_defs</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_def|fact"><span>FOREACHoci_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_to_oci_unfold|fact"><span>FOREACH_to_oci_unfold</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_body_def|fact"><span>FOREACH_body_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Mono_Prover.html#Refine_Mono_Prover.refine_mono|method"><span class="operator"><span>refine_mono</span></span></a><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Nres-Fold with Interruption (nfoldli)›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹
  A foreach-loop can be conveniently expressed as an operation that converts
  the set to a list, followed by folding over the list.
  
  This representation is handy for automatic refinement, as the complex 
  foreach-operation is expressed by two relatively simple operations.
›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹We first define a fold-function in the nres-monad›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.nfoldli.fixp_induct|fact"><span class="entity_def" id="Refine_Foreach.nfoldli.mono|fact"><span class="entity_def" id="Refine_Foreach.nfoldli.simps|fact"><span class="entity_def" id="Refine_Foreach.nfoldli.fixp_induct|thm"><span class="entity_def" id="Refine_Foreach.nfoldli.mono|thm"><span class="entity_def" id="Refine_Foreach.nfoldli.simps|thm"><span class="entity_def" id="Refine_Foreach.nfoldli_def|axiom"><span>partial_function</span></span></span></span></span></span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span>nrec</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span class="entity_def" id="Refine_Foreach.nfoldli|const"><span>nfoldli</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>nfoldli</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>case</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="keyword1"><span>of</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> 
    </span><span class="main"><span>|</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="bound"><span>ls</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>←</span></span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>nfoldli</span></span><span> </span><span class="bound"><span>ls</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>}</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span>
  </span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.nfoldli_simps|fact"><span class="entity_def" id="Refine_Foreach.nfoldli_simps(2)|thm"><span class="entity_def" id="Refine_Foreach.nfoldli_simps(1)|thm"><span>nfoldli_simps</span></span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="free"><span>ls</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> 
    </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>←</span></span><span class="free"><span>f</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>s</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>ls</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>}</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span>s</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/eqsubst.ML.html#HOL.subst|method"><span class="operator"><span>subst</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli.simps|fact"><span>nfoldli.simps</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
  
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.param_nfoldli|fact"><span class="entity_def" id="Refine_Foreach.param_nfoldli|thm"><span>param_nfoldli</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/Param_Tool.html#Param_Tool.param|attribute"><span class="operator"><span>param</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> 
    </span><span class="main"><span>⟨</span></span><span class="free"><span>Ra</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.list_rel|const"><span>list_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>Rb</span></span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>Ra</span></span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span class="free"><span>Rb</span></span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span class="main"><span>⟨</span></span><span class="free"><span>Rb</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="free"><span>Rb</span></span><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><span class="free"><span>Rb</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>1</span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="skolem"><span>l'</span></span><span> </span><span class="skolem"><span>c</span></span><span> </span><span class="skolem"><span>c'</span></span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="skolem"><span>f'</span></span><span> </span><span class="skolem"><span>s</span></span><span> </span><span class="skolem"><span>s'</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>s</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>s'</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli_simps|fact"><span>nfoldli_simps</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True_implies_equals|fact"><span>True_implies_equals</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Param_Tool.html#Param_Tool.parametricity|method"><span class="operator"><span>parametricity</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli_simps|fact"><span>nfoldli_simps</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True_implies_equals|fact"><span>True_implies_equals</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Automatic_Refinement/Param_Tool.html#Param_Tool.parametricity|method"><span class="operator"><span>parametricity</span></span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.nfoldli_no_ctd|fact"><span class="entity_def" id="Refine_Foreach.nfoldli_no_ctd|thm"><span>nfoldli_no_ctd</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="free"><span>ctd</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>ctd</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.nfoldli_append|fact"><span class="entity_def" id="Refine_Foreach.nfoldli_append|thm"><span>nfoldli_append</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>l1</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="free"><span>l2</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>ctd</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l1</span></span><span> </span><span class="free"><span>ctd</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="HOL-Library.Monad_Syntax.html#Monad_Syntax.bind|const"><span>⤜</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l2</span></span><span> </span><span class="free"><span>ctd</span></span><span> </span><span class="free"><span>f</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induction.ML.html#HOL.induction|method"><span class="operator"><span>induction</span></span></a><span> </span><span class="quoted"><span class="free"><span>l1</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>s</span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.pw_eq_iff|fact"><span>pw_eq_iff</span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.nfoldli_map|fact"><span class="entity_def" id="Refine_Foreach.nfoldli_map|thm"><span>nfoldli_map</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.map|const"><span>map</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>ctd</span></span><span> </span><span class="free"><span>g</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>ctd</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>g</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><span class="free"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span>  
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induction.ML.html#HOL.induction|method"><span class="operator"><span>induction</span></span></a><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>s</span></span></span><span class="main"><span>)</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.pw_eq_iff|fact"><span>pw_eq_iff</span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.nfoldli_nfoldli_prod_conv|fact"><span class="entity_def" id="Refine_Foreach.nfoldli_nfoldli_prod_conv|thm"><span>nfoldli_nfoldli_prod_conv</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l2</span></span><span> </span><span class="free"><span>ctd</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l1</span></span><span> </span><span class="free"><span>ctd</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.product|const"><span>List.product</span></a><span> </span><span class="free"><span>l2</span></span><span> </span><span class="free"><span>l1</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>ctd</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span class="main"><span>,</span></span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.map|const"><span>map</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Pair|const"><span>Pair</span></a><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>l</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>ctd</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="free"><span>ctd</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>s</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="skolem"><span>s</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induction.ML.html#HOL.induction|method"><span class="operator"><span>induction</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>l</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>s</span></span></span><span class="main"><span>)</span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.pw_eq_iff|fact"><span>pw_eq_iff</span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induction.ML.html#HOL.induction|method"><span class="operator"><span>induction</span></span></a><span> </span><span class="quoted"><span class="free"><span>l2</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>l1</span></span></span><span> </span><span class="quoted"><span class="free"><span>s</span></span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>  
  
  
</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹The fold-function over the nres-monad is transfered to a plain 
  foldli function›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_33660..33665">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.nfoldli_transfer_plain|fact"><span class="entity_def" id="Refine_Foreach.nfoldli_transfer_plain|thm"><span>nfoldli_transfer_plain</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="RefineG_Transfer.html#RefineG_Transfer.refine_transfer|attribute"><span class="operator"><span>refine_transfer</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>s</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_33660..33665"><span>assms</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>s</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Refine_Transfer.html#Refine_Transfer.plain_bind|fact"><span>plain_bind</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.nfoldli_transfer_dres|fact"><span class="entity_def" id="Refine_Foreach.nfoldli_transfer_dres|thm"><span>nfoldli_transfer_dres</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="RefineG_Transfer.html#RefineG_Transfer.refine_transfer|attribute"><span class="operator"><span>refine_transfer</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="free"><span>c</span></span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_33999..34001">FR</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Refine_Transfer.html#Refine_Transfer.nres_of|const"><span>nres_of</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Transfer.html#Refine_Transfer.nres_of|const"><span>nres_of</span></a><span> 
    </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.case_dres|const"><span>case_dres</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><a class="entity_ref" href="HOL-Library.Monad_Syntax.html#Monad_Syntax.bind|const"><span>⤜</span></a></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.dRETURN|const"><span>dRETURN</span></a><span> </span><span class="free"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>s</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>s</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>Cons</span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="skolem"><span>l</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>f</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="skolem"><span>s</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>l</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>rotated</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.bind_mono|fact"><span>bind_mono</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_33999..34001"><span>FR</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>assumption</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_33999..34001"><span>FR</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>a</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>s</span></span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.nfoldli_mono|fact"><span class="entity_def" id="Refine_Foreach.nfoldli_mono(2)|thm"><span class="entity_def" id="Refine_Foreach.nfoldli_mono(1)|thm"><span>nfoldli_mono</span></span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="AFP/Refine_Monadic/refine_mono_prover.ML.html#Refine_Mono_Prover.refine_mono|attribute"><span class="operator"><span>refine_mono</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span> </span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span> </span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="RefineG_Domain.html#RefineG_Domain.flat_ge|const"><span>flat_ge</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="RefineG_Domain.html#RefineG_Domain.flat_ge|const"><span>flat_ge</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>σ</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Refine_Mono_Prover.html#Refine_Mono_Prover.refine_mono|method"><span class="operator"><span>refine_mono</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>σ</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Refine_Mono_Prover.html#Refine_Mono_Prover.refine_mono|method"><span class="operator"><span>refine_mono</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹We relate our fold-function to the while-loop that we used in
  the original definition of the foreach-loop›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.nfoldli_while|fact"><span class="entity_def" id="Refine_Foreach.nfoldli_while|thm"><span>nfoldli_while</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span>
          </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span>
         </span><span class="main"><span>(</span></span><span>WHILE<span class="hidden">⇩</span><sub>T</sub>⇗</span><span class="free"><span>I</span></span><span>⇖
           </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond|const"><span>FOREACH_cond</span></a><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_body|const"><span>FOREACH_body</span></a><span> </span><span class="free"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>l</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="HOL-Library.Monad_Syntax.html#Monad_Syntax.bind|const"><span>⤜</span></a></span><span>
          </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>σ</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/eqsubst.ML.html#HOL.subst|method"><span class="operator"><span>subst</span></span></a><span> </span><a class="entity_ref" href="Refine_While.html#Refine_While.while.WHILEIT_unfold|fact"><span>WHILEIT_unfold</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond_def|fact"><span>FOREACH_cond_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_35239..35243">Cons</span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="skolem"><span>ls</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>c</span></span><span> </span><span class="skolem"><span>σ</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>False</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/eqsubst.ML.html#HOL.subst|method"><span class="operator"><span>subst</span></span></a><span> </span><a class="entity_ref" href="Refine_While.html#Refine_While.while.WHILEIT_unfold|fact"><span>WHILEIT_unfold</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond_def|fact"><span>FOREACH_cond_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span>True</span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_35239..35243"><span>Cons</span></a><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/eqsubst.ML.html#HOL.subst|method"><span class="operator"><span>subst</span></span></a><span> </span><a class="entity_ref" href="Refine_While.html#Refine_While.while.WHILEIT_unfold|fact"><span>WHILEIT_unfold</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond_def|fact"><span>FOREACH_cond_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_body_def|fact"><span>FOREACH_body_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.bind_mono|fact"><span>Refine_Basic.bind_mono</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.while_nfoldli|fact"><span class="entity_def" id="Refine_Foreach.while_nfoldli|thm"><span>while_nfoldli</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Refine_While.html#Refine_While.WHILET|const"><span>WHILE<span class="hidden">⇩</span><sub>T</sub></span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond|const"><span>FOREACH_cond</span></a><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_body|const"><span>FOREACH_body</span></a><span> </span><span class="free"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>l</span></span><span class="main"><span>,</span></span><span class="free"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>σ</span></span><span>
  </span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>σ</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/eqsubst.ML.html#HOL.subst|method"><span class="operator"><span>subst</span></span></a><span> </span><a class="entity_ref" href="Refine_While.html#Refine_While.while.WHILET_unfold|fact"><span>WHILET_unfold</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond_def|fact"><span>FOREACH_cond_def</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/eqsubst.ML.html#HOL.subst|method"><span class="operator"><span>subst</span></span></a><span> </span><a class="entity_ref" href="Refine_While.html#Refine_While.while.WHILET_unfold|fact"><span>WHILET_unfold</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
    </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond_def|fact"><span>FOREACH_cond_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_body_def|fact"><span>FOREACH_body_def</span></a><span>
    </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.bind_mono|fact"><span>bind_mono</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.while_eq_nfoldli|fact"><span class="entity_def" id="Refine_Foreach.while_eq_nfoldli|thm"><span>while_eq_nfoldli</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Refine_While.html#Refine_While.WHILET|const"><span>WHILE<span class="hidden">⇩</span><sub>T</sub></span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond|const"><span>FOREACH_cond</span></a><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_body|const"><span>FOREACH_body</span></a><span> </span><span class="free"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>l</span></span><span class="main"><span>,</span></span><span class="free"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>σ</span></span><span>
  </span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.antisym|fact"><span>antisym</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.while_nfoldli|fact"><span>while_nfoldli</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli_while|fact"><span>nfoldli_while</span></a><span class="main"><span class="main"><span class="main"><span>[</span></span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> I</span><span class="main"><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>"</span></span></span><span class="main"><span class="main"><span class="main"><span>]</span></span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_While.html#Refine_While.while.WHILET_def|fact"><span>WHILET_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.nfoldli_rule|fact"><span class="entity_def" id="Refine_Foreach.nfoldli_rule|thm"><span>nfoldli_rule</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_36299..36301">I0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="free"><span>l0</span></span><span> </span><span class="free"><span>σ0</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_36326..36328">IS</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>l1</span></span><span> </span><span class="bound"><span>l2</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="free"><span>l0</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>l1</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="bound"><span>l2</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>l1</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="bound"><span>l2</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>l1</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="main"><span>[</span></span><span class="bound"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>l2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_36420..36423">FNC</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>l1</span></span><span> </span><span class="bound"><span>l2</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="free"><span>l0</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>l1</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="bound"><span>l2</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>l1</span></span><span> </span><span class="bound"><span>l2</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_36483..36485">FC</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>l0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l0</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli_while|fact"><span>nfoldli_while</span></a><span class="main"><span class="main"><span class="main"><span>[</span></span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> I</span><span class="main"><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>l2</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span class="bound"><span>l1</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="free"><span>l0</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>l1</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="bound"><span>l2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>l1</span></span><span> </span><span class="bound"><span>l2</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span class="main"><span class="main"><span class="main"><span>]</span></span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond_def|fact"><span>FOREACH_cond_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_body_def|fact"><span>FOREACH_body_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span> </span><a class="entity_ref" href="Refine_While.html#Refine_While.while.WHILEIT_rule|fact"><span>WHILEIT_rule</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> R</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Wellfounded.html#Wellfounded.measure|const"><span>measure</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_vcg|fact"><span class="dynamic"><span class="dynamic"><span>refine_vcg</span></span></span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_36299..36301"><span>I0</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct_tacs.ML.html#HOL.case_tac|method"><span class="operator"><span>case_tac</span></span></a><span> </span><span class="quoted"><span class="improper"><span>a</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>elim</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.exE|fact"><span>exE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjE|fact"><span>conjE</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_36326..36328"><span>IS</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>assumption</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>elim</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.exE|fact"><span>exE</span></a><span> </span><a class="entity_ref" href="../Automatic_Refinement/Misc.html#Misc.disjE2|fact"><span>disjE2</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_36483..36485"><span>FC</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_36420..36423"><span>FNC</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.nfoldli_leof_rule|fact"><span class="entity_def" id="Refine_Foreach.nfoldli_leof_rule|thm"><span>nfoldli_leof_rule</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_37074..37076">I0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="free"><span>l0</span></span><span> </span><span class="free"><span>σ0</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_37101..37103">IS</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>l1</span></span><span> </span><span class="bound"><span>l2</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="free"><span>l0</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>l1</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="bound"><span>l2</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>l1</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="bound"><span>l2</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>l1</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="main"><span>[</span></span><span class="bound"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>l2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_37197..37200">FNC</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>l1</span></span><span> </span><span class="bound"><span>l2</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="free"><span>l0</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>l1</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="bound"><span>l2</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>l1</span></span><span> </span><span class="bound"><span>l2</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_37260..37262">FC</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>l0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l0</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>{</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>l1</span></span><span> </span><span class="skolem"><span>l2</span></span><span> </span><span class="skolem"><span>σ</span></span><span>
    </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>l0</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="skolem"><span>l1</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="skolem"><span>l2</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="skolem"><span>l1</span></span><span> </span><span class="skolem"><span>l2</span></span><span> </span><span class="skolem"><span>σ</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="skolem"><span>l2</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="skolem"><span>σ</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induction.ML.html#HOL.induction|method"><span class="operator"><span>induction</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>l2</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>l1</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>σ</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>c</span></span><span> </span><span class="skolem"><span>σ</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_37260..37262"><span>FC</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>fail</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_37197..37200"><span>FNC</span></a><span class="main"><span class="main"><span>[</span></span></span><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>l1</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span>"</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>fail</span></span><span class="main"><span>)</span></span><span> 
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_37670..37674">Cons</span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="skolem"><span>l2</span></span><span class="main"><span>)</span></span><span> 
      </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_vcg|attribute"><span class="operator"><span>refine_vcg</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_37670..37674"><span>Cons.IH</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>l1</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="main"><span>[</span></span><span class="skolem"><span>x</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span class="main"><span>,</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_37101..37103"><span>IS</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>l1</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>x</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>l2</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>σ</span></span></span><span class="main"><span>,</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span>]</span></span><span>

      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>split</span></span><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.if_split|fact"><span>if_split</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_37670..37674"><span>Cons.prems</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_37197..37200"><span>FNC</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_37909..37910">}</span></span></span><span> </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_37909..37910"><span>this</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="free"><span>l0</span></span></span><span> </span><span class="quoted"><span class="free"><span>σ0</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_37074..37076"><span>I0</span></a><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>  
    
    
</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_37976..37981">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.nfoldli_refine|fact"><span class="entity_def" id="Refine_Foreach.nfoldli_refine|thm"><span>nfoldli_refine</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>li</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><span>⟨</span></span><span class="free"><span>S</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.list_rel|const"><span>list_rel</span></a><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>si</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_38070..38072">CR</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>ci</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.bool_rel|const"><span>bool_rel</span></a><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>xi</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>si</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xi</span></span><span class="main"><span>,</span></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>si</span></span><span class="main"><span>,</span></span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>s</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>fi</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="bound"><span>si</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>li</span></span><span> </span><span class="free"><span>ci</span></span><span> </span><span class="free"><span>fi</span></span><span> </span><span class="free"><span>si</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>s</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_37976..37981"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>,</span></span><span>2</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induction.ML.html#HOL.induction|method"><span class="operator"><span>induction</span></span></a><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>si</span></span></span><span> </span><span class="quoted"><span class="free"><span>s</span></span></span><span> </span><span class="quasi_keyword"><span>rule</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.list_rel_induct|fact"><span>list_rel_induct</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_38355..38359">Cons</span><span> </span><span class="skolem"><span>xi</span></span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="skolem"><span>li</span></span><span> </span><span class="skolem"><span>l</span></span><span class="main"><span>)</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_38355..38359"><span>Cons</span></a><span>

  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>split</span></span><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.if_split|fact"><span>if_split</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_38070..38072"><span>CR</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_38355..38359"><span>Cons.prems</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>dest</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_relD|fact"><span>fun_relD</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>    

</span><span class="comment1"><span>(* Refine, establishing additional invariant *)</span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_38573..38578">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.nfoldli_invar_refine|fact"><span class="entity_def" id="Refine_Foreach.nfoldli_invar_refine|thm"><span>nfoldli_invar_refine</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>li</span></span><span class="main"><span>,</span></span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><span class="free"><span>S</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.list_rel|const"><span>list_rel</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>si</span></span><span class="main"><span>,</span></span><span class="free"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="free"><span>li</span></span><span> </span><span class="free"><span>si</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_38686..38690">COND</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>l1i</span></span><span> </span><span class="bound"><span>l2i</span></span><span> </span><span class="bound"><span>l1</span></span><span> </span><span class="bound"><span>l2</span></span><span> </span><span class="bound"><span>si</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span>
    </span><span class="free"><span>li</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>l1i</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="bound"><span>l2i</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>l</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>l1</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="bound"><span>l2</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>l1i</span></span><span class="main"><span>,</span></span><span class="bound"><span>l1</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><span class="free"><span>S</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.list_rel|const"><span>list_rel</span></a><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>l2i</span></span><span class="main"><span>,</span></span><span class="bound"><span>l2</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><span class="free"><span>S</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.list_rel|const"><span>list_rel</span></a><span class="main"><span>;</span></span><span> 
    </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>l1i</span></span><span> </span><span class="bound"><span>l2i</span></span><span> </span><span class="bound"><span>si</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>si</span></span><span class="main"><span>,</span></span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>ci</span></span><span> </span><span class="bound"><span>si</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.bool_rel|const"><span>bool_rel</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_38849..38852">INV</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>l1i</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="bound"><span>l2i</span></span><span> </span><span class="bound"><span>si</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="free"><span>li</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>l1i</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="bound"><span>xi</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="bound"><span>l2i</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>l1i</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xi</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="bound"><span>l2i</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>si</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>fi</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="bound"><span>si</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>l1i</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="main"><span>[</span></span><span class="bound"><span>xi</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>l2i</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_38956..38960">STEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>l1i</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="bound"><span>l2i</span></span><span> </span><span class="bound"><span>l1</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>l2</span></span><span> </span><span class="bound"><span>si</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span>
    </span><span class="free"><span>li</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>l1i</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="bound"><span>xi</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="bound"><span>l2i</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>l</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="bound"><span>l1</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="bound"><span>l2</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>l1i</span></span><span class="main"><span>,</span></span><span class="bound"><span>l1</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><span class="free"><span>S</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.list_rel|const"><span>list_rel</span></a><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xi</span></span><span class="main"><span>,</span></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>l2i</span></span><span class="main"><span>,</span></span><span class="bound"><span>l2</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><span class="free"><span>S</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.list_rel|const"><span>list_rel</span></a><span class="main"><span>;</span></span><span> 
    </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>l1i</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xi</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="bound"><span>l2i</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>si</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>si</span></span><span class="main"><span>,</span></span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>fi</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="bound"><span>si</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>li</span></span><span> </span><span class="free"><span>ci</span></span><span> </span><span class="free"><span>fi</span></span><span> </span><span class="free"><span>si</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>s</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>{</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Heuristics.html#Refine_Heuristics.refine_dref_RELATES|attribute"><span class="operator"><span>refine_dref_RELATES</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Heuristics.html#Refine_Heuristics.RELATES|const"><span>RELATES</span></a><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Heuristics.html#Refine_Heuristics.RELATES|const"><span>RELATES</span></a><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Heuristics.html#Refine_Heuristics.RELATES_def|fact"><span>RELATES_def</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli_refine|fact"><span>nfoldli_refine</span></a><span>

    </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>l1i</span></span><span> </span><span class="skolem"><span>l2i</span></span><span> </span><span class="skolem"><span>l1</span></span><span> </span><span class="skolem"><span>l2</span></span><span> </span><span class="skolem"><span>si</span></span><span> </span><span class="skolem"><span>s</span></span><span>
    </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="skolem"><span>l2i</span></span><span class="main"><span>,</span></span><span class="skolem"><span>l2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><span>⟨</span></span><span class="free"><span>S</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.list_rel|const"><span>list_rel</span></a><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="skolem"><span>l1i</span></span><span class="main"><span>,</span></span><span class="skolem"><span>l1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><span>⟨</span></span><span class="free"><span>S</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.list_rel|const"><span>list_rel</span></a><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>li</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="skolem"><span>l1i</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="skolem"><span>l2i</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>l</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="skolem"><span>l1</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="skolem"><span>l2</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="skolem"><span>si</span></span><span class="main"><span>,</span></span><span class="skolem"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="skolem"><span>l1i</span></span><span> </span><span class="skolem"><span>l2i</span></span><span> </span><span class="skolem"><span>si</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="skolem"><span>l2i</span></span><span> </span><span class="free"><span>ci</span></span><span> </span><span class="free"><span>fi</span></span><span> </span><span class="skolem"><span>si</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="skolem"><span>l2</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="skolem"><span>s</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induction.ML.html#HOL.induction|method"><span class="operator"><span>induction</span></span></a><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>si</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>s</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>l1i</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>l1</span></span></span><span> </span><span class="quasi_keyword"><span>rule</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.list_rel_induct|fact"><span>list_rel_induct</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>  
      </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_39658..39662">Cons</span><span> </span><span class="skolem"><span>xi</span></span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="skolem"><span>l2i</span></span><span> </span><span class="skolem"><span>l2</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>split</span></span><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.if_split|fact"><span>if_split</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.bind_refine&apos;|fact"><span>bind_refine'</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Heuristics.html#Refine_Heuristics.refine_dref_type|method"><span class="operator"><span>refine_dref_type</span></span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_38686..38690"><span>COND</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>l1i</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>xi</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="skolem"><span>l2i</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>l1</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="skolem"><span>l2</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>si</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>s</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_39658..39662"><span>Cons.prems</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_39658..39662"><span>Cons.hyps</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_38956..38960"><span>STEP</span></a><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_39658..39662"><span>Cons.prems</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_39658..39662"><span>Cons.hyps</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> si' s'
          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_39658..39662"><span>Cons.IH</span></a><span class="main"><span class="main"><span>[</span></span></span><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>l1i</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="main"><span>[</span></span><span class="skolem"><span>xi</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>l1</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="main"><span>[</span></span><span class="skolem"><span>x</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_39658..39662"><span>Cons.prems</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_39658..39662"><span>Cons.hyps</span></a><span>
          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Param_HOL.html#Param_HOL.list_rel_append1|fact"><span>list_rel_append1</span></a><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.force|method"><span class="operator"><span>force</span></span></a><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_38849..38852"><span>INV</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>l1i</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>xi</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>l2i</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>si</span></span></span><span class="main"><span>]</span></span><span>
          </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Leof.html#Refine_Leof.pw_leof_iff|fact"><span>pw_leof_iff</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_39658..39662"><span>Cons.prems</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_40282..40283">}</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_40282..40283"><span>this</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>li</span></span></span><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="free"><span>si</span></span></span><span> </span><span class="quoted"><span class="free"><span>s</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_38573..38578"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>,</span></span><span>2</span><span class="main"><span>,</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
    
    
    
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.foldli_mono_dres_aux1|fact"><span class="entity_def" id="Refine_Foreach.foldli_mono_dres_aux1|thm"><span>foldli_mono_dres_aux1</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>σ</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order_bot|class"><span>order_bot</span></a><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order_top|class"><span>order_top</span></a><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_40456..40460">COND</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span class="bound"><span>σ'</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ'</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.bot_class.bot|const"><span>bot</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.top_class.top|const"><span>top</span></a><span> "</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_40517..40523">STRICT</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.bot_class.bot|const"><span>bot</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.bot_class.bot|const"><span>bot</span></a><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.top_class.top|const"><span>top</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.top_class.top|const"><span>top</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_40576..40577">B</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>σ</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span class="free"><span>σ'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_40596..40597">A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span class="bound"><span>x'</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ'</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>{</span></span></span><span> </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>l</span></span><span> 
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.bot_class.bot|const"><span>bot</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.bot_class.bot|const"><span>bot</span></a><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>l</span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_40517..40523"><span>STRICT</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_40766..40767">}</span></span></span><span> </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_40766..40767"><span>this</span></a><span>
  </span><span class="keyword1"><span class="command"><span>{</span></span></span><span> </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>l</span></span><span> 
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.top_class.top|const"><span>top</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.top_class.top|const"><span>top</span></a><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>l</span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_40517..40523"><span>STRICT</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_40869..40870">}</span></span></span><span> </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_40869..40870"><span>this</span></a><span>

  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_40576..40577"><span>B</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>σ</span></span></span><span> </span><span class="quoted"><span class="free"><span>σ'</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_40596..40597"><span>A</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_40517..40523"><span>STRICT</span></a><span> </span><span class="quasi_keyword"><span>dest</span></span><span class="main"><span class="main"><span>!</span></span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_40456..40460"><span>COND</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.foldli_mono_dres_aux2|fact"><span class="entity_def" id="Refine_Foreach.foldli_mono_dres_aux2|thm"><span>foldli_mono_dres_aux2</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_41052..41058">STRICT</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.bot_class.bot|const"><span>bot</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.bot_class.bot|const"><span>bot</span></a><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.top_class.top|const"><span>top</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.top_class.top|const"><span>top</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_41111..41112">A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span class="bound"><span>x'</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.case_dres|const"><span>case_dres</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.case_dres|const"><span>case_dres</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.foldli_mono_dres_aux1|fact"><span>foldli_mono_dres_aux1</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp_all</span></span><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.split_asm|fact"><span>dres.split_asm</span></a><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_41052..41058"><span>STRICT</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_41111..41112"><span>A</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.foldli_mono_dres|fact"><span class="entity_def" id="Refine_Foreach.foldli_mono_dres|thm"><span>foldli_mono_dres</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="AFP/Refine_Monadic/refine_mono_prover.ML.html#Refine_Mono_Prover.refine_mono|attribute"><span class="operator"><span>refine_mono</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_41391..41392">A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.case_dres|const"><span>case_dres</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dbind|const"><span>dbind</span></a><span> </span><span class="bound"><span>s</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>σ</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.case_dres|const"><span>case_dres</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dbind|const"><span>dbind</span></a><span> </span><span class="bound"><span>s</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.foldli_mono_dres_aux2|fact"><span>foldli_mono_dres_aux2</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp_all</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dbind_mono|fact"><span>dbind_mono</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp_all</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_41391..41392"><span>A</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>


</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.dfoldli.fixp_induct|fact"><span class="entity_def" id="Refine_Foreach.dfoldli.mono|fact"><span class="entity_def" id="Refine_Foreach.dfoldli.simps|fact"><span class="entity_def" id="Refine_Foreach.dfoldli.fixp_induct|thm"><span class="entity_def" id="Refine_Foreach.dfoldli.mono|thm"><span class="entity_def" id="Refine_Foreach.dfoldli.simps|thm"><span class="entity_def" id="Refine_Foreach.dfoldli_def|axiom"><span>partial_function</span></span></span></span></span></span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span>drec</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span class="entity_def" id="Refine_Foreach.dfoldli|const"><span>dfoldli</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>dfoldli</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>case</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="keyword1"><span>of</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.dRETURN|const"><span>dRETURN</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> 
    </span><span class="main"><span>|</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="bound"><span>ls</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>←</span></span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>dfoldli</span></span><span> </span><span class="bound"><span>ls</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>}</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.dRETURN|const"><span>dRETURN</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span>
  </span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.dfoldli_simps|fact"><span class="entity_def" id="Refine_Foreach.dfoldli_simps(2)|thm"><span class="entity_def" id="Refine_Foreach.dfoldli_simps(1)|thm"><span>dfoldli_simps</span></span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.dfoldli|const"><span>dfoldli</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.dRETURN|const"><span>dRETURN</span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.dfoldli|const"><span>dfoldli</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="free"><span>ls</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> 
    </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>←</span></span><span class="free"><span>f</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>s</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.dfoldli|const"><span>dfoldli</span></a><span> </span><span class="free"><span>ls</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>}</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.dRETURN|const"><span>dRETURN</span></a><span> </span><span class="free"><span>s</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/eqsubst.ML.html#HOL.subst|method"><span class="operator"><span>subst</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.dfoldli.simps|fact"><span>dfoldli.simps</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
  
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.dfoldli_mono|fact"><span class="entity_def" id="Refine_Foreach.dfoldli_mono(2)|thm"><span class="entity_def" id="Refine_Foreach.dfoldli_mono(1)|thm"><span>dfoldli_mono</span></span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="AFP/Refine_Monadic/refine_mono_prover.ML.html#Refine_Mono_Prover.refine_mono|attribute"><span class="operator"><span>refine_mono</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span> </span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.dfoldli|const"><span>dfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.dfoldli|const"><span>dfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span> </span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="RefineG_Domain.html#RefineG_Domain.flat_ge|const"><span>flat_ge</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="RefineG_Domain.html#RefineG_Domain.flat_ge|const"><span>flat_ge</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.dfoldli|const"><span>dfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.dfoldli|const"><span>dfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>σ</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Refine_Mono_Prover.html#Refine_Mono_Prover.refine_mono|method"><span class="operator"><span>refine_mono</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>σ</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Refine_Mono_Prover.html#Refine_Mono_Prover.refine_mono|method"><span class="operator"><span>refine_mono</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.foldli_dres_pres_FAIL|fact"><span class="entity_def" id="Refine_Foreach.foldli_dres_pres_FAIL|thm"><span>foldli_dres_pres_FAIL</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.case_dres|const"><span>case_dres</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dbind|const"><span>dbind</span></a><span> </span><span class="bound"><span>s</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dFAIL|const"><span>dFAIL</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dFAIL|const"><span>dFAIL</span></a><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.foldli_dres_pres_SUCCEED|fact"><span class="entity_def" id="Refine_Foreach.foldli_dres_pres_SUCCEED|thm"><span>foldli_dres_pres_SUCCEED</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.case_dres|const"><span>case_dres</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dbind|const"><span>dbind</span></a><span> </span><span class="bound"><span>s</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dSUCCEED|const"><span>dSUCCEED</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dSUCCEED|const"><span>dSUCCEED</span></a><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.dfoldli_by_foldli|fact"><span class="entity_def" id="Refine_Foreach.dfoldli_by_foldli|thm"><span>dfoldli_by_foldli</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.dfoldli|const"><span>dfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span>
  </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.case_dres|const"><span>case_dres</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dbind|const"><span>dbind</span></a><span> </span><span class="bound"><span>s</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.dRETURN|const"><span>dRETURN</span></a><span> </span><span class="free"><span>σ</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induction.ML.html#HOL.induction|method"><span class="operator"><span>induction</span></span></a><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>σ</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>!</span></span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.ext|fact"><span>ext</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rename_tac</span></span><span> a l x</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct_tacs.ML.html#HOL.case_tac|method"><span class="operator"><span>case_tac</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>f</span></span><span> </span><span class="improper"><span>a</span></span><span> </span><span class="improper"><span>x</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.foldli_mono_dres_flat|fact"><span class="entity_def" id="Refine_Foreach.foldli_mono_dres_flat|thm"><span>foldli_mono_dres_flat</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="AFP/Refine_Monadic/refine_mono_prover.ML.html#Refine_Mono_Prover.refine_mono|attribute"><span class="operator"><span>refine_mono</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_42958..42959">A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="RefineG_Domain.html#RefineG_Domain.flat_ge|const"><span>flat_ge</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="RefineG_Domain.html#RefineG_Domain.flat_ge|const"><span>flat_ge</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.case_dres|const"><span>case_dres</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dbind|const"><span>dbind</span></a><span> </span><span class="bound"><span>s</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>σ</span></span><span class="main"><span>)</span></span><span> 
          </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.case_dres|const"><span>case_dres</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dbind|const"><span>dbind</span></a><span> </span><span class="bound"><span>s</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>σ</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="free"><span>σ</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp_all</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.dfoldli_by_foldli|fact"><span>dfoldli_by_foldli</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>symmetric</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_42958..42959"><span>A</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Refine_Mono_Prover.html#Refine_Mono_Prover.refine_mono|method"><span class="operator"><span>refine_mono</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.dres_foldli_ne_bot|fact"><span class="entity_def" id="Refine_Foreach.dres_foldli_ne_bot|thm"><span>dres_foldli_ne_bot</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="RefineG_Transfer.html#RefineG_Transfer.refine_transfer|attribute"><span class="operator"><span>refine_transfer</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_43306..43307">1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dSUCCEED|const"><span>dSUCCEED</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_43334..43335">2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dSUCCEED|const"><span>dSUCCEED</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="HOL-Library.Monad_Syntax.html#Monad_Syntax.bind|const"><span>⤜</span></a></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dSUCCEED|const"><span>dSUCCEED</span></a><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_43306..43307"><span>1</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>σ</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.split|fact"><span>dres.split</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.allI|fact"><span>allI</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.impI|fact"><span>impI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Refine_Util.html#Refine_Util.rprems|method"><span class="operator"><span>rprems</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_43334..43335"><span>2</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres_ne_bot_basic|fact"><span>dres_ne_bot_basic</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹LIST FOREACH combinator›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹
  Foreach-loops are mapped to the combinator </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>‹</span></span><span>LIST_FOREACH›</span></span></span><span>, that
  takes as first argument an explicit </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>‹</span></span><span>to_list›</span></span></span><span> operation. 
  This mapping is done during operation identification. 
  It is then the responsibility of the various implementations to further map
  the </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>‹</span></span><span>to_list›</span></span></span><span> operations to custom </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>‹</span></span><span>to_list›</span></span></span><span> operations, like
  </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>‹</span></span><span>set_to_list›</span></span></span><span>, </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>‹</span></span><span>map_to_list›</span></span></span><span>, </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>‹</span></span><span>nodes_to_list›</span></span></span><span>, etc.
›</span></span></span><span>

  
</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹We define a relation between distinct lists and sets.›</span></span></span><span>  
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.list_set_rel_def|fact"><span class="entity_def" id="Refine_Foreach.list_set_rel_def|thm"><span class="entity_def" id="Refine_Foreach.list_set_rel_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/Param_Tool.html#Param_Tool.to_relAPP|attribute"><span class="operator"><span>to_relAPP</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Refine_Foreach.list_set_rel|const"><span>list_set_rel</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>⟨</span></span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.list_rel|const"><span>list_rel</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.relcomp|const"><span>O</span></a></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.br|const"><span>br</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.distinct|const"><span>distinct</span></a><span>"</span></span></span><span>
  
  
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.autoref_nfoldli|fact"><span class="entity_def" id="Refine_Foreach.autoref_nfoldli|thm"><span>autoref_nfoldli</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/Autoref_Relator_Interface.html#Autoref_Relator_Interface.autoref_rules|attribute"><span class="operator"><span>autoref_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span class="main"><span>)</span></span><span>
  </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><span>⟨</span></span><span class="free"><span>Ra</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.list_rel|const"><span>list_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>Rb</span></span><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.bool_rel|const"><span>bool_rel</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>Ra</span></span><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="free"><span>Rb</span></span><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><span class="free"><span>Rb</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="free"><span>Rb</span></span><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><span class="free"><span>Rb</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.param_nfoldli|fact"><span>param_nfoldli</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹This constant is a placeholder to be converted to
  custom operations by pattern rules›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.it_to_sorted_list_def|fact"><span class="entity_def" id="Refine_Foreach.it_to_sorted_list_def|thm"><span class="entity_def" id="Refine_Foreach.it_to_sorted_list_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Refine_Foreach.it_to_sorted_list|const"><span>it_to_sorted_list</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> 
  </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>l</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.distinct|const"><span>distinct</span></a><span> </span><span class="bound"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.sorted_wrt|const"><span>sorted_wrt</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="bound"><span>l</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.LIST_FOREACH_def|fact"><span class="entity_def" id="Refine_Foreach.LIST_FOREACH_def|thm"><span class="entity_def" id="Refine_Foreach.LIST_FOREACH_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Refine_Foreach.LIST_FOREACH|const"><span>LIST_FOREACH</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>tsl</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>σ0</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
  </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>tsl</span></span></span></span><span class="main"><span>;</span></span><span>
  </span><span class="main"><span>(</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>←</span></span><span> WHILE<span class="hidden">⇩</span><sub>T</sub>⇗</span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>it</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span class="bound"><span>xs'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="bound"><span>xs'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span> </span><span class="bound"><span>it</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>it</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span>⇖
    </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond|const"><span>FOREACH_cond</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_body|const"><span>FOREACH_body</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>σ0</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHoci_by_LIST_FOREACH|fact"><span class="entity_def" id="Refine_Foreach.FOREACHoci_by_LIST_FOREACH|thm"><span>FOREACHoci_by_LIST_FOREACH</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span>S</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH|const"><span>LIST_FOREACH</span></a><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.it_to_sorted_list|const"><span>it_to_sorted_list</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ0</span></span><span>
  </span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.OP_def|fact"><span>OP_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_def|fact"><span>FOREACHoci_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH_def|fact"><span>LIST_FOREACH_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.it_to_sorted_list_def|fact"><span>it_to_sorted_list_def</span></a><span> 
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Patterns that convert FOREACH-constructs 
  to </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>‹</span></span><span>LIST_FOREACH›</span></span></span><span>
›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>context</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span> </span><span class="keyword1"><span class="command"><span>interpretation</span></span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Autoref_Tool.html#Autoref_Tool.autoref_syn|locale"><span>autoref_syn</span></a><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACH_patterns|fact"><span class="entity_def" id="Refine_Foreach.FOREACH_patterns(6)|thm"><span class="entity_def" id="Refine_Foreach.FOREACH_patterns(5)|thm"><span class="entity_def" id="Refine_Foreach.FOREACH_patterns(4)|thm"><span class="entity_def" id="Refine_Foreach.FOREACH_patterns(3)|thm"><span class="entity_def" id="Refine_Foreach.FOREACH_patterns(2)|thm"><span class="entity_def" id="Refine_Foreach.FOREACH_patterns(1)|thm"><span>FOREACH_patterns</span></span></span></span></span></span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/Autoref_Id_Ops.html#Autoref_Id_Ops.autoref_op_pat_def|attribute"><span class="operator"><span>autoref_op_pat_def</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"FOREACH⇗</span><span class="free"><span>I</span></span><span>⇖ </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>≡</span></span><span> FOREACH<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>C</sub>⇗</span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>,</span></a></span><span class="free"><span>I</span></span><span>⇖ </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>f</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci|const"><span>FOREACHci</span></a><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"FOREACH<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>C</sub>⇗</span><span class="free"><span>R</span></span><span class="main"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>,</span></a></span><span class="free"><span>Φ</span></span><span>⇖ </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="../Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.OP|const"><span>Autoref_Tagging.OP</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH|const"><span>LIST_FOREACH</span></a><span> </span><span class="free"><span>Φ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.it_to_sorted_list|const"><span>it_to_sorted_list</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>σ</span></span><span>
  </span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH|const"><span>FOREACH</span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>f</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoi|const"><span>FOREACHoi</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>f</span></span><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc|const"><span>FOREACHc</span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci|const"><span>FOREACHoci</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> 
    </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_by_LIST_FOREACH|fact"><span>FOREACHoci_by_LIST_FOREACH</span></a><span class="main"><span>[</span></span><span class="operator"><span>abs_def</span></span><span class="main"><span>]</span></span><span>
    </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc_def|fact"><span>FOREACHc_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>abs_def</span></span><span class="main"><span>]</span></span><span> 
    </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_def|fact"><span>FOREACH_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>abs_def</span></span><span class="main"><span>]</span></span><span> 
    </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_def|fact"><span>FOREACHci_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>abs_def</span></span><span class="main"><span>]</span></span><span> 
    </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi_def|fact"><span>FOREACHi_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>abs_def</span></span><span class="main"><span>]</span></span><span> 
    </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoi_def|fact"><span>FOREACHoi_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>abs_def</span></span><span class="main"><span>]</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span>

</span><span class="comment1"><span>(*lemma FOREACH_patterns[autoref_op_pat]: 
  "FOREACHoci R Φ s c f σ ≡ do {
    ASSERT (finite s);
    OP (LIST_FOREACH Φ) (it_to_sorted_list R s) c f σ
  }"
  "FOREACHc s c f σ ≡ FOREACHoci (λ_ _. True) (λ_ _. True) s c f σ"
  "FOREACH s f σ ≡ FOREACHoci (λ_ _. True) (λ_ _. True) s (λ_. True) f σ"
  "FOREACHci I s c f σ ≡ FOREACHoci (λ_ _. True) I s c f σ"
  "FOREACHi I s f σ ≡ FOREACHoci (λ_ _. True) I s (λ_. True) f σ"
  "FOREACHoi R I s f σ ≡ FOREACHoci R I s (λ_. True) f σ"
  unfolding 
    FOREACHoci_by_LIST_FOREACH[abs_def]
    FOREACHc_def[abs_def] 
    FOREACH_def[abs_def] 
    FOREACHci_def[abs_def] 
    FOREACHi_def[abs_def] 
    FOREACHoi_def[abs_def] 
  by simp_all*)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.LIST_FOREACH&apos;_def|fact"><span class="entity_def" id="Refine_Foreach.LIST_FOREACH&apos;_def|thm"><span class="entity_def" id="Refine_Foreach.LIST_FOREACH&apos;_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Refine_Foreach.LIST_FOREACH&apos;|const"><span>LIST_FOREACH'</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>tsl</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>σ</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>xs</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>tsl</span></span></span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>σ</span></span></span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.LIST_FOREACH&apos;_param|fact"><span class="entity_def" id="Refine_Foreach.LIST_FOREACH&apos;_param|thm"><span>LIST_FOREACH'_param</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/Param_Tool.html#Param_Tool.param|attribute"><span class="operator"><span>param</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;|const"><span>LIST_FOREACH'</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;|const"><span>LIST_FOREACH'</span></a><span class="main"><span>)</span></span><span> 
  </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>⟨</span></span><span class="main"><span>⟨</span></span><span class="free"><span>Rv</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.list_rel|const"><span>list_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>Rσ</span></span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.bool_rel|const"><span>bool_rel</span></a><span class="main"><span>)</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>Rv</span></span><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="free"><span>Rσ</span></span><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><span class="free"><span>Rσ</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="free"><span>Rσ</span></span><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><span class="free"><span>Rσ</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;_def|fact"><span>LIST_FOREACH'_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>abs_def</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Param_Tool.html#Param_Tool.parametricity|method"><span class="operator"><span>parametricity</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.LIST_FOREACH_autoref|fact"><span class="entity_def" id="Refine_Foreach.LIST_FOREACH_autoref|thm"><span>LIST_FOREACH_autoref</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/Autoref_Relator_Interface.html#Autoref_Relator_Interface.autoref_rules|attribute"><span class="operator"><span>autoref_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;|const"><span>LIST_FOREACH'</span></a><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH|const"><span>LIST_FOREACH</span></a><span> </span><span class="free"><span>Φ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> 
    </span><span class="main"><span>(</span></span><span class="main"><span>⟨</span></span><span class="main"><span>⟨</span></span><span class="free"><span>Rv</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.list_rel|const"><span>list_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>Rσ</span></span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.bool_rel|const"><span>bool_rel</span></a><span class="main"><span>)</span></span><span> 
      </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>Rv</span></span><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="free"><span>Rσ</span></span><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><span class="free"><span>Rσ</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="free"><span>Rσ</span></span><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><span class="free"><span>Rσ</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>tsl</span></span><span> </span><span class="skolem"><span>tsl'</span></span><span> </span><span class="skolem"><span>c</span></span><span> </span><span class="skolem"><span>c'</span></span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="skolem"><span>f'</span></span><span> </span><span class="skolem"><span>σ</span></span><span> </span><span class="skolem"><span>σ'</span></span><span>
  </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/Param_Tool.html#Param_Tool.param|attribute"><span class="operator"><span>param</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="skolem"><span>tsl</span></span><span class="main"><span>,</span></span><span class="skolem"><span>tsl'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><span class="main"><span>⟨</span></span><span class="free"><span>Rv</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.list_rel|const"><span>list_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="skolem"><span>c</span></span><span class="main"><span>,</span></span><span class="skolem"><span>c'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>Rσ</span></span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.bool_rel|const"><span>bool_rel</span></a><span>"</span></span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="skolem"><span>f</span></span><span class="main"><span>,</span></span><span class="skolem"><span>f'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>Rv</span></span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span class="free"><span>Rσ</span></span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span class="main"><span>⟨</span></span><span class="free"><span>Rσ</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="skolem"><span>σ</span></span><span class="main"><span>,</span></span><span class="skolem"><span>σ'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>Rσ</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;|const"><span>LIST_FOREACH'</span></a><span> </span><span class="skolem"><span>tsl</span></span><span> </span><span class="skolem"><span>c</span></span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="skolem"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>Rσ</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;|const"><span>LIST_FOREACH'</span></a><span> </span><span class="skolem"><span>tsl'</span></span><span> </span><span class="skolem"><span>c'</span></span><span> </span><span class="skolem"><span>f'</span></span><span> </span><span class="skolem"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres_relD|fact"><span>nres_relD</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Param_Tool.html#Param_Tool.parametricity|method"><span class="operator"><span>parametricity</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;|const"><span>LIST_FOREACH'</span></a><span> </span><span class="skolem"><span>tsl'</span></span><span> </span><span class="skolem"><span>c'</span></span><span> </span><span class="skolem"><span>f'</span></span><span> </span><span class="skolem"><span>σ'</span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH|const"><span>LIST_FOREACH</span></a><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="skolem"><span>tsl'</span></span><span> </span><span class="skolem"><span>c'</span></span><span> </span><span class="skolem"><span>f'</span></span><span> </span><span class="skolem"><span>σ'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_IdD|fact"><span>refine_IdD</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH_def|fact"><span>LIST_FOREACH_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;_def|fact"><span>LIST_FOREACH'_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli_while|fact"><span>nfoldli_while</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span> 
  </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;|const"><span>LIST_FOREACH'</span></a><span> </span><span class="skolem"><span>tsl</span></span><span> </span><span class="skolem"><span>c</span></span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="skolem"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span> </span><span class="free"><span>Rσ</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH|const"><span>LIST_FOREACH</span></a><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="skolem"><span>tsl'</span></span><span> </span><span class="skolem"><span>c'</span></span><span> </span><span class="skolem"><span>f'</span></span><span> </span><span class="skolem"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>context</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span> </span><span class="keyword1"><span class="command"><span>interpretation</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec|locale"><span>trimono_spec</span></a><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.LIST_FOREACH&apos;_mono|fact"><span class="entity_def" id="Refine_Foreach.LIST_FOREACH&apos;_mono|thm"><span>LIST_FOREACH'_mono</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><span>trimono_spec_defs</span></a></a></a><span class="main"><span>,</span></span><a class="entity_ref" href="AFP/Refine_Monadic/refine_mono_prover.ML.html#Refine_Mono_Prover.refine_mono|attribute"><span class="operator"><span>refine_mono</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec|const"><span>trimono_spec</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.M2|const"><span>M2</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec.R|const"><span>R</span></a><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;|const"><span>LIST_FOREACH'</span></a><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>unfold</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.trimono_spec_defs|fact"><span>trimono_spec_defs</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;_def|fact"><span>LIST_FOREACH'_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="Refine_Mono_Prover.html#Refine_Mono_Prover.refine_mono|method"><span class="operator"><span>refine_mono</span></span></a><span class="main"><span class="keyword3"><span>+</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_47820..47825">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.LIST_FOREACH&apos;_transfer_plain|fact"><span class="entity_def" id="Refine_Foreach.LIST_FOREACH&apos;_transfer_plain|thm"><span>LIST_FOREACH'_transfer_plain</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="RefineG_Transfer.html#RefineG_Transfer.refine_transfer|attribute"><span class="operator"><span>refine_transfer</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span>tsl</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>tsl'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="free"><span>tsl</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;|const"><span>LIST_FOREACH'</span></a><span> </span><span class="free"><span>tsl'</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>rotated</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;_def|fact"><span>LIST_FOREACH'_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_47820..47825"><span>assms</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="RefineG_Transfer.html#RefineG_Transfer.refine_transfer|method"><span class="operator"><span>refine_transfer</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span>thm</span></span></span><span> </span><a class="entity_ref" href="RefineG_Transfer.html#RefineG_Transfer.refine_transfer|fact"><span class="dynamic"><span class="dynamic"><span>refine_transfer</span></span></span></a><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_48145..48150">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.LIST_FOREACH&apos;_transfer_nres|fact"><span class="entity_def" id="Refine_Foreach.LIST_FOREACH&apos;_transfer_nres|thm"><span>LIST_FOREACH'_transfer_nres</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="RefineG_Transfer.html#RefineG_Transfer.refine_transfer|attribute"><span class="operator"><span>refine_transfer</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Transfer.html#Refine_Transfer.nres_of|const"><span>nres_of</span></a><span> </span><span class="free"><span>tsl</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>tsl'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Refine_Transfer.html#Refine_Transfer.nres_of|const"><span>nres_of</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Transfer.html#Refine_Transfer.nres_of|const"><span>nres_of</span></a><span> </span><span class="main"><span>(</span></span><span>
    </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><span class="bound"><span>xs</span></span><span class="main"><span>←</span></span><span class="free"><span>tsl</span></span><span class="main"><span>;</span></span><span> 
      </span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.case_dres|const"><span>case_dres</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><a class="entity_ref" href="HOL-Library.Monad_Syntax.html#Monad_Syntax.bind|const"><span>⤜</span></a></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.dRETURN|const"><span>dRETURN</span></a><span> </span><span class="free"><span>σ</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;|const"><span>LIST_FOREACH'</span></a><span> </span><span class="free"><span>tsl'</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;_def|fact"><span>LIST_FOREACH'_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_48145..48150"><span>assms</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="RefineG_Transfer.html#RefineG_Transfer.refine_transfer|method"><span class="operator"><span>refine_transfer</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Simplification rules to summarize iterators›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="RefineG_Transfer.html#RefineG_Transfer.refine_transfer_post_simp|attribute"><span class="operator"><span>refine_transfer_post_simp</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="Refine_Det.html#Refine_Det.dres.dRETURN|const"><span>dRETURN</span></a><span> </span><span class="free"><span>tsl</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span>
  </span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="free"><span>tsl</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span>"</span></span></span><span> 
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="RefineG_Transfer.html#RefineG_Transfer.refine_transfer_post_simp|attribute"><span class="operator"><span>refine_transfer_post_simp</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>tsl</span></span><span> </span><span class="keyword1"><span>in</span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Foldi.html#Foldi.foldli|const"><span>foldli</span></a><span> </span><span class="free"><span>tsl</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span>"</span></span></span><span> 
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

    
</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_48767..48772">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.LFO_pre_refine|fact"><span class="entity_def" id="Refine_Foreach.LFO_pre_refine|thm"><span>LFO_pre_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="comment1"><span>(* TODO: Generalize! *)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>li</span></span><span class="main"><span>,</span></span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><span class="free"><span>A</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.list_set_rel|const"><span>list_set_rel</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>ci</span></span><span class="main"><span>,</span></span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.bool_rel|const"><span>bool_rel</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>fi</span></span><span class="main"><span>,</span></span><span class="free"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span class="free"><span>R</span></span><span class="main"><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span class="main"><span>⟨</span></span><span class="free"><span>R</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s0i</span></span><span class="main"><span>,</span></span><span class="free"><span>s0</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;|const"><span>LIST_FOREACH'</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span>li</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>ci</span></span><span> </span><span class="free"><span>fi</span></span><span> </span><span class="free"><span>s0i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci|const"><span>FOREACHci</span></a><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>s0</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_48767..48772"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span>l</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.list_set_rel_def|fact"><span>list_set_rel_def</span></a><span> </span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.br_def|fact"><span>br_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc_def|fact"><span>FOREACHc_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_def|fact"><span>FOREACHci_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_by_LIST_FOREACH|fact"><span>FOREACHoci_by_LIST_FOREACH</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH_autoref|fact"><span>LIST_FOREACH_autoref</span></a><span class="main"><span class="main"><span>[</span></span></span><a class="entity_ref" href="../Automatic_Refinement/Param_Tool.html#Param_Tool.param_fo|attribute"><span class="operator"><span>param_fo</span></span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres_relD|fact"><span>nres_relD</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_48767..48772"><span>assms</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.it_to_sorted_list_def|fact"><span>it_to_sorted_list_def</span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres_rel_def|fact"><span>nres_rel_def</span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.pw_le_iff|fact"><span>pw_le_iff</span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span>
      </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.list_set_rel_def|fact"><span>list_set_rel_def</span></a><span> </span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.br_def|fact"><span>br_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>    
    

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_49430..49435">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.LFOci_refine|fact"><span class="entity_def" id="Refine_Foreach.LFOci_refine|thm"><span>LFOci_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="comment1"><span>(* TODO: Generalize! *)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>li</span></span><span class="main"><span>,</span></span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><span class="free"><span>A</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.list_set_rel|const"><span>list_set_rel</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>s</span></span><span> </span><span class="bound"><span>si</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>si</span></span><span class="main"><span>,</span></span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>ci</span></span><span> </span><span class="bound"><span>si</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>s</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="bound"><span>s</span></span><span> </span><span class="bound"><span>si</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="main"><span>(</span></span><span class="bound"><span>xi</span></span><span class="main"><span>,</span></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>A</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>si</span></span><span class="main"><span>,</span></span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>fi</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="bound"><span>si</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s0i</span></span><span class="main"><span>,</span></span><span class="free"><span>s0</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>li</span></span><span> </span><span class="free"><span>ci</span></span><span> </span><span class="free"><span>fi</span></span><span> </span><span class="free"><span>s0i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci|const"><span>FOREACHci</span></a><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>s0</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_49430..49435"><span>assms</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LFO_pre_refine|fact"><span>LFO_pre_refine</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>li</span></span></span><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span> </span><span class="quoted"><span class="free"><span>A</span></span></span><span> </span><span class="quoted"><span class="free"><span>ci</span></span></span><span> </span><span class="quoted"><span class="free"><span>c</span></span></span><span> </span><span class="quoted"><span class="free"><span>R</span></span></span><span> </span><span class="quoted"><span class="free"><span>fi</span></span></span><span> </span><span class="quoted"><span class="free"><span>f</span></span></span><span> </span><span class="quoted"><span class="free"><span>s0i</span></span></span><span> </span><span class="quoted"><span class="free"><span>s0</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.fun_rel_def|fact"><span>fun_rel_def</span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres_rel_def|fact"><span>nres_rel_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;_def|fact"><span>LIST_FOREACH'_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.pw_le_iff|fact"><span>pw_le_iff</span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span class="main"><span class="keyword3"><span>+</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>    

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_49921..49926">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.LFOc_refine|fact"><span class="entity_def" id="Refine_Foreach.LFOc_refine|thm"><span>LFOc_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="comment1"><span>(* TODO: Generalize! *)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>li</span></span><span class="main"><span>,</span></span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><span class="free"><span>A</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.list_set_rel|const"><span>list_set_rel</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>s</span></span><span> </span><span class="bound"><span>si</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>si</span></span><span class="main"><span>,</span></span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>ci</span></span><span> </span><span class="bound"><span>si</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>s</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="bound"><span>s</span></span><span> </span><span class="bound"><span>si</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="main"><span>(</span></span><span class="bound"><span>xi</span></span><span class="main"><span>,</span></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>A</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>si</span></span><span class="main"><span>,</span></span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>fi</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="bound"><span>si</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s0i</span></span><span class="main"><span>,</span></span><span class="free"><span>s0</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>li</span></span><span> </span><span class="free"><span>ci</span></span><span> </span><span class="free"><span>fi</span></span><span> </span><span class="free"><span>s0i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc|const"><span>FOREACHc</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>s0</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc_def|fact"><span>FOREACHc_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LFOci_refine|fact"><span>LFOci_refine</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_49921..49926"><span>assms</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>

  
</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_50253..50258">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.LFO_refine|fact"><span class="entity_def" id="Refine_Foreach.LFO_refine|thm"><span>LFO_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="comment1"><span>(* TODO: Generalize! *)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>li</span></span><span class="main"><span>,</span></span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><span class="free"><span>A</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.list_set_rel|const"><span>list_set_rel</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="bound"><span>s</span></span><span> </span><span class="bound"><span>si</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="main"><span>(</span></span><span class="bound"><span>xi</span></span><span class="main"><span>,</span></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>A</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>si</span></span><span class="main"><span>,</span></span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>fi</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="bound"><span>si</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s0i</span></span><span class="main"><span>,</span></span><span class="free"><span>s0</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>li</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>fi</span></span><span> </span><span class="free"><span>s0i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH|const"><span>FOREACH</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>s0</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_def|fact"><span>FOREACH_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LFOc_refine|fact"><span>LFOc_refine</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_50253..50258"><span>assms</span></a><span> </span><span class="main"><span class="keyword3"><span>|</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_50571..50576">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.LFOi_refine|fact"><span class="entity_def" id="Refine_Foreach.LFOi_refine|thm"><span>LFOi_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="comment1"><span>(* TODO: Generalize! *)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>li</span></span><span class="main"><span>,</span></span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><span class="free"><span>A</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.list_set_rel|const"><span>list_set_rel</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="bound"><span>s</span></span><span> </span><span class="bound"><span>si</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="main"><span>(</span></span><span class="bound"><span>xi</span></span><span class="main"><span>,</span></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>A</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>si</span></span><span class="main"><span>,</span></span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>fi</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="bound"><span>si</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s0i</span></span><span class="main"><span>,</span></span><span class="free"><span>s0</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>li</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>fi</span></span><span> </span><span class="free"><span>s0i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi|const"><span>FOREACHi</span></a><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>s0</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHi_def|fact"><span>FOREACHi_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LFOci_refine|fact"><span>LFOci_refine</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_50571..50576"><span>assms</span></a><span> </span><span class="main"><span class="keyword3"><span>|</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
    
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.LIST_FOREACH&apos;_refine|fact"><span class="entity_def" id="Refine_Foreach.LIST_FOREACH&apos;_refine|thm"><span>LIST_FOREACH'_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;|const"><span>LIST_FOREACH'</span></a><span> </span><span class="free"><span>tsl'</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH|const"><span>LIST_FOREACH</span></a><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="free"><span>tsl'</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ'</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_IdD|fact"><span>refine_IdD</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH_def|fact"><span>LIST_FOREACH_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;_def|fact"><span>LIST_FOREACH'_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli_while|fact"><span>nfoldli_while</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.LIST_FOREACH&apos;_eq|fact"><span class="entity_def" id="Refine_Foreach.LIST_FOREACH&apos;_eq|thm"><span>LIST_FOREACH'_eq</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH|const"><span>LIST_FOREACH</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>tsl'</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;|const"><span>LIST_FOREACH'</span></a><span> </span><span class="free"><span>tsl'</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.antisym|fact"><span>antisym</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_IdD|fact"><span>refine_IdD</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH_def|fact"><span>LIST_FOREACH_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;_def|fact"><span>LIST_FOREACH'_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.while_eq_nfoldli|fact"><span>while_eq_nfoldli</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span> 
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span> </span><a class="entity_ref" href="Refine_While.html#Refine_While.WHILEIT_refine_new_invar|fact"><span>WHILEIT_refine_new_invar</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_While.html#Refine_While.while.WHILET_def|fact"><span>WHILET_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_While.html#Refine_While.WHILEIT_refine_new_invar|fact"><span>WHILEIT_refine_new_invar</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Refine_Heuristics.html#Refine_Heuristics.refine_dref_type|method"><span class="operator"><span>refine_dref_type</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Refine_Util.html#Refine_Util.clarsimp_all|method"><span class="operator"><span>clarsimp_all</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_body_def|fact"><span>FOREACH_body_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_cond_def|fact"><span>FOREACH_cond_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.pw_le_iff|fact"><span>pw_le_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.neq_Nil_conv|fact"><span>neq_Nil_conv</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;_refine|fact"><span>LIST_FOREACH'_refine</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
    
    
</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹FOREACH with duplicates›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.FOREACHcd_def|fact"><span class="entity_def" id="Refine_Foreach.FOREACHcd_def|thm"><span class="entity_def" id="Refine_Foreach.FOREACHcd_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Refine_Foreach.FOREACHcd|const"><span>FOREACHcd</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>σ</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
  </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="bound"><span>l</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>l</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="bound"><span>l</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>σ</span></span></span></span><span>
</span><span class="main"><span>}</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHcd_rule|fact"><span class="entity_def" id="Refine_Foreach.FOREACHcd_rule|thm"><span>FOREACHcd_rule</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span>S<span class="hidden">⇩</span><sub>0</sub></span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_51932..51934">I0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="free"><span>S<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="free"><span>σ<span class="hidden">⇩</span><sub>0</sub></span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_51961..51965">STEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>S1</span></span><span> </span><span class="bound"><span>S2</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="free"><span>S<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert|const"><span>insert</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>S1</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span class="bound"><span>S2</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>S1</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert|const"><span>insert</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>S2</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert|const"><span>insert</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>S1</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>S2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_52081..52085">INTR</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>S1</span></span><span> </span><span class="bound"><span>S2</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="free"><span>S<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="bound"><span>S1</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span class="bound"><span>S2</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>S1</span></span><span> </span><span class="bound"><span>S2</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_52148..52153">COMPL</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHcd|const"><span>FOREACHcd</span></a><span> </span><span class="free"><span>S<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="free"><span>Φ</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHcd_def|fact"><span>FOREACHcd_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>fact</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli_rule|fact"><span>nfoldli_rule</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> I </span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="bound"><span>l1</span></span><span> </span><span class="bound"><span>l2</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>l1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>l2</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_51932..51934"><span>I0</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_51961..51965"><span>STEP</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_52081..52085"><span>INTR</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_52148..52153"><span>COMPL</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.FOREACHcdi_def|fact"><span class="entity_def" id="Refine_Foreach.FOREACHcdi_def|thm"><span class="entity_def" id="Refine_Foreach.FOREACHcdi_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Refine_Foreach.FOREACHcdi|const"><span>FOREACHcdi</span></span></span><span> 
  </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span class="main"><span>)</span></span><span> 
    </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>FOREACHcdi</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>I</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHcd|const"><span>FOREACHcd</span></a><span>"</span></span></span><span>  

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_52647..52652">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHcdi_rule|fact"><span class="entity_def" id="Refine_Foreach.FOREACHcdi_rule|thm"><span>FOREACHcdi_rule</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_vcg|attribute"><span class="operator"><span>refine_vcg</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span>S<span class="hidden">⇩</span><sub>0</sub></span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>I0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="free"><span>S<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="free"><span>σ<span class="hidden">⇩</span><sub>0</sub></span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>STEP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>S1</span></span><span> </span><span class="bound"><span>S2</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="free"><span>S<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert|const"><span>insert</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>S1</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span class="bound"><span>S2</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>S1</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert|const"><span>insert</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>S2</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert|const"><span>insert</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>S1</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>S2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>INTR</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>S1</span></span><span> </span><span class="bound"><span>S2</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="free"><span>S<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="bound"><span>S1</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span class="bound"><span>S2</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="bound"><span>S1</span></span><span> </span><span class="bound"><span>S2</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>COMPL</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHcdi|const"><span>FOREACHcdi</span></a><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>S<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ<span class="hidden">⇩</span><sub>0</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="free"><span>Φ</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHcdi_def|fact"><span>FOREACHcdi_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_52647..52652"><span>assms</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHcd_rule|fact"><span>FOREACHcd_rule</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHcd_refine|fact"><span class="entity_def" id="Refine_Foreach.FOREACHcd_refine|thm"><span>FOREACHcd_refine</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span>s'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_53155..53156">S</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s'</span></span><span class="main"><span>,</span></span><span class="free"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><span class="free"><span>S</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.set_rel|const"><span>set_rel</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_53188..53190">SV</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.single_valued|const"><span>single_valued</span></a><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_53220..53222">R0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>σ'</span></span><span class="main"><span>,</span></span><span class="free"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_53245..53246">C</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>σ'</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>,</span></span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>c'</span></span><span> </span><span class="bound"><span>σ'</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.bool_rel|const"><span>bool_rel</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_53300..53301">F</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ'</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="main"><span>(</span></span><span class="bound"><span>x'</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>σ'</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R</span></span><span class="main"><span>⟧</span></span><span>
     </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>σ'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHcd|const"><span>FOREACHcd</span></a><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>c'</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>σ'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHcdi|const"><span>FOREACHcdi</span></a><span> </span><span class="free"><span>I</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Heuristics.html#Refine_Heuristics.refine_dref_RELATES|attribute"><span class="operator"><span>refine_dref_RELATES</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Heuristics.html#Refine_Heuristics.RELATES|const"><span>RELATES</span></a><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Heuristics.html#Refine_Heuristics.RELATES_def|fact"><span>RELATES_def</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_53188..53190"><span>SV</span></a><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>α</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>I</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.br|const"><span>br</span></a><span> </span><span class="skolem"><span>α</span></span><span> </span><span class="skolem"><span>I</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.single_valued_as_brE|fact"><span>single_valued_as_brE</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>with</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_53155..53156"><span>S</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>s</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="skolem"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>s'</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="free"><span>s'</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>I</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.br_set_rel_alt|fact"><span>br_set_rel_alt</span></a><span class="main"><span>)</span></span><span>
  
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHcd_def|fact"><span>FOREACHcd_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHcdi_def|fact"><span>FOREACHcdi_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Refine_Heuristics.html#Refine_Heuristics.refine_dref_type|method"><span class="operator"><span>refine_dref_type</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.pw_le_iff|fact"><span>pw_le_iff</span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_53155..53156"><span>S</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule_tac</span></span><span> x</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.map|const"><span>map</span></a><span> </span><span class="skolem"><span>α</span></span><span> </span><span class="improper"><span>x</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>in</span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.exI|fact"><span>exI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.map_in_list_rel_conv|fact"><span>map_in_list_rel_conv</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_53220..53222"><span>R0</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_53245..53246"><span>C</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>  
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_53300..53301"><span>F</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>    
    

  
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHc_refines_FOREACHcd_aux|fact"><span class="entity_def" id="Refine_Foreach.FOREACHc_refines_FOREACHcd_aux|thm"><span>FOREACHc_refines_FOREACHcd_aux</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc|const"><span>FOREACHc</span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHcd|const"><span>FOREACHcd</span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>σ</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc_def|fact"><span>FOREACHc_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHci_def|fact"><span>FOREACHci_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHoci_by_LIST_FOREACH|fact"><span>FOREACHoci_by_LIST_FOREACH</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;_eq|fact"><span>LIST_FOREACH'_eq</span></a><span>
    </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.LIST_FOREACH&apos;_def|fact"><span>LIST_FOREACH'_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHcd_def|fact"><span>FOREACHcd_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.it_to_sorted_list_def|fact"><span>it_to_sorted_list_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_IdD|fact"><span>refine_IdD</span></a><span class="main"><span>)</span></span><span>  
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Refine_Heuristics.html#Refine_Heuristics.refine_dref_type|method"><span class="operator"><span>refine_dref_type</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
    
</span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.FOREACHc_refines_FOREACHcd|fact"><span class="entity_def" id="Refine_Foreach.FOREACHc_refines_FOREACHcd|thm"><span>FOREACHc_refines_FOREACHcd</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHc_refines_FOREACHcd_aux|fact"><span>FOREACHc_refines_FOREACHcd_aux</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACHcd_refine|fact"><span>FOREACHcd_refine</span></a><span class="main"><span>]</span></span><span>
    
    
</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Miscellanneous Utility Lemmas›</span></span></span><span>

</span><span class="comment1"><span>(* TODO: Can we make this somewhat more general ? *)</span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_54641..54646">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.map_foreach|fact"><span class="entity_def" id="Refine_Foreach.map_foreach|thm"><span>map_foreach</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH|const"><span>FOREACH</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert|const"><span>insert</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>R0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>(=)</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>R0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span> </span><span class="free"><span>f</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>S</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_rule|fact"><span>FOREACH_rule</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> I</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>R0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span> </span><span class="free"><span>f</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="main"><span>(</span></span><span class="free"><span>S</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_54641..54646"><span>assms</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_54858..54863">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.map_sigma_foreach|fact"><span class="entity_def" id="Refine_Foreach.map_sigma_foreach|thm"><span>map_sigma_foreach</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'c</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>A</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>B</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH|const"><span>FOREACH</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> 
    </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH|const"><span>FOREACH</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>B</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert|const"><span>insert</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span>
  </span><span class="main"><span>)</span></span><span> </span><span class="free"><span>R0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>(=)</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>R0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span> </span><span class="free"><span>f</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Sigma|const"><span>Sigma</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_rule|fact"><span>FOREACH_rule</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> I</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>R0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span> </span><span class="free"><span>f</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Sigma|const"><span>Sigma</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_54858..54863"><span>assms</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span>2</span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule_tac</span></span><span> I</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>R0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span> </span><span class="free"><span>f</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Sigma|const"><span>Sigma</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="improper"><span>it</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span> </span><span class="free"><span>f</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="improper"><span>x</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Times|const"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>B</span></span><span> </span><span class="improper"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>in</span></span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_rule|fact"><span>FOREACH_rule</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_54858..54863"><span>assms</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span>2</span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_vcg|fact"><span class="dynamic"><span class="dynamic"><span>refine_vcg</span></span></span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_55419..55424">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.map_sigma_sigma_foreach|fact"><span class="entity_def" id="Refine_Foreach.map_sigma_sigma_foreach|thm"><span>map_sigma_sigma_foreach</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'d</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>A</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>B</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="bound"><span>a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>A</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>B</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>C</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH|const"><span>FOREACH</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> 
    </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH|const"><span>FOREACH</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>B</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> 
      </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH|const"><span>FOREACH</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>C</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>c</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span>
        </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert|const"><span>insert</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>b</span></span><span class="main"><span>,</span></span><span class="bound"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>σ</span></span><span>
  </span><span class="main"><span>)</span></span><span> </span><span class="free"><span>R0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>(=)</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>R0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span> </span><span class="free"><span>f</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Sigma|const"><span>Sigma</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Sigma|const"><span>Sigma</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>B</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>C</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_rule|fact"><span>FOREACH_rule</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> 
    I</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>R0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span> </span><span class="free"><span>f</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Sigma|const"><span>Sigma</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>it</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Sigma|const"><span>Sigma</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>B</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>C</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_55419..55424"><span>assms</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span>2</span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule_tac</span></span><span> 
    I</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="bound"><span>it'</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>R0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span> </span><span class="free"><span>f</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Sigma|const"><span>Sigma</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="improper"><span>it</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Sigma|const"><span>Sigma</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>B</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>C</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 
      </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span> </span><span class="free"><span>f</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="improper"><span>x</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Times|const"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Sigma|const"><span>Sigma</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>B</span></span><span> </span><span class="improper"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="bound"><span>it'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>C</span></span><span> </span><span class="improper"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>in</span></span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_rule|fact"><span>FOREACH_rule</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_55419..55424"><span>assms</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span>2</span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule_tac</span></span><span> 
    I</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="bound"><span>it''</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>σ</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>R0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span> </span><span class="free"><span>f</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Sigma|const"><span>Sigma</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="improper"><span>it</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Sigma|const"><span>Sigma</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>B</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>C</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 
      </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span> </span><span class="free"><span>f</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="improper"><span>x</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Times|const"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Sigma|const"><span>Sigma</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>B</span></span><span> </span><span class="improper"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="improper"><span>ita</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>C</span></span><span> </span><span class="improper"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span> </span><span class="free"><span>f</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="improper"><span>x</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Times|const"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="improper"><span>xa</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Times|const"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>C</span></span><span> </span><span class="improper"><span>x</span></span><span> </span><span class="improper"><span>xa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="bound"><span>it''</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    "</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>in</span></span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_rule|fact"><span>FOREACH_rule</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_55419..55424"><span>assms</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span>2</span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>


</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_56352..56357">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.bij_set_rel_for_inj|fact"><span class="entity_def" id="Refine_Foreach.bij_set_rel_for_inj(2)|thm"><span class="entity_def" id="Refine_Foreach.bij_set_rel_for_inj(1)|thm"><span>bij_set_rel_for_inj</span></span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>R</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>defines</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>α</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Misc.html#Misc.fun_of_rel|const"><span>fun_of_rel</span></a><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Automatic_Refinement/Misc.html#Misc.bijective|const"><span>bijective</span></a><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>,</span></span><span class="free"><span>s'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><span class="free"><span>R</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.set_rel|const"><span>set_rel</span></a><span>"</span></span></span><span>  
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>α</span></span><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>s'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>α</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span class="free"><span>s</span></span><span>"</span></span></span><span>
  </span><span class="comment1"><span>― ‹To be used when generating refinement conditions for foreach-loops›</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_56352..56357"><span>assms</span></a><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Misc.html#Misc.bijective_def|fact"><span>bijective_def</span></a><span> </span><a class="entity_ref" href="../Automatic_Refinement/Relators.html#Relators.set_rel_def|fact"><span>set_rel_def</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_56352..56357"><span>α_def</span></a><span> </span><a class="entity_ref" href="../Automatic_Refinement/Misc.html#Misc.fun_of_rel_def|fact"><span>fun_of_rel_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>abs_def</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>!</span></span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_onI|fact"><span>inj_onI</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.ImageI|fact"><span>ImageI</span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image_def|fact"><span>image_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>mono_tags</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Domain.simps|fact"><span>Domain.simps</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.contra_subsetD|fact"><span>contra_subsetD</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.tfl_some|fact"><span>tfl_some</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>mono_tags</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.someI|fact"><span>someI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.DomainE|fact"><span>DomainE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.contra_subsetD|fact"><span>contra_subsetD</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.tfl_some|fact"><span>tfl_some</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.nfoldli_by_idx_gen|fact"><span class="entity_def" id="Refine_Foreach.nfoldli_by_idx_gen|thm"><span>nfoldli_by_idx_gen</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.drop|const"><span>drop</span></a><span> </span><span class="free"><span>k</span></span><span> </span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>[</span></a></span><span class="free"><span>k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>..&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>l</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>]</span></a></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>l</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>i</span></span><span class="main"><span>;</span></span><span>
      </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span>
    </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>l</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>False</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>True</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> 
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induction.ML.html#HOL.induction|method"><span class="operator"><span>induction</span></span></a><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>s</span></span></span><span> </span><span class="quasi_keyword"><span>rule</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.inc_induct|fact"><span>inc_induct</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>base</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>    
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_57231..57235">step</span><span> </span><span class="skolem"><span>k</span></span><span class="main"><span>)</span></span><span> 
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_57231..57235"><span>step.hyps</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_57264..57265">1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.drop|const"><span>drop</span></a><span> </span><span class="skolem"><span>k</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>l</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="skolem"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.drop|const"><span>drop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="skolem"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>l</span></span><span>"</span></span></span><span> 
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.Cons_nth_drop_Suc|fact"><span>Cons_nth_drop_Suc</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_57231..57235"><span>step.hyps</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_57366..57367">2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>[</span></a></span><span class="skolem"><span>k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>..&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>l</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>]</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>[</span></a></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="skolem"><span>k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>..&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>l</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>]</span></a></span><span>"</span></span></span><span> 
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt_conv_Cons|fact"><span>upt_conv_Cons</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_57264..57265"><span>1</span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_57366..57367"><span>2</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_57231..57235"><span>step.IH</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>abs_def</span></span><span class="main"><span class="main"><span>]</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_57231..57235"><span>step.hyps</span></a><span class="main"><span>)</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  


</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.nfoldli_by_idx|fact"><span class="entity_def" id="Refine_Foreach.nfoldli_by_idx|thm"><span>nfoldli_by_idx</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>[</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>..&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>l</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>]</span></a></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>l</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>i</span></span><span class="main"><span>;</span></span><span>
    </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span>
  </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli_by_idx_gen|fact"><span>nfoldli_by_idx_gen</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_57730..57735">lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.nfoldli_map_inv|fact"><span class="entity_def" id="Refine_Foreach.nfoldli_map_inv|thm"><span>nfoldli_map_inv</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj|const"><span>inj</span></a><span> </span><span class="free"><span>g</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.map|const"><span>map</span></a><span> </span><span class="free"><span>g</span></span><span> </span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.the_inv|const"><span>the_inv</span></a><span> </span><span class="free"><span>g</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_57730..57735"><span>assms</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induction.ML.html#HOL.induction|method"><span class="operator"><span>induction</span></span></a><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.the_inv_f_f|fact"><span>the_inv_f_f</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
    
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.nfoldli_shift|fact"><span class="entity_def" id="Refine_Foreach.nfoldli_shift|thm"><span>nfoldli_shift</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>ofs</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.map|const"><span>map</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="free"><span>ofs</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span class="free"><span>ofs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>ofs</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induction.ML.html#HOL.induction|method"><span class="operator"><span>induction</span></span></a><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.nfoldli_foreach_shift|fact"><span class="entity_def" id="Refine_Foreach.nfoldli_foreach_shift|thm"><span>nfoldli_foreach_shift</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>[</span></a></span><span class="free"><span>a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>..&lt;</span></a></span><span class="free"><span>b</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>]</span></a></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>[</span></a></span><span class="free"><span>a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="free"><span>ofs</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>..&lt;</span></a></span><span class="free"><span>b</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="free"><span>ofs</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>]</span></a></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span class="main"><span>{</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span class="free"><span>ofs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>ofs</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli_shift|fact"><span>nfoldli_shift</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>[</span></a></span><span class="free"><span>a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>..&lt;</span></a></span><span class="free"><span>b</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>]</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="free"><span>c</span></span></span><span> </span><span class="quoted"><span class="free"><span>f</span></span></span><span> </span><span class="quoted"><span class="free"><span>ofs</span></span></span><span class="main"><span>]</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Misc.html#Misc.map_add_upt&apos;|fact"><span>map_add_upt'</span></a><span class="main"><span>)</span></span><span>


</span><span class="comment1"><span>(* TODO: Move. Probably we have this already with FOREACH, or iterator! *)</span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.member_by_nfoldli|fact"><span class="entity_def" id="Refine_Foreach.member_by_nfoldli|thm"><span>member_by_nfoldli</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="bound"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>y</span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>y</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>r</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.nfoldli|const"><span>nfoldli</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="bound"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>y</span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>y</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>r</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="skolem"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="skolem"><span>s</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induction.ML.html#HOL.induction|method"><span class="operator"><span>induction</span></span></a><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>s</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> a l s
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../Automatic_Refinement/Refine_Util.html#Refine_Util.rprems|method"><span class="operator"><span>rprems</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span class="entity_def" id="offset_58757..58761">done</span></span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#offset_58757..58761"><span>this</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a></span><span class="main"><span>]</span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>  

  
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Refine_Foreach.sum_impl_def|fact"><span class="entity_def" id="Refine_Foreach.sum_impl_def|thm"><span class="entity_def" id="Refine_Foreach.sum_impl_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Refine_Foreach.sum_impl|const"><span>sum_impl</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.comm_monoid_add|class"><span>comm_monoid_add</span></a><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>sum_impl</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>g</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH|const"><span>FOREACH</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>g</span></span></span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Refine_Foreach.sum_impl_correct|fact"><span class="entity_def" id="Refine_Foreach.sum_impl_correct|thm"><span>sum_impl_correct</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_vcg|attribute"><span class="operator"><span>refine_vcg</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>S</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>gi</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>g</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.sum_impl|const"><span>sum_impl</span></a><span> </span><span class="free"><span>gi</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="../../HOL/HOL/Groups_Big.html#Groups_Big.comm_monoid_add_class.sum|const"><span>sum</span></a><span> </span><span class="free"><span>g</span></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.sum_impl_def|fact"><span>sum_impl_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.FOREACH_rule|fact"><span>FOREACH_rule</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> I</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="bound"><span>it</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups_Big.html#Groups_Big.comm_monoid_add_class.sum|const"><span>sum</span></a><span> </span><span class="free"><span>g</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="bound"><span>it</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Refine_Foreach.html#Refine_Foreach.it_step_insert_iff|fact"><span>it_step_insert_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
  

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>