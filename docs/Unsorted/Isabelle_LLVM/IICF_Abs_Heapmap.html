<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory IICF_Abs_Heapmap</title>
</head>


<body>
<div class="head">
<h1>Theory IICF_Abs_Heapmap</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Priority Maps implemented with List and Map›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><a href="IICF_Abs_Heapmap.html"><span>IICF_Abs_Heapmap</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> </span><a href="IICF_Abs_Heap.html"><span>IICF_Abs_Heap</span></a><span> </span><span class="quoted"><span>"</span><a href="HOL-Library.Rewrite.html"><span>HOL-Library.Rewrite</span></a><span>"</span></span><span> </span><span class="quoted"><span>"</span><a href="IICF_Prio_Map.html"><span>../../Intf/IICF_Prio_Map</span></a><span>"</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>type_synonym</span></span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.ahm|type"><span>ahm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'k</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.map|type"><span>⇀</span></a></span><span> </span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Basic Setup›</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹First, we define a mapping to list-based heaps›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'v</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heap.html#IICF_Abs_Heap.heap|type"><span>heap</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hmr_α</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.map|const"><span>map</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.the|const"><span>the</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>pq</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmr_invar_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmr_invar_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmr_invar_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.distinct|const"><span>distinct</span></a><span> </span><span class="bound"><span>pq</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.dom|const"><span>dom</span></a><span> </span><span class="bound"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.supset_eq|const"><span>⊇</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>pq</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmr_rel_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmr_rel_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmr_rel_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.br|const"><span>br</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmr_rel_defs|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmr_rel_defs(3)|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmr_rel_defs(2)|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmr_rel_defs(1)|thm"><span>hmr_rel_defs</span></span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;_def|fact"><span>hmr_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar_def|fact"><span>hmr_invar_def</span></a><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmr_empty_invar|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmr_empty_invar|thm"><span>hmr_empty_invar</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span class="main"><span>,</span></span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.empty|const"><span>Map.empty</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar_def|fact"><span>hmr_invar_def</span></a><span class="main"><span>)</span></span><span>


  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_654..660">locale</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct|locale"><span>hmstruct</span></span><span> </span><span class="main"><span>=</span></span><span> h</span><span class="main"><span>:</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heap.html#IICF_Abs_Heap.heapstruct|locale"><span>heapstruct</span></a><span> </span><span class="quoted"><span class="free"><span>prio</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="free"><span>prio</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'v</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder|class"><span>linorder</span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Next, we define a mapping to priority maps.›</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_\&lt;alpha&gt;_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_\&lt;alpha&gt;_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_\&lt;alpha&gt;_def_raw|axiom"><span class="entity_def" id="offset_792..802">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_\&lt;alpha&gt;|const"><span class="entity_def" id="offset_803..812">heapmap_α</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.map|type"><span>⇀</span></a></span><span> </span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>heapmap_α</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.restrict_map|const"><span>|`</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>pq</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_invar_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_invar_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_invar_def_raw|axiom"><span class="entity_def" id="offset_894..904">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_invar.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_invar.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_invar|const"><span class="entity_def" id="offset_905..918">heapmap_invar</span></span></span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>heapmap_invar</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="bound"><span>hm</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span>h.heap_invar</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="bound"><span>hm</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_rel_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_rel_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_rel_def_raw|axiom"><span class="entity_def" id="offset_1028..1038">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_rel.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_rel.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_rel|const"><span class="entity_def" id="offset_1040..1051">heapmap_rel</span></span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.br|const"><span>br</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_905..918"><span>heapmap_invar</span></a><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_rel_defs|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_rel_defs(4)|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_rel_defs(3)|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_rel_defs(2)|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_rel_defs(1)|thm"><span class="entity_def" id="offset_1094..1110">heapmap_rel_defs</span></span></span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1028..1038"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.br_def|fact"><span>br_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_792..802"><span>heapmap_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_894..904"><span>heapmap_invar_def</span></a><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Heuristics.html#Refine_Heuristics.refine_dref_RELATES|attribute"><span class="operator"><span>refine_dref_RELATES</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Heuristics.html#Refine_Heuristics.RELATES|const"><span>RELATES</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Heuristics.html#Refine_Heuristics.RELATES_def|fact"><span>RELATES_def</span></a><span class="main"><span>)</span></span><span>


    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.h_heap_invarI|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.h_heap_invarI|thm"><span>h_heap_invarI</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_905..918"><span>heapmap_invar</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span>h.heap_invar</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_894..904"><span>heapmap_invar_def</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hmr_invarI|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hmr_invarI|thm"><span>hmr_invarI</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_905..918"><span>heapmap_invar</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="free"><span>hm</span></span><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_894..904"><span>heapmap_invar_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>



    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.set_hmr_\&lt;alpha&gt;|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.set_hmr_\&lt;alpha&gt;|thm"><span>set_hmr_α</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ran|const"><span>ran</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;_def|fact"><span>hmr_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar_def|fact"><span>hmr_invar_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_792..802"><span>heapmap_α_def</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.Int_absorb1|fact"><span>Int_absorb1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp_apply|fact"><span>comp_apply</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.dom_restrict|fact"><span>dom_restrict</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image_cong|fact"><span>image_cong</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.ran_is_image|fact"><span>ran_is_image</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.restrict_in|fact"><span>restrict_in</span></a><span class="main"><span>)</span></span><span>
      
    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.in_h_hmr_\&lt;alpha&gt;_conv|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.in_h_hmr_\&lt;alpha&gt;_conv|thm"><span>in_h_hmr_α_conv</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/HOL-Library.Multiset.html#Multiset.member_mset|const"><span>∈#</span></a></span><span> </span><span>h.α</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ran|const"><span>ran</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;_def|fact"><span>hmr_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar_def|fact"><span>hmr_invar_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_792..802"><span>heapmap_α_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/HOL-Library.Multiset.html#Multiset.in_multiset_in_set|fact"><span>in_multiset_in_set</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.ran_is_image|fact"><span>ran_is_image</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.Int_absorb1|fact"><span>Int_absorb1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp_apply|fact"><span>comp_apply</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image_cong|fact"><span>image_cong</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.restrict_in|fact"><span>restrict_in</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Basic Operations›</span></span></span><span>
    </span><span class="comment1"><span>(* length, val_of_op, update, butlast, append, empty *)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹In this section, we define the basic operations on heapmaps, 
      and their relations to heaps and maps.›</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Length›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Length of the list that represents the heap›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_length_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_length_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_length_def_raw|axiom"><span class="entity_def" id="offset_2276..2286">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_length|const"><span class="entity_def" id="offset_2287..2296">hm_length</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm_length</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>pq</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_length_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_length_refine|thm"><span class="entity_def" id="offset_2376..2392">hm_length_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2287..2296"><span>hm_length</span></a><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.nat_rel|const"><span>nat_rel</span></a><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_defs|fact"><span>hmr_rel_defs</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span class="main"><span>)</span></span><span>
        
    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_length_hmr_\&lt;alpha&gt;|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_length_hmr_\&lt;alpha&gt;|thm"><span>hm_length_hmr_α</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2287..2296"><span>hm_length</span></a><span> </span><span class="free"><span>hm</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;_def|fact"><span>hmr_α_def</span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.splits|fact"><span>prod.splits</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2376..2392"><span>hm_length_refine</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.param_fo|attribute"><span class="operator"><span>param_fo</span></span></a><span class="main"><span>]</span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Valid›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Check whether index is valid›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_valid_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_valid_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_valid_def_raw|axiom"><span class="entity_def" id="offset_2806..2816">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_valid|const"><span class="entity_def" id="offset_2818..2826">hm_valid</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2287..2296"><span>hm_length</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_valid_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_valid_refine|thm"><span class="entity_def" id="offset_2868..2883">hm_valid_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span class="main"><span>,</span></span><span>h.valid</span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.nat_rel|const"><span>nat_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.bool_rel|const"><span>bool_rel</span></a><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2806..2816"><span>hm_valid_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.valid_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Param_Tool.html#Param_Tool.parametricity|method"><span class="operator"><span>parametricity</span></span></a><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2376..2392"><span>hm_length_refine</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_valid_hmr_\&lt;alpha&gt;|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_valid_hmr_\&lt;alpha&gt;|thm"><span>hm_valid_hmr_α</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>h.valid</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.ext|fact"><span>ext</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.valid_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2806..2816"><span>hm_valid_def</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Has-Child›</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_has_child_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_has_child_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_has_child_op_def_raw|axiom"><span class="entity_def" id="offset_3216..3226">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_has_child_op|const"><span class="entity_def" id="offset_3228..3243">hm_has_child_op</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2287..2296"><span>hm_length</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_left_child_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_left_child_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_left_child_op_def_raw|axiom"><span class="entity_def" id="offset_3275..3285">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_left_child_op|const"><span>hm_left_child_op</span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span>"</span></span></span><span>   
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_next_child_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_next_child_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_next_child_op_def_raw|axiom"><span class="entity_def" id="offset_3327..3337">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_next_child_op|const"><span>hm_next_child_op</span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>"</span></span></span><span>   
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_has_next_child_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_has_next_child_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_has_next_child_op_def_raw|axiom"><span class="entity_def" id="offset_3379..3389">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_has_next_child_op|const"><span class="entity_def" id="offset_3391..3411">hm_has_next_child_op</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2287..2296"><span>hm_length</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span>"</span></span></span><span>   
    
    
    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Key-Of›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_key_of_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_key_of_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_key_of_def_raw|axiom"><span class="entity_def" id="offset_3483..3493">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_key_of|const"><span class="entity_def" id="offset_3494..3503">hm_key_of</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'k</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>  
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm_key_of</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>pq</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_key_of_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_key_of_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_key_of_op_def_raw|axiom"><span class="entity_def" id="offset_3587..3597">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_key_of_op|const"><span class="entity_def" id="offset_3598..3610">hm_key_of_op</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'k</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm_key_of_op</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="IICF_List.html#IICF_List.mop_list_get|const"><span>mop_list_get</span></a><span> </span><span class="bound"><span>pq</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_key_of_op_unfold|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_key_of_op_unfold|thm"><span class="entity_def" id="offset_3739..3758">hm_key_of_op_unfold</span></span></span><span class="main"><span>:</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3598..3610"><span>hm_key_of_op</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3494..3503"><span>hm_key_of</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2806..2816"><span>hm_valid_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3587..3597"><span>hm_key_of_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3483..3493"><span>hm_key_of_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.splits|fact"><span>prod.splits</span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pw_eq_iff|fact"><span>pw_eq_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.val_of_hmr_\&lt;alpha&gt;|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.val_of_hmr_\&lt;alpha&gt;|thm"><span>val_of_hmr_α</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span>h.val_of</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>i</span></span><span> 
      </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.the|const"><span>the</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3494..3503"><span>hm_key_of</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> 
        </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;_def|fact"><span>hmr_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.val_of_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_792..802"><span>heapmap_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3483..3493"><span>hm_key_of_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2806..2816"><span>hm_valid_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span>
        </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.splits|fact"><span>prod.splits</span></a><span class="main"><span>)</span></span><span>
 
    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_\&lt;alpha&gt;_key_ex|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_\&lt;alpha&gt;_key_ex|thm"><span>hm_α_key_ex</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3494..3503"><span>hm_key_of</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_894..904"><span>heapmap_invar_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar_def|fact"><span>hmr_invar_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2806..2816"><span>hm_valid_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_792..802"><span>heapmap_α_def</span></a><span> 
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3483..3493"><span>hm_key_of_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.splits|fact"><span>prod.splits</span></a><span class="main"><span>)</span></span><span>  
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.domD|fact"><span>domD</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.in_set_conv_nth|fact"><span>in_set_conv_nth</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.nz_le_conv_less|fact"><span>nz_le_conv_less</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.subset_code|fact"><span>subset_code</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Lookup›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="main"><span>(</span></span><span>input</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_lookup|const"><span class="entity_def" id="offset_4629..4638">hm_lookup</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm_lookup</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_the_lookup_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_the_lookup_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_the_lookup_op_def_raw|axiom"><span class="entity_def" id="offset_4674..4684">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_the_lookup_op|const"><span class="entity_def" id="offset_4686..4702">hm_the_lookup_op</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.the|const"><span>the</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="comment1"><span>(*definition "hm_the_lookup_op' hm k ≡ do {
      let (pq,ml) = hm;
      (*ASSERT (heapmap_α (hm_impl1_α hm) k ≠ None ∧ hm_impl1_invar hm);*)
      v ← mop_map_lookup ml k;
      RETURN v
    }"
      
    lemma hm_the_lookup_op'_refine: 
      "(hm_the_lookup_op', hm_the_lookup_op) ∈ hmr_rel → nat_rel → ⟨Id⟩nres_rel"
      apply (intro fun_relI nres_relI)
      unfolding hm_the_lookup_op'_def hm_the_lookup_op_def
      apply refine_vcg
      apply (auto)
      apply (auto simp: hm_impl1_rel_defs heapmap_α_def hmr_invar_def split: if_split_asm)
      done
    *)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Exchange›</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Exchange two indices›</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_op_def_raw|axiom"><span class="entity_def" id="offset_5451..5461">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_op|const"><span class="entity_def" id="offset_5463..5473">hm_exch_op</span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>pq</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_List.html#IICF_List.mop_list_swap|const"><span>mop_list_swap</span></a><span> </span><span class="bound"><span>pq</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>j</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_op_invar|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_op_invar|thm"><span>hm_exch_op_invar</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_5463..5473"><span>hm_exch_op</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>j</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_5451..5461"><span>hm_exch_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.exch_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.val_of_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.update_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2806..2816"><span>hm_valid_def</span></a><span> </span><a class="entity_ref" href="More_List.html#More_List.map_swap|fact"><span>map_swap</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_defs|fact"><span>hmr_rel_defs</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_op_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_op_refine|thm"><span class="entity_def" id="offset_5948..5965">hm_exch_op_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_5463..5473"><span>hm_exch_op</span></a><span class="main"><span>,</span></span><span>h.exch_op</span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.nat_rel|const"><span>nat_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.nat_rel|const"><span>nat_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_5451..5461"><span>hm_exch_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.exch_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.val_of_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.update_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2806..2816"><span>hm_valid_def</span></a><span> </span><a class="entity_ref" href="More_List.html#More_List.map_swap|fact"><span>map_swap</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_defs|fact"><span>hmr_rel_defs</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
      
    </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_op_refine&apos;|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_op_refine&apos;|thm"><span>hm_exch_op_refine'</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_5948..5965"><span>hm_exch_op_refine</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.param_fo|attribute"><span class="operator"><span>param_fo</span></span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relD|fact"><span>nres_relD</span></a><span class="main"><span>]</span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_def_raw|axiom"><span class="entity_def" id="offset_6390..6400">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch|const"><span class="entity_def" id="offset_6401..6408">hm_exch</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm_exch</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="More_List.html#More_List.swap|const"><span>swap</span></a><span> </span><span class="bound"><span>pq</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>j</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

      
    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_op_\&lt;alpha&gt;_correct|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_op_\&lt;alpha&gt;_correct|thm"><span class="entity_def" id="offset_6531..6551">hm_exch_op_α_correct</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_5463..5473"><span>hm_exch_op</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>j</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>hm'</span></span><span class="main"><span>.</span></span><span> 
      </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>j</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="bound"><span>hm'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_6401..6408"><span>hm_exch</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>j</span></span><span>
      </span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_5451..5461"><span>hm_exch_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3483..3493"><span>hm_key_of_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_6390..6400"><span>hm_exch_def</span></a><span> </span><a class="entity_ref" href="More_List.html#More_List.swap_def|fact"><span>swap_def</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_\&lt;alpha&gt;|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_\&lt;alpha&gt;|thm"><span>hm_exch_α</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>j</span></span><span class="main"><span>⟧</span></span><span> 
      </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_6401..6408"><span>hm_exch</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_792..802"><span>heapmap_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_6390..6400"><span>hm_exch_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2806..2816"><span>hm_valid_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.splits|fact"><span>prod.splits</span></a><span class="main"><span>)</span></span><span>
      
    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_valid|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_valid|thm"><span>hm_exch_valid</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_6401..6408"><span>hm_exch</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.ext|fact"><span>ext</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2806..2816"><span>hm_valid_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_6390..6400"><span>hm_exch_def</span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.splits|fact"><span>prod.splits</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_length|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_length|thm"><span>hm_exch_length</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2287..2296"><span>hm_length</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_6401..6408"><span>hm_exch</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2287..2296"><span>hm_length</span></a><span> </span><span class="free"><span>hm</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_6390..6400"><span>hm_exch_def</span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.splits|fact"><span>prod.splits</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_same|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_exch_same|thm"><span>hm_exch_same</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_6401..6408"><span>hm_exch</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>hm</span></span><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_6390..6400"><span>hm_exch_def</span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.splits|fact"><span>prod.splits</span></a><span class="main"><span>)</span></span><span>
      

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_key_of_exch_conv|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_key_of_exch_conv|thm"><span>hm_key_of_exch_conv</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>   
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>j</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> 
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3494..3503"><span>hm_key_of</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_6401..6408"><span>hm_exch</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span>k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>i</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3494..3503"><span>hm_key_of</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>j</span></span><span>
          </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span>k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>j</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3494..3503"><span>hm_key_of</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span>
          </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3494..3503"><span>hm_key_of</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span>
          </span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_6390..6400"><span>hm_exch_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2806..2816"><span>hm_valid_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3483..3493"><span>hm_key_of_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.splits|fact"><span>prod.splits</span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="More_List.html#More_List.swap_nth|fact"><span>swap_nth</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_key_of_exch_matching|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_key_of_exch_matching(2)|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_key_of_exch_matching(1)|thm"><span>hm_key_of_exch_matching</span></span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>  
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>j</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3494..3503"><span>hm_key_of</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_6401..6408"><span>hm_exch</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3494..3503"><span>hm_key_of</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>j</span></span><span>"</span></span></span><span>
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>j</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3494..3503"><span>hm_key_of</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_6401..6408"><span>hm_exch</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>j</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3494..3503"><span>hm_key_of</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Index›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Obtaining the index of a key›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_index_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_index_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_index_def_raw|axiom"><span class="entity_def" id="offset_8108..8118">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_index|const"><span>hm_index</span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="List-Index.List_Index.html#List_Index.index|const"><span>index</span></a><span> </span><span class="bound"><span>pq</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_index_valid|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_index_valid|thm"><span>hm_index_valid</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmstruct.hm_index|const"><span>hm_index</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> 
        </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2806..2816"><span>hm_valid_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_792..802"><span>heapmap_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar_def|fact"><span>hmr_invar_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_8108..8118"><span>hm_index_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_le_eq|fact"><span>Suc_le_eq</span></a><span>
        </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.restrict_map_def|fact"><span>restrict_map_def</span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.if_splits|fact"><span>if_splits</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_index_key_of|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_index_key_of|thm"><span>hm_index_key_of</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3494..3503"><span>hm_key_of</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmstruct.hm_index|const"><span>hm_index</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>k</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> 
        </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2806..2816"><span>hm_valid_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_792..802"><span>heapmap_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar_def|fact"><span>hmr_invar_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_8108..8118"><span>hm_index_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3483..3493"><span>hm_key_of_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_le_eq|fact"><span>Suc_le_eq</span></a><span>
        </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.restrict_map_def|fact"><span>restrict_map_def</span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.if_splits|fact"><span>if_splits</span></a><span class="main"><span>)</span></span><span>


    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_index_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_index_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_index_op_def_raw|axiom"><span class="entity_def" id="offset_8704..8714">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_index_op|const"><span class="entity_def" id="offset_8716..8727">hm_index_op</span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>.</span></span><span> 
      </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_List.html#IICF_List.mop_list_index|const"><span>mop_list_index</span></a><span> </span><span class="bound"><span>pq</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>;</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_8884..8889">lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_index_op_correct|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_index_op_correct|thm"><span class="entity_def" id="offset_8890..8909">hm_index_op_correct</span></span></span><span class="main"><span>:</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="free"><span>hm</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_8716..8727"><span>hm_index_op</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmstruct.hm_index|const"><span>hm_index</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_8884..8889"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_8704..8714"><span>hm_index_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_792..802"><span>heapmap_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar_def|fact"><span>hmr_invar_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_8108..8118"><span>hm_index_def</span></a><span> </span><a class="entity_ref" href="List-Index.List_Index.html#List_Index.index_nth_id|fact"><span>index_nth_id</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|attribute"><span class="operator"><span>refine_vcg</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_8890..8909"><span>hm_index_op_correct</span></a><span>  
      

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Update›</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Updating the heap at an index›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_update_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_update_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_update_op_def_raw|axiom"><span class="entity_def" id="offset_9326..9336">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_update_op|const"><span class="entity_def" id="offset_9337..9349">hm_update_op</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'v</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm_update_op</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>v</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_List.html#IICF_List.mop_list_get|const"><span>mop_list_get</span></a><span> </span><span class="bound"><span>pq</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>m</span></span><span class="main"><span>(</span></span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>↦</span></span><span> </span><span class="bound"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>}</span></span><span>"</span></span></span><span>
    
    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_update_op_invar|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_update_op_invar|thm"><span>hm_update_op_invar</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_9337..9349"><span>hm_update_op</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_9326..9336"><span>hm_update_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.update_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_defs|fact"><span>hmr_rel_defs</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.map_distinct_upd_conv|fact"><span>map_distinct_upd_conv</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2806..2816"><span>hm_valid_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_update_op_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_update_op_refine|thm"><span class="entity_def" id="offset_9817..9836">hm_update_op_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_9337..9349"><span>hm_update_op</span></a><span class="main"><span>,</span></span><span> </span><span>h.update_op</span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.nat_rel|const"><span>nat_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_9326..9336"><span>hm_update_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.update_op_def</span></a><span> </span><a class="entity_ref" href="IICF_List.html#IICF_List.mop_list_get_alt|fact"><span>mop_list_get_alt</span></a><span> </span><a class="entity_ref" href="IICF_List.html#IICF_List.mop_list_set_alt|fact"><span>mop_list_set_alt</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_defs|fact"><span>hmr_rel_defs</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.map_distinct_upd_conv|fact"><span>map_distinct_upd_conv</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2806..2816"><span>hm_valid_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
      
    </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_9817..9836"><span>hm_update_op_refine</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.param_fo|attribute"><span class="operator"><span>param_fo</span></span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relD|fact"><span>nres_relD</span></a><span class="main"><span>]</span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_10247..10252">lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_update_op_\&lt;alpha&gt;_correct|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_update_op_\&lt;alpha&gt;_correct|thm"><span class="entity_def" id="offset_10253..10275">hm_update_op_α_correct</span></span></span><span class="main"><span>:</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="free"><span>hm</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_9337..9349"><span>hm_update_op</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmstruct.hm_index|const"><span>hm_index</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>hm'</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span class="main"><span>(</span></span><span class="free"><span>k</span></span><span class="main"><span>↦</span></span><span class="free"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_10247..10252"><span>assms</span></a><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_9326..9336"><span>hm_update_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1094..1110"><span>heapmap_rel_defs</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_defs|fact"><span>hmr_rel_defs</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_8108..8118"><span>hm_index_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.restrict_map_def|fact"><span>restrict_map_def</span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.if_splits|fact"><span>if_splits</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Butlast›</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Remove last element›</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_butlast_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_butlast_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_butlast_op_def_raw|axiom"><span class="entity_def" id="offset_10702..10712">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_butlast_op|const"><span class="entity_def" id="offset_10713..10726">hm_butlast_op</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm_butlast_op</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_List.html#IICF_List.mop_list_get|const"><span>mop_list_get</span></a><span> </span><span class="bound"><span>pq</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>pq</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>pq</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_List.html#IICF_List.mop_list_butlast|const"><span>mop_list_butlast</span></a><span> </span><span class="bound"><span>pq</span></span><span class="main"><span>;</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_butlast_op_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_butlast_op_refine|thm"><span class="entity_def" id="offset_10986..11006">hm_butlast_op_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_10713..10726"><span>hm_butlast_op</span></a><span class="main"><span>,</span></span><span> </span><span>h.butlast_op</span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>supply</span></span></span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.map_upd_eq_restrict|fact"><span>map_upd_eq_restrict</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_10702..10712"><span>hm_butlast_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.butlast_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Refine_Util.html#Refine_Util.clarsimp_all|method"><span class="operator"><span>clarsimp_all</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_defs|fact"><span>hmr_rel_defs</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.map_butlast|fact"><span>map_butlast</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.distinct_butlast|fact"><span>distinct_butlast</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.neq_Nil_rev_conv|fact"><span>neq_Nil_rev_conv</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_10986..11006"><span>hm_butlast_op_refine</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.param_fo|attribute"><span class="operator"><span>param_fo</span></span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relD|fact"><span>nres_relD</span></a><span class="main"><span>]</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_butlast_op_\&lt;alpha&gt;_correct|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_butlast_op_\&lt;alpha&gt;_correct|thm"><span class="entity_def" id="offset_11469..11492">hm_butlast_op_α_correct</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_10713..10726"><span>hm_butlast_op</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span>
      </span><span class="main"><span>λ</span></span><span class="bound"><span>hm'</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span class="main"><span>(</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3494..3503"><span>hm_key_of</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2287..2296"><span>hm_length</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span> </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
      </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>AUX</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>xs</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> 
        </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.butlast|const"><span>butlast</span></a><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.butlast|const"><span>butlast</span></a><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>xs</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span>"</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>xs</span></span></span><span> </span><span class="quasi_keyword"><span>rule</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.rev_cases|fact"><span>rev_cases</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
        
      </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_11884..11887">AUX</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.distinct|const"><span>distinct</span></a><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>;</span></span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.butlast|const"><span>butlast</span></a><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>xs</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span>"</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>xs</span></span></span><span> </span><span class="quasi_keyword"><span>rule</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.rev_cases|fact"><span>rev_cases</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
        
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_10702..10712"><span>hm_butlast_op_def</span></a><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_792..802"><span>heapmap_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3483..3493"><span>hm_key_of_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar_def|fact"><span>hmr_invar_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_11884..11887"><span>AUX</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
    
    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Append›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Append new element at end of heap›</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_append_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_append_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_append_op_def_raw|axiom"><span class="entity_def" id="offset_12313..12323">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_append_op|const"><span class="entity_def" id="offset_12324..12336">hm_append_op</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'k</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'v</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm_append_op</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>v</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>∉</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>pq</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>pq</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_List.html#IICF_List.mop_list_append|const"><span>mop_list_append</span></a><span> </span><span class="bound"><span>pq</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>m</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="bound"><span>m</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>↦</span></span><span> </span><span class="bound"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_append_op_invar|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_append_op_invar|thm"><span>hm_append_op_invar</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_12324..12336"><span>hm_append_op</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_12313..12323"><span>hm_append_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.append_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_792..802"><span>heapmap_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_defs|fact"><span>hmr_rel_defs</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_append_op_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_append_op_refine|thm"><span class="entity_def" id="offset_12823..12842">hm_append_op_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>hm</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><span>⟧</span></span><span> 
      </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_12324..12336"><span>hm_append_op</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="free"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span>h.append_op</span><span> </span><span class="free"><span>h</span></span><span> </span><span class="free"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_12313..12323"><span>hm_append_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.append_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_792..802"><span>heapmap_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_defs|fact"><span>hmr_rel_defs</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_append_op_refine&apos;|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_append_op_refine&apos;|thm"><span>hm_append_op_refine'</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_12823..12842"><span>hm_append_op_refine</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.param_fo|attribute"><span class="operator"><span>param_fo</span></span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relD|fact"><span>nres_relD</span></a><span class="main"><span>]</span></span><span>
    
    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_append_op_\&lt;alpha&gt;_correct|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_append_op_\&lt;alpha&gt;_correct|thm"><span class="entity_def" id="offset_13263..13285">hm_append_op_α_correct</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_12324..12336"><span>hm_append_op</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>hm'</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>k</span></span><span> </span><span class="main"><span>↦</span></span><span> </span><span class="free"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_12313..12323"><span>hm_append_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_792..802"><span>heapmap_α_def</span></a><span class="main"><span>)</span></span><span>


    </span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Auxiliary Operations›</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Auxiliary operations on heapmaps, which are derived 
      from the basic operations, but do not correspond to 
      operations of the priority map interface›</span></span></span><span>
    

    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹We start with some setup›</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_hmr_relI|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_hmr_relI|thm"><span class="entity_def" id="offset_13729..13745">heapmap_hmr_relI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>hm</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>hm</span></span><span class="main"><span>,</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1094..1110"><span>heapmap_rel_defs</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_defs|fact"><span>hmr_rel_defs</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_hmr_relI&apos;|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_hmr_relI&apos;|thm"><span>heapmap_hmr_relI'</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_905..918"><span>heapmap_invar</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>hm</span></span><span class="main"><span>,</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1094..1110"><span>heapmap_rel_defs</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_defs|fact"><span>hmr_rel_defs</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹The basic principle how we prove correctness of our operations:
      Invariant preservation is shown by relating the operations to 
      operations on heaps. Then, only correctness on the abstraction 
      remains to be shown, assuming the operation does not fail.
      ›</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_14270..14275">lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_nres_relI&apos;|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_nres_relI&apos;|thm"><span class="entity_def" id="offset_14276..14294">heapmap_nres_relI'</span></span></span><span class="main"><span>:</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="free"><span>h'</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>h'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span>h.heap_invar</span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>hm'</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span> </span><span class="free"><span>h</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_14270..14275"><span>assms</span></a><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1094..1110"><span>heapmap_rel_defs</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pw_le_iff|fact"><span>pw_le_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.pw_leof_iff|fact"><span>pw_leof_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_nres_relI&apos;&apos;|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_nres_relI&apos;&apos;|thm"><span class="entity_def" id="offset_14601..14620">heapmap_nres_relI''</span></span></span><span class="main"><span>:</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="free"><span>h'</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>h'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="free"><span>Φ</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>h'</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>h'</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span>h.heap_invar</span><span> </span><span class="bound"><span>h'</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>hm'</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span> </span><span class="free"><span>h</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_14276..14294"><span>heapmap_nres_relI'</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>fact</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>fact</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>fact</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>fact</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Val-of›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Indexing into the heap›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_val_of_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_val_of_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_val_of_op_def_raw|axiom"><span class="entity_def" id="offset_15039..15049">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_val_of_op|const"><span class="entity_def" id="offset_15050..15062">hm_val_of_op</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'v</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm_val_of_op</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="bound"><span>hm</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
        </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3598..3610"><span>hm_key_of_op</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>v</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_4686..4702"><span>hm_the_lookup_op</span></a><span> </span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>hm</span></span><span class="main"><span>;</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>v</span></span><span>
      </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_val_of_op_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_val_of_op_refine|thm"><span class="entity_def" id="offset_15239..15258">hm_val_of_op_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_15050..15062"><span>hm_val_of_op</span></a><span class="main"><span>,</span></span><span>h.val_of_op</span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.nat_rel|const"><span>nat_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_15039..15049"><span>hm_val_of_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.val_of_op_def</span></a><span> 
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3587..3597"><span>hm_key_of_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3483..3493"><span>hm_key_of_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2806..2816"><span>hm_valid_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span>
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_4674..4684"><span>hm_the_lookup_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_IdD|fact"><span>refine_IdD</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_defs|fact"><span>hmr_rel_defs</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_792..802"><span>heapmap_α_def</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.domD|fact"><span>domD</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_mem|fact"><span>nth_mem</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subsetCE|fact"><span>subsetCE</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_15239..15258"><span>hm_val_of_op_refine</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.param_fo|attribute"><span class="operator"><span>param_fo</span></span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relD|fact"><span>nres_relD</span></a><span class="main"><span>]</span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Prio-of›</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Priority of key›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_prio_of_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_prio_of_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_prio_of_op_def_raw|axiom"><span class="entity_def" id="offset_15819..15829">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_prio_of_op.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_prio_of_op.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_prio_of_op|const"><span class="entity_def" id="offset_15831..15844">hm_prio_of_op</span></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>v</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_15050..15062"><span>hm_val_of_op</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>prio</span></span><span> </span><span class="bound"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
    
    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_prio_of_op_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_prio_of_op_refine|thm"><span class="entity_def" id="offset_15910..15930">hm_prio_of_op_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_15831..15844"><span>hm_prio_of_op</span></a><span class="main"><span>,</span></span><span> </span><span>h.prio_of_op</span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.nat_rel|const"><span>nat_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_15819..15829"><span>hm_prio_of_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.prio_of_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

    </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_prio_of_op_refine&apos;|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_prio_of_op_refine&apos;|thm"><span>hm_prio_of_op_refine'</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_15910..15930"><span>hm_prio_of_op_refine</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.param_fo|attribute"><span class="operator"><span>param_fo</span></span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relD|fact"><span>nres_relD</span></a><span class="main"><span>]</span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Swim›</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_swim_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_swim_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_swim_op_def_raw|axiom"><span class="entity_def" id="offset_16248..16258">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_swim_op.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_swim_op.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_swim_op|const"><span class="entity_def" id="offset_16259..16269">hm_swim_op</span></span></span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm_swim_op</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/RefineG_Recursion.html#RefineG_Recursion.RECT|const"><span>RECT</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>swim</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>h</span></span><span class="main"><span>,</span></span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
          </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="bound"><span>h</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span>h.swim_invar</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="bound"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="bound"><span>h</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heap.html#IICF_Abs_Heap.heapstruct.parent|const"><span>h.parent</span></a><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
            </span><span class="bound"><span>ppi</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_15831..15844"><span>hm_prio_of_op</span></a><span> </span><span class="bound"><span>h</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heap.html#IICF_Abs_Heap.heapstruct.parent|const"><span>h.parent</span></a><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="bound"><span>pi</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_15831..15844"><span>hm_prio_of_op</span></a><span> </span><span class="bound"><span>h</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="bound"><span>ppi</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="bound"><span>pi</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
              </span><span class="bound"><span>h</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_5463..5473"><span>hm_exch_op</span></a><span> </span><span class="bound"><span>h</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heap.html#IICF_Abs_Heap.heapstruct.parent|const"><span>h.parent</span></a><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="bound"><span>swim</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>h</span></span><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heap.html#IICF_Abs_Heap.heapstruct.parent|const"><span>h.parent</span></a><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>}</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span>
              </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>h</span></span><span>
          </span><span class="main"><span>}</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> 
            </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>h</span></span><span>
        </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span class="main"><span>,</span></span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_swim_op_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_swim_op_refine|thm"><span class="entity_def" id="offset_16807..16824">hm_swim_op_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_16259..16269"><span>hm_swim_op</span></a><span class="main"><span>,</span></span><span> </span><span>h.swim_op</span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.nat_rel|const"><span>nat_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_16248..16258"><span>hm_swim_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.swim_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Heuristics.html#Refine_Heuristics.refine_dref_type|method"><span class="operator"><span>refine_dref_type</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Refine_Util.html#Refine_Util.clarsimp_all|method"><span class="operator"><span>clarsimp_all</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2868..2883"><span>hm_valid_refine</span></a><span class="main"><span class="main"><span>[</span></span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.param_fo|attribute"><span class="operator"><span>param_fo</span></span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.IdD|fact"><span>IdD</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_swim_op_refine&apos;|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_swim_op_refine&apos;|thm"><span>hm_swim_op_refine'</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_16807..16824"><span>hm_swim_op_refine</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.param_fo|attribute"><span class="operator"><span>param_fo</span></span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relD|fact"><span>nres_relD</span></a><span class="main"><span>]</span></span><span>


    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_swim_op_nofail_imp_valid|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_swim_op_nofail_imp_valid|thm"><span class="entity_def" id="offset_17252..17279">hm_swim_op_nofail_imp_valid</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nofail|const"><span>nofail</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_16259..16269"><span>hm_swim_op</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span>h.swim_invar</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>i</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_16248..16258"><span>hm_swim_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/eqsubst.ML.html#HOL.subst|method"><span class="operator"><span>subst</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span class="quasi_keyword"><span>asm</span></span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/RefineG_Recursion.html#RefineG_Recursion.RECT_unfold|fact"><span>RECT_unfold</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Mono_Prover.html#Refine_Mono_Prover.refine_mono|method"><span class="operator"><span>refine_mono</span></span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_swim_op_\&lt;alpha&gt;_correct|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_swim_op_\&lt;alpha&gt;_correct|thm"><span class="entity_def" id="offset_17490..17510">hm_swim_op_α_correct</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_16259..16269"><span>hm_swim_op</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>hm'</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_add_nofailI|fact"><span>leof_add_nofailI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>drule</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_17252..17279"><span>hm_swim_op_nofail_imp_valid</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_16248..16258"><span>hm_swim_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.RECT_rule_leof|fact"><span>RECT_rule_leof</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> 
            pre</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>hm'</span></span><span class="main"><span>,</span></span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="bound"><span>hm'</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span>"</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span>and</span></span></span></span></span><span> V </span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.inv_image|const"><span>inv_image</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Wellfounded.html#Wellfounded.less_than|const"><span>less_than</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span>"</span></span></span><span>
            </span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_15819..15829"><span>hm_prio_of_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_15039..15049"><span>hm_val_of_op_def</span></a><span> 
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_5451..5461"><span>hm_exch_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3587..3597"><span>hm_key_of_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_4674..4684"><span>hm_the_lookup_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Refine_Util.html#Refine_Util.clarsimp_all|method"><span class="operator"><span>clarsimp_all</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2806..2816"><span>hm_valid_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Refine_Util.html#Refine_Util.rprems|method"><span class="operator"><span>rprems</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_792..802"><span>heapmap_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.parent_def</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Sink›</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_sink_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_sink_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_sink_op_def_raw|axiom"><span class="entity_def" id="offset_18217..18227">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_sink_op.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_sink_op.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_sink_op|const"><span class="entity_def" id="offset_18228..18238">hm_sink_op</span></span></span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>   
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm_sink_op</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/RefineG_Recursion.html#RefineG_Recursion.RECT|const"><span>RECT</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>D</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>h</span></span><span class="main"><span>,</span></span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="bound"><span>k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2287..2296"><span>hm_length</span></a><span> </span><span class="bound"><span>h</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3228..3243"><span>hm_has_child_op</span></a><span> </span><span class="bound"><span>h</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
          </span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>j</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmstruct.hm_left_child_op|const"><span>hm_left_child_op</span></a><span> </span><span class="bound"><span>k</span></span><span class="main"><span>;</span></span><span>
          </span><span class="bound"><span>pj</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_15831..15844"><span>hm_prio_of_op</span></a><span> </span><span class="bound"><span>h</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>;</span></span><span>

          </span><span class="bound"><span>j</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3391..3411"><span>hm_has_next_child_op</span></a><span> </span><span class="bound"><span>h</span></span><span> </span><span class="bound"><span>j</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
              </span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>j'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmstruct.hm_next_child_op|const"><span>hm_next_child_op</span></a><span> </span><span class="bound"><span>j</span></span><span class="main"><span>;</span></span><span>
              </span><span class="bound"><span>psj</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_15831..15844"><span>hm_prio_of_op</span></a><span> </span><span class="bound"><span>h</span></span><span> </span><span class="bound"><span>j'</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>pj</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span class="bound"><span>psj</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>j'</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>j</span></span><span>
            </span><span class="main"><span>}</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="bound"><span>pj</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_15831..15844"><span>hm_prio_of_op</span></a><span> </span><span class="bound"><span>h</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>;</span></span><span>
          </span><span class="bound"><span>pk</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_15831..15844"><span>hm_prio_of_op</span></a><span> </span><span class="bound"><span>h</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>pk</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span> </span><span class="bound"><span>pj</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
            </span><span class="bound"><span>h</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_5463..5473"><span>hm_exch_op</span></a><span> </span><span class="bound"><span>h</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>;</span></span><span>
            </span><span class="bound"><span>D</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>h</span></span><span class="main"><span>,</span></span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>}</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span>
            </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>h</span></span><span>
        </span><span class="main"><span>}</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>h</span></span><span>    
      </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span class="main"><span>,</span></span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    
    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_sink_op_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_sink_op_refine|thm"><span class="entity_def" id="offset_18934..18951">hm_sink_op_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_18228..18238"><span>hm_sink_op</span></a><span class="main"><span>,</span></span><span> </span><span>h.sink_op</span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.nat_rel|const"><span>nat_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_18217..18227"><span>hm_sink_op_def</span></a><span> </span><span>h.sink_op_opt_eq</span><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.sink_op_opt_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3216..3226"><span>hm_has_child_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3379..3389"><span>hm_has_next_child_op_def</span></a><span>
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3275..3285"><span>hm_left_child_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3327..3337"><span>hm_next_child_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="ISABELLE_HOME/src/HOL/Library/rewrite.ML.html#Rewrite.rewrite|method"><span class="operator"><span>rewrite</span></span></a><span> </span><span class="quasi_keyword"><span>at</span></span><span> </span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span class="keyword1"><span>let</span></span></span><span> </span><span class="main"><span class="bound"><span class="main"><span class="bound"><span>_</span></span></span></span></span><span> </span><span class="main"><span class="main"><span>=</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a></a><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="keyword1"><span class="keyword1"><span>in</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span>"</span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a></a><span class="main"><span>)</span></span><span>  
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="ISABELLE_HOME/src/HOL/Library/rewrite.ML.html#Rewrite.rewrite|method"><span class="operator"><span>rewrite</span></span></a><span> </span><span class="quasi_keyword"><span>at</span></span><span> </span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span class="keyword1"><span>let</span></span></span><span> </span><span class="main"><span class="bound"><span class="main"><span class="bound"><span>_</span></span></span></span></span><span> </span><span class="main"><span class="main"><span>=</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span></a></span><span> </span><span class="keyword1"><span class="keyword1"><span>in</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span>"</span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a></a><span class="main"><span>)</span></span><span>  
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Heuristics.html#Refine_Heuristics.refine_dref_type|method"><span class="operator"><span>refine_dref_type</span></span></a><span>

      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1028..1038"><span>heapmap_rel_def</span></a><span> 
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_sink_op_refine&apos;|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_sink_op_refine&apos;|thm"><span>hm_sink_op_refine'</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_18934..18951"><span>hm_sink_op_refine</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.param_fo|attribute"><span class="operator"><span>param_fo</span></span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relD|fact"><span>nres_relD</span></a><span class="main"><span>]</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_sink_op_nofail_imp_valid|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_sink_op_nofail_imp_valid|thm"><span class="entity_def" id="offset_19602..19629">hm_sink_op_nofail_imp_valid</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nofail|const"><span>nofail</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_18228..18238"><span>hm_sink_op</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_18217..18227"><span>hm_sink_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/eqsubst.ML.html#HOL.subst|method"><span class="operator"><span>subst</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span class="quasi_keyword"><span>asm</span></span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/RefineG_Recursion.html#RefineG_Recursion.RECT_unfold|fact"><span>RECT_unfold</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Mono_Prover.html#Refine_Mono_Prover.refine_mono|method"><span class="operator"><span>refine_mono</span></span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2806..2816"><span>hm_valid_def</span></a><span class="main"><span>)</span></span><span>
      
    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_sink_op_\&lt;alpha&gt;_correct|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_sink_op_\&lt;alpha&gt;_correct|thm"><span class="entity_def" id="offset_19824..19844">hm_sink_op_α_correct</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_18228..18238"><span>hm_sink_op</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>hm'</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_add_nofailI|fact"><span>leof_add_nofailI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>drule</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_19602..19629"><span>hm_sink_op_nofail_imp_valid</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_18217..18227"><span>hm_sink_op_def</span></a><span> 
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3275..3285"><span>hm_left_child_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3216..3226"><span>hm_has_child_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3379..3389"><span>hm_has_next_child_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3327..3337"><span>hm_next_child_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.RECT_rule_leof|fact"><span>RECT_rule_leof</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> 
            pre</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>hm'</span></span><span class="main"><span>,</span></span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="bound"><span>hm'</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2287..2296"><span>hm_length</span></a><span> </span><span class="bound"><span>hm'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2287..2296"><span>hm_length</span></a><span> </span><span class="free"><span>hm</span></span><span>"</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span>and</span></span></span></span></span><span> V </span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Wellfounded.html#Wellfounded.measure|const"><span>measure</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>hm'</span></span><span class="main"><span>,</span></span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2287..2296"><span>hm_length</span></a><span> </span><span class="bound"><span>hm'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
            </span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_15819..15829"><span>hm_prio_of_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_15039..15049"><span>hm_val_of_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_5451..5461"><span>hm_exch_op_def</span></a><span> 
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3587..3597"><span>hm_key_of_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_4674..4684"><span>hm_the_lookup_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Refine_Util.html#Refine_Util.clarsimp_all|method"><span class="operator"><span>clarsimp_all</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2806..2816"><span>hm_valid_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span class="main"><span>)</span></span><span> </span><span class="comment1"><span>(* Takes long *)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Refine_Util.html#Refine_Util.rprems|method"><span class="operator"><span>rprems</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Refine_Util.html#Refine_Util.clarsimp_all|method"><span class="operator"><span>clarsimp_all</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_792..802"><span>heapmap_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.parent_def</span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.splits|fact"><span>prod.splits</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Repair›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_repair_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_repair_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_repair_op_def_raw|axiom"><span class="entity_def" id="offset_20763..20773">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_repair_op.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_repair_op.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_repair_op|const"><span class="entity_def" id="offset_20775..20787">hm_repair_op</span></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><span class="bound"><span>hm</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_18228..18238"><span>hm_sink_op</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>hm</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_16259..16269"><span>hm_swim_op</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>hm</span></span><span>
    </span><span class="main"><span>}</span></span><span>"</span></span></span><span>
    
    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_repair_op_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_repair_op_refine|thm"><span class="entity_def" id="offset_20894..20913">hm_repair_op_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_20775..20787"><span>hm_repair_op</span></a><span class="main"><span>,</span></span><span> </span><span>h.repair_op</span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.nat_rel|const"><span>nat_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_20763..20773"><span>hm_repair_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.repair_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span>
      
    </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_repair_op_refine&apos;|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_repair_op_refine&apos;|thm"><span>hm_repair_op_refine'</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_20894..20913"><span>hm_repair_op_refine</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.param_fo|attribute"><span class="operator"><span>param_fo</span></span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relD|fact"><span>nres_relD</span></a><span class="main"><span>]</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_repair_op_\&lt;alpha&gt;_correct|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_repair_op_\&lt;alpha&gt;_correct|thm"><span class="entity_def" id="offset_21199..21221">hm_repair_op_α_correct</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_20775..20787"><span>hm_repair_op</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>hm'</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_20763..20773"><span>hm_repair_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span> 
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_17490..17510"><span>hm_swim_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span> 
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_19824..19844"><span>hm_sink_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>


    </span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Operations›</span></span></span><span>    
    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹In this section, we define the operations that implement the priority-map interface›</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Empty›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_empty_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_empty_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_empty_op_def_raw|axiom"><span class="entity_def" id="offset_21615..21625">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_empty_op|const"><span class="entity_def" id="offset_21626..21637">hm_empty_op</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span>"</span></span></span><span> 
      </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm_empty_op</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="bound"><span>m</span></span><span class="main"><span>←</span></span><a class="entity_ref" href="IICF_Map.html#IICF_Map.mop_map_empty|const"><span>mop_map_empty</span></a><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_empty_op_aref|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_empty_op_aref|thm"><span>hm_empty_op_aref</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_21626..21637"><span>hm_empty_op</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="IICF_Map.html#IICF_Map.mop_map_empty|const"><span>mop_map_empty</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_21615..21625"><span>hm_empty_op_def</span></a><span> 
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1094..1110"><span>heapmap_rel_defs</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_defs|fact"><span>hmr_rel_defs</span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Insert›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_insert_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_insert_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_insert_op_def_raw|axiom"><span class="entity_def" id="offset_21969..21979">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_insert_op.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_insert_op.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_insert_op|const"><span class="entity_def" id="offset_21980..21992">hm_insert_op</span></span></span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'k</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'v</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm_insert_op</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>h</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span>h.heap_invar</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="bound"><span>h</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>h</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_12324..12336"><span>hm_append_op</span></a><span> </span><span class="bound"><span>h</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>v</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>l</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2287..2296"><span>hm_length</span></a><span> </span><span class="bound"><span>h</span></span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>h</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_16259..16269"><span>hm_swim_op</span></a><span> </span><span class="bound"><span>h</span></span><span> </span><span class="bound"><span>l</span></span><span class="main"><span>;</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>h</span></span><span>
      </span><span class="main"><span>}</span></span><span>"</span></span></span><span>
      
    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_insert_op_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_insert_op_refine|thm"><span class="entity_def" id="offset_22253..22272">hm_insert_op_refine</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>hm</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span>
      </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_21980..21992"><span>hm_insert_op</span></a><span> </span><span class="free"><span>k</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><span>(</span></span><span>h.insert_op</span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_21969..21979"><span>hm_insert_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.insert_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.br_def|fact"><span>br_def</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_insert_op_aref|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_insert_op_aref|thm"><span class="entity_def" id="offset_22507..22524">hm_insert_op_aref</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_21980..21992"><span>hm_insert_op</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_map_update_new|const"><span>mop_map_update_new</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_map_update_new_alt|fact"><span>mop_map_update_new_alt</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT_refine_right|fact"><span>ASSERT_refine_right</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_14601..14620"><span>heapmap_nres_relI''</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_22253..22272"><span>hm_insert_op_refine</span></a><span> </span><span>h.insert_op_correct</span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>unfold</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1028..1038"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>erule</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_13729..13745"><span>heapmap_hmr_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>unfold</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1028..1038"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>unfold</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1028..1038"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_21969..21979"><span>hm_insert_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span> 
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_13263..13285"><span>hm_append_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span>
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_17490..17510"><span>hm_swim_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>unfold</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1028..1038"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Is-Empty›</span></span></span><span>  

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hmr_\&lt;alpha&gt;_empty_iff|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hmr_\&lt;alpha&gt;_empty_iff|thm"><span>hmr_α_empty_iff</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.empty|const"><span>Map.empty</span></a><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> 
        </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;_def|fact"><span>hmr_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_894..904"><span>heapmap_invar_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_792..802"><span>heapmap_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar_def|fact"><span>hmr_invar_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.restrict_map_def|fact"><span>restrict_map_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.fun_eq_iff|fact"><span>fun_eq_iff</span></a><span>
        </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.split|fact"><span>prod.split</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.if_splits|fact"><span>if_splits</span></a><span class="main"><span>)</span></span><span>  

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_is_empty_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_is_empty_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_is_empty_op_def_raw|axiom"><span class="entity_def" id="offset_23541..23551">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_is_empty_op|const"><span class="entity_def" id="offset_23552..23566">hm_is_empty_op</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm_is_empty_op</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="bound"><span>hm</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="bound"><span>hm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>l</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2287..2296"><span>hm_length</span></a><span> </span><span class="bound"><span>hm</span></span><span class="main"><span>;</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>l</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_is_empty_op_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_is_empty_op_refine|thm"><span>hm_is_empty_op_refine</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_23552..23566"><span>hm_is_empty_op</span></a><span class="main"><span>,</span></span><span> </span><span>h.is_empty_op</span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.bool_rel|const"><span>bool_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_23541..23551"><span>hm_is_empty_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_654..660"><span>h.is_empty_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_defs|fact"><span>hmr_rel_defs</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Param_Tool.html#Param_Tool.parametricity|method"><span class="operator"><span>parametricity</span></span></a><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2376..2392"><span>hm_length_refine</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>


    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_is_empty_op_aref|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_is_empty_op_aref|thm"><span>hm_is_empty_op_aref</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_23552..23566"><span>hm_is_empty_op</span></a><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="IICF_Map.html#IICF_Map.mop_map_is_empty|const"><span>mop_map_is_empty</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.bool_rel|const"><span>bool_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_23541..23551"><span>hm_is_empty_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_defs|fact"><span>hmr_rel_defs</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1094..1110"><span>heapmap_rel_defs</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2276..2286"><span>hm_length_def</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.Int_absorb1|fact"><span>Int_absorb1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.dom_restrict|fact"><span>dom_restrict</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length_greater_0_conv|fact"><span>length_greater_0_conv</span></a><span> </span><a class="entity_ref" href="Misc_LLang.html#Misc_LLang.ndomIff|fact"><span>ndomIff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_mem|fact"><span>nth_mem</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Lookup›</span></span></span><span>  

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_lookup_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_lookup_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_lookup_op_def_raw|axiom"><span class="entity_def" id="offset_24460..24470">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_lookup_op.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_lookup_op.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_lookup_op|const"><span class="entity_def" id="offset_24471..24483">hm_lookup_op</span></span></span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'k</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'v</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option|type"><span>option</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm_lookup_op</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>hm</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_905..918"><span>heapmap_invar</span></a><span> </span><span class="bound"><span>hm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_4629..4638"><span>hm_lookup</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_lookup_op_aref|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_lookup_op_aref|thm"><span>hm_lookup_op_aref</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_24471..24483"><span>hm_lookup_op</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.comp2|const"><span>oo</span></a></span><span> </span><a class="entity_ref" href="IICF_Map.html#IICF_Map.op_map_lookup|const"><span>op_map_lookup</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><span class="main"><span>⟨</span></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.option_rel|const"><span>option_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_24460..24470"><span>hm_lookup_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1028..1038"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_the_lookup_op_aref|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_the_lookup_op_aref|thm"><span>hm_the_lookup_op_aref</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_4686..4702"><span>hm_the_lookup_op</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="IICF_Map.html#IICF_Map.mop_map_the_lookup|const"><span>mop_map_the_lookup</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_4674..4684"><span>hm_the_lookup_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>!</span></span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pw_eq_iff|fact"><span>pw_eq_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1028..1038"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span class="main"><span>)</span></span><span>
      
    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Contains-Key›</span></span></span><span>  

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_contains_key_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_contains_key_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_contains_key_op_def_raw|axiom"><span class="entity_def" id="offset_25174..25184">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_contains_key_op.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_contains_key_op.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_contains_key_op|const"><span class="entity_def" id="offset_25186..25204">hm_contains_key_op</span></span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_905..918"><span>heapmap_invar</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>pq</span></span><span class="main"><span>,</span></span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="IICF_List.html#IICF_List.mop_list_contains|const"><span>mop_list_contains</span></a><span> </span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>pq</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_contains_key_op_aref|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_contains_key_op_aref|thm"><span class="entity_def" id="offset_25289..25312">hm_contains_key_op_aref</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_25186..25204"><span>hm_contains_key_op</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="IICF_Map.html#IICF_Map.mop_map_contains_key|const"><span>mop_map_contains_key</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.bool_rel|const"><span>bool_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_25174..25184"><span>hm_contains_key_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1094..1110"><span>heapmap_rel_defs</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar_def|fact"><span>hmr_invar_def</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Decrease-Key›</span></span></span><span>  


    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_decrease_key_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_decrease_key_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_decrease_key_op_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_decrease_key_op.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_decrease_key_op.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_decrease_key_op|const"><span class="entity_def" id="offset_25608..25626">hm_decrease_key_op</span></span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>hm</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_905..918"><span>heapmap_invar</span></a><span> </span><span class="bound"><span>hm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>prio</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>prio</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.the|const"><span>the</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_8716..8727"><span>hm_index_op</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>hm</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_9337..9349"><span>hm_update_op</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>v</span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_16259..16269"><span>hm_swim_op</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="bound"><span>i</span></span><span>
    </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.decrease_key_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.decrease_key_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.decrease_key_op_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heap.html#IICF_Abs_Heap.heapstruct|locale"><span>heapstruct</span></a><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.decrease_key_op.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.decrease_key_op.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.decrease_key_op|const"><span class="entity_def" id="offset_25875..25890">decrease_key_op</span></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span>valid</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>prio</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span>prio_of</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>h</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span>update_op</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span class="main"><span>;</span></span><span>
      </span><span>swim_op</span><span> </span><span class="bound"><span>h</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span>
    </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_26010..26015">lemma</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heap.html#IICF_Abs_Heap.heapstruct|locale"><span>heapstruct</span></a><span class="main"><span>)</span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.decrease_key_op_invar|fact"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.decrease_key_op_invar|thm"><span class="entity_def" id="offset_26032..26053">decrease_key_op_invar</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span>heap_invar</span><span> </span><span class="free"><span>h</span></span><span class="main"><span>;</span></span><span> </span><span>valid</span><span> </span><span class="free"><span>h</span></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>prio</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span>prio_of</span><span> </span><span class="free"><span>h</span></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_25875..25890"><span>decrease_key_op</span></a><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>h</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span>heap_invar</span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_26010..26015"><span>decrease_key_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>swim_invar_decr</span><span class="main"><span>)</span></span><span>


    </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_26257..26262">lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.index_op_inline_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.index_op_inline_refine|thm"><span class="entity_def" id="offset_26263..26285">index_op_inline_refine</span></span></span><span class="main"><span>:</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_905..918"><span>heapmap_invar</span></a><span> </span><span class="free"><span>hm</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmstruct.hm_index|const"><span>hm_index</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>m</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_8716..8727"><span>hm_index_op</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>m</span></span><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_8890..8909"><span>hm_index_op_correct</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>hm</span></span></span><span> </span><span class="quoted"><span class="free"><span>k</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_26257..26262"><span>assms</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pw_le_iff|fact"><span>pw_le_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_decrease_key_op_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_decrease_key_op_refine|thm"><span class="entity_def" id="offset_26553..26578">hm_decrease_key_op_refine</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span class="main"><span>(</span></span><span class="free"><span>hm</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>hm</span></span><span class="main"><span>,</span></span><span class="free"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span class="main"><span>;</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="free"><span>v'</span></span><span class="main"><span>⟧</span></span><span> 
        </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_25608..25626"><span>hm_decrease_key_op</span></a><span> </span><span class="free"><span>k</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_25875..25890"><span>h.decrease_key_op</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmstruct.hm_index|const"><span>hm_index</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_26010..26015"><span>hm_decrease_key_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_26010..26015"><span>h.decrease_key_op_def</span></a><span>
      </span><span class="comment1"><span>(*apply (rewrite at "Let (hm_index hm k) _" Let_def)*)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_26263..26285"><span>index_op_inline_refine</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_26010..26015"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Refine_Util.html#Refine_Util.clarsimp_all|method"><span class="operator"><span>clarsimp_all</span></span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_26998..27003">lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_index_op_inline_leof|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_index_op_inline_leof|thm"><span class="entity_def" id="offset_27004..27027">hm_index_op_inline_leof</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmstruct.hm_index|const"><span>hm_index</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><span class="free"><span>m</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_8716..8727"><span>hm_index_op</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>}</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><span class="free"><span>m</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_8890..8909"><span>hm_index_op_correct</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>hm</span></span></span><span> </span><span class="quoted"><span class="free"><span>k</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_26998..27003"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_26010..26015"><span>hm_index_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pw_le_iff|fact"><span>pw_le_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.pw_leof_iff|fact"><span>pw_leof_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.splits|fact"><span>prod.splits</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_decrease_key_op_\&lt;alpha&gt;_correct|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_decrease_key_op_\&lt;alpha&gt;_correct|thm"><span class="entity_def" id="offset_27284..27312">hm_decrease_key_op_α_correct</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_905..918"><span>heapmap_invar</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_25608..25626"><span>hm_decrease_key_op</span></a><span> </span><span class="free"><span>k</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>hm</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>hm'</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span class="main"><span>(</span></span><span class="free"><span>k</span></span><span class="main"><span>↦</span></span><span class="free"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_26010..26015"><span>hm_decrease_key_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span> 
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_10253..10275"><span>hm_update_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span> 
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_17490..17510"><span>hm_swim_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span>
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_27004..27027"><span>hm_index_op_inline_leof</span></a><span>
        </span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_decrease_key_op_aref|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_decrease_key_op_aref|thm"><span>hm_decrease_key_op_aref</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_25608..25626"><span>hm_decrease_key_op</span></a><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_pm_decrease_key|const"><span>mop_pm_decrease_key</span></a><span> </span><span class="free"><span>prio</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST_def|fact"><span>PR_CONST_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>frule</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_13729..13745"><span>heapmap_hmr_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_pm_decrease_key_alt|fact"><span>mop_pm_decrease_key_alt</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT_refine_right|fact"><span>ASSERT_refine_right</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_14276..14294"><span>heapmap_nres_relI'</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_26553..26578"><span>hm_decrease_key_op_refine</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>assumption</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_26010..26015"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_26032..26053"><span>h.decrease_key_op_invar</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>fail</span></span><span> </span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_27284..27312"><span>hm_decrease_key_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>fail</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Increase-Key›</span></span></span><span>  

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_increase_key_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_increase_key_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_increase_key_op_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_increase_key_op.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_increase_key_op.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_increase_key_op|const"><span class="entity_def" id="offset_28352..28370">hm_increase_key_op</span></span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>hm</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_905..918"><span>heapmap_invar</span></a><span> </span><span class="bound"><span>hm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>prio</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span> </span><span class="free"><span>prio</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.the|const"><span>the</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_8716..8727"><span>hm_index_op</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>hm</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_9337..9349"><span>hm_update_op</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>v</span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_18228..18238"><span>hm_sink_op</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="bound"><span>i</span></span><span>
    </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.increase_key_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.increase_key_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.increase_key_op_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heap.html#IICF_Abs_Heap.heapstruct|locale"><span>heapstruct</span></a><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.increase_key_op.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.increase_key_op.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.increase_key_op|const"><span class="entity_def" id="offset_28619..28634">increase_key_op</span></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span>valid</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>prio</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span> </span><span>prio_of</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>h</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span>update_op</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span class="main"><span>;</span></span><span>
      </span><span>sink_op</span><span> </span><span class="bound"><span>h</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span>
    </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_28754..28759">lemma</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heap.html#IICF_Abs_Heap.heapstruct|locale"><span>heapstruct</span></a><span class="main"><span>)</span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.increase_key_op_invar|fact"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.increase_key_op_invar|thm"><span class="entity_def" id="offset_28776..28797">increase_key_op_invar</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span>heap_invar</span><span> </span><span class="free"><span>h</span></span><span class="main"><span>;</span></span><span> </span><span>valid</span><span> </span><span class="free"><span>h</span></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>prio</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span> </span><span>prio_of</span><span> </span><span class="free"><span>h</span></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_28619..28634"><span>increase_key_op</span></a><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>h</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span>heap_invar</span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_28754..28759"><span>increase_key_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>sink_invar_incr</span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_increase_key_op_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_increase_key_op_refine|thm"><span class="entity_def" id="offset_29006..29031">hm_increase_key_op_refine</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span class="main"><span>(</span></span><span class="free"><span>hm</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>hm</span></span><span class="main"><span>,</span></span><span class="free"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span class="main"><span>;</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="free"><span>v'</span></span><span class="main"><span>⟧</span></span><span> 
        </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_28352..28370"><span>hm_increase_key_op</span></a><span> </span><span class="free"><span>k</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_28619..28634"><span>h.increase_key_op</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmstruct.hm_index|const"><span>hm_index</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_28754..28759"><span>hm_increase_key_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_28754..28759"><span>h.increase_key_op_def</span></a><span>
      </span><span class="comment1"><span>(*apply (rewrite at "Let (hm_index hm k) _" Let_def)*)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_26263..26285"><span>index_op_inline_refine</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_28754..28759"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Refine_Util.html#Refine_Util.clarsimp_all|method"><span class="operator"><span>clarsimp_all</span></span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_increase_key_op_\&lt;alpha&gt;_correct|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_increase_key_op_\&lt;alpha&gt;_correct|thm"><span class="entity_def" id="offset_29457..29485">hm_increase_key_op_α_correct</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_905..918"><span>heapmap_invar</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_28352..28370"><span>hm_increase_key_op</span></a><span> </span><span class="free"><span>k</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>hm</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>hm'</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span class="main"><span>(</span></span><span class="free"><span>k</span></span><span class="main"><span>↦</span></span><span class="free"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_28754..28759"><span>hm_increase_key_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span> 
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_10253..10275"><span>hm_update_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span> 
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_19824..19844"><span>hm_sink_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span>
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_27004..27027"><span>hm_index_op_inline_leof</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_increase_key_op_aref|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_increase_key_op_aref|thm"><span>hm_increase_key_op_aref</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_28352..28370"><span>hm_increase_key_op</span></a><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_pm_increase_key|const"><span>mop_pm_increase_key</span></a><span> </span><span class="free"><span>prio</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST_def|fact"><span>PR_CONST_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>frule</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_13729..13745"><span>heapmap_hmr_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_pm_increase_key_alt|fact"><span>mop_pm_increase_key_alt</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT_refine_right|fact"><span>ASSERT_refine_right</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_14276..14294"><span>heapmap_nres_relI'</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_29006..29031"><span>hm_increase_key_op_refine</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>assumption</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_28754..28759"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_28776..28797"><span>h.increase_key_op_invar</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>fail</span></span><span> </span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_29457..29485"><span>hm_increase_key_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Change-Key›</span></span></span><span>  

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_change_key_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_change_key_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_change_key_op_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_change_key_op.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_change_key_op.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_change_key_op|const"><span class="entity_def" id="offset_30508..30524">hm_change_key_op</span></span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>hm</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_905..918"><span>heapmap_invar</span></a><span> </span><span class="bound"><span>hm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_8716..8727"><span>hm_index_op</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>hm</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_9337..9349"><span>hm_update_op</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>v</span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_20775..20787"><span>hm_repair_op</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="bound"><span>i</span></span><span>
    </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.change_key_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.change_key_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.change_key_op_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heap.html#IICF_Abs_Heap.heapstruct|locale"><span>heapstruct</span></a><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.change_key_op.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.change_key_op.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.change_key_op|const"><span class="entity_def" id="offset_30736..30749">change_key_op</span></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span>valid</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>h</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span>update_op</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span class="main"><span>;</span></span><span>
      </span><span>repair_op</span><span> </span><span class="bound"><span>h</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span>
    </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_30848..30853">lemma</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heap.html#IICF_Abs_Heap.heapstruct|locale"><span>heapstruct</span></a><span class="main"><span>)</span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.change_key_op_invar|fact"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.change_key_op_invar|thm"><span class="entity_def" id="offset_30870..30889">change_key_op_invar</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span>heap_invar</span><span> </span><span class="free"><span>h</span></span><span class="main"><span>;</span></span><span> </span><span>valid</span><span> </span><span class="free"><span>h</span></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_30736..30749"><span>change_key_op</span></a><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>h</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span>heap_invar</span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_30848..30853"><span>change_key_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/hypsubst.ML.html#HOL.hypsubst|method"><span class="operator"><span>hypsubst</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>sink_invar_incr</span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_change_key_op_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_change_key_op_refine|thm"><span class="entity_def" id="offset_31118..31141">hm_change_key_op_refine</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span class="main"><span>(</span></span><span class="free"><span>hm</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>hm</span></span><span class="main"><span>,</span></span><span class="free"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span class="main"><span>;</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="free"><span>v'</span></span><span class="main"><span>⟧</span></span><span> 
        </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_30508..30524"><span>hm_change_key_op</span></a><span> </span><span class="free"><span>k</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_30736..30749"><span>h.change_key_op</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmstruct.hm_index|const"><span>hm_index</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_30848..30853"><span>hm_change_key_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_30848..30853"><span>h.change_key_op_def</span></a><span>
      </span><span class="comment1"><span>(*apply (rewrite at "Let (hm_index hm k) _" Let_def)*)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_26263..26285"><span>index_op_inline_refine</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_30848..30853"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Refine_Util.html#Refine_Util.clarsimp_all|method"><span class="operator"><span>clarsimp_all</span></span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_change_key_op_\&lt;alpha&gt;_correct|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_change_key_op_\&lt;alpha&gt;_correct|thm"><span class="entity_def" id="offset_31559..31585">hm_change_key_op_α_correct</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_905..918"><span>heapmap_invar</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_30508..30524"><span>hm_change_key_op</span></a><span> </span><span class="free"><span>k</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>hm</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>hm'</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span class="main"><span>(</span></span><span class="free"><span>k</span></span><span class="main"><span>↦</span></span><span class="free"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_30848..30853"><span>hm_change_key_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span> 
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_10253..10275"><span>hm_update_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span> 
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_21199..21221"><span>hm_repair_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span>
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_27004..27027"><span>hm_index_op_inline_leof</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_30848..30853"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_change_key_op_aref|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_change_key_op_aref|thm"><span class="entity_def" id="offset_31983..32004">hm_change_key_op_aref</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_30508..30524"><span>hm_change_key_op</span></a><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_map_update_ex|const"><span>mop_map_update_ex</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>frule</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_13729..13745"><span>heapmap_hmr_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_map_update_ex_alt|fact"><span>mop_map_update_ex_alt</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT_refine_right|fact"><span>ASSERT_refine_right</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_14276..14294"><span>heapmap_nres_relI'</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_31118..31141"><span>hm_change_key_op_refine</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>assumption</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_30848..30853"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_30870..30889"><span>h.change_key_op_invar</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>fail</span></span><span> </span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_31559..31585"><span>hm_change_key_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Set›</span></span></span><span>  

    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Realized as generic algorithm!›</span></span></span><span> </span><span class="comment1"><span>(* TODO: Implement as such! *)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_32659..32664">lemma</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> -</span><span class="main"><span>)</span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.op_pm_set_gen_impl|fact"><span class="entity_def" id="IICF_Abs_Heapmap.op_pm_set_gen_impl|thm"><span>op_pm_set_gen_impl</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.comp3|const"><span>ooo</span></a></span><span> </span><a class="entity_ref" href="IICF_Map.html#IICF_Map.op_map_update|const"><span>op_map_update</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>m</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><span class="bound"><span>c</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Map.html#IICF_Map.op_map_contains_key|const"><span>op_map_contains_key</span></a><span> </span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>c</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> 
        </span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_map_update_ex|const"><span>mop_map_update_ex</span></a><span> </span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>m</span></span><span>
      </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span>
        </span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_map_update_new|const"><span>mop_map_update_new</span></a><span> </span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>m</span></span><span>
    </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.ext|fact"><span>ext</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Map.html#IICF_Map.op_map_contains_key_def|fact"><span>op_map_contains_key_def</span></a><span> </span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_map_update_ex_def|fact"><span>mop_map_update_ex_def</span></a><span> </span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_map_update_new_def|fact"><span>mop_map_update_new_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_set_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_set_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_set_op_def_raw|axiom"><span class="entity_def" id="offset_33007..33017">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_set_op.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_set_op.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_set_op|const"><span class="entity_def" id="offset_33019..33028">hm_set_op</span></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><span class="bound"><span>c</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_25186..25204"><span>hm_contains_key_op</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>c</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span>
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_30508..30524"><span>hm_change_key_op</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span>
      </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span>
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_21980..21992"><span>hm_insert_op</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span>
    </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="comment1"><span>(* TODO: Move. Near RETURN_to_SPEC_rule *)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>thm</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN_to_SPEC_rule|fact"><span>RETURN_to_SPEC_rule</span></a><span>
    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.SPEC_to_RETURN_rule|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.SPEC_to_RETURN_rule|thm"><span>SPEC_to_RETURN_rule</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>(=)</span></a></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pw_le_iff|fact"><span>pw_le_iff</span></a><span class="main"><span>)</span></span><span>
    
    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_set_op_aref|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_set_op_aref|thm"><span>hm_set_op_aref</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_33019..33028"><span>hm_set_op</span></a><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="IICF_Map.html#IICF_Map.mop_map_update|const"><span>mop_map_update</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.op_pm_set_gen_impl|fact"><span>op_pm_set_gen_impl</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_33007..33017"><span>hm_set_op_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.o_def|fact"><span>o_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_25289..25312"><span>hm_contains_key_op_aref</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.param_fo|attribute"><span class="operator"><span>param_fo</span></span></a><span class="main"><span>]</span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_31983..32004"><span>hm_change_key_op_aref</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.param_fo|attribute"><span class="operator"><span>param_fo</span></span></a><span class="main"><span>]</span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_22507..22524"><span>hm_insert_op_aref</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.param_fo|attribute"><span class="operator"><span>param_fo</span></span></a><span class="main"><span>]</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pw_le_iff|fact"><span>pw_le_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pw_nres_rel_iff|fact"><span>pw_nres_rel_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span class="main"><span>)</span></span><span> </span><span class="comment1"><span>(** Takes long *)</span></span><span>
 
    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Pop-Min›</span></span></span><span>  

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_op_def_raw|axiom"><span class="entity_def" id="offset_33825..33835">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_op.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_op.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_op|const"><span class="entity_def" id="offset_33836..33849">hm_pop_min_op</span></span></span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm_pop_min_op</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_905..918"><span>heapmap_invar</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3598..3610"><span>hm_key_of_op</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>v</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_4686..4702"><span>hm_the_lookup_op</span></a><span> </span><span class="bound"><span>k</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>l</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2287..2296"><span>hm_length</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>hm</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_5463..5473"><span>hm_exch_op</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="bound"><span>l</span></span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>hm</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_10713..10726"><span>hm_butlast_op</span></a><span> </span><span class="bound"><span>hm</span></span><span class="main"><span>;</span></span><span>
        
        </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>l</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
          </span><span class="bound"><span>hm</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_18228..18238"><span>hm_sink_op</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>;</span></span><span>
          </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>k</span></span><span class="main"><span>,</span></span><span class="bound"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="bound"><span>hm</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>}</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>k</span></span><span class="main"><span>,</span></span><span class="bound"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="bound"><span>hm</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_op_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_op_refine|thm"><span class="entity_def" id="offset_34310..34330">hm_pop_min_op_refine</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_33836..33849"><span>hm_pop_min_op</span></a><span class="main"><span>,</span></span><span> </span><span>h.pop_min_op</span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.UNIV|const"><span>UNIV</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_33825..33835"><span>hm_pop_min_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>h.pop_min_op_def</span></a><span>
      </span><span class="comment1"><span>(* Project away stuff of second component *)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ignore_snd_refine_conv|fact"><span>ignore_snd_refine_conv</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>hm_the_lookup_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3739..3758"><span>hm_key_of_op_unfold</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>cong</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.if_cong|fact"><span>if_cong</span></a><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.unused_bind_conv|fact"><span>unused_bind_conv</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>h.val_of_op_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span class="main"><span>)</span></span><span>

      </span><span class="comment1"><span>(* Prove refinement *)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>unfold</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>heapmap_invar_def</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹We demonstrate two different approaches for proving correctness 
      here.
      The first approach uses the relation to plain heaps only to establish
      the invariant. 

      The second approach also uses the relation to heaps to establish 
      correctness of the result.

      The first approach seems to be more robust against badly set 
      up simpsets, which may be the case in early stages of development.

      Assuming a working simpset, the second approach may be less work,
      and the proof may look more elegant.
      ›</span></span></span><span>  

    </span><span class="keyword1"><span class="command"><span>text_raw</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹\paragraph{First approach}›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Transfer heapmin-property to heapmap-domain›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_min_prop|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_min_prop|thm"><span class="entity_def" id="offset_35601..35617">heapmap_min_prop</span></span></span><span class="main"><span>:</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_35633..35636">INV</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_905..918"><span>heapmap_invar</span></a><span> </span><span class="free"><span>hm</span></span><span>"</span></span></span><span>  
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_35673..35675">V'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="free"><span>v'</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_35718..35720">NE</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>prio</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.the|const"><span>the</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3494..3503"><span>hm_key_of</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>prio</span></span><span> </span><span class="free"><span>v'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>  
      </span><span class="comment1"><span>― ‹Transform into the domain of heaps›</span></span><span>
      </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>pq</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>m</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="main"><span>(</span></span><span class="skolem"><span>pq</span></span><span class="main"><span>,</span></span><span class="skolem"><span>m</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="free"><span>hm</span></span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_35718..35720"><span>NE</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>pq</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>hm_valid_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>hm_length_def</span></a><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_36025..36032">CNV_LHS</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>prio</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.the|const"><span>the</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3494..3503"><span>hm_key_of</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 
        </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span>h.prio_of</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>heapmap_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>hm_key_of_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;_def|fact"><span>hmr_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>h.val_of_def</span></a><span class="main"><span>)</span></span><span>
        
      </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_35633..35636"><span>INV</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_36229..36233">INV'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>h.heap_invar</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
        </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>heapmap_invar_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

      </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_35673..35675"><span>V'</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_35633..35636"><span>INV</span></a><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>i</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_36341..36344">IDX</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>h.valid</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>i</span></span><span>"</span></span></span><span> 
        </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_36382..36389">CNV_RHS</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>prio</span></span><span> </span><span class="free"><span>v'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span>h.prio_of</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>i</span></span><span>"</span></span></span><span> 
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>heapmap_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>heapmap_invar_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar_def|fact"><span>hmr_invar_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;_def|fact"><span>hmr_α_def</span></a><span>
          </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>h.valid_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>h.val_of_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.restrict_map_eq|fact"><span>restrict_map_eq</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>no_types</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_leI|fact"><span>Suc_leI</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp_apply|fact"><span>comp_apply</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.diff_Suc_Suc|fact"><span>diff_Suc_Suc</span></a><span> 
          </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.cancel_comm_monoid_add_class.diff_zero|fact"><span>diff_zero</span></a><span> </span><a class="entity_ref" href="List-Index.List_Index.html#List_Index.index_less_size_conv|fact"><span>index_less_size_conv</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.neq0_conv|fact"><span>neq0_conv</span></a><span> </span><a class="entity_ref" href="List-Index.List_Index.html#List_Index.nth_index|fact"><span>nth_index</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_map|fact"><span>nth_map</span></a><span> 
          </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.old.nat.distinct|fact"><span>old.nat.distinct</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.sel|fact"><span>option.sel</span></a><span class="main"><span>)</span></span><span>
        
      </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span>h.heap_min_prop</span><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_36229..36233"><span>INV'</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_36341..36344"><span>IDX</span></a><span class="main"><span>]</span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_36025..36032"><span>CNV_LHS</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_36382..36389"><span>CNV_RHS</span></a><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>    


    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹With the above lemma, the correctness proof is straightforward›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_\&lt;alpha&gt;_correct|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_\&lt;alpha&gt;_correct|thm"><span class="entity_def" id="offset_36935..36955">hm_pop_min_α_correct</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_33836..33849"><span>hm_pop_min_op</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>k</span></span><span class="main"><span>,</span></span><span class="bound"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="bound"><span>hm'</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> 
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="bound"><span>v</span></span><span> 
      </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span class="main"><span>(</span></span><span class="bound"><span>k</span></span><span class="main"><span>:=</span></span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span class="main"><span>)</span></span><span> 
      </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>k'</span></span><span> </span><span class="bound"><span>v'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="bound"><span>k'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="bound"><span>v'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>prio</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>prio</span></span><span> </span><span class="bound"><span>v'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_33825..33835"><span>hm_pop_min_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3739..3758"><span>hm_key_of_op_unfold</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>hm_the_lookup_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span> 
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_6531..6551"><span>hm_exch_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span>
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_11469..11492"><span>hm_butlast_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span>
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_19824..19844"><span>hm_sink_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span>
        </span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_35601..35617"><span>heapmap_min_prop</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>  

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_37460..37465">lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_nres_rel_prodI|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_nres_rel_prodI|thm"><span class="entity_def" id="offset_37466..37488">heapmap_nres_rel_prodI</span></span></span><span class="main"><span>:</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hmx</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.UNIV|const"><span>UNIV</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>h'x</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>h'x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>,</span></span><span class="bound"><span>h'</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span>h.heap_invar</span><span> </span><span class="bound"><span>h'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hmx</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>r</span></span><span class="main"><span>,</span></span><span class="bound"><span>hm'</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>r</span></span><span class="main"><span>,</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>hx</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hmx</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>hx</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_37460..37465"><span>assms</span></a><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.br_def|fact"><span>br_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>heapmap_invar_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pw_le_iff|fact"><span>pw_le_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.pw_leof_iff|fact"><span>pw_leof_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
      

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_op_aref|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_op_aref|thm"><span>hm_pop_min_op_aref</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_33836..33849"><span>hm_pop_min_op</span></a><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_pm_pop_min|const"><span>mop_pm_pop_min</span></a><span> </span><span class="free"><span>prio</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>)</span></span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST_def|fact"><span>PR_CONST_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>frule</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_13729..13745"><span>heapmap_hmr_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_pm_pop_min_alt|fact"><span>mop_pm_pop_min_alt</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT_refine_right|fact"><span>ASSERT_refine_right</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_37466..37488"><span>heapmap_nres_rel_prodI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_34310..34330"><span>hm_pop_min_op_refine</span></a><span class="main"><span class="main"><span>[</span></span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.param_fo|attribute"><span class="operator"><span>param_fo</span></span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relD|fact"><span>nres_relD</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>assumption</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_36935..36955"><span>hm_pop_min_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.splits|fact"><span>prod.splits</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
      
    </span><span class="keyword1"><span class="command"><span>text_raw</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹\paragraph{Second approach}›</span></span></span><span>

    </span><span class="comment1"><span>(* Alternative approach: Also use knowledge about result
      in multiset domain. Obtaining property seems infeasible at first attempt! *)</span></span><span>  

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_kv_of_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_kv_of_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_kv_of_op_def_raw|axiom"><span class="entity_def" id="offset_38708..38718">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_kv_of_op|const"><span class="entity_def" id="offset_38720..38731">hm_kv_of_op</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3598..3610"><span>hm_key_of_op</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>v</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_4686..4702"><span>hm_the_lookup_op</span></a><span> </span><span class="bound"><span>k</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>v</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>}</span></span><span>"</span></span></span><span>


    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.kvi_rel_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.kvi_rel_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.kvi_rel_def_raw|axiom"><span class="entity_def" id="offset_38884..38894">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.kvi_rel|const"><span class="entity_def" id="offset_38896..38903">kvi_rel</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>k</span></span><span class="main"><span>,</span></span><span class="bound"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="bound"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>v</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3494..3503"><span>hm_key_of</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_38955..38960">lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_kv_op_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_kv_op_refine|thm"><span class="entity_def" id="offset_38961..38976">hm_kv_op_refine</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>hm</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_38720..38731"><span>hm_kv_of_op</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_38896..38903"><span>kvi_rel</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>h.val_of_op</span><span> </span><span class="free"><span>h</span></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_38708..38718"><span>hm_kv_of_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>h.val_of_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_38884..38894"><span>kvi_rel_def</span></a><span> 
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3739..3758"><span>hm_key_of_op_unfold</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>hm_the_lookup_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>  
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_38955..38960"><span>assms</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> 
        </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>hm_valid_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>hm_length_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_defs|fact"><span>hmr_rel_defs</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>heapmap_α_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>hm_key_of_def</span></a><span>
        </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.splits|fact"><span>prod.splits</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.contra_subsetD|fact"><span>contra_subsetD</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.domIff|fact"><span>domIff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.not_None_eq|fact"><span>not_None_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_mem|fact"><span>nth_mem</span></a><span class="main"><span>)</span></span><span>  

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_op&apos;_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_op&apos;_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_op&apos;_def_raw|axiom"><span class="entity_def" id="offset_39460..39470">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_op&apos;.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_op&apos;.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_op&apos;|const"><span class="entity_def" id="offset_39471..39485">hm_pop_min_op'</span></span></span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm_pop_min_op'</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_905..918"><span>heapmap_invar</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2818..2826"><span>hm_valid</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>kv</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_38720..38731"><span>hm_kv_of_op</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>l</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2287..2296"><span>hm_length</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>hm</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_5463..5473"><span>hm_exch_op</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="bound"><span>l</span></span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>hm</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_10713..10726"><span>hm_butlast_op</span></a><span> </span><span class="bound"><span>hm</span></span><span class="main"><span>;</span></span><span>
        
        </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>l</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
          </span><span class="bound"><span>hm</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_18228..18238"><span>hm_sink_op</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>;</span></span><span>
          </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>kv</span></span><span class="main"><span>,</span></span><span class="bound"><span>hm</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>}</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>kv</span></span><span class="main"><span>,</span></span><span class="bound"><span>hm</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>}</span></span><span>"</span></span></span><span>


    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_op_refine&apos;|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_op_refine&apos;|thm"><span class="entity_def" id="offset_39907..39928">hm_pop_min_op_refine'</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>hm</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_39471..39485"><span>hm_pop_min_op'</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_38896..38903"><span>kvi_rel</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>h.pop_min_op</span><span> </span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_39460..39470"><span>hm_pop_min_op'_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>h.pop_min_op_def</span></a><span>
      </span><span class="comment1"><span>(* Project away stuff of second component *)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ignore_snd_refine_conv|fact"><span>ignore_snd_refine_conv</span></a><span>
      </span><span class="comment1"><span>(* Prove refinement *)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>heapmap_rel_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>unfold</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>heapmap_invar_def</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp_all</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>


    </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_40380..40385">lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_nres_rel_prodI&apos;|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.heapmap_nres_rel_prodI&apos;|thm"><span class="entity_def" id="offset_40386..40409">heapmap_nres_rel_prodI'</span></span></span><span class="main"><span>:</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hmx</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><span class="free"><span>S</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>h'x</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>h'x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="free"><span>Φ</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>h'</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>r</span></span><span class="main"><span>,</span></span><span class="bound"><span>h'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span>h.heap_invar</span><span> </span><span class="bound"><span>h'</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hmx</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>r</span></span><span class="main"><span>,</span></span><span class="bound"><span>hm'</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span class="bound"><span>r'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>r</span></span><span class="main"><span>,</span></span><span class="bound"><span>r'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>r'</span></span><span class="main"><span>,</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="bound"><span>hm'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="bound"><span>hm'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>r</span></span><span class="main"><span>,</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>hx</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hmx</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>hx</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_40380..40385"><span>assms</span></a><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>heapmap_invar_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> 
        </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pw_le_iff|fact"><span>pw_le_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.pw_leof_iff|fact"><span>pw_leof_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span>
        </span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.ex_in_kvi_rel_conv|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.ex_in_kvi_rel_conv|thm"><span class="entity_def" id="offset_40907..40925">ex_in_kvi_rel_conv</span></span></span><span class="main"><span>:</span></span><span>
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span class="bound"><span>r'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>r</span></span><span class="main"><span>,</span></span><span class="bound"><span>r'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_38896..38903"><span>kvi_rel</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>r'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span>r</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3494..3503"><span>hm_key_of</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_38884..38894"><span>kvi_rel_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="free"><span>r</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

      
    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_aref&apos;|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_pop_min_aref&apos;|thm"><span>hm_pop_min_aref'</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_39471..39485"><span>hm_pop_min_op'</span></a><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_pm_pop_min|const"><span>mop_pm_pop_min</span></a><span> </span><span class="free"><span>prio</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>frule</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_13729..13745"><span>heapmap_hmr_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_pm_pop_min_alt|fact"><span>mop_pm_pop_min_alt</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT_refine_right|fact"><span>ASSERT_refine_right</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_40386..40409"><span>heapmap_nres_rel_prodI'</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>erule</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_39907..39928"><span>hm_pop_min_op_refine'</span></a><span class="main"><span>)</span></span><span>

        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>unfold</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><span>h.pop_min_op_correct</span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_40907..40925"><span>ex_in_kvi_rel_conv</span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.splits|fact"><span>prod.splits</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_39460..39470"><span>hm_pop_min_op'_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_38708..38718"><span>hm_kv_of_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3739..3758"><span>hm_key_of_op_unfold</span></a><span>
          </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>hm_the_lookup_op_def</span></a><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span> 
          </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_6531..6551"><span>hm_exch_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span>
          </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_11469..11492"><span>hm_butlast_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span>
          </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_19824..19844"><span>hm_sink_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span>
          </span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_32659..32664"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ranI|fact"><span>ranI</span></a><span class="main"><span>)</span></span><span> 
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Remove›</span></span></span><span>  

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_remove_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_remove_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_remove_op_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_remove_op.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_remove_op.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_remove_op|const"><span class="entity_def" id="offset_42131..42143">hm_remove_op</span></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_905..918"><span>heapmap_invar</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.dom|const"><span>dom</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_8716..8727"><span>hm_index_op</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>l</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2287..2296"><span>hm_length</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>hm</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_5463..5473"><span>hm_exch_op</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>l</span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>hm</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_10713..10726"><span>hm_butlast_op</span></a><span> </span><span class="bound"><span>hm</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><span class="bound"><span>l</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span>
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_20775..20787"><span>hm_repair_op</span></a><span> </span><span class="bound"><span>hm</span></span><span> </span><span class="bound"><span>i</span></span><span>
      </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span>  
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>hm</span></span><span>
    </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.remove_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.remove_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.remove_op_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heap.html#IICF_Abs_Heap.heapstruct|locale"><span>heapstruct</span></a><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.remove_op.cong|fact"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.remove_op.cong|thm"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.remove_op|const"><span class="entity_def" id="offset_42460..42469">remove_op</span></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>do</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span>heap_invar</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span>valid</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>l</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>h</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span>exch_op</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="bound"><span>l</span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>h</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span>butlast_op</span><span> </span><span class="bound"><span>h</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><span class="bound"><span>l</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span>
        </span><span>repair_op</span><span> </span><span class="bound"><span>h</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span>
      </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span>  
        </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>h</span></span><span>
    </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> -</span><span class="main"><span>)</span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.swap_empty_iff|fact"><span class="entity_def" id="IICF_Abs_Heapmap.swap_empty_iff|thm"><span>swap_empty_iff</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.iff|attribute"><span class="operator"><span>iff</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="More_List.html#More_List.swap|const"><span>swap</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>j</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="free"><span>l</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="More_List.html#More_List.swap_def|fact"><span>swap_def</span></a><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_42788..42793">lemma</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heap.html#IICF_Abs_Heap.heapstruct|locale"><span>heapstruct</span></a><span class="main"><span>)</span></span><span> 
      </span><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.butlast_exch_last|fact"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.butlast_exch_last|thm"><span class="entity_def" id="offset_42817..42834">butlast_exch_last</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.butlast|const"><span>butlast</span></a><span> </span><span class="main"><span>(</span></span><span>exch</span><span> </span><span class="free"><span>h</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span>update</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.butlast|const"><span>butlast</span></a><span> </span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.last|const"><span>last</span></a><span> </span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_42788..42793"><span>exch_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_42788..42793"><span>update_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="free"><span>h</span></span></span><span> </span><span class="quasi_keyword"><span>rule</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.rev_cases|fact"><span>rev_cases</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="More_List.html#More_List.swap_def|fact"><span>swap_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.butlast_list_update|fact"><span>butlast_list_update</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_43046..43051">lemma</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heap.html#IICF_Abs_Heap.heapstruct|locale"><span>heapstruct</span></a><span class="main"><span>)</span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.remove_op_invar|fact"><span class="entity_def" id="IICF_Abs_Heapmap.heapstruct.remove_op_invar|thm"><span class="entity_def" id="offset_43068..43083">remove_op_invar</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span> </span><span>heap_invar</span><span> </span><span class="free"><span>h</span></span><span class="main"><span>;</span></span><span> </span><span>valid</span><span> </span><span class="free"><span>h</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_42460..42469"><span>remove_op</span></a><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>h</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span>heap_invar</span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43046..43051"><span>remove_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43046..43051"><span>valid_def</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43046..43051"><span>valid_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43046..43051"><span>exch_def</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_42817..42834"><span>butlast_exch_last</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43046..43051"><span>valid_def</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_remove_op_refine|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_remove_op_refine|thm"><span class="entity_def" id="offset_43499..43518">hm_remove_op_refine</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine|attribute"><span class="operator"><span>refine</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>hm</span></span><span class="main"><span>,</span></span><span class="free"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>hm</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> 
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_42131..42143"><span>hm_remove_op</span></a><span> </span><span class="free"><span>k</span></span><span> </span><span class="free"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel|const"><span>hmr_rel</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_42460..42469"><span>h.remove_op</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmstruct.hm_index|const"><span>hm_index</span></a><span> </span><span class="free"><span>hm</span></span><span> </span><span class="free"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43046..43051"><span>hm_remove_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43046..43051"><span>h.remove_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43046..43051"><span>heapmap_rel_def</span></a><span>
      </span><span class="comment1"><span>(*apply (rewrite at "Let (hm_index hm k) _" Let_def)*)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_26263..26285"><span>index_op_inline_refine</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_remove_op_\&lt;alpha&gt;_correct|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_remove_op_\&lt;alpha&gt;_correct|thm"><span class="entity_def" id="offset_43930..43952">hm_remove_op_α_correct</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_42131..42143"><span>hm_remove_op</span></a><span> </span><span class="free"><span>k</span></span><span> </span><span class="free"><span>hm</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.le_or_fail|const"><span>≤<span class="hidden">⇩</span><sub>n</sub></span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>hm'</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="bound"><span>hm'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="free"><span>hm</span></span><span class="main"><span>)</span></span><span class="main"><span>(</span></span><span class="free"><span>k</span></span><span class="main"><span>:=</span></span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43046..43051"><span>hm_remove_op_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span> 
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_6531..6551"><span>hm_exch_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span>
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_11469..11492"><span>hm_butlast_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span>
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_21199..21221"><span>hm_repair_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span>
        </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_27004..27027"><span>hm_index_op_inline_leof</span></a><span>
        </span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>fail</span></span><span class="main"><span>)</span></span><span>
      
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="ISABELLE_HOME/src/HOL/Library/rewrite.ML.html#Rewrite.rewrite|method"><span class="operator"><span>rewrite</span></span></a><span> </span><span class="quasi_keyword"><span>at</span></span><span> </span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmstruct.hm_index|const"><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmstruct.hm_index|const"><span>hm_index</span></a></a><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="free"><span class="free"><span>k</span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2287..2296"><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_2287..2296"><span>hm_length</span></a></a><span> </span><span class="main"><span class="main"><span>_</span></span></span><span>"</span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>in</span></span></span></span><span> </span><span class="quasi_keyword"><span>asm</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq_commute|fact"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq_commute|fact"><span>eq_commute</span></a></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>fail</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_remove_op_aref|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_remove_op_aref|thm"><span>hm_remove_op_aref</span></span></span><span class="main"><span>:</span></span><span>
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_42131..42143"><span>hm_remove_op</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_map_delete_ex|const"><span>mop_map_delete_ex</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_map_delete_ex_alt|fact"><span>mop_map_delete_ex_alt</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT_refine_right|fact"><span>ASSERT_refine_right</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>frule</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_13729..13745"><span>heapmap_hmr_relI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_14276..14294"><span>heapmap_nres_relI'</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43499..43518"><span>hm_remove_op_refine</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>assumption</span></span><span class="main"><span class="keyword3"><span>?</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>unfold</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43046..43051"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43046..43051"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_rel_def|fact"><span>hmr_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span> 
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43068..43083"><span>h.remove_op_invar</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>fail</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43930..43952"><span>hm_remove_op_α_correct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Leof.html#Refine_Leof.leof_trans|fact"><span>leof_trans</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>fail</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
      
    </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Peek-Min›</span></span></span><span> 


    </span><span class="keyword1"><span class="command"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_peek_min_op_def|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_peek_min_op_def|thm"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_peek_min_op_def_raw|axiom"><span class="entity_def" id="offset_45102..45112">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_peek_min_op|const"><span class="entity_def" id="offset_45113..45127">hm_peek_min_op</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><span>,</span></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.ahm|type"><span>ahm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span class="tfree"><span>'v</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hm_peek_min_op</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_38720..38731"><span>hm_kv_of_op</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>hm</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>"</span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_peek_min_op_aref|fact"><span class="entity_def" id="IICF_Abs_Heapmap.hmstruct.hm_peek_min_op_aref|thm"><span>hm_peek_min_op_aref</span></span></span><span class="main"><span>:</span></span><span> 
      </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_45113..45127"><span>hm_peek_min_op</span></a><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_pm_peek_min|const"><span>mop_pm_peek_min</span></a><span> </span><span class="free"><span>prio</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="main"><span>⟨</span></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>  
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST_def|fact"><span>PR_CONST_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>  
      </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>hm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="skolem"><span>m</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.map|type"><span>⇀</span></a></span><span> </span><span class="tfree"><span>'v</span></span><span>"</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="entity_def" id="offset_45465..45466">A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="skolem"><span>hm</span></span><span class="main"><span>,</span></span><span class="skolem"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_1040..1051"><span>heapmap_rel</span></a><span>"</span></span></span><span>
      
      </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_45465..45466"><span>A</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>h.heap_invar</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="skolem"><span>hm</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_invar|const"><span>hmr_invar</span></a><span> </span><span class="skolem"><span>hm</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>m</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="skolem"><span>hm</span></span><span>"</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43046..43051"><span>heapmap_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.in_br_conv|fact"><span>in_br_conv</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43046..43051"><span>heapmap_invar_def</span></a><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span>

      </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_45113..45127"><span>hm_peek_min_op</span></a><span> </span><span class="skolem"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_38896..38903"><span>kvi_rel</span></a><span> </span><span class="skolem"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>h.peek_min_op</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="skolem"><span>hm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_45102..45112"><span>hm_peek_min_op_def</span></a><span>  </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43046..43051"><span>h.peek_min_op_def</span></a><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_rcg|method"><span class="operator"><span>refine_rcg</span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_38961..38976"><span>hm_kv_op_refine</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_45465..45466"><span>A</span></a><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_13729..13745"><span>heapmap_hmr_relI</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="skolem"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span>h.peek_min_op</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#IICF_Abs_Heapmap.hmr_\&lt;alpha&gt;|const"><span>hmr_α</span></a><span> </span><span class="skolem"><span>hm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 
        </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>v</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>v</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ran|const"><span>ran</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="skolem"><span>hm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>∀</span></span><span class="bound"><span>v'</span></span><span class="main"><span>∈</span></span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ran|const"><span>ran</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_803..812"><span>heapmap_α</span></a><span> </span><span class="skolem"><span>hm</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>prio</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>prio</span></span><span> </span><span class="bound"><span>v'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|method"><span class="operator"><span>refine_vcg</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span>
      </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_45113..45127"><span>hm_peek_min_op</span></a><span> </span><span class="skolem"><span>hm</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.conc_fun|const"><span>⇓</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_pm_peek_min|const"><span>mop_pm_peek_min</span></a><span> </span><span class="free"><span>prio</span></span><span> </span><span class="skolem"><span>m</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
        </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="IICF_Prio_Map.html#IICF_Prio_Map.mop_pm_peek_min_alt|fact"><span>mop_pm_peek_min_alt</span></a><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pw_le_iff|fact"><span>pw_le_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_45102..45112"><span>hm_peek_min_op_def</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43046..43051"><span>hm_kv_of_op_def</span></a><span> 
            </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_3739..3758"><span>hm_key_of_op_unfold</span></a><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43046..43051"><span>hm_the_lookup_op_def</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="IICF_Abs_Heapmap.html#offset_43046..43051"><span>kvi_rel_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ran_def|fact"><span>ran_def</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

    </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>    


  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>