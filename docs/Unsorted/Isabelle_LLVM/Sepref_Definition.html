<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Sepref_Definition</title>
</head>


<body>
<div class="head">
<h1>Theory Sepref_Definition</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Sepref-Definition Command›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><a href="Sepref_Definition.html"><span>Sepref_Definition</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> </span><a href="Sepref_Translate.html"><span>Sepref_Translate</span></a><span> </span><span class="quoted"><span>"</span><a href="Term_Synth.html"><span>Lib/Term_Synth</span></a><span>"</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>keywords</span></span></span><span> </span><span class="quoted"><span>"sepref_definition"</span></span><span> </span><span class="main"><span>::</span></span><span> thy_goal
      </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span>"sepref_def"</span></span><span> </span><span class="main"><span>::</span></span><span> thy_goal
      </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span>"sepref_thm"</span></span><span> </span><span class="main"><span>::</span></span><span> thy_goal
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹ Setup of Extraction-Tools ›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>declare</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Definition_Utils.html#Definition_Utils.cd_patterns|attribute"><span class="operator"><span>cd_patterns</span></span></a><span> </span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a></a></a></a><span> </span><span class="main"><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="HOL-Library.Rewrite.html#Rewrite.rewrite_HOLE|const"><span class="main"><a class="entity_ref" href="HOL-Library.Rewrite.html#Rewrite.rewrite_HOLE|const"><span class="main"><a class="entity_ref" href="HOL-Library.Rewrite.html#Rewrite.rewrite_HOLE|const"><span class="main"><a class="entity_ref" href="HOL-Library.Rewrite.html#Rewrite.rewrite_HOLE|const"><span>⌑</span></a></span></a></span></a></span></a></span><span> </span><span class="main"><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span></span><span> </span><span class="main"><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span></span><span> </span><span class="main"><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span></span><span>"</span></span></span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>


  </span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Synthesis setup for sepref-definition goals›</span></span></span><span>
  </span><span class="comment1"><span>(* TODO: The UNSPEC are an ad-hoc hack to specify the synthesis goal *)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>consts</span></span></span><span> </span><span class="entity_def" id="Sepref_Definition.UNSPEC|const"><span>UNSPEC</span></span><span class="main"><span>::</span></span><span class="tfree"><span class="quoted"><span class="tfree"><span>'a</span></span></span></span><span>  

  </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Definition.hfunspec|const"><span>hfunspec</span></span></span><span> 
    </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword3"><span>(</span></span><span>_</span><span class="keyword1"><span><span class="hidden">⇧</span><sup>?</sup></span></span><span class="keyword3"><span>)</span></span><span>"</span></span><span> </span><span class="main"><span>[</span></span><span>1000</span><span class="main"><span>]</span></span><span> 999</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span class="main"><span class="free"><span><span class="hidden">⇧</span><sup>?</sup></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hf_pres|const"><span>hf_pres</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.UNSPEC|const"><span>UNSPEC</span></a><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Definition.SYNTH_def|fact"><span class="entity_def" id="Sepref_Definition.SYNTH_def|thm"><span class="entity_def" id="Sepref_Definition.SYNTH_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Definition.SYNTH|const"><span>SYNTH</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'r</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'ai</span></span><span> </span><span class="main"><span>⇒</span></span><span class="tfree"><span>'ri</span></span><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'r</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>SYNTH</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Definition.CP_UNCURRY_def|fact"><span class="entity_def" id="Sepref_Definition.CP_UNCURRY_def|thm"><span class="entity_def" id="Sepref_Definition.CP_UNCURRY_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Definition.CP_UNCURRY|const"><span>CP_UNCURRY</span></span></span><span> </span><span class="main"><span class="bound"><span class="entity"><span>_</span></span></span></span><span> </span><span class="main"><span class="bound"><span class="entity"><span>_</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Definition.CP_PAT_def|fact"><span class="entity_def" id="Sepref_Definition.CP_PAT_def|thm"><span class="entity_def" id="Sepref_Definition.CP_PAT_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Definition.CP_PAT|const"><span>CP_PAT</span></span></span><span> </span><span class="main"><span class="bound"><span class="entity"><span>_</span></span></span></span><span> </span><span class="main"><span class="bound"><span class="entity"><span>_</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Definition.INTRO_KD_def|fact"><span class="entity_def" id="Sepref_Definition.INTRO_KD_def|thm"><span class="entity_def" id="Sepref_Definition.INTRO_KD_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Definition.INTRO_KD|const"><span>INTRO_KD</span></span></span><span> </span><span class="main"><span class="bound"><span class="entity"><span>_</span></span></span></span><span> </span><span class="main"><span class="bound"><span class="entity"><span>_</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Definition.SPEC_RES_ASSN_def|fact"><span class="entity_def" id="Sepref_Definition.SPEC_RES_ASSN_def|thm"><span class="entity_def" id="Sepref_Definition.SPEC_RES_ASSN_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Definition.SPEC_RES_ASSN|const"><span>SPEC_RES_ASSN</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>SPEC_RES_ASSN</span></span><span> </span><span class="main"><span class="bound"><span class="entity"><span>_</span></span></span></span><span> </span><span class="main"><span class="bound"><span class="entity"><span>_</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Term_Synth.html#Term_Synth.synth_rules|attribute"><span class="operator"><span>synth_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.CP_UNCURRY|const"><span>CP_UNCURRY</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>g</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Term_Synth.html#Term_Synth.synth_rules|attribute"><span class="operator"><span>synth_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.CP_UNCURRY|const"><span>CP_UNCURRY</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Misc.html#Sepref_Misc.uncurry0|const"><span>uncurry0</span></a><span> </span><span class="free"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Misc.html#Sepref_Misc.uncurry0|const"><span>uncurry0</span></a><span> </span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Term_Synth.html#Term_Synth.synth_rules|attribute"><span class="operator"><span>synth_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.CP_UNCURRY|const"><span>CP_UNCURRY</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>g</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.CP_UNCURRY|const"><span>CP_UNCURRY</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><span class="free"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Term_Synth.html#Term_Synth.synth_rules|attribute"><span class="operator"><span>synth_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.CP_PAT|const"><span>CP_PAT</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>g</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Term_Synth.html#Term_Synth.synth_rules|attribute"><span class="operator"><span>synth_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.CP_PAT|const"><span>CP_PAT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Misc.html#Sepref_Misc.uncurry0|const"><span>uncurry0</span></a><span> </span><span class="free"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Misc.html#Sepref_Misc.uncurry0|const"><span>uncurry0</span></a><span> </span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Term_Synth.html#Term_Synth.synth_rules|attribute"><span class="operator"><span>synth_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.CP_PAT|const"><span>CP_PAT</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>g</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.CP_PAT|const"><span>CP_PAT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><span class="free"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Term_Synth.html#Term_Synth.synth_rules|attribute"><span class="operator"><span>synth_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.INTRO_KD|const"><span>INTRO_KD</span></a><span> </span><span class="free"><span>R1</span></span><span> </span><span class="free"><span>R1'</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.INTRO_KD|const"><span>INTRO_KD</span></a><span> </span><span class="free"><span>R2</span></span><span> </span><span class="free"><span>R2'</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.INTRO_KD|const"><span>INTRO_KD</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>R1</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span class="free"><span>R2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>R1'</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span class="free"><span>R2'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Term_Synth.html#Term_Synth.synth_rules|attribute"><span class="operator"><span>synth_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.INTRO_KD|const"><span>INTRO_KD</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span class="main"><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.hfunspec|const"><span><span class="hidden">⇧</span><sup>?</sup></span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hf_pres|const"><span>hf_pres</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>k</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Term_Synth.html#Term_Synth.synth_rules|attribute"><span class="operator"><span>synth_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.INTRO_KD|const"><span>INTRO_KD</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfkeep|const"><span><span class="hidden">⇧</span><sup>k</sup></span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfkeep|const"><span><span class="hidden">⇧</span><sup>k</sup></span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Term_Synth.html#Term_Synth.synth_rules|attribute"><span class="operator"><span>synth_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.INTRO_KD|const"><span>INTRO_KD</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfdrop|const"><span><span class="hidden">⇧</span><sup>d</sup></span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfdrop|const"><span><span class="hidden">⇧</span><sup>d</sup></span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Term_Synth.html#Term_Synth.synth_rules|attribute"><span class="operator"><span>synth_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.SPEC_RES_ASSN|const"><span>SPEC_RES_ASSN</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Term_Synth.html#Term_Synth.synth_rules|attribute"><span class="operator"><span>synth_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.SPEC_RES_ASSN|const"><span>SPEC_RES_ASSN</span></a><span> </span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.UNSPEC|const"><span>UNSPEC</span></a><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Definition.synth_hnrI|fact"><span class="entity_def" id="Sepref_Definition.synth_hnrI|thm"><span>synth_hnrI</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.CP_UNCURRY|const"><span>CP_UNCURRY</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>fi</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.CP_PAT|const"><span>CP_PAT</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>fpat</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.INTRO_KD|const"><span>INTRO_KD</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>R'</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.SPEC_RES_ASSN|const"><span>SPEC_RES_ASSN</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>S'</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Term_Synth.html#Term_Synth.SYNTH_TERM|const"><span>SYNTH_TERM</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.SYNTH|const"><span>SYNTH</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>R</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span>fpat</span></span><span class="main"><span>,</span></span><a class="entity_ref" href="Term_Synth.html#Term_Synth.SDUMMY|const"><span>SDUMMY</span></a><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="Term_Synth.html#Term_Synth.SDUMMY|const"><span>SDUMMY</span></a><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="free"><span>fi</span></span><span class="main"><span>,</span></span><span class="free"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>R'</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.SYNTH_def|fact"><span>SYNTH_def</span></a><span class="main"><span>)</span></span><span>


</span><span class="keyword1"><span class="command"><span>ML</span></span></span><span> </span><span class="quoted"><span>‹
  </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Sepref_Definition</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>make_hnr_goal</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.declare_term</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Term_Synth.synth_term</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.synth_hnrI|fact"><span>synth_hnrI</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="var"><span>?pat</span></span><span class="main"><span>,</span></span><span class="var"><span>?goal</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Synthesized term does not match"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pat</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>pat</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>Definition_Utils.prepare_cd_pattern</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>goal</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span> 
      </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Refine_Util</span><span>
      </span><span class="comment1"><span>(*val flags = parse_bool_config' "prep_code" cfg_prep_code
      val parse_flags = parse_paren_list' flags  
      *)</span></span><span>

    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>       
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sd_parser</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Parse.binding</span><span> </span><span>--</span><span> </span><span>Parse.opt_attribs</span><span> </span><span>--|</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>keyword</span></span><span> "</span><span class="keyword2"><span>is</span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span> 
        </span><span>--</span><span> </span><span>Parse.opt_attribs</span><span> </span><span>--</span><span> </span><span>Parse.term</span><span> </span><span>--|</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>keyword</span></span><span> "</span><span class="keyword2"><span>::</span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>--</span><span> </span><span>Parse.term</span><span>
        
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sd_dflt_parser</span></span><span> </span><span class="main"><span>=</span></span><span> 
          </span><span>Parse.binding</span><span> 
        </span><span>--</span><span> </span><span>Scan.optional</span><span> </span><span>Parse.attribs</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>attributes</span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> 
        </span><span>--|</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>keyword</span></span><span> "</span><span class="keyword2"><span>is</span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span> 
        </span><span>--</span><span> </span><span>Scan.optional</span><span> </span><span>Parse.attribs</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>attributes</span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.sepref_fr_rules|attribute"><span class="operator"><span>sepref_fr_rules</span></span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> 
        </span><span>--</span><span> </span><span>Parse.term</span><span> 
        </span><span>--|</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>keyword</span></span><span> "</span><span class="keyword2"><span>::</span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span> 
        </span><span>--</span><span> </span><span>Parse.term</span><span>
        
        
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>  

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_synth_term</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t_raw</span></span><span> </span><span class="entity"><span>r_raw</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Syntax.parse_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t_raw</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Syntax.parse_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>r_raw</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="Sepref_Definition.html#Sepref_Definition.SYNTH|const"><span>SYNTH</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span>dummyT</span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>t</span></span><span>$</span><span class="entity"><span>r</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Syntax.check_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>  


    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>sd_cmd</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span class="entity"><span>attribs_def</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>attribs_ref</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>t_raw</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>r_raw</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="comment1"><span>(*local
        val ctxt = Refine_Util.apply_configs flags lthy
      in
        val flag_prep_code = Config.get ctxt cfg_prep_code
      end
      *)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_synth_term</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>t_raw</span></span><span> </span><span class="entity"><span>r_raw</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>make_hnr_goal</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> 
        </span><span class="entity"><span>after_qed</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>singleton</span><span> </span><span class="main"><span>(</span></span><span>Variable.export</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> 
              </span><span class="main"><span>=</span></span><span> </span><span>Local_Theory.note</span><span> 
                 </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Definition_Utils.mk_qualified</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.name_of</span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"refine_raw"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> 
                 </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>dthm</span></span><span class="main"><span>,</span></span><span class="entity"><span>rthm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Definition_Utils.define_concrete_fun</span></span><span> </span><span>NONE</span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>attribs_def</span></span><span> </span><span class="entity"><span>attribs_ref</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>pat</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>lthy</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.pretty_thm</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>dthm</span></span><span> </span><span>|&gt;</span><span> </span><span>Pretty.string_of</span><span> </span><span>|&gt;</span><span> </span><span>writeln</span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.pretty_thm</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>rthm</span></span><span> </span><span>|&gt;</span><span> </span><span>Pretty.string_of</span><span> </span><span>|&gt;</span><span> </span><span>writeln</span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>lthy</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>after_qed</span></span><span> </span><span class="entity"><span>thmss</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"After-qed: Wrong thmss structure"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span>flat</span><span> </span><span class="entity"><span>thmss</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="entity"><span>Proof.theorem</span></span><span> </span><span>NONE</span><span> </span><span class="entity"><span>after_qed</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>goal</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>



    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Outer_Syntax.local_theory_to_proof</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>command_keyword</span></span><span> "</span><span class="keyword1"><span>sepref_definition</span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span>
      </span><span class="inner_quoted"><span>"Synthesis of imperative program"</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>sd_parser</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>sd_cmd</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Outer_Syntax.local_theory_to_proof</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>command_keyword</span></span><span> "</span><span class="keyword1"><span>sepref_def</span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span>
      </span><span class="inner_quoted"><span>"Synthesis of imperative program (default attributes)"</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>sd_dflt_parser</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>sd_cmd</span></span><span class="main"><span>)</span></span><span>
      
      
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>st_parser</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Parse.binding</span><span> </span><span>--|</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>keyword</span></span><span> "</span><span class="keyword2"><span>is</span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>--</span><span> </span><span>Parse.term</span><span> </span><span>--|</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>keyword</span></span><span> "</span><span class="keyword2"><span>::</span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>--</span><span> </span><span>Parse.term</span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>st_cmd</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span class="entity"><span>t_raw</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>r_raw</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_synth_term</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>t_raw</span></span><span> </span><span class="entity"><span>r_raw</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>make_hnr_goal</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> 
        </span><span class="entity"><span>after_qed</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>singleton</span><span> </span><span class="main"><span>(</span></span><span>Variable.export</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.pretty_thm</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>|&gt;</span><span> </span><span>Pretty.string_of</span><span> </span><span>|&gt;</span><span> </span><span>tracing</span><span>
  
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> 
              </span><span class="main"><span>=</span></span><span> </span><span>Local_Theory.note</span><span> 
                 </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Definition_Utils.mk_qualified</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.name_of</span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"refine_raw"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> 
                 </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>lthy</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>after_qed</span></span><span> </span><span class="entity"><span>thmss</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"After-qed: Wrong thmss structure"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span>flat</span><span> </span><span class="entity"><span>thmss</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="entity"><span>Proof.theorem</span></span><span> </span><span>NONE</span><span> </span><span class="entity"><span>after_qed</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>goal</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Outer_Syntax.local_theory_to_proof</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>command_keyword</span></span><span> "</span><span class="keyword1"><span>sepref_thm</span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span>
      </span><span class="inner_quoted"><span>"Synthesis of imperative program: Only generate raw refinement theorem"</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>st_parser</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>st_cmd</span></span><span class="main"><span>)</span></span><span>

  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
›</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>