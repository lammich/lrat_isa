<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Sepref_Rules</title>
</head>


<body>
<div class="head">
<h1>Theory Sepref_Rules</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Refinement Rule Management›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><a href="Sepref_Rules.html"><span>Sepref_Rules</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> </span><a href="Sepref_Basic.html"><span>Sepref_Basic</span></a><span> </span><a href="Sepref_Constraints.html"><span>Sepref_Constraints</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹This theory contains tools for managing the refinement rules used by Sepref›</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹The theories are based on uncurried functions, i.e.,
    every function has type </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>typ</span></span><span> </span><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span class="main"><span>⇒</span></span><span class="tfree"><span>'b</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span>, where </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>typ</span></span><span> </span><span class="quoted"><span class="tfree"><span>'a</span></span></span><span class="antiquote"><span>}</span></span></span><span> is the 
    tuple of parameters, or unit if there are none.
    ›</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Rules.non_dep_def|fact"><span class="entity_def" id="Sepref_Rules.non_dep_def|thm"><span class="entity_def" id="Sepref_Rules.non_dep_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Rules.non_dep|const"><span>non_dep</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.undefined|const"><span>undefined</span></a><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.non_dep_simp|fact"><span class="entity_def" id="Sepref_Rules.non_dep_simp|thm"><span>non_dep_simp</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.non_dep|const"><span>non_dep</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.NO_MATCH|const"><span>NO_MATCH</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.undefined|const"><span>undefined</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.undefined|const"><span>undefined</span></a><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.non_dep_def|fact"><span>non_dep_def</span></a><span class="main"><span>)</span></span><span>
    
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.non_dep_K|fact"><span class="entity_def" id="Sepref_Rules.non_dep_K|thm"><span>non_dep_K</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.intro|attribute"><span class="operator"><span>intro</span></span></a><span class="main"><span class="main"><span class="main"><span class="main"><span>!</span></span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.non_dep|const"><span>non_dep</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.non_dep_def|fact"><span>non_dep_def</span></a><span class="main"><span>)</span></span><span>
    
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Rules.non_dep2_def|fact"><span class="entity_def" id="Sepref_Rules.non_dep2_def|thm"><span class="entity_def" id="Sepref_Rules.non_dep2_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Rules.non_dep2|const"><span>non_dep2</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.undefined|const"><span>undefined</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.undefined|const"><span>undefined</span></a><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.non_dep2_simp|fact"><span class="entity_def" id="Sepref_Rules.non_dep2_simp(2)|thm"><span class="entity_def" id="Sepref_Rules.non_dep2_simp(1)|thm"><span>non_dep2_simp</span></span></span></span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.non_dep2|const"><span>non_dep2</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.NO_MATCH|const"><span>NO_MATCH</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.undefined|const"><span>undefined</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.undefined|const"><span>undefined</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.undefined|const"><span>undefined</span></a><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.non_dep2|const"><span>non_dep2</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.NO_MATCH|const"><span>NO_MATCH</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.undefined|const"><span>undefined</span></a><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.undefined|const"><span>undefined</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.undefined|const"><span>undefined</span></a><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.non_dep2_def|fact"><span>non_dep2_def</span></a><span class="main"><span>)</span></span><span>
    
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.non_dep2_K|fact"><span class="entity_def" id="Sepref_Rules.non_dep2_K|thm"><span>non_dep2_K</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.intro|attribute"><span class="operator"><span>intro</span></span></a><span class="main"><span class="main"><span class="main"><span class="main"><span>!</span></span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.non_dep2|const"><span>non_dep2</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.non_dep2_def|fact"><span>non_dep2_def</span></a><span class="main"><span>)</span></span><span>
    

  </span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Assertion Interface Binding›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Binding of interface types to refinement assertions›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Rules.intf_of_assn_def|fact"><span class="entity_def" id="Sepref_Rules.intf_of_assn_def|thm"><span class="entity_def" id="Sepref_Rules.intf_of_assn_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Rules.intf_of_assn|const"><span>intf_of_assn</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span>itself</span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
    </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>intf_of_assn</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.intf_of_assnI|fact"><span class="entity_def" id="Sepref_Rules.intf_of_assnI|thm"><span>intf_of_assnI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.intf_of_assn|const"><span>intf_of_assn</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>named_theorems_rev</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.intf_of_assn|attribute"><span class="entity_def" id="Sepref_Rules.intf_of_assn|fact"><span>intf_of_assn</span></span></span><span> </span><span class="quoted"><span>‹Links between refinement assertions and interface types›</span></span><span>  

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.intf_of_assn_fallback|fact"><span class="entity_def" id="Sepref_Rules.intf_of_assn_fallback|thm"><span>intf_of_assn_fallback</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.intf_of_assn|const"><span>intf_of_assn</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

  </span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Function Refinement with Precondition›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Rules.fref_def|fact"><span class="entity_def" id="Sepref_Rules.fref_def|thm"><span class="entity_def" id="Sepref_Rules.fref_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Rules.fref|const"><span>fref</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'c</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'c</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'c</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'d</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span class="main"><span>)</span></span><span>
           </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'c</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'d</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword1"><span>[</span></span><span>_</span><span class="keyword1"><span>]<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>d</sub></span></span><span> _ </span><span class="keyword1"><span>→</span></span><span> _"</span></span><span> </span><span class="main"><span>[</span></span><span>0</span><span class="main"><span>,</span></span><span>60</span><span class="main"><span>,</span></span><span>60</span><span class="main"><span>]</span></span><span> 60</span><span class="main"><span>)</span></span><span>         
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span class="free"><span>[</span></span></span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span class="keyword1"><span class="free"><span>]<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>d</sub></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><span class="free"><span>→</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="bound"><span>f</span></span><span class="main"><span>,</span></span><span class="bound"><span>g</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span class="main"><span>,</span></span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>g</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Rules.freft|const"><span>freft</span></span></span><span> </span><span class="main"><span>(</span></span><span class="quoted"><span>"_ </span><span class="keyword1"><span>→<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>d</sub></span></span><span> _"</span></span><span> </span><span class="main"><span>[</span></span><span>60</span><span class="main"><span>,</span></span><span>60</span><span class="main"><span>]</span></span><span> 60</span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="keyword1"><span class="free"><span>→<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>d</sub></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>[</span></a></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>]<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>→</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Rules.freftnd|const"><span>freftnd</span></span></span><span> </span><span class="main"><span>(</span></span><span class="quoted"><span>"_ </span><span class="keyword1"><span>→<span class="hidden">⇩</span><sub>f</sub></span></span><span> _"</span></span><span> </span><span class="main"><span>[</span></span><span>60</span><span class="main"><span>,</span></span><span>60</span><span class="main"><span>]</span></span><span> 60</span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="keyword1"><span class="free"><span>→<span class="hidden">⇩</span><sub>f</sub></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>[</span></a></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>]<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>→</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Rules.frefnd|const"><span>frefnd</span></span></span><span> </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword1"><span>[</span></span><span>_</span><span class="keyword1"><span>]<span class="hidden">⇩</span><sub>f</sub></span></span><span> _ </span><span class="keyword1"><span>→</span></span><span> _"</span></span><span> </span><span class="main"><span>[</span></span><span>0</span><span class="main"><span>,</span></span><span>60</span><span class="main"><span>,</span></span><span>60</span><span class="main"><span>]</span></span><span> 60</span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span class="free"><span>[</span></span></span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span class="keyword1"><span class="free"><span>]<span class="hidden">⇩</span><sub>f</sub></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><span class="free"><span>→</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>[</span></a></span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>]<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>→</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

  
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.rel2p_fref|fact"><span class="entity_def" id="Sepref_Rules.rel2p_fref|thm"><span>rel2p_fref</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.rel2p|attribute"><span class="operator"><span>rel2p</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.rel2p|const"><span>rel2p</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>)</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>f</span></span><span> </span><span class="bound"><span>g</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.rel2p|const"><span>rel2p</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.rel2p|const"><span>rel2p</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>S</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>g</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_def|fact"><span>fref_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.rel2p_def|fact"><span>rel2p_def</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>abs_def</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_2189..2194">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_cons|fact"><span class="entity_def" id="Sepref_Rules.fref_cons|thm"><span>fref_cons</span></span></span><span class="main"><span>:</span></span><span>  
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>]<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>→</span></a></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>c</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>c</span></span><span class="main"><span>,</span></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R'</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>a</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>R'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>c</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="main"><span>(</span></span><span class="bound"><span>c</span></span><span class="main"><span>,</span></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R'</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="bound"><span>a</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>[</span></a></span><span class="free"><span>Q</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>]<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>R'</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>→</span></a></span><span> </span><span class="free"><span>S'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_2189..2194"><span>assms</span></a><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_def|fact"><span>fref_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_cons&apos;|fact"><span class="entity_def" id="Sepref_Rules.fref_cons&apos;|thm"><span>fref_cons'</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_cons|fact"><span>fref_cons</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> _ _ </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_refl|fact"><span>order_refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_refl|fact"><span>order_refl</span></a><span class="main"><span>]</span></span><span>  

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_2515..2520">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.frefI|fact"><span class="entity_def" id="Sepref_Rules.frefI|thm"><span>frefI</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.intro|attribute"><span class="operator"><span>intro</span></span></a><span class="main"><span class="main"><span class="main"><span class="main"><span>?</span></span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span class="main"><span>,</span></span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>g</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>S</span></span><span> </span><span class="bound"><span>y</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_2515..2520"><span>assms</span></a><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_def|fact"><span>fref_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_ncI|fact"><span class="entity_def" id="Sepref_Rules.fref_ncI|thm"><span>fref_ncI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span class="free"><span>S</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.freftnd|const"><span>→<span class="hidden">⇩</span><sub>f</sub></span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.frefI|fact"><span>frefI</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Param_Tool.html#Param_Tool.parametricity|method"><span class="operator"><span>parametricity</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_2775..2780">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.frefD|fact"><span class="entity_def" id="Sepref_Rules.frefD|thm"><span>frefD</span></span></span><span class="main"><span>:</span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span class="free"><span>P</span></span><span> </span><span class="free"><span>y</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>x</span></span><span class="main"><span>,</span></span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>g</span></span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>S</span></span><span> </span><span class="free"><span>y</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_2775..2780"><span>assms</span></a><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_def|fact"><span>fref_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_ncD|fact"><span class="entity_def" id="Sepref_Rules.fref_ncD|thm"><span>fref_ncD</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.freftnd|const"><span>→<span class="hidden">⇩</span><sub>f</sub></span></a></span><span class="free"><span>S</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relI|fact"><span>fun_relI</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>drule</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.frefD|fact"><span>frefD</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>assumption</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>


      
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Rules.rr_comp_def|fact"><span class="entity_def" id="Sepref_Rules.rr_comp_def|thm"><span class="entity_def" id="Sepref_Rules.rr_comp_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Rules.rr_comp|const"><span>rr_comp</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R1</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R2</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.non_dep|const"><span>non_dep</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>R1</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R1</span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.undefined|const"><span>undefined</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.relcomp|const"><span>O</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R2</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Complete_Lattices.html#Complete_Lattices.Union|const"><span>⋃</span></a></span><span class="main"><span>{</span></span><span class="free"><span class="bound"><span class="entity"><span>R1</span></span></span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>y</span></span><span class="main"><span>,</span></span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.relcomp|const"><span>O</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R2</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span>"</span></span></span><span>  
    
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.rr_comp_K|fact"><span class="entity_def" id="Sepref_Rules.rr_comp_K|thm"><span>rr_comp_K</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.rr_comp|const"><span>rr_comp</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>R1</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>R2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>R1</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.relcomp|const"><span>O</span></a></span><span> </span><span class="free"><span>R2</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.rr_comp_def|fact"><span>rr_comp_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.fun_eq_iff|fact"><span>fun_eq_iff</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.rr_comp_nondep|fact"><span class="entity_def" id="Sepref_Rules.rr_comp_nondep|thm"><span>rr_comp_nondep</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.rr_comp|const"><span>rr_comp</span></a><span> </span><span class="free"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.relcomp|const"><span>O</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.rr_comp_def|fact"><span>rr_comp_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.fun_eq_iff|fact"><span>fun_eq_iff</span></a><span class="main"><span>)</span></span><span>
    
      
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_compI|fact"><span class="entity_def" id="Sepref_Rules.fref_compI|thm"><span>fref_compI</span></span></span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>R1</span></span><span> </span><span class="free"><span>R2</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.relcomp|const"><span>O</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>S1</span></span><span> </span><span class="free"><span>S2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span>
      </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>y</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>y</span></span><span class="main"><span>,</span></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>S1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>R1</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.relcomp|const"><span>O</span></a></span><span> </span><span class="free"><span>S1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.rr_comp|const"><span>rr_comp</span></a><span> </span><span class="free"><span>S1</span></span><span> </span><span class="free"><span>R2</span></span><span> </span><span class="free"><span>S2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_def|fact"><span>fref_def</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.rr_comp_def|fact"><span>rr_comp_def</span></a><span> 
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.non_dep|const"><span>non_dep</span></a><span> </span><span class="free"><span>R2</span></span><span>"</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.non_dep_simp|fact"><span>non_dep_simp</span></a><span class="main"><span class="main"><span>[</span></span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>R2</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
    
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_compI&apos;|fact"><span class="entity_def" id="Sepref_Rules.fref_compI&apos;|thm"><span>fref_compI'</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>R1</span></span><span> </span><span class="free"><span>R2</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>g</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>S1</span></span><span> </span><span class="free"><span>S2</span></span><span> </span><span class="main"><span>⟧</span></span><span> 
      </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>y</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>y</span></span><span class="main"><span>,</span></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>S1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>R1</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.relcomp|const"><span>O</span></a></span><span> </span><span class="free"><span>S1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.rr_comp|const"><span>rr_comp</span></a><span> </span><span class="free"><span>S1</span></span><span> </span><span class="free"><span>R2</span></span><span> </span><span class="free"><span>S2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_compI|fact"><span>fref_compI</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>P</span></span></span><span> </span><span class="quoted"><span class="free"><span>R1</span></span></span><span> </span><span class="quoted"><span class="free"><span>R2</span></span></span><span> </span><span class="quoted"><span class="free"><span>Q</span></span></span><span> </span><span class="quoted"><span class="free"><span>S1</span></span></span><span> </span><span class="quoted"><span class="free"><span>S2</span></span></span><span class="main"><span>]</span></span><span>   
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_unit_conv|fact"><span class="entity_def" id="Sepref_Rules.fref_unit_conv|thm"><span>fref_unit_conv</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>P</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.unit_rel|const"><span>unit_rel</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Unity|const"><span>()</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>c</span></span><span class="main"><span>,</span></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Unity|const"><span>()</span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span>   
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_def|fact"><span>fref_def</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_uncurry_conv|fact"><span class="entity_def" id="Sepref_Rules.fref_uncurry_conv|thm"><span>fref_uncurry_conv</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><span class="free"><span>c</span></span><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>R1</span></span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><span class="free"><span>R2</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>S</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>x1</span></span><span> </span><span class="bound"><span>y1</span></span><span> </span><span class="bound"><span>x2</span></span><span> </span><span class="bound"><span>y2</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>y1</span></span><span class="main"><span>,</span></span><span class="bound"><span>y2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x1</span></span><span class="main"><span>,</span></span><span class="bound"><span>y1</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x2</span></span><span class="main"><span>,</span></span><span class="bound"><span>y2</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>x1</span></span><span> </span><span class="bound"><span>x2</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="bound"><span>y1</span></span><span> </span><span class="bound"><span>y2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>y1</span></span><span class="main"><span>,</span></span><span class="bound"><span>y2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_def|fact"><span>fref_def</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_mono|fact"><span class="entity_def" id="Sepref_Rules.fref_mono|thm"><span>fref_mono</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span> </span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>R'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span> </span><span class="free"><span>R</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>⟧</span></span><span> 
    </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>P'</span></span><span> </span><span class="free"><span>R'</span></span><span> </span><span class="free"><span>S'</span></span><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_def|fact"><span>fref_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_composeI|fact"><span class="entity_def" id="Sepref_Rules.fref_composeI|thm"><span>fref_composeI</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_4438..4441">FR1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>R1</span></span><span> </span><span class="free"><span>R2</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_4476..4479">FR2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>g</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>S1</span></span><span> </span><span class="free"><span>S2</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_4514..4516">C1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_4547..4549">C2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="free"><span>P'</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>y</span></span><span class="main"><span>,</span></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>S1</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>y</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_4594..4596">R1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>R'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span> </span><span class="free"><span>R1</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.relcomp|const"><span>O</span></a></span><span> </span><span class="free"><span>S1</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_4625..4627">R2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="free"><span>P'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.rr_comp|const"><span>rr_comp</span></a><span> </span><span class="free"><span>S1</span></span><span> </span><span class="free"><span>R2</span></span><span> </span><span class="free"><span>S2</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_4684..4686">FH</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>f'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>f</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>h'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>h</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span class="main"><span>,</span></span><span class="free"><span>h'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>P'</span></span><span> </span><span class="free"><span>R'</span></span><span> </span><span class="free"><span>S'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_4684..4686"><span>FH</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set_mp|fact"><span>set_mp</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_mono|fact"><span>fref_mono</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_compI&apos;|fact"><span>fref_compI'</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_4438..4441"><span>FR1</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_4476..4479"><span>FR2</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_4514..4516"><span>C1</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_4547..4549"><span>C2</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_4594..4596"><span>R1</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_4625..4627"><span>R2</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_triv|fact"><span class="entity_def" id="Sepref_Rules.fref_triv|thm"><span>fref_triv</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.frefnd|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.frefnd|const"><span>]<span class="hidden">⇩</span><sub>f</sub></span></a></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.frefnd|const"><span>→</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_def|fact"><span>fref_def</span></a><span class="main"><span>)</span></span><span>


  </span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Heap-Function Refinement›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹
    The following relates a heap-function with a pure function.
    It contains a precondition, a refinement assertion for the arguments
    before and after execution, and a refinement relation for the result.
    ›</span></span></span><span>
  </span><span class="comment1"><span>(* TODO: We only use this with keep/destroy information, so we could model
    the parameter relations as such (('a⇒'ai ⇒ assn) × bool) *)</span></span><span>
    
    
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Rules.hfref_def|fact"><span class="entity_def" id="Sepref_Rules.hfref_def|thm"><span class="entity_def" id="Sepref_Rules.hfref_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Rules.hfref|const"><span>hfref</span></span></span><span> 
    </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"
      </span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span class="main"><span>)</span></span><span> 
   </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'ai</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span class="main"><span>)</span></span><span> 
   </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'ai</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'ai</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 
   </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'bi</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span>
   </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'ai</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'bi</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span class="main"><span>)</span></span><span> 
   </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'ai</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'bi</span></span><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span class="main"><span>⇒</span></span><span class="tfree"><span>'b</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span>
   </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword1"><span>[</span></span><span>_</span><span class="keyword1"><span>]<span class="hidden">⇩</span><sub>a</sub></span></span><span> </span><span class="keyword1"><span>[</span></span><span>_</span><span class="keyword1"><span>]<span class="hidden">⇩</span><sub>c</sub></span></span><span> _ </span><span class="keyword1"><span>→<span class="hidden">⇩</span><sub>d</sub></span></span><span> _ </span><span class="keyword1"><span>[</span></span><span>_</span><span class="keyword1"><span>]<span class="hidden">⇩</span><sub>c</sub></span></span><span>"</span></span><span> </span><span class="main"><span>[</span></span><span>0</span><span class="main"><span>,</span></span><span>0</span><span class="main"><span>,</span></span><span>60</span><span class="main"><span>,</span></span><span>60</span><span class="main"><span>,</span></span><span>0</span><span class="main"><span>]</span></span><span> 60</span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span class="free"><span>[</span></span></span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span class="keyword1"><span class="free"><span>]<span class="hidden">⇩</span><sub>a</sub></span></span></span><span> </span><span class="main"><span class="free"><span>[</span></span></span><span class="free"><span class="bound"><span class="entity"><span>C</span></span></span></span><span class="keyword1"><span class="free"><span>]<span class="hidden">⇩</span><sub>c</sub></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>RS</span></span></span></span><span> </span><span class="keyword1"><span class="free"><span>→<span class="hidden">⇩</span><sub>d</sub></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>T</span></span></span></span><span> </span><span class="main"><span class="free"><span>[</span></span></span><span class="free"><span class="bound"><span class="entity"><span>CP</span></span></span></span><span class="keyword1"><span class="free"><span>]<span class="hidden">⇩</span><sub>c</sub></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>f</span></span><span class="main"><span>,</span></span><span class="bound"><span>g</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>.</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>c</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span>  </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>C</span></span></span></span><span> </span><span class="bound"><span>c</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>RS</span></span></span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>f</span></span><span> </span><span class="bound"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>RS</span></span></span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>T</span></span></span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>CP</span></span></span></span><span> </span><span class="bound"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>g</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
    
    

  </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Rules.hfrefcpt|const"><span>hfrefcpt</span></span></span><span> </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword1"><span>[</span></span><span>_</span><span class="keyword1"><span>]<span class="hidden">⇩</span><sub>a</sub></span></span><span> _ </span><span class="keyword1"><span>→<span class="hidden">⇩</span><sub>d</sub></span></span><span> _"</span></span><span> </span><span class="main"><span>[</span></span><span>0</span><span class="main"><span>,</span></span><span>60</span><span class="main"><span>,</span></span><span>60</span><span class="main"><span>]</span></span><span> 60</span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span class="free"><span>[</span></span></span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span class="keyword1"><span class="free"><span>]<span class="hidden">⇩</span><sub>a</sub></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>RS</span></span></span></span><span> </span><span class="keyword1"><span class="free"><span>→<span class="hidden">⇩</span><sub>d</sub></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>T</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>RS</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>T</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Rules.hfrefpt|const"><span>hfrefpt</span></span></span><span> </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword1"><span>[</span></span><span>_</span><span class="keyword1"><span>]<span class="hidden">⇩</span><sub>c</sub></span></span><span> _ </span><span class="keyword1"><span>→<span class="hidden">⇩</span><sub>d</sub></span></span><span> _ </span><span class="keyword1"><span>[</span></span><span>_</span><span class="keyword1"><span>]<span class="hidden">⇩</span><sub>c</sub></span></span><span>"</span></span><span> </span><span class="main"><span>[</span></span><span>0</span><span class="main"><span>,</span></span><span>60</span><span class="main"><span>,</span></span><span>60</span><span class="main"><span>,</span></span><span>0</span><span class="main"><span>]</span></span><span> 60</span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span class="free"><span>[</span></span></span><span class="free"><span class="bound"><span class="entity"><span>C</span></span></span></span><span class="keyword1"><span class="free"><span>]<span class="hidden">⇩</span><sub>c</sub></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>RS</span></span></span></span><span> </span><span class="keyword1"><span class="free"><span>→<span class="hidden">⇩</span><sub>d</sub></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>T</span></span></span></span><span> </span><span class="main"><span class="free"><span>[</span></span></span><span class="free"><span class="bound"><span class="entity"><span>CP</span></span></span></span><span class="keyword1"><span class="free"><span>]<span class="hidden">⇩</span><sub>c</sub></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span class="bound"><span class="entity"><span>C</span></span></span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>RS</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>T</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span class="bound"><span class="entity"><span>CP</span></span></span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Rules.hfreftt|const"><span>hfreftt</span></span></span><span> </span><span class="main"><span>(</span></span><span class="quoted"><span>"_ </span><span class="keyword1"><span>→<span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub></span></span><span> _"</span></span><span> </span><span class="main"><span>[</span></span><span>60</span><span class="main"><span>,</span></span><span>60</span><span class="main"><span>]</span></span><span> 60</span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="bound"><span class="entity"><span>RS</span></span></span></span><span> </span><span class="keyword1"><span class="free"><span>→<span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>T</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefcpt|const"><span>[</span></a></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefcpt|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>RS</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefcpt|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>T</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Rules.hfrefcptnd|const"><span>hfrefcptnd</span></span></span><span> </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword1"><span>[</span></span><span>_</span><span class="keyword1"><span>]<span class="hidden">⇩</span><sub>a</sub></span></span><span> _ </span><span class="keyword1"><span>→</span></span><span> _"</span></span><span> </span><span class="main"><span>[</span></span><span>0</span><span class="main"><span>,</span></span><span>60</span><span class="main"><span>,</span></span><span>60</span><span class="main"><span>]</span></span><span> 60</span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span class="free"><span>[</span></span></span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span class="keyword1"><span class="free"><span>]<span class="hidden">⇩</span><sub>a</sub></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>RS</span></span></span></span><span> </span><span class="main"><span class="free"><span>→</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>T</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefcpt|const"><span>[</span></a></span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefcpt|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>RS</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefcpt|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>T</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Rules.hfrefptnd|const"><span>hfrefptnd</span></span></span><span> </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword1"><span>[</span></span><span>_</span><span class="keyword1"><span>]<span class="hidden">⇩</span><sub>c</sub></span></span><span> _ </span><span class="keyword1"><span>→</span></span><span> _ </span><span class="keyword1"><span>[</span></span><span>_</span><span class="keyword1"><span>]<span class="hidden">⇩</span><sub>c</sub></span></span><span>"</span></span><span> </span><span class="main"><span>[</span></span><span>0</span><span class="main"><span>,</span></span><span>60</span><span class="main"><span>,</span></span><span>60</span><span class="main"><span>,</span></span><span>0</span><span class="main"><span>]</span></span><span> 60</span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span class="free"><span>[</span></span></span><span class="free"><span class="bound"><span class="entity"><span>C</span></span></span></span><span class="keyword1"><span class="free"><span>]<span class="hidden">⇩</span><sub>c</sub></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>RS</span></span></span></span><span> </span><span class="main"><span class="free"><span>→</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>T</span></span></span></span><span> </span><span class="main"><span class="free"><span>[</span></span></span><span class="free"><span class="bound"><span class="entity"><span>CP</span></span></span></span><span class="keyword1"><span class="free"><span>]<span class="hidden">⇩</span><sub>c</sub></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefpt|const"><span>[</span></a></span><span class="free"><span class="bound"><span class="entity"><span>C</span></span></span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefpt|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>RS</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefpt|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>T</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefpt|const"><span>[</span></a></span><span class="free"><span class="bound"><span class="entity"><span>CP</span></span></span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefpt|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Rules.hfrefttnd|const"><span>hfrefttnd</span></span></span><span> </span><span class="main"><span>(</span></span><span class="quoted"><span>"_ </span><span class="keyword1"><span>→<span class="hidden">⇩</span><sub>a</sub></span></span><span> _"</span></span><span> </span><span class="main"><span>[</span></span><span>60</span><span class="main"><span>,</span></span><span>60</span><span class="main"><span>]</span></span><span> 60</span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="bound"><span class="entity"><span>RS</span></span></span></span><span> </span><span class="keyword1"><span class="free"><span>→<span class="hidden">⇩</span><sub>a</sub></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>T</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>RS</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfreftt|const"><span>→<span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>T</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_6464..6469">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfrefI|fact"><span class="entity_def" id="Sepref_Rules.hfrefI|thm"><span>hfrefI</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.intro|attribute"><span class="operator"><span>intro</span></span></a><span class="main"><span class="main"><span class="main"><span class="main"><span>?</span></span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>c</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="bound"><span>c</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span>RS</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span>RS</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>T</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span> </span><span class="bound"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>g</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>hfref</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="free"><span>RS</span></span><span> </span><span class="free"><span>T</span></span><span> </span><span class="free"><span>CP</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_6464..6469"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_def|fact"><span>hfref_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_6664..6669">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfrefD|fact"><span class="entity_def" id="Sepref_Rules.hfrefD|thm"><span>hfrefD</span></span></span><span class="main"><span>:</span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>hfref</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="free"><span>RS</span></span><span> </span><span class="free"><span>T</span></span><span> </span><span class="free"><span>CP</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>c</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="bound"><span>c</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span>RS</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span>RS</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>T</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span> </span><span class="bound"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>g</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_6664..6669"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_def|fact"><span>hfref_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfref_to_ASSERT_conv|fact"><span class="entity_def" id="Sepref_Rules.hfref_to_ASSERT_conv|thm"><span>hfref_to_ASSERT_conv</span></span></span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.NO_MATCH|const"><span>NO_MATCH</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>a</span></span><span class="main"><span>,</span></span><span class="free"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>a</span></span><span class="main"><span>,</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefpt|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefpt|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefpt|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefpt|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefpt|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_def|fact"><span>hfref_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.safe|method"><span class="operator"><span>safe</span></span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span class="main"><span class="keyword3"><span>?</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_nofailI|fact"><span>hn_refine_nofailI</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> xc xa
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>drule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.spec|fact"><span>spec</span></a><span class="main"><span class="main"><span>[</span></span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>xc</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>drule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.spec|fact"><span>spec</span></a><span class="main"><span class="main"><span>[</span></span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>xa</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
    
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹
    A pair of argument refinement assertions can be created by the 
    input assertion and the information whether the parameter is kept or destroyed
    by the function.
    ›</span></span></span><span>  
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Rules.hf_pres.simps|fact"><span class="entity_def" id="Sepref_Rules.hf_pres_def|fact"><span class="entity_def" id="Sepref_Rules.hf_pres.simps(2)|thm"><span class="entity_def" id="Sepref_Rules.hf_pres.simps(1)|thm"><span class="entity_def" id="Sepref_Rules.hf_pres_def|thm"><span class="entity_def" id="Sepref_Rules.hf_pres_def|axiom"><span>primrec</span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity_def" id="Sepref_Rules.hf_pres|const"><span>hf_pres</span></span></span></span><span> 
    </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span class="main"><span>(</span></span></span><span class="tfree"><span class="tfree"><span>'a</span></span></span><span> </span><span class="main"><span class="main"><span>⇒</span></span></span><span> </span><span class="tfree"><span class="tfree"><span>'b</span></span></span><span> </span><span class="main"><span class="main"><span>⇒</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a></a><span class="main"><span class="main"><span>)</span></span></span><span> </span><span class="main"><span class="main"><span>⇒</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a></a><span> </span><span class="main"><span class="main"><span>⇒</span></span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span class="tfree"><span class="tfree"><span>'a</span></span></span><span> </span><span class="main"><span class="main"><span>⇒</span></span></span><span> </span><span class="tfree"><span class="tfree"><span>'b</span></span></span><span> </span><span class="main"><span class="main"><span>⇒</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a></a><span class="main"><span class="main"><span>)</span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span></a></span><span class="main"><span class="main"><span>(</span></span></span><span class="tfree"><span class="tfree"><span>'a</span></span></span><span> </span><span class="main"><span class="main"><span>⇒</span></span></span><span> </span><span class="tfree"><span class="tfree"><span>'b</span></span></span><span> </span><span class="main"><span class="main"><span>⇒</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a></a><span class="main"><span class="main"><span>)</span></span></span><span>"</span></span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> 
      </span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="free"><span>hf_pres</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span></a></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span class="free"><span class="bound"><span class="entity"><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span></span></span></span><span class="main"><span class="main"><span>,</span></span></span><span class="free"><span class="bound"><span class="entity"><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span></span></span></span><span class="main"><span class="main"><span>)</span></span></span><span>"</span></span></span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="free"><span>hf_pres</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span></a></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span class="free"><span class="bound"><span class="entity"><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span></span></span></span><span class="main"><span class="main"><span>,</span></span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.invalid_assn|const"><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.invalid_assn|const"><span>invalid_assn</span></a></a><span> </span><span class="free"><span class="bound"><span class="entity"><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span></span></span></span><span class="main"><span class="main"><span>)</span></span></span><span>"</span></span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Rules.hfkeep|const"><span>hfkeep</span></span></span><span> 
    </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword3"><span>(</span></span><span>_</span><span class="keyword1"><span><span class="hidden">⇧</span><sup>k</sup></span></span><span class="keyword3"><span>)</span></span><span>"</span></span><span> </span><span class="main"><span>[</span></span><span>1000</span><span class="main"><span>]</span></span><span> 999</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span class="keyword1"><span class="free"><span><span class="hidden">⇧</span><sup>k</sup></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hf_pres|const"><span>hf_pres</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Rules.hfdrop|const"><span>hfdrop</span></span></span><span> 
    </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword3"><span>(</span></span><span>_</span><span class="keyword1"><span><span class="hidden">⇧</span><sup>d</sup></span></span><span class="keyword3"><span>)</span></span><span>"</span></span><span> </span><span class="main"><span>[</span></span><span>1000</span><span class="main"><span>]</span></span><span> 999</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span class="keyword1"><span class="free"><span><span class="hidden">⇧</span><sup>d</sup></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hf_pres|const"><span>hf_pres</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Rules.hn_kede|const"><span>hn_kede</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>kd</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hf_pres|const"><span>hf_pres</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>kd</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Rules.hn_keep|const"><span>hn_keep</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hn_kede|const"><span>hn_kede</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Rules.hn_dest|const"><span>hn_dest</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hn_kede|const"><span>hn_kede</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.keep_drop_sels|fact"><span class="entity_def" id="Sepref_Rules.keep_drop_sels(4)|thm"><span class="entity_def" id="Sepref_Rules.keep_drop_sels(3)|thm"><span class="entity_def" id="Sepref_Rules.keep_drop_sels(2)|thm"><span class="entity_def" id="Sepref_Rules.keep_drop_sels(1)|thm"><span>keep_drop_sels</span></span></span></span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>  
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfkeep|const"><span><span class="hidden">⇧</span><sup>k</sup></span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfkeep|const"><span><span class="hidden">⇧</span><sup>k</sup></span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfdrop|const"><span><span class="hidden">⇧</span><sup>d</sup></span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfdrop|const"><span><span class="hidden">⇧</span><sup>d</sup></span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.invalid_assn|const"><span>invalid_assn</span></a><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hf_pres_fst|fact"><span class="entity_def" id="Sepref_Rules.hf_pres_fst|thm"><span>hf_pres_fst</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hf_pres|const"><span>hf_pres</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="free"><span>k</span></span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹
    The following operator combines multiple argument assertion-pairs to
    argument assertion-pairs for the product. It is required to state
    argument assertion-pairs for uncurried functions.
    ›</span></span></span><span>  
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Rules.hfprod_def|fact"><span class="entity_def" id="Sepref_Rules.hfprod_def|thm"><span class="entity_def" id="Sepref_Rules.hfprod_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Rules.hfprod|const"><span>hfprod</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 
    </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'c</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'d</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span class="main"><span>(</span></span><span class="tfree"><span>'c</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'d</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span class="tfree"><span>'c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'d</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span class="tfree"><span>'c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'d</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>infixl</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword1"><span>*<span class="hidden">⇩</span><sub>a</sub></span></span><span>"</span></span><span> 65</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="bound"><span class="entity"><span>RR</span></span></span></span><span> </span><span class="keyword1"><span class="free"><span>*<span class="hidden">⇩</span><sub>a</sub></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>SS</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.prod_assn|const"><span>prod_assn</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>RR</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>SS</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.prod_assn|const"><span>prod_assn</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>RR</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>SS</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfprod_fst_snd|fact"><span class="entity_def" id="Sepref_Rules.hfprod_fst_snd(2)|thm"><span class="entity_def" id="Sepref_Rules.hfprod_fst_snd(1)|thm"><span>hfprod_fst_snd</span></span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.prod_assn|const"><span>prod_assn</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.prod_assn|const"><span>prod_assn</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfprod_def|fact"><span>hfprod_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>



  </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Conversion from fref to hfref›</span></span></span><span>  
  </span><span class="comment1"><span>(* TODO: Variant of import-param! Automate this! *)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_9052..9057">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_to_pure_hfref&apos;|fact"><span class="entity_def" id="Sepref_Rules.fref_to_pure_hfref&apos;|thm"><span>fref_to_pure_hfref'</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.frefnd|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.frefnd|const"><span>]<span class="hidden">⇩</span><sub>f</sub></span></a></span><span> </span><span class="free"><span>R</span></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.frefnd|const"><span>→</span></a></span><span class="main"><span>(</span></span><span class="main"><span>⟨</span></span><span class="free"><span>S</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Domain|const"><span>Domain</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.inter|const"><span>∩</span></a></span><span> </span><span class="free"><span>R</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.converse|const"><span>¯</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Image|const"><span>``</span></a></span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.Collect|const"><span>Collect</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><span class="free"><span>f'</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefcpt|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefcpt|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure|const"><span>pure</span></a><span> </span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfkeep|const"><span><span class="hidden">⇧</span><sup>k</sup></span></a></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefcpt|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure|const"><span>pure</span></a><span> </span><span class="free"><span>S</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  
    </span><span class="keyword1"><span class="command"><span>{</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>c</span></span><span> </span><span class="skolem"><span>a</span></span><span>
      </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span>A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="skolem"><span>a</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nofail|const"><span>nofail</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>g</span></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="skolem"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f'</span></span><span> </span><span class="skolem"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>g</span></span><span> </span><span class="skolem"><span>a</span></span><span>"</span></span></span><span> 
        </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_9052..9057"><span>assms</span></a><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_def|fact"><span>fref_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pw_le_iff|fact"><span>pw_le_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pw_nres_rel_iff|fact"><span>pw_nres_rel_iff</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span class="main"><span>)</span></span><span>
        
      </span><span class="comment1"><span>(*hence "ENTAILS F ((↑((c, a) ∈ R) ∧* (λs. ∃x. (↑((f' c, x) ∈ S) ∧* ↑(RETURN x ≤ g a)) s)) ∧* F)" 
        for F :: assn 
        using A by vcg
      *)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_9660..9661">}</span></span></span><span> </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="entity_def" id="offset_9667..9670">AUX</span><span class="main"><span>=</span></span><a class="entity_ref" href="Sepref_Rules.html#offset_9660..9661"><span>this</span></a><span> 
    
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefI|fact"><span>hfrefI</span></a><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refineI|fact"><span>hn_refineI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure_def|fact"><span>pure_def</span></a><span> 
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg|method"><span class="operator"><span>vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>frule</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_9667..9670"><span>AUX</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg|method"><span class="operator"><span>vcg</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>      


  </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Conversion from hfref to hnr›</span></span></span><span>  
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹This section contains the lemmas. The ML code is further down. ›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_9981..9986">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hf2hnr|fact"><span class="entity_def" id="Sepref_Rules.hf2hnr|thm"><span>hf2hnr</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>xi</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_empty|const"><span>□</span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>xi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_empty|const"><span>□</span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>S</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span> </span><span class="bound"><span>xi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>g</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_9981..9986"><span>assms</span></a><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_def|fact"><span>hfref_def</span></a><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span class="main"><span>)</span></span><span>

  </span><span class="comment1"><span>(* Products that stem from currying are tagged by a special refinement relation *)</span></span><span>  
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Rules.to_hnr_prod_def|fact"><span class="entity_def" id="Sepref_Rules.to_hnr_prod_def|thm"><span class="entity_def" id="Sepref_Rules.to_hnr_prod_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Rules.to_hnr_prod|const"><span>to_hnr_prod</span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.prod_assn|const"><span>prod_assn</span></a><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.to_hnr_prod_fst_snd|fact"><span class="entity_def" id="Sepref_Rules.to_hnr_prod_fst_snd(2)|thm"><span class="entity_def" id="Sepref_Rules.to_hnr_prod_fst_snd(1)|thm"><span>to_hnr_prod_fst_snd</span></span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.to_hnr_prod|const"><span>to_hnr_prod</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.to_hnr_prod|const"><span>to_hnr_prod</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfprod_def|fact"><span>hfprod_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  </span><span class="comment1"><span>(* Warning: This lemma is carefully set up to be applicable as an unfold rule,
    for more than one level of uncurrying*)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hnr_uncurry_unfold|fact"><span class="entity_def" id="Sepref_Rules.hnr_uncurry_unfold|thm"><span>hnr_uncurry_unfold</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"
    </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>xi</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> 
      </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> 
        </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.to_hnr_prod|const"><span>to_hnr_prod</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>Γ</span></span><span class="main"><span>)</span></span><span> 
        </span><span class="main"><span>(</span></span><span class="free"><span>fi</span></span><span> </span><span class="bound"><span>xi</span></span><span class="main"><span>)</span></span><span> 
        </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.to_hnr_prod|const"><span>to_hnr_prod</span></a><span> </span><span class="free"><span>A'</span></span><span> </span><span class="free"><span>B'</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>Γ'</span></span><span class="main"><span>)</span></span><span> 
        </span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span> </span><span class="bound"><span>xi</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>bi</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span>
      </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> 
        </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>B</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>bi</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>Γ</span></span><span class="main"><span>)</span></span><span> 
        </span><span class="main"><span>(</span></span><span class="free"><span>fi</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>ai</span></span><span class="main"><span>,</span></span><span class="bound"><span>bi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 
        </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>A'</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>B'</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>bi</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>Γ'</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>ai</span></span><span class="main"><span>,</span></span><span class="bound"><span>bi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.prod_assn_def|fact"><span>prod_assn_def</span></a><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_conj_c|fact"><span>sep_conj_c</span></a><span class="main"><span>)</span></span><span>
    
  </span><span class="comment1"><span>(*  
  lemma hnr_intro_dummy:
    "∀x xi. P x ⟶ hn_refine (Γ x xi) (c xi) (Γ' x xi) (R x) (a x) ⟹ ∀x xi. P x ⟶ hn_refine (Γ x xi ** □) (c xi) (Γ' x xi ** □) (R x) (a x)" 
    by simp
  *)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hn_ctxt_ctxt_fix_conv|fact"><span class="entity_def" id="Sepref_Rules.hn_ctxt_ctxt_fix_conv|thm"><span>hn_ctxt_ctxt_fix_conv</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>abs_def</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.uncurry_APP|fact"><span class="entity_def" id="Sepref_Rules.uncurry_APP|thm"><span>uncurry_APP</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><span class="free"><span>f</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="free"><span>a</span></span><span class="main"><span>,</span></span><span class="free"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>f</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>a</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>b</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  </span><span class="comment1"><span>(* TODO: Replace by more general rule. *)</span></span><span>  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.norm_RETURN_o|fact"><span class="entity_def" id="Sepref_Rules.norm_RETURN_o(5)|thm"><span class="entity_def" id="Sepref_Rules.norm_RETURN_o(4)|thm"><span class="entity_def" id="Sepref_Rules.norm_RETURN_o(3)|thm"><span class="entity_def" id="Sepref_Rules.norm_RETURN_o(2)|thm"><span class="entity_def" id="Sepref_Rules.norm_RETURN_o(1)|thm"><span>norm_RETURN_o</span></span></span></span></span></span></span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><span class="bound"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="bound"><span>f</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.comp2|const"><span>oo</span></a></span><span> </span><span class="bound"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="bound"><span>f</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.comp3|const"><span>ooo</span></a></span><span> </span><span class="bound"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>y</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>z</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="bound"><span>f</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>y</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.comp3|const"><span>ooo</span></a></span><span> </span><span class="bound"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>y</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>z</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="bound"><span>f</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>y</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>z</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.comp3|const"><span>ooo</span></a></span><span> </span><span class="bound"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>y</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>z</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>a</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="bound"><span>f</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>y</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>z</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>a</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.norm_return_o|fact"><span class="entity_def" id="Sepref_Rules.norm_return_o(5)|thm"><span class="entity_def" id="Sepref_Rules.norm_return_o(4)|thm"><span class="entity_def" id="Sepref_Rules.norm_return_o(3)|thm"><span class="entity_def" id="Sepref_Rules.norm_return_o(2)|thm"><span class="entity_def" id="Sepref_Rules.norm_return_o(1)|thm"><span>norm_return_o</span></span></span></span></span></span></span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>return</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><span class="bound"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>return</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="bound"><span>f</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>return</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.comp2|const"><span>oo</span></a></span><span> </span><span class="bound"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>return</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="bound"><span>f</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>return</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.comp3|const"><span>ooo</span></a></span><span> </span><span class="bound"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>y</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>z</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>return</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="bound"><span>f</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>y</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>return</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.comp3|const"><span>ooo</span></a></span><span> </span><span class="bound"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>y</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>z</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>return</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="bound"><span>f</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>y</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>z</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>return</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.comp3|const"><span>ooo</span></a></span><span> </span><span class="bound"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>y</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>z</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>a</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>return</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="bound"><span>f</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>y</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>z</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>a</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hn_val_unit_conv_emp|fact"><span class="entity_def" id="Sepref_Rules.hn_val_unit_conv_emp|thm"><span>hn_val_unit_conv_emp</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_val|const"><span>hn_val</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.unit_rel|const"><span>unit_rel</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_empty|const"><span>□</span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure_def|fact"><span>pure_def</span></a><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Conversion from hnr to hfref›</span></span></span><span>  
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹This section contains the lemmas. The ML code is further down. ›</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Rules.id_assn|const"><span>id_assn</span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure|const"><span>pure</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Rules.unit_assn|const"><span>unit_assn</span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.id_assn|const"><span>id_assn</span></a><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.unit|type"><span>unit</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>_</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.pure_unit_rel_eq_empty|fact"><span class="entity_def" id="Sepref_Rules.pure_unit_rel_eq_empty|thm"><span>pure_unit_rel_eq_empty</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.unit_assn|const"><span>unit_assn</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_empty|const"><span>□</span></a></span><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure_def|fact"><span>pure_def</span></a><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.uc_hfprod_sel|fact"><span class="entity_def" id="Sepref_Rules.uc_hfprod_sel(2)|thm"><span class="entity_def" id="Sepref_Rules.uc_hfprod_sel(1)|thm"><span>uc_hfprod_sel</span></span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>case</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>a</span></span><span class="main"><span>,</span></span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span>of</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>a1</span></span><span class="main"><span>,</span></span><span class="bound"><span>a2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>c1</span></span><span class="main"><span>,</span></span><span class="bound"><span>c2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="bound"><span>a1</span></span><span> </span><span class="bound"><span>c1</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span>B</span></span><span> </span><span class="bound"><span>a2</span></span><span> </span><span class="bound"><span>c2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>case</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>a</span></span><span class="main"><span>,</span></span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span>of</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>a1</span></span><span class="main"><span>,</span></span><span class="bound"><span>a2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="bound"><span>c1</span></span><span class="main"><span>,</span></span><span class="bound"><span>c2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="bound"><span>a1</span></span><span> </span><span class="bound"><span>c1</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span>B</span></span><span> </span><span class="bound"><span>a2</span></span><span> </span><span class="bound"><span>c2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Conversion from relation to fref›</span></span></span><span>  
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹This section contains the lemmas. The ML code is further down. ›</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Rules.CURRY_def|fact"><span class="entity_def" id="Sepref_Rules.CURRY_def|thm"><span class="entity_def" id="Sepref_Rules.CURRY_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Rules.CURRY|const"><span>CURRY</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>f</span></span><span class="main"><span>,</span></span><span class="bound"><span>g</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><span class="bound"><span>f</span></span><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><span class="bound"><span>g</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_param1|fact"><span class="entity_def" id="Sepref_Rules.fref_param1|thm"><span>fref_param1</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>R</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>R</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.freftnd|const"><span>→<span class="hidden">⇩</span><sub>f</sub></span></a></span><span class="free"><span>S</span></span><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_def|fact"><span>fref_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_relD|fact"><span>fun_relD</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_nest|fact"><span class="entity_def" id="Sepref_Rules.fref_nest|thm"><span>fref_nest</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.frefnd|const"><span>[</span></a></span><span class="free"><span>P1</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.frefnd|const"><span>]<span class="hidden">⇩</span><sub>f</sub></span></a></span><span> </span><span class="free"><span>R1</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.frefnd|const"><span>→</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.frefnd|const"><span>[</span></a></span><span class="free"><span>P2</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.frefnd|const"><span>]<span class="hidden">⇩</span><sub>f</sub></span></a></span><span> </span><span class="free"><span>R2</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.frefnd|const"><span>→</span></a></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>)</span></span><span> 
    </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.CURRY|const"><span>CURRY</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.frefnd|const"><span>[</span></a></span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P1</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>P2</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.frefnd|const"><span>]<span class="hidden">⇩</span><sub>f</sub></span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>R1</span></span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><span class="free"><span>R2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.frefnd|const"><span>→</span></a></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq_reflection|fact"><span>eq_reflection</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_def|fact"><span>fref_def</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.CURRY_def|fact"><span>CURRY_def</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.in_CURRY_conv|fact"><span class="entity_def" id="Sepref_Rules.in_CURRY_conv|thm"><span>in_CURRY_conv</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.CURRY|const"><span>CURRY</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.CURRY_def|fact"><span>CURRY_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.uncurry0_APP|fact"><span class="entity_def" id="Sepref_Rules.uncurry0_APP|thm"><span>uncurry0_APP</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Misc.html#Sepref_Misc.uncurry0|const"><span>uncurry0</span></a><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>c</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_param0I|fact"><span class="entity_def" id="Sepref_Rules.fref_param0I|thm"><span>fref_param0I</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>c</span></span><span class="main"><span>,</span></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Misc.html#Sepref_Misc.uncurry0|const"><span>uncurry0</span></a><span> </span><span class="free"><span>c</span></span><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="Sepref_Misc.html#Sepref_Misc.uncurry0|const"><span>uncurry0</span></a><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.unit_rel|const"><span>unit_rel</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.freftnd|const"><span>→<span class="hidden">⇩</span><sub>f</sub></span></a></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_def|fact"><span>fref_def</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Composition›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Rules.hr_comp_def|fact"><span class="entity_def" id="Sepref_Rules.hr_comp_def|thm"><span class="entity_def" id="Sepref_Rules.hr_comp_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Rules.hr_comp|const"><span>hr_comp</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'c</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'a</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'c</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span>"</span></span></span><span>
    </span><span class="comment1"><span>― ‹Compose refinement assertion with refinement relation›</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hr_comp</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R1</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R2</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.pred_ex|const"><span>EXS</span></a></span><span> </span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.pred_ex|const"><span>.</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R1</span></span></span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>b</span></span><span class="main"><span>,</span></span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span class="bound"><span class="entity"><span>R2</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Rules.hrp_comp_def|fact"><span class="entity_def" id="Sepref_Rules.hrp_comp_def|thm"><span class="entity_def" id="Sepref_Rules.hrp_comp_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Rules.hrp_comp|const"><span>hrp_comp</span></span></span><span> 
    </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'d</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'d</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'c</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'d</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'a</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'c</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="comment1"><span>― ‹Compose argument assertion-pair with refinement relation›</span></span><span>    
    </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hrp_comp</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>RR'</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>RR'</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>RR'</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span class="main"><span>)</span></span><span> "</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hr_compI|fact"><span class="entity_def" id="Sepref_Rules.hr_compI|thm"><span>hr_compI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>b</span></span><span class="main"><span>,</span></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R2</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>R1</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="free"><span>R1</span></span><span> </span><span class="free"><span>R2</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="free"><span>c</span></span><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_def|fact"><span>hr_comp_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span> </span><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails_def|fact"><span>entails_def</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hr_comp_Id1|fact"><span class="entity_def" id="Sepref_Rules.hr_comp_Id1|thm"><span>hr_comp_Id1</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure|const"><span>pure</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure|const"><span>pure</span></a><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_def|fact"><span>hr_comp_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>abs_def</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure_def|fact"><span>pure_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.ext|fact"><span>ext</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift_extract_simps|fact"><span>pred_lift_extract_simps</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hr_comp_Id2|fact"><span class="entity_def" id="Sepref_Rules.hr_comp_Id2|thm"><span>hr_comp_Id2</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="free"><span>R</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_def|fact"><span>hr_comp_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>abs_def</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.ext|fact"><span>ext</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>
    
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hr_comp_emp|fact"><span class="entity_def" id="Sepref_Rules.hr_comp_emp|thm"><span>hr_comp_emp</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>c</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_empty|const"><span>□</span></a></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>b</span></span><span class="main"><span>,</span></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_def|fact"><span>hr_comp_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>abs_def</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.ext|fact"><span>ext</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hr_comp_prod_conv|fact"><span class="entity_def" id="Sepref_Rules.hr_comp_prod_conv|thm"><span>hr_comp_prod_conv</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.prod_assn|const"><span>prod_assn</span></a><span> </span><span class="free"><span>Ra</span></span><span> </span><span class="free"><span>Rb</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>Ra'</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><span> </span><span class="free"><span>Rb'</span></span><span class="main"><span>)</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.prod_assn|const"><span>prod_assn</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="free"><span>Ra</span></span><span> </span><span class="free"><span>Ra'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="free"><span>Rb</span></span><span> </span><span class="free"><span>Rb'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_def|fact"><span>hr_comp_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>abs_def</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.prod_assn_def|fact"><span>prod_assn_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>abs_def</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.ext|fact"><span>ext</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> 0 3 </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hr_comp_pure|fact"><span class="entity_def" id="Sepref_Rules.hr_comp_pure|thm"><span>hr_comp_pure</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure|const"><span>pure</span></a><span> </span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure|const"><span>pure</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.relcomp|const"><span>O</span></a></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.ext|fact"><span>ext</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_def|fact"><span>hr_comp_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>abs_def</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure_def|fact"><span>pure_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hr_comp_is_pure|fact"><span class="entity_def" id="Sepref_Rules.hr_comp_is_pure|thm"><span>hr_comp_is_pure</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.safe_constraint_rules|attribute"><span class="operator"><span>safe_constraint_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.is_pure|const"><span>is_pure</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.is_pure|const"><span>is_pure</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_pure|fact"><span>hr_comp_pure</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.is_pure_conv|fact"><span>is_pure_conv</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hr_comp_the_pure|fact"><span class="entity_def" id="Sepref_Rules.hr_comp_the_pure|thm"><span>hr_comp_the_pure</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.is_pure|const"><span>is_pure</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.the_pure|const"><span>the_pure</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.the_pure|const"><span>the_pure</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.relcomp|const"><span>O</span></a></span><span> </span><span class="free"><span>B</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.is_pure_conv|fact"><span>is_pure_conv</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_pure|fact"><span>hr_comp_pure</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.rdomp_hrcomp_conv|fact"><span class="entity_def" id="Sepref_Rules.rdomp_hrcomp_conv|thm"><span>rdomp_hrcomp_conv</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.rdomp|const"><span>rdomp</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span class="bound"><span>y</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.rdomp|const"><span>rdomp</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>y</span></span><span class="main"><span>,</span></span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.rdomp_def|fact"><span>rdomp_def</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_def|fact"><span>hr_comp_def</span></a><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hn_rel_compI|fact"><span class="entity_def" id="Sepref_Rules.hn_rel_compI|thm"><span>hn_rel_compI</span></span></span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nofail|const"><span>nofail</span></a><span> </span><span class="free"><span>a</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>b</span></span><span class="main"><span>,</span></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><span class="free"><span>R2</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_rel|const"><span>hn_rel</span></a><span> </span><span class="free"><span>R1</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_rel|const"><span>hn_rel</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="free"><span>R1</span></span><span> </span><span class="free"><span>R2</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="free"><span>c</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_def|fact"><span>hr_comp_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_rel_def|fact"><span>hn_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel_def|fact"><span>nres_rel_def</span></a><span> </span><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails_def|fact"><span>entails_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>drule</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ret_le_down_conv|fact"><span>ret_le_down_conv</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

  </span><span class="comment1"><span>(*  
  lemma hr_comp_precise[constraint_rules]:
    assumes [safe_constraint_rules]: "precise R"
    assumes SV: "single_valued S"
    shows "precise (hr_comp R S)"
    apply (rule preciseI)
    unfolding hr_comp_def
    apply clarsimp
    by (metis SV assms(1) preciseD single_valuedD)
  *)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hr_comp_assoc|fact"><span class="entity_def" id="Sepref_Rules.hr_comp_assoc|thm"><span>hr_comp_assoc</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>T</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>S</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.relcomp|const"><span>O</span></a></span><span> </span><span class="free"><span>T</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.ext|fact"><span>ext</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_def|fact"><span>hr_comp_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>

    
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hrp_comp_Id1|fact"><span class="entity_def" id="Sepref_Rules.hrp_comp_Id1|thm"><span>hrp_comp_Id1</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp|const"><span>hrp_comp</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hf_pres|const"><span>hf_pres</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure|const"><span>pure</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>pp</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hf_pres|const"><span>hf_pres</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure|const"><span>pure</span></a><span> </span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>pp</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp_def|fact"><span>hrp_comp_def</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="free"><span>pp</span></span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_def|fact"><span>hr_comp_def</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>abs_def</span></span><span class="main"><span class="main"><span>]</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.invalid_assn_def|fact"><span>invalid_assn_def</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>abs_def</span></span><span class="main"><span class="main"><span>]</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.fun_eq_iff|fact"><span>fun_eq_iff</span></a><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hrp_comp_Id2|fact"><span class="entity_def" id="Sepref_Rules.hrp_comp_Id2|thm"><span>hrp_comp_Id2</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp|const"><span>hrp_comp</span></a><span> </span><span class="free"><span>A</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp_def|fact"><span>hrp_comp_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_16605..16610">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hnr_comp_aux|fact"><span class="entity_def" id="Sepref_Rules.hnr_comp_aux|thm"><span>hnr_comp_aux</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>m</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nofail|const"><span>nofail</span></a><span> </span><span class="free"><span>m'</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>m</span></span><span class="main"><span>,</span></span><span class="free"><span>m'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><span class="free"><span>R</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>obtains</span></span></span><span> </span><span class="free"><span>x'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>x</span></span><span class="main"><span>,</span></span><span class="free"><span>x'</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span>x'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>m'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_16605..16610"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_16605..16610"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_16605..16610"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.inres_def|fact"><span>inres_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relD|fact"><span>nres_relD</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pwD2|fact"><span>pwD2</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pw_conc_inres|fact"><span>pw_conc_inres</span></a><span class="main"><span>)</span></span><span>
    
    
    
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Rules.hrr_comp_def|fact"><span class="entity_def" id="Sepref_Rules.hrr_comp_def|thm"><span class="entity_def" id="Sepref_Rules.hrr_comp_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Rules.hrr_comp|const"><span>hrr_comp</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R1</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R2</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> 
    </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.non_dep|const"><span>non_dep</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>R1</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span>
      </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>R1</span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.undefined|const"><span>undefined</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>R2</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span>
    </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span>
      </span><span class="keyword1"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.pred_ex|const"><span>EXS</span></a></span><span> </span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.pred_ex|const"><span>.</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="bound"><span>b</span></span><span class="main"><span>,</span></span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>R1</span></span></span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>R2</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>c</span></span></span></span><span>"</span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hnr_comp|fact"><span class="entity_def" id="Sepref_Rules.hnr_comp|thm"><span>hnr_comp</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_17029..17030">R</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>b1</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>b1</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>R1</span></span><span> </span><span class="bound"><span>b1</span></span><span> </span><span class="free"><span>c1</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>Γ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>c</span></span><span> </span><span class="free"><span>c1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>R1p</span></span><span> </span><span class="bound"><span>b1</span></span><span> </span><span class="free"><span>c1</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>Γ'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span> </span><span class="bound"><span>b1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>c1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>b</span></span><span> </span><span class="bound"><span>b1</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_17131..17132">S</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>a1</span></span><span> </span><span class="bound"><span>b1</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>a1</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>b1</span></span><span class="main"><span>,</span></span><span class="bound"><span>a1</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R1'</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>b</span></span><span> </span><span class="bound"><span>b1</span></span><span class="main"><span>,</span></span><span class="free"><span>a</span></span><span> </span><span class="bound"><span>a1</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><span class="free"><span>R'</span></span><span> </span><span class="bound"><span>a1</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_17206..17208">PQ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>a1</span></span><span> </span><span class="bound"><span>b1</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>a1</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>b1</span></span><span class="main"><span>,</span></span><span class="bound"><span>a1</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R1'</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>b1</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_17259..17260">Q</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>a1</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> 
      </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="free"><span>R1</span></span><span> </span><span class="free"><span>R1'</span></span><span> </span><span class="free"><span>a1</span></span><span> </span><span class="free"><span>c1</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>Γ</span></span><span class="main"><span>)</span></span><span> 
      </span><span class="main"><span>(</span></span><span class="free"><span>c</span></span><span> </span><span class="free"><span>c1</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="free"><span>R1p</span></span><span> </span><span class="free"><span>R1'</span></span><span> </span><span class="free"><span>a1</span></span><span> </span><span class="free"><span>c1</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>Γ'</span></span><span class="main"><span>)</span></span><span> 
      </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrr_comp|const"><span>hrr_comp</span></a><span> </span><span class="free"><span>R1'</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>R'</span></span><span> </span><span class="free"><span>a1</span></span><span class="main"><span>)</span></span><span> 
      </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>c1</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span class="free"><span>a</span></span><span> </span><span class="free"><span>a1</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>

    </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_rules|attribute"><span class="operator"><span>vcg_rules</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_17029..17030"><span>R</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refineD|fact"><span>hn_refineD</span></a><span class="main"><span>]</span></span><span>
    
    </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_17496..17500">have</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nofail|const"><span>nofail</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>b</span></span><span> </span><span class="skolem"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span>  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nofail|const"><span>nofail</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>a</span></span><span> </span><span class="free"><span>a1</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="skolem"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>a1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="free"><span>R1'</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="skolem"><span>x</span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_17496..17500"><span>that</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_17259..17260"><span>Q</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_17131..17132"><span>S</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel_def|fact"><span>nres_rel_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.pw_ref_iff|fact"><span>pw_ref_iff</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span>
    
      
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>      
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_alt|fact"><span>hn_refine_alt</span></a><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_def|fact"><span>hr_comp_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_rel_def|fact"><span>hn_rel_def</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrr_comp_def|fact"><span>hrr_comp_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.non_dep|const"><span>non_dep</span></a><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_17802..17807">prems</span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift_extract_simps|fact"><span>pred_lift_extract_simps</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_17206..17208"><span>PQ</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_17259..17260"><span>Q</span></a><span class="main"><span>]</span></span><span> 
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>supply</span></span></span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.non_dep_simp|fact"><span>non_dep_simp</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_17802..17807"><span>prems</span></a><span class="main"><span>]</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg|method"><span class="operator"><span>vcg</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>frule</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_17131..17132"><span>S</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_17259..17260"><span>Q</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>erule</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hnr_comp_aux|fact"><span>hnr_comp_aux</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_try_solve|method"><span class="operator"><span>vcg_try_solve</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span>  
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift_extract_simps|fact"><span>pred_lift_extract_simps</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_17206..17208"><span>PQ</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_17259..17260"><span>Q</span></a><span class="main"><span>]</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg|method"><span class="operator"><span>vcg</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>frule</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_17131..17132"><span>S</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_17259..17260"><span>Q</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>erule</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hnr_comp_aux|fact"><span>hnr_comp_aux</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_try_solve|method"><span class="operator"><span>vcg_try_solve</span></span></a><span>
        
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_18332..18337">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hnr_comp1_aux|fact"><span class="entity_def" id="Sepref_Rules.hnr_comp1_aux|thm"><span>hnr_comp1_aux</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>R</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>b1</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>b1</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>R1</span></span><span> </span><span class="bound"><span>b1</span></span><span> </span><span class="free"><span>c1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>c</span></span><span> </span><span class="free"><span>c1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>R1p</span></span><span> </span><span class="bound"><span>b1</span></span><span> </span><span class="free"><span>c1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span> </span><span class="bound"><span>b1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>c1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>b</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>b1</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>S</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>a1</span></span><span> </span><span class="bound"><span>b1</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>a1</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>b1</span></span><span class="main"><span>,</span></span><span class="bound"><span>a1</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R1'</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>b</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>b1</span></span><span class="main"><span>,</span></span><span class="free"><span>a</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>a1</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>⟨</span></span><span class="free"><span>R'</span></span><span> </span><span class="bound"><span>a1</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>PQ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>a1</span></span><span> </span><span class="bound"><span>b1</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>a1</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>b1</span></span><span class="main"><span>,</span></span><span class="bound"><span>a1</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R1'</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>b1</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>Q</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>a1</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> 
      </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="free"><span>R1</span></span><span> </span><span class="free"><span>R1'</span></span><span> </span><span class="free"><span>a1</span></span><span> </span><span class="free"><span>c1</span></span><span class="main"><span>)</span></span><span> 
      </span><span class="main"><span>(</span></span><span class="free"><span>c</span></span><span> </span><span class="free"><span>c1</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="free"><span>R1p</span></span><span> </span><span class="free"><span>R1'</span></span><span> </span><span class="free"><span>a1</span></span><span> </span><span class="free"><span>c1</span></span><span class="main"><span>)</span></span><span> 
      </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrr_comp|const"><span>hrr_comp</span></a><span> </span><span class="free"><span>R1'</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>R'</span></span><span> </span><span class="free"><span>a1</span></span><span class="main"><span>)</span></span><span> 
      </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>c1</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span class="free"><span>a</span></span><span> </span><span class="free"><span>a1</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_18332..18337"><span>assms</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hnr_comp|fact"><span>hnr_comp</span></a><span class="main"><span>[</span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> Γ</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_empty|const"><span>□</span></a></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>and</span></span></span></span><span> Γ'</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_empty|const"><span>□</span></a></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>and</span></span></span></span><span> a</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="free"><span>a</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>and</span></span></span></span><span> b</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="free"><span>b</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>and</span></span></span></span><span> c</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="free"><span>c</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>and</span></span></span></span><span> P</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="free"><span>P</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>and</span></span></span></span><span> Q</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="free"><span>Q</span></span></span><span class="main"><span>]</span></span><span>  
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_18892..18897">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfcomp|fact"><span class="entity_def" id="Sepref_Rules.hfcomp|thm"><span>hfcomp</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>B</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>g</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>[</span></a></span><span class="free"><span>Q</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>]<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>T</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>→</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟨</span></span><span class="free"><span>U</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="main"><span>λ</span></span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>a'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>a'</span></span><span class="main"><span>,</span></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>T</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>a'</span></span><span class="main"><span>)</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>
      </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp|const"><span>hrp_comp</span></a><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="free"><span>T</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrr_comp|const"><span>hrr_comp</span></a><span> </span><span class="free"><span>T</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>U</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_18892..18897"><span>assms</span></a><span>  
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_def|fact"><span>fref_def</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_def|fact"><span>hfref_def</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp_def|fact"><span>hrp_comp_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> c a
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hnr_comp1_aux|fact"><span>hnr_comp1_aux</span></a><span class="main"><span class="main"><span>[</span></span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> 
          </span><span class="quoted"><span class="free"><span>P</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span>RR'</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>c</span></span></span><span> </span><span class="quoted"><span class="free"><span>f</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span>RR'</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="free"><span>S</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><span class="free"><span>g</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>a'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>a'</span></span><span class="main"><span>,</span></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>T</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>a'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="free"><span>T</span></span></span><span> </span><span class="quoted"><span class="free"><span>h</span></span></span><span> </span><span class="quoted"><span class="free"><span>U</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span class="main"><span>)</span></span><span> 
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hrr_comp_nondep|fact"><span class="entity_def" id="Sepref_Rules.hrr_comp_nondep|thm"><span>hrr_comp_nondep</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrr_comp|const"><span>hrr_comp</span></a><span> </span><span class="free"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>R</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrr_comp_def|fact"><span>hrr_comp_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.fun_eq_iff|fact"><span>fun_eq_iff</span></a><span class="main"><span>)</span></span><span>
    
  </span><span class="comment1"><span>(* TODO: Concept of lifting dependent relation over other relation! Allows us to handle hrr_comp R R1 (λ_. Id) *)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hrr_comp_Id_R_Id|fact"><span class="entity_def" id="Sepref_Rules.hrr_comp_Id_R_Id|thm"><span>hrr_comp_Id_R_Id</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrr_comp|const"><span>hrr_comp</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="free"><span>R1</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>R1</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrr_comp_def|fact"><span>hrr_comp_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.fun_eq_iff|fact"><span>fun_eq_iff</span></a><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift_extract_simps|fact"><span>pred_lift_extract_simps</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.non_dep_simp|fact"><span>non_dep_simp</span></a><span class="main"><span class="main"><span>[</span></span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>R1</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hrr_comp_id_conv|fact"><span class="entity_def" id="Sepref_Rules.hrr_comp_id_conv|thm"><span>hrr_comp_id_conv</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrr_comp|const"><span>hrr_comp</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id|const"><span>Id</span></a><span> </span><span class="free"><span>R1</span></span><span> </span><span class="free"><span>R2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>R1</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>R2</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrr_comp_def|fact"><span>hrr_comp_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.fun_eq_iff|fact"><span>fun_eq_iff</span></a><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift_extract_simps|fact"><span>pred_lift_extract_simps</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.non_dep_simp|fact"><span>non_dep_simp</span></a><span class="main"><span class="main"><span>[</span></span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>R1</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  
    
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_20003..20008">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfref_weaken_pre_nofail|fact"><span class="entity_def" id="Sepref_Rules.hfref_weaken_pre_nofail|thm"><span>hfref_weaken_pre_nofail</span></span></span><span class="main"><span>:</span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>  
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nofail|const"><span>nofail</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>g</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_20003..20008"><span>assms</span></a><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_def|fact"><span>hfref_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_def|fact"><span>hn_refine_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_20223..20228">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfref_cons|fact"><span class="entity_def" id="Sepref_Rules.hfref_cons|thm"><span>hfref_cons</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>C'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span>R'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span>R'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P'</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>CP'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>P'</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C'</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>R'</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP'</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_def|fact"><span>hfref_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_cons_cp|fact"><span>hn_refine_cons_cp</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_20223..20228"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>defer</span></span></span></span></span><span>
    
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails_trans|fact"><span>entails_trans</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_20223..20228"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>5</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails_refl|fact"><span>entails_refl</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>erule</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_20223..20228"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>6</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>erule</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_20223..20228"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>7</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>frule</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_20223..20228"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>frule</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_20223..20228"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_20223..20228"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_def|fact"><span>hfref_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
    

  </span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Composition Automation›</span></span></span><span>  
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹This section contains the lemmas. The ML code is further down. ›</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.prod_hrp_comp|fact"><span class="entity_def" id="Sepref_Rules.prod_hrp_comp|thm"><span>prod_hrp_comp</span></span></span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp|const"><span>hrp_comp</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>C</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_syn|const"><span>×<span class="hidden">⇩</span><sub>r</sub></span></a></span><span> </span><span class="free"><span>D</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp|const"><span>hrp_comp</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp|const"><span>hrp_comp</span></a><span> </span><span class="free"><span>B</span></span><span> </span><span class="free"><span>D</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp_def|fact"><span>hrp_comp_def</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfprod_def|fact"><span>hfprod_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hrp_comp_keep|fact"><span class="entity_def" id="Sepref_Rules.hrp_comp_keep|thm"><span>hrp_comp_keep</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp|const"><span>hrp_comp</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfkeep|const"><span><span class="hidden">⇧</span><sup>k</sup></span></a></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfkeep|const"><span><span class="hidden">⇧</span><sup>k</sup></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp_def|fact"><span>hrp_comp_def</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hr_comp_invalid|fact"><span class="entity_def" id="Sepref_Rules.hr_comp_invalid|thm"><span>hr_comp_invalid</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.invalid_assn|const"><span>invalid_assn</span></a><span> </span><span class="free"><span>R1</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>R2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.invalid_assn|const"><span>invalid_assn</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="free"><span>R1</span></span><span> </span><span class="free"><span>R2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.ext|fact"><span>ext</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.invalid_assn_def|fact"><span>invalid_assn_def</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_def|fact"><span>hr_comp_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pure_part_def|fact"><span>pure_part_def</span></a><span class="main"><span>)</span></span><span> </span><span class="comment1"><span>(* TODO: too low-level! *)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hrp_comp_dest|fact"><span class="entity_def" id="Sepref_Rules.hrp_comp_dest|thm"><span>hrp_comp_dest</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp|const"><span>hrp_comp</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfdrop|const"><span><span class="hidden">⇧</span><sup>d</sup></span></a></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp|const"><span>hr_comp</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfdrop|const"><span><span class="hidden">⇧</span><sup>d</sup></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp_def|fact"><span>hrp_comp_def</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_invalid|fact"><span>hr_comp_invalid</span></a><span class="main"><span>)</span></span><span>



  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Rules.hrp_imp_def|fact"><span class="entity_def" id="Sepref_Rules.hrp_imp_def|thm"><span class="entity_def" id="Sepref_Rules.hrp_imp_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Rules.hrp_imp|const"><span>hrp_imp</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>RR</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>RR'</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> 
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>RR'</span></span></span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>RR</span></span></span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>RR</span></span></span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>RR'</span></span></span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfref_imp|fact"><span class="entity_def" id="Sepref_Rules.hfref_imp|thm"><span>hfref_imp</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp|const"><span>hrp_imp</span></a><span> </span><span class="free"><span>RR</span></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>RR</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>⊆</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>erule</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_cons|fact"><span>hfref_cons</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp_all</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp_def|fact"><span>hrp_imp_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
    
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hrp_imp_refl|fact"><span class="entity_def" id="Sepref_Rules.hrp_imp_refl|thm"><span>hrp_imp_refl</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp|const"><span>hrp_imp</span></a><span> </span><span class="free"><span>RR</span></span><span> </span><span class="free"><span>RR</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp_def|fact"><span>hrp_imp_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hrp_imp_reflI|fact"><span class="entity_def" id="Sepref_Rules.hrp_imp_reflI|thm"><span>hrp_imp_reflI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>RR</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp|const"><span>hrp_imp</span></a><span> </span><span class="free"><span>RR</span></span><span> </span><span class="free"><span>RR'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp_def|fact"><span>hrp_imp_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>


  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hrp_comp_cong|fact"><span class="entity_def" id="Sepref_Rules.hrp_comp_cong|thm"><span>hrp_comp_cong</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp|const"><span>hrp_imp</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>A'</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>B</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>B'</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp|const"><span>hrp_imp</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp|const"><span>hrp_comp</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp|const"><span>hrp_comp</span></a><span> </span><span class="free"><span>A'</span></span><span> </span><span class="free"><span>B'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp_def|fact"><span>hrp_imp_def</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp_def|fact"><span>hrp_comp_def</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_def|fact"><span>hr_comp_def</span></a><span> </span><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails_def|fact"><span>entails_def</span></a><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>
    
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hrp_prod_cong|fact"><span class="entity_def" id="Sepref_Rules.hrp_prod_cong|thm"><span>hrp_prod_cong</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp|const"><span>hrp_imp</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>A'</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp|const"><span>hrp_imp</span></a><span> </span><span class="free"><span>B</span></span><span> </span><span class="free"><span>B'</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp|const"><span>hrp_imp</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>A'</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span class="free"><span>B'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp_def|fact"><span>hrp_imp_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.prod_assn_def|fact"><span>prod_assn_def</span></a><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span>
      </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.conj_entails_mono|fact"><span>conj_entails_mono</span></a><span>
    </span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hrp_imp_trans|fact"><span class="entity_def" id="Sepref_Rules.hrp_imp_trans|thm"><span>hrp_imp_trans</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp|const"><span>hrp_imp</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>B</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp|const"><span>hrp_imp</span></a><span> </span><span class="free"><span>B</span></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp|const"><span>hrp_imp</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>C</span></span><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp_def|fact"><span>hrp_imp_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails_trans|fact"><span>entails_trans</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fcomp_norm_dflt_init|fact"><span class="entity_def" id="Sepref_Rules.fcomp_norm_dflt_init|thm"><span>fcomp_norm_dflt_init</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>T</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp|const"><span>hrp_imp</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>T</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>erule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set_rev_mp|fact"><span>set_rev_mp</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_imp|fact"><span>hfref_imp</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Rules.comp_PRE_def|fact"><span class="entity_def" id="Sepref_Rules.comp_PRE_def|thm"><span class="entity_def" id="Sepref_Rules.comp_PRE_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Rules.comp_PRE|const"><span>comp_PRE</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Q</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>y</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>y</span></span><span class="main"><span>,</span></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Q</span></span></span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_22849..22854">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.comp_PRE_cong|fact"><span class="entity_def" id="Sepref_Rules.comp_PRE_cong|thm"><span>comp_PRE_cong</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>cong</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>R</span></span><span class="main"><span>≡</span></span><span class="free"><span>R'</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span>P'</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>y</span></span><span class="main"><span>,</span></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Domain|const"><span>Domain</span></a><span> </span><span class="free"><span>R</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>S'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span>Q'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE|const"><span>comp_PRE</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE|const"><span>comp_PRE</span></a><span> </span><span class="free"><span>R'</span></span><span> </span><span class="free"><span>P'</span></span><span> </span><span class="free"><span>Q'</span></span><span> </span><span class="free"><span>S'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_22849..22854"><span>assms</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE_def|fact"><span>comp_PRE_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.fun_eq_iff|fact"><span>fun_eq_iff</span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>!</span></span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq_reflection|fact"><span>eq_reflection</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_compI_PRE|fact"><span class="entity_def" id="Sepref_Rules.fref_compI_PRE|thm"><span>fref_compI_PRE</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>R1</span></span><span> </span><span class="free"><span>R2</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>g</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>S1</span></span><span> </span><span class="free"><span>S2</span></span><span> </span><span class="main"><span>⟧</span></span><span> 
      </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE|const"><span>comp_PRE</span></a><span> </span><span class="free"><span>S1</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>R1</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.relcomp|const"><span>O</span></a></span><span> </span><span class="free"><span>S1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.rr_comp|const"><span>rr_comp</span></a><span> </span><span class="free"><span>S1</span></span><span> </span><span class="free"><span>R2</span></span><span> </span><span class="free"><span>S2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_compI|fact"><span>fref_compI</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>P</span></span></span><span> </span><span class="quoted"><span class="free"><span>R1</span></span></span><span> </span><span class="quoted"><span class="free"><span>R2</span></span></span><span> </span><span class="quoted"><span class="free"><span>Q</span></span></span><span> </span><span class="quoted"><span class="free"><span>S1</span></span></span><span> </span><span class="quoted"><span class="free"><span>S2</span></span></span><span class="main"><span>]</span></span><span>   
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE_def|fact"><span>comp_PRE_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.PRE_D1|fact"><span class="entity_def" id="Sepref_Rules.PRE_D1|thm"><span>PRE_D1</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE|const"><span>comp_PRE</span></a><span> </span><span class="free"><span>S1</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE_def|fact"><span>comp_PRE_def</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.PRE_D2|fact"><span class="entity_def" id="Sepref_Rules.PRE_D2|thm"><span>PRE_D2</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>y</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>y</span></span><span class="main"><span>,</span></span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>S1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE|const"><span>comp_PRE</span></a><span> </span><span class="free"><span>S1</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE_def|fact"><span>comp_PRE_def</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_23617..23622">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_weaken_pre|fact"><span class="entity_def" id="Sepref_Rules.fref_weaken_pre|thm"><span>fref_weaken_pre</span></span></span><span class="main"><span>:</span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>P'</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span>  
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>P'</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set_rev_mp|fact"><span>set_rev_mp</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_23617..23622"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_mono|fact"><span>fref_mono</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_23617..23622"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
    
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_23822..23827">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_PRE_D1|fact"><span class="entity_def" id="Sepref_Rules.fref_PRE_D1|thm"><span>fref_PRE_D1</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE|const"><span>comp_PRE</span></a><span> </span><span class="free"><span>S1</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>X</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>  
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_weaken_pre|fact"><span>fref_weaken_pre</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.PRE_D1|fact"><span>PRE_D1</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_23822..23827"><span>assms</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_23999..24004">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_PRE_D2|fact"><span class="entity_def" id="Sepref_Rules.fref_PRE_D2|thm"><span>fref_PRE_D2</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE|const"><span>comp_PRE</span></a><span> </span><span class="free"><span>S1</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>X</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>  
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>y</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>y</span></span><span class="main"><span>,</span></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>S1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_weaken_pre|fact"><span>fref_weaken_pre</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.PRE_D2|fact"><span>PRE_D2</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_23999..24004"><span>assms</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fref_PRE_D|fact"><span class="entity_def" id="Sepref_Rules.fref_PRE_D(2)|thm"><span class="entity_def" id="Sepref_Rules.fref_PRE_D(1)|thm"><span>fref_PRE_D</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_PRE_D1|fact"><span>fref_PRE_D1</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_PRE_D2|fact"><span>fref_PRE_D2</span></a><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_24238..24243">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfref_weaken_pre|fact"><span class="entity_def" id="Sepref_Rules.hfref_weaken_pre|thm"><span>hfref_weaken_pre</span></span></span><span class="main"><span>:</span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>P'</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span>  
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>hfref</span></a><span> </span><span class="free"><span>P'</span></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>CP</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>hfref</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>CP</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_24238..24243"><span>assms</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_def|fact"><span>hfref_def</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_24420..24425">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfref_weaken_pre&apos;|fact"><span class="entity_def" id="Sepref_Rules.hfref_weaken_pre&apos;|thm"><span>hfref_weaken_pre'</span></span></span><span class="main"><span>:</span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.rdomp|const"><span>rdomp</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P'</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span>  
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>hfref</span></a><span> </span><span class="free"><span>P'</span></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>CP</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>hfref</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>CP</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefI|fact"><span>hfrefI</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_preI|fact"><span>hn_refine_preI</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_24420..24425"><span>assms</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_def|fact"><span>hfref_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.rdomp_def|fact"><span>rdomp_def</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_24688..24693">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfref_weaken_pre_nofail&apos;|fact"><span class="entity_def" id="Sepref_Rules.hfref_weaken_pre_nofail&apos;|thm"><span>hfref_weaken_pre_nofail'</span></span></span><span class="main"><span>:</span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>  
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nofail|const"><span>nofail</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>g</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>Q</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_weaken_pre|fact"><span>hfref_weaken_pre</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="Sepref_Rules.html#offset_24688..24693"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_weaken_pre_nofail|fact"><span>hfref_weaken_pre_nofail</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_24688..24693"><span>assms</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_24978..24983">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfref_with_rdomI|fact"><span class="entity_def" id="Sepref_Rules.hfref_with_rdomI|thm"><span>hfref_with_rdomI</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>c</span></span><span class="main"><span>,</span></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.rdomp|const"><span>rdomp</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>x</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>c</span></span><span class="main"><span>,</span></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>no_types</span><span class="main"><span class="main"><span>,</span></span></span><span> lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_24978..24983"><span>assms</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_weaken_pre&apos;|fact"><span>hfref_weaken_pre'</span></a><span class="main"><span>)</span></span><span>
    
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfref_compI_PRE_aux|fact"><span class="entity_def" id="Sepref_Rules.hfref_compI_PRE_aux|thm"><span>hfref_compI_PRE_aux</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_25223..25224">A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_25277..25278">B</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>g</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>[</span></a></span><span class="free"><span>Q</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>]<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>T</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>→</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟨</span></span><span class="free"><span>U</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE|const"><span>comp_PRE</span></a><span> </span><span class="free"><span>T</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>
      </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp|const"><span>hrp_comp</span></a><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="free"><span>T</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrr_comp|const"><span>hrr_comp</span></a><span> </span><span class="free"><span>T</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>U</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_weaken_pre|fact"><span>hfref_weaken_pre</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfcomp|fact"><span>hfcomp</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_25223..25224"><span>A</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_25277..25278"><span>B</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE_def|fact"><span>comp_PRE_def</span></a><span class="main"><span>)</span></span><span>


  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfref_compI_PRE|fact"><span class="entity_def" id="Sepref_Rules.hfref_compI_PRE|thm"><span>hfref_compI_PRE</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_25558..25559">A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_25612..25613">B</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>g</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>[</span></a></span><span class="free"><span>Q</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>]<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>T</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>→</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟨</span></span><span class="free"><span>U</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE|const"><span>comp_PRE</span></a><span> </span><span class="free"><span>T</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nofail|const"><span>nofail</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>h</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>
      </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp|const"><span>hrp_comp</span></a><span> </span><span class="free"><span>RR'</span></span><span> </span><span class="free"><span>T</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrr_comp|const"><span>hrr_comp</span></a><span> </span><span class="free"><span>T</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>U</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_compI_PRE_aux|fact"><span>hfref_compI_PRE_aux</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_25558..25559"><span>A</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_25612..25613"><span>B</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_weaken_pre_nofail|fact"><span>hfref_weaken_pre_nofail</span></a><span class="main"><span>]</span></span><span>  
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_weaken_pre|fact"><span>hfref_weaken_pre</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>rotated</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE_def|fact"><span>comp_PRE_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_25939..25944">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfref_PRE_D1|fact"><span class="entity_def" id="Sepref_Rules.hfref_PRE_D1|thm"><span>hfref_PRE_D1</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>hfref</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE|const"><span>comp_PRE</span></a><span> </span><span class="free"><span>S1</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>X</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>CP</span></span><span>"</span></span></span><span>  
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>hfref</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>CP</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_weaken_pre|fact"><span>hfref_weaken_pre</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.PRE_D1|fact"><span>PRE_D1</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_25939..25944"><span>assms</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_26130..26135">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfref_PRE_D2|fact"><span class="entity_def" id="Sepref_Rules.hfref_PRE_D2|thm"><span>hfref_PRE_D2</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>hfref</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE|const"><span>comp_PRE</span></a><span> </span><span class="free"><span>S1</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>X</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>CP</span></span><span>"</span></span></span><span>  
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>hfref</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>y</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>y</span></span><span class="main"><span>,</span></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>S1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>CP</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_weaken_pre|fact"><span>hfref_weaken_pre</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.PRE_D2|fact"><span>PRE_D2</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_26130..26135"><span>assms</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_26336..26341">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfref_PRE_D3|fact"><span class="entity_def" id="Sepref_Rules.hfref_PRE_D3|thm"><span>hfref_PRE_D3</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>hfref</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE|const"><span>comp_PRE</span></a><span> </span><span class="free"><span>S1</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>X</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>CP</span></span><span>"</span></span></span><span>  
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>hfref</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE|const"><span>comp_PRE</span></a><span> </span><span class="free"><span>S1</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>X</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>CP</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_26336..26341"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfref_PRE_D|fact"><span class="entity_def" id="Sepref_Rules.hfref_PRE_D(2)|thm"><span class="entity_def" id="Sepref_Rules.hfref_PRE_D(1)|thm"><span>hfref_PRE_D</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_PRE_D1|fact"><span>hfref_PRE_D1</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_PRE_D3|fact"><span>hfref_PRE_D3</span></a><span>

  </span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Automation›</span></span></span><span>  
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Purity configuration for constraint solver›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.safe_constraint_rules|attribute"><span class="operator"><span>safe_constraint_rules</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure_pure|fact"><span>pure_pure</span></a><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.invalid_pure|fact"><span class="entity_def" id="Sepref_Rules.invalid_pure|thm"><span>invalid_pure</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.safe_constraint_rules|attribute"><span class="operator"><span>safe_constraint_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.is_pure|const"><span>is_pure</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.invalid_assn|const"><span>invalid_assn</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.invalid_assn_def|fact"><span>invalid_assn_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.is_pure_def|fact"><span>is_pure_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Configuration for hfref to hnr conversion›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.to_hnr_post|attribute"><span class="entity_def" id="Sepref_Rules.to_hnr_post|fact"><span>to_hnr_post</span></span></span><span> </span><span class="quoted"><span>‹to_hnr converter: Postprocessing unfold rules›</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.uncurry0_add_app_tag|fact"><span class="entity_def" id="Sepref_Rules.uncurry0_add_app_tag|thm"><span>uncurry0_add_app_tag</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Misc.html#Sepref_Misc.uncurry0|const"><span>uncurry0</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Misc.html#Sepref_Misc.uncurry0|const"><span>uncurry0</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>c</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

  </span><span class="keyword1"><span class="command"><span>thm</span></span></span><span> </span><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj_empty|fact"><span>sep_conj_empty</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="LLVM_Shallow_RS.html#LLVM_Shallow_RS.ll_assn|type"><span>ll_assn</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>for</span></span></span></span><span> </span><span class="free"><span>P</span></span><span class="main"><span>]</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.to_hnr_post|attribute"><span class="operator"><span>to_hnr_post</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.norm_RETURN_o|fact"><span>norm_RETURN_o</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.norm_return_o|fact"><span>norm_return_o</span></a><span>
    </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.uncurry0_add_app_tag|fact"><span>uncurry0_add_app_tag</span></a><span> </span><a class="entity_ref" href="Sepref_Misc.html#Sepref_Misc.uncurry0_apply|fact"><span>uncurry0_apply</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.uncurry0_APP|fact"><span>uncurry0_APP</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hn_val_unit_conv_emp|fact"><span>hn_val_unit_conv_emp</span></a><span>
    </span><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj_empty|fact"><span>sep_conj_empty</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="LLVM_Shallow_RS.html#LLVM_Shallow_RS.ll_assn|type"><span>ll_assn</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>for</span></span></span></span><span> </span><span class="free"><span>P</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj_empty&apos;|fact"><span>sep_conj_empty'</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="LLVM_Shallow_RS.html#LLVM_Shallow_RS.ll_assn|type"><span>ll_assn</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>for</span></span></span></span><span> </span><span class="free"><span>P</span></span><span class="main"><span>]</span></span><span>

  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.to_hfref_post|attribute"><span class="entity_def" id="Sepref_Rules.to_hfref_post|fact"><span>to_hfref_post</span></span></span><span> </span><span class="quoted"><span>‹to_hfref converter: Postprocessing unfold rules›</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.prod_casesK|fact"><span class="entity_def" id="Sepref_Rules.prod_casesK|thm"><span>prod_casesK</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.to_hfref_post|attribute"><span class="operator"><span>to_hfref_post</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case_prod|const"><span>case_prod</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span> </span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>k</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.uncurry0_hfref_post|fact"><span class="entity_def" id="Sepref_Rules.uncurry0_hfref_post|thm"><span>uncurry0_hfref_post</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.to_hfref_post|attribute"><span class="operator"><span>to_hfref_post</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>hfref</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Misc.html#Sepref_Misc.uncurry0|const"><span>uncurry0</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>hfref</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Refine_Util.html#Refine_Util.fo_rule|method"><span class="operator"><span>fo_rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.arg_cong|fact"><span>arg_cong</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.fun_cong|fact"><span>fun_cong</span></a><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>


  </span><span class="comment1"><span>(* Currently not used, we keep it in here anyway. *)</span></span><span>  
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Configuration for relation normalization after composition›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fcomp_norm_unfold|attribute"><span class="entity_def" id="Sepref_Rules.fcomp_norm_unfold|fact"><span>fcomp_norm_unfold</span></span></span><span> </span><span class="quoted"><span>‹fcomp-normalizer: Unfold theorems›</span></span><span>
  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fcomp_norm_simps|attribute"><span class="entity_def" id="Sepref_Rules.fcomp_norm_simps|fact"><span>fcomp_norm_simps</span></span></span><span> </span><span class="quoted"><span>‹fcomp-normalizer: Simplification theorems›</span></span><span>
  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fcomp_norm_init|attribute"><span class="entity_def" id="Sepref_Rules.fcomp_norm_init|fact"><span>fcomp_norm_init</span></span></span><span> </span><span class="quoted"><span>"fcomp-normalizer: Initialization rules"</span></span><span>  
  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fcomp_norm_trans|attribute"><span class="entity_def" id="Sepref_Rules.fcomp_norm_trans|fact"><span>fcomp_norm_trans</span></span></span><span> </span><span class="quoted"><span>"fcomp-normalizer: Transitivity rules"</span></span><span>  
  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fcomp_norm_cong|attribute"><span class="entity_def" id="Sepref_Rules.fcomp_norm_cong|fact"><span>fcomp_norm_cong</span></span></span><span> </span><span class="quoted"><span>"fcomp-normalizer: Congruence rules"</span></span><span>  
  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fcomp_norm_norm|attribute"><span class="entity_def" id="Sepref_Rules.fcomp_norm_norm|fact"><span>fcomp_norm_norm</span></span></span><span> </span><span class="quoted"><span>"fcomp-normalizer: Normalization rules"</span></span><span>  
  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fcomp_norm_refl|attribute"><span class="entity_def" id="Sepref_Rules.fcomp_norm_refl|fact"><span>fcomp_norm_refl</span></span></span><span> </span><span class="quoted"><span>"fcomp-normalizer: Reflexivity rules"</span></span><span>  

  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Default Setup›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fcomp_norm_unfold|attribute"><span class="operator"><span>fcomp_norm_unfold</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_comp|fact"><span>prod_rel_comp</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel_comp|fact"><span>nres_rel_comp</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Id_O_R|fact"><span>Id_O_R</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.R_O_Id|fact"><span>R_O_Id</span></a><span>
  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fcomp_norm_unfold|attribute"><span class="operator"><span>fcomp_norm_unfold</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_Id1|fact"><span>hr_comp_Id1</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_Id2|fact"><span>hr_comp_Id2</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp_Id1|fact"><span>hrp_comp_Id1</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp_Id2|fact"><span>hrp_comp_Id2</span></a><span>
  </span><span class="keyword1"><span class="command"><span>find_theorems</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.rr_comp|const"><span>rr_comp</span></a></span><span>
  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fcomp_norm_unfold|attribute"><span class="operator"><span>fcomp_norm_unfold</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrr_comp_nondep|fact"><span>hrr_comp_nondep</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.rr_comp_nondep|fact"><span>rr_comp_nondep</span></a><span>
  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fcomp_norm_unfold|attribute"><span class="operator"><span>fcomp_norm_unfold</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_prod_conv|fact"><span>hr_comp_prod_conv</span></a><span>
  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fcomp_norm_unfold|attribute"><span class="operator"><span>fcomp_norm_unfold</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.prod_hrp_comp|fact"><span>prod_hrp_comp</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp_keep|fact"><span>hrp_comp_keep</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp_dest|fact"><span>hrp_comp_dest</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hr_comp_pure|fact"><span>hr_comp_pure</span></a><span>
  </span><span class="comment1"><span>(*lemmas [fcomp_norm_unfold] = prod_casesK uncurry0_hfref_post*)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fcomp_norm_simps|attribute"><span class="operator"><span>fcomp_norm_simps</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT|const"><span>CONSTRAINT</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.is_pure|const"><span>is_pure</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure|const"><span>pure</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.the_pure|const"><span>the_pure</span></a><span> </span><span class="free"><span>P</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fcomp_norm_simps|attribute"><span class="operator"><span>fcomp_norm_simps</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True_implies_equals|fact"><span>True_implies_equals</span></a><span> 
  
  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fcomp_norm_init|attribute"><span class="operator"><span>fcomp_norm_init</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fcomp_norm_dflt_init|fact"><span>fcomp_norm_dflt_init</span></a><span>
  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fcomp_norm_trans|attribute"><span class="operator"><span>fcomp_norm_trans</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp_trans|fact"><span>hrp_imp_trans</span></a><span>
  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fcomp_norm_cong|attribute"><span class="operator"><span>fcomp_norm_cong</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_comp_cong|fact"><span>hrp_comp_cong</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_prod_cong|fact"><span>hrp_prod_cong</span></a><span>
  </span><span class="comment1"><span>(*lemmas [fcomp_norm_norm] = hrp_comp_dest*)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fcomp_norm_refl|attribute"><span class="operator"><span>fcomp_norm_refl</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hrp_imp_refl|fact"><span>hrp_imp_refl</span></a><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.ensure_fref_nresI|fact"><span class="entity_def" id="Sepref_Rules.ensure_fref_nresI|thm"><span>ensure_fref_nresI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>]<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>R</span></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>→</span></a></span><span class="free"><span>S</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>]<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>R</span></span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>→</span></a></span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟨</span></span><span class="free"><span>S</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>⟩</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_rel|const"><span>nres_rel</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres_relI|fact"><span>nres_relI</span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_def|fact"><span>fref_def</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.ensure_fref_nres_unfold|fact"><span class="entity_def" id="Sepref_Rules.ensure_fref_nres_unfold(3)|thm"><span class="entity_def" id="Sepref_Rules.ensure_fref_nres_unfold(2)|thm"><span class="entity_def" id="Sepref_Rules.ensure_fref_nres_unfold(1)|thm"><span>ensure_fref_nres_unfold</span></span></span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Misc.html#Sepref_Misc.uncurry0|const"><span>uncurry0</span></a><span> </span><span class="bound"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Sepref_Misc.html#Sepref_Misc.uncurry0|const"><span>uncurry0</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="bound"><span>f</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><span class="bound"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.comp2|const"><span>oo</span></a></span><span> </span><span class="bound"><span>f</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.comp3|const"><span>ooo</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span class="main"><span>)</span></span><span> </span><span class="bound"><span>f</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.comp3|const"><span>ooo</span></a></span><span> </span><span class="bound"><span>f</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Composed precondition normalizer›</span></span></span><span>  
  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.fcomp_prenorm_simps|attribute"><span class="entity_def" id="Sepref_Rules.fcomp_prenorm_simps|fact"><span>fcomp_prenorm_simps</span></span></span><span> </span><span class="quoted"><span>‹fcomp precondition-normalizer: Simplification theorems›</span></span><span>

  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Support for preconditions of the form </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>text</span></span><span> </span><span class="raw_text"><span>"_∈Domain R"</span></span><span class="antiquote"><span>}</span></span></span><span>, 
    where </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>text</span></span><span> </span><span class="raw_text"><span>R</span></span><span class="antiquote"><span>}</span></span></span><span> is the relation of the next more abstract level.›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>declare</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Relation.html#Relation.Domain.DomainI|fact"><span>DomainI</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fcomp_prenorm_simps|attribute"><span class="operator"><span>fcomp_prenorm_simps</span></span></a><span class="main"><span>]</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_29743..29748">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_init_hf|fact"><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_init_hf|thm"><span>auto_weaken_pre_init_hf</span></span></span><span class="main"><span>:</span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.PROTECT|const"><span>PROTECT</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>P'</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span>  
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>hfref</span></a><span> </span><span class="free"><span>P'</span></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>CP</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>hfref</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>CP</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_29743..29748"><span>assms</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_def|fact"><span>hfref_def</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_29940..29945">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_init_f|fact"><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_init_f|thm"><span>auto_weaken_pre_init_f</span></span></span><span class="main"><span>:</span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.PROTECT|const"><span>PROTECT</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>P'</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span>  
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>P'</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>h</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_29940..29945"><span>assms</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_def|fact"><span>fref_def</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_init|fact"><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_init(2)|thm"><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_init(1)|thm"><span>auto_weaken_pre_init</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.auto_weaken_pre_init_hf|fact"><span>auto_weaken_pre_init_hf</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.auto_weaken_pre_init_f|fact"><span>auto_weaken_pre_init_f</span></a><span>  

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_30205..30210">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_uncurry_step|fact"><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_uncurry_step|thm"><span>auto_weaken_pre_uncurry_step</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.PROTECT|const"><span>PROTECT</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span>f'</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.PROTECT|const"><span>PROTECT</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span class="main"><span>,</span></span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>a</span></span><span class="main"><span>,</span></span><span class="free"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span>f'</span></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_30205..30210"><span>assms</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.curry_def|fact"><span>curry_def</span></a><span> </span><span class="quasi_keyword"><span>dest</span></span><span class="main"><span class="main"><span>!</span></span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.meta_eq_to_obj_eq|fact"><span>meta_eq_to_obj_eq</span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>!</span></span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq_reflection|fact"><span>eq_reflection</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_uncurry_finish|fact"><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_uncurry_finish|thm"><span>auto_weaken_pre_uncurry_finish</span></span></span><span class="main"><span>:</span></span><span>  
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.PROTECT|const"><span>PROTECT</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_30495..30500">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_uncurry_start|fact"><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_uncurry_start|thm"><span>auto_weaken_pre_uncurry_start</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span>P'</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span class="free"><span>Q</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span class="free"><span>Q</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_30495..30500"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_30617..30622">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_comp_PRE_I|fact"><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_comp_PRE_I|thm"><span>auto_weaken_pre_comp_PRE_I</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>S</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span class="main"><span>(</span></span><span class="bound"><span>y</span></span><span class="main"><span>,</span></span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>R</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE|const"><span>comp_PRE</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_30617..30622"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.comp_PRE_def|fact"><span>comp_PRE_def</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_to_imp_nf|fact"><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_to_imp_nf(2)|thm"><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_to_imp_nf(1)|thm"><span>auto_weaken_pre_to_imp_nf</span></span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span class="free"><span>B</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span class="free"><span>C</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span class="free"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>C</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span class="free"><span>C</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span class="free"><span>B</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span class="free"><span>C</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_add_dummy_imp|fact"><span class="entity_def" id="Sepref_Rules.auto_weaken_pre_add_dummy_imp|thm"><span>auto_weaken_pre_add_dummy_imp</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>


  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Synthesis for hfref statements›</span></span></span><span>  
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Rules.hfsynth_ID_R_def|fact"><span class="entity_def" id="Sepref_Rules.hfsynth_ID_R_def|thm"><span class="entity_def" id="Sepref_Rules.hfsynth_ID_R_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Rules.hfsynth_ID_R|const"><span>hfsynth_ID_R</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
    </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>hfsynth_ID_R</span></span><span> </span><span class="main"><span class="bound"><span class="entity"><span>_</span></span></span></span><span> </span><span class="main"><span class="bound"><span class="entity"><span>_</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfsynth_ID_R_D|fact"><span class="entity_def" id="Sepref_Rules.hfsynth_ID_R_D|thm"><span>hfsynth_ID_R_D</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><span>itself</span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfsynth_ID_R|const"><span>hfsynth_ID_R</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.intf_of_assn|const"><span>intf_of_assn</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.intf_type|const"><span>::<span class="hidden">⇩</span><sub>i</sub></span></a></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_31261..31266">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfsynth_hnr_from_hfI|fact"><span class="entity_def" id="Sepref_Rules.hfsynth_hnr_from_hfI|thm"><span>hfsynth_hnr_from_hfI</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>xi</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfsynth_ID_R|const"><span>hfsynth_ID_R</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_empty|const"><span>□</span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>xi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>xi</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_empty|const"><span>□</span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>S</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>CP</span></span><span> </span><span class="bound"><span>xi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>g</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span class="main"><span>,</span></span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>P</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>C</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="free"><span>CP</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#offset_31261..31266"><span>assms</span></a><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_def|fact"><span>hfref_def</span></a><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span class="main"><span>)</span></span><span>


  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.hfsynth_ID_R_uncurry_unfold|fact"><span class="entity_def" id="Sepref_Rules.hfsynth_ID_R_uncurry_unfold(2)|thm"><span class="entity_def" id="Sepref_Rules.hfsynth_ID_R_uncurry_unfold(1)|thm"><span>hfsynth_ID_R_uncurry_unfold</span></span></span></span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfsynth_ID_R|const"><span>hfsynth_ID_R</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.to_hnr_prod|const"><span>to_hnr_prod</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>S</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>a</span></span><span class="main"><span>,</span></span><span class="free"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfsynth_ID_R|const"><span>hfsynth_ID_R</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfsynth_ID_R|const"><span>hfsynth_ID_R</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfsynth_ID_R|const"><span>hfsynth_ID_R</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hf_pres|const"><span>hf_pres</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>k</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfsynth_ID_R|const"><span>hfsynth_ID_R</span></a><span> </span><span class="free"><span>R</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>intro</span></span><span class="main"><span class="main"><span>!</span></span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq_reflection|fact"><span>eq_reflection</span></a><span class="main"><span>)</span></span><span>

    
  </span><span class="keyword1"><span class="command"><span>ML</span></span></span><span> </span><span class="quoted"><span>‹

    </span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>SEPREF_RULES</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
      </span><span class="comment1"><span>(* Analysis of relations, both fref and fun_rel *)</span></span><span>
      </span><span class="comment1"><span>(* "R1→...→Rn→_" / "[_]<span class="hidden">⇩</span><sub>f</sub> ((R1×<span class="hidden">⇩</span><sub>r</sub>R2)...×<span class="hidden">⇩</span><sub>r</sub>Rn)"  ↦  "[R1,...,Rn]" *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> binder_rels</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> 
      </span><span class="comment1"><span>(* "_→...→_→S" / "[_]<span class="hidden">⇩</span><sub>f</sub> _ → S"  ↦  "S" *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> body_rel</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> 
      </span><span class="comment1"><span>(* Map →/fref to (precond,args,res). NONE if no/trivial precond. *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> analyze_rel</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>option</span><span> * </span><span>term</span><span> </span><span>list</span><span> * </span><span>term</span><span> 
      </span><span class="comment1"><span>(* Make trivial ("λ_. True") precond *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_triv_precond</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> 
      </span><span class="comment1"><span>(* Make "[P]<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>d</sub> ((R1×<span class="hidden">⇩</span><sub>r</sub>R2)...×<span class="hidden">⇩</span><sub>r</sub>Rn) → S". Insert trivial precond if NONE. *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_rel</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>option</span><span> * </span><span>term</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> 
      </span><span class="comment1"><span>(* Map relation to (args,res) *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> strip_rel</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> * </span><span>term</span><span> 

      </span><span class="comment1"><span>(* Make hfprod (op *<span class="hidden">⇩</span><sub>a</sub>) *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_hfprod </span><span class="main"><span>:</span></span><span> </span><span>term</span><span> * </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_hfprods </span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>

      </span><span class="comment1"><span>(* Determine interface type of refinement assertion, using default fallback
        if necessary. Use named_thms intf_of_assn for configuration. *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> intf_of_assn </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span>

      </span><span class="comment1"><span>(*
        Convert a parametricity theorem in higher-order form to
        uncurried fref-form. For functions without arguments, 
        a unit-argument is added.

        TODO/FIXME: Currently this only works for higher-order theorems,
          i.e., theorems of the form (f,g)∈R1→…→Rn. 
          
          First-order theorems are silently treated as refinement theorems
          for functions with zero arguments, i.e., a unit-argument is added.
      *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> to_fref </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>

      </span><span class="comment1"><span>(* Convert a parametricity or fref theorem to first order form *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> to_foparam </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>

      </span><span class="comment1"><span>(* Convert schematic hfref goal to hnr-goal *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> prepare_hfref_synth_tac </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tactic'</span></span><span>

      </span><span class="comment1"><span>(* Convert theorem in hfref-form to hnr-form *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> to_hnr </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>

      </span><span class="comment1"><span>(* Convert theorem in hnr-form to hfref-form *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> to_hfref</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>

      </span><span class="comment1"><span>(* Convert theorem to given form, if not yet in this form *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> ensure_fref </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> ensure_fref_nres </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> ensure_hfref </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> ensure_hnr </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>


      </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>hnr_analysis</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
        thm</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>                     </span><span class="comment1"><span>(* Original theorem, may be normalized *)</span></span><span>
        precond</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>                </span><span class="comment1"><span>(* Precondition, abstracted over abs-arguments *)</span></span><span>
        ccond</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>                  </span><span class="comment1"><span>(* Concrete precondition, abstracted over conc-arguments *)</span></span><span>
        prems </span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>            </span><span class="comment1"><span>(* Premises not depending on arguments *)</span></span><span>
        ahead</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> * </span><span>bool</span><span class="main"><span>,</span></span><span>           </span><span class="comment1"><span>(* Abstract function, has leading RETURN *)</span></span><span>
        chead</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> * </span><span>bool</span><span class="main"><span>,</span></span><span>           </span><span class="comment1"><span>(* Concrete function, has leading return *)</span></span><span>
        argrels</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>term</span><span> * </span><span>bool</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>  </span><span class="comment1"><span>(* Argument relations, preserved (keep-flag) *)</span></span><span>
        result_rel</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>             </span><span class="comment1"><span>(* Result relation *)</span></span><span>
        cpcond</span><span class="main"><span>:</span></span><span> </span><span>term</span><span>                  </span><span class="comment1"><span>(* Concrete postcondition (abstracted over conc-arguments) *)</span></span><span>
      </span><span class="main"><span>}</span></span><span>
  
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> analyze_hnr</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>hnr_analysis</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> pretty_hnr_analysis</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>hnr_analysis</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Pretty.T</span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_hfref_thm</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>hnr_analysis</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  
  

      </span><span class="comment1"><span>(* Simplify precondition of fref/hfref-theorem *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> simplify_precond</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>

      </span><span class="comment1"><span>(* Normalize hfref-theorem after composition *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> norm_fcomp_rule</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>

      </span><span class="comment1"><span>(* Replace "pure ?A" by "?A'" and is_pure constraint, then normalize *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> add_pure_constraints_rule</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>

      </span><span class="comment1"><span>(* Compose fref/hfref and fref theorem, to produce hfref theorem.
        The input theorems may also be in ho-param or hnr form, and
        are converted accordingly.
      *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> gen_compose </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>

      </span><span class="comment1"><span>(* FCOMP-attribute *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fcomp_attrib</span><span class="main"><span>:</span></span><span> </span><span>attribute</span><span> </span><span>context_parser</span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Sepref_Rules</span></span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>SEPREF_RULES</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

      </span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Refine_Util</span><span> </span><span>Relators</span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>binder_rels</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><span class="var"><span>?F</span></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="var"><span>?G</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>F</span></span><span>::</span><span class="entity"><span>binder_rels</span></span><span> </span><span class="entity"><span>G</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>binder_rels</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="var"><span>?F</span></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_prodrel_left</span></span><span> </span><span class="entity"><span>F</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>binder_rels</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
    
        </span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span> 
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>br_aux</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>_</span></span><span> </span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span> </span><span class="var"><span>?G</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>br_aux</span></span><span> </span><span class="entity"><span>G</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>br_aux</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>    
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>body_rel</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="var"><span>?G</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>G</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>body_rel</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>br_aux</span></span><span> </span><span class="entity"><span>R</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strip_rel</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>binder_rels</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body_rel</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span>   
    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>analyze_rel</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span> </span><span class="var"><span>?R</span></span><span> </span><span class="var"><span>?S</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span class="entity"><span>strip_prodrel_left</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span class="entity"><span>S</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>analyze_rel</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="var"><span>?P</span></span><span> </span><span class="var"><span>?R</span></span><span> </span><span class="var"><span>?S</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>P</span></span><span class="main"><span>,</span></span><span class="entity"><span>strip_prodrel_left</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span class="entity"><span>S</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>analyze_rel</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>args</span></span><span class="main"><span>,</span></span><span class="entity"><span>res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_rel</span></span><span> </span><span class="entity"><span>R</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>argTuc</span></span><span> </span><span class="main"><span>=</span></span><span> 
                   </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>HOLogic.dest_setT</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>HOLogic.dest_prodT</span></span><span> </span><span>#&gt;</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span> 
                </span><span>|&gt;</span><span> </span><span class="entity"><span>list_prodT_left</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>res</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.absdummy</span><span> </span><span class="entity"><span>argTuc</span></span><span> </span><span class="entity"><span>res</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span class="entity"><span>args</span></span><span class="main"><span>,</span></span><span class="entity"><span>res</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_triv_precond</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>absdummy</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>rel_absT</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>list_prodT_left</span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a></span><span class="antiquote"><span>}</span></span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>P</span></span><span class="main"><span>,</span></span><span class="entity"><span>Rs</span></span><span class="main"><span>,</span></span><span class="entity"><span>S</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> 
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>list_prodrel_left</span></span><span> </span><span class="entity"><span>Rs</span></span><span> 
    
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> 
              </span><span>SOME</span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>P</span></span><span> 
            </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_triv_precond</span></span><span> </span><span class="entity"><span>Rs</span></span><span>
    
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> 
          </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="var"><span>?P</span></span><span> </span><span class="var"><span>?R</span></span><span> </span><span class="var"><span>?S</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> 
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_hfprod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><span class="var"><span>?a</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfprod|const"><span>*<span class="hidden">⇩</span><sub>a</sub></span></a></span><span class="var"><span>?b</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
  
      </span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span> 
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_hfprods_rev</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.unit_assn|const"><span>unit_assn</span></a><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfkeep|const"><span><span class="hidden">⇧</span><sup>k</sup></span></a></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_hfprods_rev</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Rk</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Rk</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_hfprods_rev</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rkn</span></span><span>::</span><span class="entity"><span>Rks</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_hfprod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_hfprods_rev</span></span><span> </span><span class="entity"><span>Rks</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rkn</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_hfprods</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_hfprods_rev</span></span><span> </span><span>o</span><span> </span><span>rev</span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>intf_of_assn</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>orig_ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span>Variable.import_terms</span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>TVar</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"T"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>Proof_Context.default_sort</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"T"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>Logic.mk_type</span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.intf_of_assn|const"><span>intf_of_assn</span></a><span> </span><span class="var"><span>?t</span></span><span> </span><span class="var"><span>?v</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>i_of_assn_rls</span></span><span> </span><span class="main"><span>=</span></span><span> 
          </span><span class="entity"><span>Named_Theorems_Rev.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems_rev</span></span><span> intf_of_assn</span><span class="antiquote"><span>}</span></span></span><span>
          </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.intf_of_assn_fallback|fact"><span>intf_of_assn_fallback</span></a><span class="antiquote"><span>}</span></span></span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>REPEAT_ALL_NEW</span><span> </span><span class="main"><span>(</span></span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>i_of_assn_rls</span></span><span class="main"><span>)</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Goal.prove</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>context</span></span><span class="main"><span>,</span></span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>intf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.concl_of</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.intf_of_assn|const"><span>intf_of_assn</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="var"><span>?v</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Mpat_Antiquot.html#Mpat_Antiquot.mpaq_AS_PAT|const"><span>AS<span class="hidden">⇩</span><sub>p</sub></span></a></span><span> </span><span class="keyword1"><span>TYPE</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>v</span></span><span> 
          </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Intf_of_assn: Proved a different theorem?"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>intf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>singleton</span><span> </span><span class="main"><span>(</span></span><span>Variable.export_terms</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>orig_ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>intf</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Logic.dest_type</span><span>

      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>intf</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>rthm_type</span></span><span> </span><span class="main"><span>=</span></span><span> 
        </span><span class="entity"><span>RT_HOPARAM</span></span><span>    </span><span class="comment1"><span>(* (_,_) ∈ _ → … → _ *)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>RT_FREF</span></span><span>       </span><span class="comment1"><span>(* (_,_) ∈ [_]<span class="hidden">⇩</span><sub>f</sub> _ → _ *)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>RT_HNR</span></span><span>        </span><span class="comment1"><span>(* hn_refine _ _ _ _ _ *)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>RT_HFREF</span></span><span>      </span><span class="comment1"><span>(* (_,_) ∈ [_]<span class="hidden">⇩</span><sub>a</sub> _ → _ *)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>RT_OTHER</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rthm_type</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.concl_of</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.dest_Trueprop</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>RT_FREF</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>hfref</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>RT_HFREF</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>RT_HNR</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>RT_HOPARAM</span></span><span> </span><span class="comment1"><span>(* TODO: Distinction between ho-param and fo-param *)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>RT_OTHER</span></span><span>


      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>to_fref</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Conv</span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>  
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.concl_of</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.dest_Trueprop</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>_</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.fun_rel_syn|const"><span>→</span></a></span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_param1|fact"><span>fref_param1</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>thm</span></span><span>
            </span><span>|&gt;</span><span> </span><span>fconv_rule</span><span> </span><span class="main"><span>(</span></span><span>repeat_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Refine_Util.ftop_conv</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span>rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_nest|fact"><span>fref_nest</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.in_CURRY_conv|fact"><span>in_CURRY_conv</span></a><span class="antiquote"><span>}</span></span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_param0I|fact"><span>fref_param0I</span></a><span class="antiquote"><span>}</span></span></span></span><span>   
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"to_fref: Expected theorem of form (_,_)∈_"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>to_foparam</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unf_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> 
          </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.split_tupled_all|fact"><span>split_tupled_all</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Relators.html#Relators.prod_rel_simp|fact"><span>prod_rel_simp</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry_apply|fact"><span>uncurry_apply</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.cnv_conj_to_meta|fact"><span>cnv_conj_to_meta</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.split|fact"><span>Product_Type.split</span></a><span class="antiquote"><span>}</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.concl_of</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.frefD|fact"><span>frefD</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.forall_intr_vars</span><span>
            </span><span>|&gt;</span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>unf_thms</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Variable.gen_all</span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>Parametricity.fo_rule</span></span><span> </span><span class="entity"><span>thm</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Expected parametricity or fref theorem"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>to_hnr</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hf2hnr|fact"><span>hf2hnr</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.to_hnr_prod_fst_snd|fact"><span>to_hnr_prod_fst_snd</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.keep_drop_sels|fact"><span>keep_drop_sels</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="comment1"><span>(* Resolve fst and snd over *<span class="hidden">⇩</span><sub>a</sub> and R<span class="hidden">⇧</span><sup>k</sup>, R<span class="hidden">⇧</span><sup>d</sup> *)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hnr_uncurry_unfold|fact"><span>hnr_uncurry_unfold</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="comment1"><span>(* Resolve products for uncurried parameters *)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry_apply|fact"><span>uncurry_apply</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.uncurry_APP|fact"><span>uncurry_APP</span></a><span> </span><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj_empty&apos;|fact"><span>sep_conj_empty'</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.split|fact"><span>split</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="comment1"><span>(* Remove the uncurry modifiers, the emp-dummy, and unfold product cases *)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hn_ctxt_ctxt_fix_conv|fact"><span>hn_ctxt_ctxt_fix_conv</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="comment1"><span>(* Remove duplicate hn_ctxt tagging *)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.all_to_meta|fact"><span>all_to_meta</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.imp_to_meta|fact"><span>imp_to_meta</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True_implies_equals|fact"><span>HOL.True_implies_equals</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies_True_equals|fact"><span>HOL.implies_True_equals</span></a><span> </span><span>Pure.triv_forall_equality</span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.cnv_conj_to_meta|fact"><span>cnv_conj_to_meta</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="comment1"><span>(* Convert to meta-level, remove vacuous condition *)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> to_hnr_post</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span> </span><span class="comment1"><span>(* Post-Processing *)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Goal.norm_result</span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Conv.fconv_rule</span><span> </span><span>Thm.eta_conversion</span><span>

      </span><span class="comment1"><span>(* Convert schematic hfref-goal to hn_refine goal *)</span></span><span>  
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prepare_hfref_synth_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>i_of_assn_rls</span></span><span> </span><span class="main"><span>=</span></span><span> 
          </span><span class="entity"><span>Named_Theorems_Rev.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems_rev</span></span><span> intf_of_assn</span><span class="antiquote"><span>}</span></span></span><span>
          </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.intf_of_assn_fallback|fact"><span>intf_of_assn_fallback</span></a><span class="antiquote"><span>}</span></span></span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>to_hnr_post_rls</span></span><span> </span><span class="main"><span>=</span></span><span> 
          </span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> to_hnr_post</span><span class="antiquote"><span>}</span></span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>i_of_assn_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>REPEAT'</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span>DETERM</span><span> </span><span>o</span><span> </span><span>dresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfsynth_ID_R_D|fact"><span>hfsynth_ID_R_D</span></a><span class="antiquote"><span>}</span></span></span></span><span>
            </span><span>THEN'</span><span> </span><span>DETERM</span><span> </span><span>o</span><span> </span><span>SOLVED'</span><span> </span><span class="main"><span>(</span></span><span>REPEAT_ALL_NEW</span><span> </span><span class="main"><span>(</span></span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>i_of_assn_rls</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="comment1"><span>(* Note: To re-use the to_hnr infrastructure, we first work with
          $-tags on the abstract function, which are finally removed.
        *)</span></span><span>
        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfsynth_hnr_from_hfI|fact"><span>hfsynth_hnr_from_hfI</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>THEN_ELSE'</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="entity"><span>unfold_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.to_hnr_prod_fst_snd|fact"><span>to_hnr_prod_fst_snd</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.keep_drop_sels|fact"><span>keep_drop_sels</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hf_pres_fst|fact"><span>hf_pres_fst</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="comment1"><span>(* Distribute fst,snd over product and hf_pres *)</span></span><span>
            </span><span>THEN</span><span> </span><span class="entity"><span>unfold_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hnr_uncurry_unfold|fact"><span>hnr_uncurry_unfold</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfsynth_ID_R_uncurry_unfold|fact"><span>hfsynth_ID_R_uncurry_unfold</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="comment1"><span>(* Curry parameters *)</span></span><span>
            </span><span>THEN</span><span> </span><span class="entity"><span>unfold_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry_apply|fact"><span>uncurry_apply</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.uncurry_APP|fact"><span>uncurry_APP</span></a><span> </span><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj_empty&apos;|fact"><span>sep_conj_empty'</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.split|fact"><span>split</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="comment1"><span>(* Curry parameters (II) and remove emp assertion *)</span></span><span>
            </span><span class="comment1"><span>(*THEN unfold_tac ctxt @{thms hn_ctxt_ctxt_fix_conv} (* Remove duplicate hn_ctxt (Should not be necessary) *)*)</span></span><span>
            </span><span>THEN</span><span> </span><span class="entity"><span>unfold_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.all_to_meta|fact"><span>all_to_meta</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.imp_to_meta|fact"><span>imp_to_meta</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True_implies_equals|fact"><span>HOL.True_implies_equals</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies_True_equals|fact"><span>HOL.implies_True_equals</span></a><span> </span><span>Pure.triv_forall_equality</span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.cnv_conj_to_meta|fact"><span>cnv_conj_to_meta</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="comment1"><span>(* Convert precondition to meta-level *)</span></span><span>
            </span><span>THEN</span><span> </span><span>ALLGOALS</span><span> </span><span class="entity"><span>i_of_assn_tac</span></span><span> </span><span class="comment1"><span>(* Generate _::<span class="hidden">⇩</span><sub>i</sub>_ premises*)</span></span><span>
            </span><span>THEN</span><span> </span><span class="entity"><span>unfold_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>to_hnr_post_rls</span></span><span> </span><span class="comment1"><span>(* Postprocessing *)</span></span><span>
            </span><span>THEN</span><span> </span><span class="entity"><span>unfold_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP_def|fact"><span>APP_def</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="comment1"><span>(* Get rid of $ - tags *)</span></span><span>
          </span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span>all_tac</span><span>
        </span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


      </span><span class="comment1"><span>(************************************)</span></span><span>  
      </span><span class="comment1"><span>(* Analyze hnr *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Termtab2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Table</span><span class="main"><span>(</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>key</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>term</span><span> * </span><span>term</span><span> 
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prod_ord</span><span> </span><span>Term_Ord.fast_term_ord</span><span> </span><span>Term_Ord.fast_term_ord</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  
      </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>hnr_analysis</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
        thm</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>                     </span><span class="comment1"><span>(* Original theorem, may be normalized *)</span></span><span>
        precond</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>                </span><span class="comment1"><span>(* Precondition, abstracted over abs-arguments *)</span></span><span>
        ccond</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>                  </span><span class="comment1"><span>(* Concrete precondition, abstracted over conc-arguments *)</span></span><span>
        prems </span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>            </span><span class="comment1"><span>(* Premises not depending on arguments *)</span></span><span>
        ahead</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> * </span><span>bool</span><span class="main"><span>,</span></span><span>           </span><span class="comment1"><span>(* Abstract function, has leading RETURN *)</span></span><span>
        chead</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> * </span><span>bool</span><span class="main"><span>,</span></span><span>           </span><span class="comment1"><span>(* Concrete function, has leading return *)</span></span><span>
        argrels</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>term</span><span> * </span><span>bool</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>  </span><span class="comment1"><span>(* Argument relations, preserved (keep-flag) *)</span></span><span>
        result_rel</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>             </span><span class="comment1"><span>(* Result relation *)</span></span><span>
        cpcond</span><span class="main"><span>:</span></span><span> </span><span>term</span><span>                  </span><span class="comment1"><span>(* Concrete postcondition (abstracted over conc-arguments) *)</span></span><span>
      </span><span class="main"><span>}</span></span><span>
  
    
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>analyze_hnr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>:</span></span><span class="entity"><span>Proof.context</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    
        </span><span class="comment1"><span>(* Debug information: Stores string*term pairs, which are pretty-printed on error *)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dbg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.ref</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_dbg</span></span><span> </span><span class="entity"><span>msg</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>dbg</span></span><span> </span><span>:=</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>msg</span></span><span class="main"><span>,</span></span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span>!</span><span class="entity"><span>dbg</span></span><span class="main"><span>;</span></span><span>
          </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pretty_dbg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>msg</span></span><span class="main"><span>,</span></span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span>Pretty.str</span><span> </span><span class="entity"><span>msg</span></span><span class="main"><span>,</span></span><span>
          </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>,</span></span><span>
          </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>
          </span><span>Pretty.list</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>]</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pretty_dbgs</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>pretty_dbg</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span>|&gt;</span><span> </span><span>Pretty.fbreaks</span><span> </span><span>|&gt;</span><span> </span><span>Pretty.block</span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>trace_dbg</span></span><span> </span><span class="entity"><span>msg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>Pretty.str</span><span> </span><span class="entity"><span>msg</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.fbrk</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pretty_dbgs</span></span><span> </span><span class="main"><span>(</span></span><span>rev</span><span> </span><span class="main"><span>(</span></span><span>!</span><span class="entity"><span>dbg</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>Pretty.string_of</span><span> </span><span>|&gt;</span><span> </span><span>tracing</span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fail</span></span><span> </span><span class="entity"><span>msg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>trace_dbg</span></span><span> </span><span class="entity"><span>msg</span></span><span class="main"><span>;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span class="main"><span>(</span></span><span class="entity"><span>msg</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>assert</span></span><span> </span><span class="entity"><span>cond</span></span><span> </span><span class="entity"><span>msg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>cond</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>fail</span></span><span> </span><span class="entity"><span>msg</span></span><span class="main"><span>;</span></span><span>
    
    
        </span><span class="comment1"><span>(* Heads may have a leading return/RETURN.
          The following code strips off the leading return, unless it has the form
          "return x" for an argument x
        *)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>check_strip_leading</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="comment1"><span>(* Handle the case RETURN x, where x is an argument *)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Termtab.defined</span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span>true</span><span class="main"><span>)</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strip_leading_RETURN</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="var"><span>?f</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>check_strip_leading</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>f</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>strip_leading_RETURN</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="var"><span>?f</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>check_strip_leading</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>f</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>strip_leading_RETURN</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span>false</span><span class="main"><span>)</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strip_leading_return</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="main"><span>(</span></span><span class="var"><span>?f</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>check_strip_leading</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>f</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>strip_leading_return</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="var"><span>?f</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>check_strip_leading</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>f</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>strip_leading_return</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span>false</span><span class="main"><span>)</span></span><span>
    
    
        </span><span class="comment1"><span>(* The following code strips the arguments of the concrete or abstract
          function. It knows how to handle APP-tags ($), and stops at PR_CONST-tags.
    
          Moreover, it only strips actual arguments that occur in the 
          precondition-section of the hn_refine-statement. This ensures
          that non-arguments, like maxsize, are treated correctly.
        *)</span></span><span>    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strip_fun</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Id_Op.html#Sepref_Id_Op.PR_CONST|const"><span>PR_CONST</span></a><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>strip_fun</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><span class="var"><span>?f</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="var"><span>?x</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>check_arg</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>x</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>strip_fun</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><span class="var"><span>?f</span></span><span> </span><span class="var"><span>?x</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>check_arg</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>x</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>strip_fun</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>check_arg</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> 
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Termtab.defined</span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="entity"><span>strip_fun</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span>|&gt;</span><span> </span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>::</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>  
    
        </span><span class="comment1"><span>(* Arguments in the pre/postcondition are wrapped into hn_ctxt tags. 
          This function strips them off. *)</span></span><span>    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_hn_ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="var"><span>?R</span></span><span> </span><span class="var"><span>?a</span></span><span> </span><span class="var"><span>?c</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dest_hn_ctxt</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fail</span></span><span> </span><span class="inner_quoted"><span>"Invalid hn_ctxt parameter in pre or postcondition"</span></span><span>
    
    
        </span><span class="comment1"><span>(*fun dest_hn_refine @{mpat "(hn_refine ?G ?c ?G' ?R ?a)"} = (G,c,G',R,CP,a) 
          | dest_hn_refine _ = fail "Conclusion is not a hn_refine statement"
        *)</span></span><span>
    
        </span><span class="comment1"><span>(*
          Strip separation conjunctions. Special case for "emp", which is ignored. 
        *)</span></span><span>  
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_emp</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_empty|const"><span>□</span></a></span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_emp</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
  
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>strip_star'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sepref_Basic.strip_star</span></span><span> </span><span>#&gt;</span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span>o</span><span> </span><span class="entity"><span>is_emp</span></span><span class="main"><span>)</span></span><span>
  
        </span><span class="comment1"><span>(* Compare Termtab2s for equality of keys *)</span></span><span>  
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pairs_eq</span></span><span> </span><span class="entity"><span>pairs1</span></span><span> </span><span class="entity"><span>pairs2</span></span><span> </span><span class="main"><span>=</span></span><span> 
                  </span><span>Termtab2.forall</span><span> </span><span class="main"><span>(</span></span><span>Termtab2.defined</span><span> </span><span class="entity"><span>pairs1</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pairs2</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>Termtab2.forall</span><span> </span><span class="main"><span>(</span></span><span>Termtab2.defined</span><span> </span><span class="entity"><span>pairs2</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pairs1</span></span><span>
    
    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>atomize_prem</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="var"><span>?p</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>p</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>atomize_prem</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fail</span></span><span> </span><span class="inner_quoted"><span>"Non-atomic premises"</span></span><span>
    
        </span><span class="comment1"><span>(* Make HOL conjunction list *)</span></span><span>  
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="antiquote"><span>}</span></span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>p</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span>::</span><span class="entity"><span>ps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_binop</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> "</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>"</span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span class="entity"><span>mk_conjs</span></span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>)</span></span><span>
    
    
        </span><span class="comment1"><span>(***********************)</span></span><span>      
        </span><span class="comment1"><span>(* Start actual analysis *)</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>add_dbg</span></span><span> </span><span class="inner_quoted"><span>"thm"</span></span><span> </span><span class="main"><span>[</span></span><span>Thm.prop_of</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.prems_of</span><span> </span><span class="entity"><span>thm</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.concl_of</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.dest_Trueprop</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>G</span></span><span class="main"><span>,</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span class="entity"><span>G'</span></span><span class="main"><span>,</span></span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span class="entity"><span>CP</span></span><span class="main"><span>,</span></span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sepref_Basic.dest_hn_refine</span></span><span> </span><span class="entity"><span>concl</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pre_pairs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>G</span></span><span> 
          </span><span>|&gt;</span><span> </span><span class="entity"><span>strip_star'</span></span><span>
          </span><span>|&gt;</span><span> </span><span>tap</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>add_dbg</span></span><span> </span><span class="inner_quoted"><span>"precondition"</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>dest_hn_ctxt</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Termtab2.make</span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>post_pairs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>G'</span></span><span> 
          </span><span>|&gt;</span><span> </span><span class="entity"><span>strip_star'</span></span><span>
          </span><span>|&gt;</span><span> </span><span>tap</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>add_dbg</span></span><span> </span><span class="inner_quoted"><span>"postcondition"</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>dest_hn_ctxt</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Termtab2.make</span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>assert</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pairs_eq</span></span><span> </span><span class="entity"><span>pre_pairs</span></span><span> </span><span class="entity"><span>post_pairs</span></span><span class="main"><span>)</span></span><span> 
          </span><span class="inner_quoted"><span>"Parameters in precondition do not match postcondition"</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>aa_set</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pre_pairs</span></span><span> </span><span>|&gt;</span><span> </span><span>Termtab2.keys</span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>fst</span><span> </span><span>|&gt;</span><span> </span><span>Termtab.make_set</span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ca_set</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pre_pairs</span></span><span> </span><span>|&gt;</span><span> </span><span>Termtab2.keys</span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>snd</span><span> </span><span>|&gt;</span><span> </span><span>Termtab.make_set</span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span class="entity"><span>leading_RETURN</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_leading_RETURN</span></span><span> </span><span class="entity"><span>aa_set</span></span><span> </span><span class="entity"><span>a</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span class="entity"><span>leading_return</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_leading_return</span></span><span> </span><span class="entity"><span>ca_set</span></span><span> </span><span class="entity"><span>c</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>add_dbg</span></span><span> </span><span class="inner_quoted"><span>"stripped abstract term"</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>a</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>add_dbg</span></span><span> </span><span class="inner_quoted"><span>"stripped concrete term"</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>c</span></span><span class="main"><span>]</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ahead</span></span><span class="main"><span>,</span></span><span class="entity"><span>aargs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_fun</span></span><span> </span><span class="entity"><span>aa_set</span></span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>chead</span></span><span class="main"><span>,</span></span><span class="entity"><span>cargs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_fun</span></span><span> </span><span class="entity"><span>ca_set</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>;</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>add_dbg</span></span><span> </span><span class="inner_quoted"><span>"abstract head"</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ahead</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>add_dbg</span></span><span> </span><span class="inner_quoted"><span>"abstract args"</span></span><span> </span><span class="entity"><span>aargs</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>add_dbg</span></span><span> </span><span class="inner_quoted"><span>"concrete head"</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>chead</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>add_dbg</span></span><span> </span><span class="inner_quoted"><span>"concrete args"</span></span><span> </span><span class="entity"><span>cargs</span></span><span>
    
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>assert</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>cargs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>aargs</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"Different number of abstract and concrete arguments"</span></span><span class="main"><span>;</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>assert</span></span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span class="main"><span>(</span></span><span>has_duplicates</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>aargs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"Duplicate abstract arguments"</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>assert</span></span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span class="main"><span>(</span></span><span>has_duplicates</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>cargs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"Duplicate concrete arguments"</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>argpairs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>aargs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>cargs</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ap_set</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Termtab2.make_set</span><span> </span><span class="entity"><span>argpairs</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>assert</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pairs_eq</span></span><span> </span><span class="entity"><span>pre_pairs</span></span><span> </span><span class="entity"><span>ap_set</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"Arguments from pre/postcondition do not match operation's arguments"</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pre_rels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>Termtab2.lookup</span><span> </span><span class="entity"><span>pre_pairs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>argpairs</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>post_rels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>Termtab2.lookup</span><span> </span><span class="entity"><span>post_pairs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>argpairs</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>add_dbg</span></span><span> </span><span class="inner_quoted"><span>"pre-rels"</span></span><span> </span><span class="entity"><span>pre_rels</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>add_dbg</span></span><span> </span><span class="inner_quoted"><span>"post-rels"</span></span><span> </span><span class="entity"><span>post_rels</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>adjust_hf_pres</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="main"><span>(</span></span><span class="var"><span>?R</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfkeep|const"><span><span class="hidden">⇧</span><sup>k</sup></span></a></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>adjust_hf_pres</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t</span></span><span>
          
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>post_rels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>adjust_hf_pres</span></span><span> </span><span class="entity"><span>post_rels</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_invalid</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.invalid_assn|const"><span>invalid_assn</span></a><span> </span><span class="var"><span>?R'</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>R'</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_invalid</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfdrop|const"><span><span class="hidden">⇧</span><sup>d</sup></span></a></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_invalid</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_keep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span class="entity"><span>R'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>R'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>true</span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_invalid</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>R'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>false</span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>fail</span></span><span> </span><span class="inner_quoted"><span>"Mismatch between pre and post relation for argument"</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>keep</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>is_keep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pre_rels</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>post_rels</span></span><span class="main"><span>)</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>argrels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pre_rels</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>keep</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>aa_set</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Termtab.make_set</span><span> </span><span class="entity"><span>aargs</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ca_set</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Termtab.make_set</span><span> </span><span class="entity"><span>cargs</span></span><span>

        
        </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>PCLS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pc_PREM</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>pc_ABS</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>pc_CONC</span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>classify_precond</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>exists_subterm</span><span> </span><span class="main"><span>(</span></span><span>Termtab.defined</span><span> </span><span class="entity"><span>ca_set</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span>exists_subterm</span><span> </span><span class="main"><span>(</span></span><span>Termtab.defined</span><span> </span><span class="entity"><span>aa_set</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span class="main"><span>(</span></span><span>false</span><span class="main"><span>,</span></span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pc_PREM</span></span><span class="main"><span>,</span></span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pc_CONC</span></span><span class="main"><span>,</span></span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>false</span><span class="main"><span>,</span></span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pc_ABS</span></span><span class="main"><span>,</span></span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fail</span></span><span> </span><span class="inner_quoted"><span>"Premise contains abstract and concrete argument"</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>classify_precond</span></span><span> </span><span class="entity"><span>prems</span></span><span>  
                  
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>preconds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>=</span></span><span class="entity"><span>pc_ABS</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>snd</span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cconds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>=</span></span><span class="entity"><span>pc_CONC</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>snd</span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>=</span></span><span class="entity"><span>pc_PREM</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>snd</span><span>
        
        </span><span class="comment1"><span>(*fun is_precond t =
          (exists_subterm (Termtab.defined ca_set) t andalso fail "Premise contains concrete argument")
          orelse exists_subterm (Termtab.defined aa_set) t

        val (preconds, prems) = split is_precond prems  
        *)</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>precond</span></span><span> </span><span class="main"><span>=</span></span><span> 
          </span><span>map</span><span> </span><span class="entity"><span>atomize_prem</span></span><span> </span><span class="entity"><span>preconds</span></span><span> 
          </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span>
          </span><span>|&gt;</span><span> </span><span>fold</span><span> </span><span>lambda</span><span> </span><span class="entity"><span>aargs</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ccond</span></span><span> </span><span class="main"><span>=</span></span><span> 
          </span><span>map</span><span> </span><span class="entity"><span>atomize_prem</span></span><span> </span><span class="entity"><span>cconds</span></span><span> 
          </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span>
          </span><span>|&gt;</span><span> </span><span>fold</span><span> </span><span>lambda</span><span> </span><span class="entity"><span>cargs</span></span><span>
          
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>add_dbg</span></span><span> </span><span class="inner_quoted"><span>"precond"</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>precond</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>add_dbg</span></span><span> </span><span class="inner_quoted"><span>"ccond"</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ccond</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>add_dbg</span></span><span> </span><span class="inner_quoted"><span>"prems"</span></span><span> </span><span class="entity"><span>prems</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cpcond</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span>lambda</span><span> </span><span class="entity"><span>cargs</span></span><span> </span><span class="entity"><span>CP</span></span><span>  
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span>lambda</span><span> </span><span class="entity"><span>aargs</span></span><span> </span><span class="entity"><span>R</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>add_dbg</span></span><span> </span><span class="inner_quoted"><span>"cpcond"</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>cpcond</span></span><span class="main"><span>]</span></span><span>
        
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>{</span></span><span>
          thm </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span>
          precond </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>precond</span></span><span class="main"><span>,</span></span><span>
          ccond </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ccond</span></span><span class="main"><span>,</span></span><span>
          prems </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
          ahead </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ahead</span></span><span class="main"><span>,</span></span><span class="entity"><span>leading_RETURN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          chead </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>chead</span></span><span class="main"><span>,</span></span><span class="entity"><span>leading_return</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          argrels </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>argrels</span></span><span class="main"><span>,</span></span><span>
          result_rel </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span>
          cpcond </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>cpcond</span></span><span>
        </span><span class="main"><span>}</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>  
    
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pretty_hnr_analysis</span></span><span> 
        </span><span class="entity"><span>ctxt</span></span><span> 
        </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span class="entity"><span>precond</span></span><span class="main"><span>,</span></span><span class="entity"><span>ccond</span></span><span class="main"><span>,</span></span><span class="entity"><span>ahead</span></span><span class="main"><span>,</span></span><span class="entity"><span>chead</span></span><span class="main"><span>,</span></span><span class="entity"><span>argrels</span></span><span class="main"><span>,</span></span><span class="entity"><span>result_rel</span></span><span class="main"><span>,</span></span><span class="entity"><span>cpcond</span></span><span class="main"><span>,</span></span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> 
        </span><span class="main"><span>:</span></span><span> </span><span>Pretty.T</span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>  
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="comment1"><span>(* Suppress unused warning for thm *)</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pretty_argrel</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span class="entity"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"<span class="hidden">⇧</span><sup>k</sup>"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"<span class="hidden">⇧</span><sup>d</sup>"</span></span><span>
        </span><span class="main"><span>]</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pretty_chead</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>chead</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> 
          </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span> 
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"return "</span></span><span class="main"><span>,</span></span><span> </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pretty_ahead</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>ahead</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> 
          </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span> 
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"RETURN "</span></span><span class="main"><span>,</span></span><span> </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span>

      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Pretty.fbreaks</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span class="comment1"><span>(*Display.pretty_thm ctxt thm,*)</span></span><span>
          </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span> 
            </span><span>Pretty.enclose</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>pretty_chead</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pretty_ahead</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>Pretty.enclose</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span class="main"><span>[</span></span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>precond</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>Pretty.enclose</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span class="main"><span>[</span></span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ccond</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>
            </span><span>Pretty.block</span><span> </span><span class="main"><span>(</span></span><span>Pretty.separate</span><span> </span><span class="inner_quoted"><span>" →"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>pretty_argrel</span></span><span> </span><span class="entity"><span>argrels</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>result_rel</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>
            </span><span>Pretty.enclose</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span class="main"><span>[</span></span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>cpcond</span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>]</span></span><span>
        </span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>Pretty.block</span><span>
    
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    
    
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_hfref_thm</span></span><span> 
        </span><span class="entity"><span>ctxt</span></span><span> 
        </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span class="entity"><span>precond</span></span><span class="main"><span>,</span></span><span class="entity"><span>ccond</span></span><span class="main"><span>,</span></span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span class="entity"><span>ahead</span></span><span class="main"><span>,</span></span><span class="entity"><span>chead</span></span><span class="main"><span>,</span></span><span class="entity"><span>argrels</span></span><span class="main"><span>,</span></span><span class="entity"><span>result_rel</span></span><span class="main"><span>,</span></span><span class="entity"><span>cpcond</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_keep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><span class="var"><span>?R</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfkeep|const"><span><span class="hidden">⇧</span><sup>k</sup></span></a></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_keep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><span class="var"><span>?R</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfdrop|const"><span><span class="hidden">⇧</span><sup>d</sup></span></a></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
    
        </span><span class="comment1"><span>(* TODO: Move, this is of general use! *)</span></span><span>  
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_uncurry</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry|const"><span>uncurry</span></a><span> </span><span class="var"><span>?f</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>  
      
        </span><span class="comment1"><span>(* Uncurry function for the given number of arguments. 
          For zero arguments, add a unit-parameter.
        *)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rpt_uncurry</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>=</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Misc.html#Sepref_Misc.uncurry0|const"><span>uncurry0</span></a><span> </span><span class="var"><span>?t</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>=</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>t</span></span><span> 
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>funpow</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mk_uncurry</span></span><span> </span><span class="entity"><span>t</span></span><span>
      
        </span><span class="comment1"><span>(* Rewrite uncurried lambda's to λ(_,_). _ form. Use top-down rewriting
          to correctly handle nesting to the left. 
    
          TODO: Combine with abstraction and  uncurry-procedure,
            and mark the deviation about uncurry as redundant 
            intermediate step to be eliminated.
        *)</span></span><span>  
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rew_uncurry_lambda</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Logic.dest_equals</span><span> </span><span>o</span><span> </span><span>Thm.prop_of</span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry_def|fact"><span>uncurry_def</span></a><span> </span><a class="entity_ref" href="Sepref_Misc.html#Sepref_Misc.uncurry0_def|fact"><span>uncurry0_def</span></a><span class="antiquote"><span>}</span></span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> 
          </span><span>Pattern.rewrite_term_top</span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>rr</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>t</span></span><span> 
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>  
    
        </span><span class="comment1"><span>(* Shortcuts for simplification tactics *)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gsimp_only</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sec</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>sec</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>asm_full_simp_tac</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>simp_only</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gsimp_only</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span>
    
    
        </span><span class="comment1"><span>(********************************)</span></span><span>
        </span><span class="comment1"><span>(* Build theorem statement *)</span></span><span>
        </span><span class="comment1"><span>(* ⟦prems⟧ ⟹ (chead,ahead) ∈ [precond] rels → R *)</span></span><span>
    
        </span><span class="comment1"><span>(* Uncurry precondition *)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>num_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>argrels</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>precond</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>precond</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>rpt_uncurry</span></span><span> </span><span class="entity"><span>num_args</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>rew_uncurry_lambda</span></span><span> </span><span class="comment1"><span>(* Convert to nicer λ((...,_),_) - form*)</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ccond</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ccond</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>rpt_uncurry</span></span><span> </span><span class="entity"><span>num_args</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>rew_uncurry_lambda</span></span><span> </span><span class="comment1"><span>(* Convert to nicer λ((...,_),_) - form*)</span></span><span>
          
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cpcond</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>cpcond</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>rpt_uncurry</span></span><span> </span><span class="entity"><span>num_args</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>rew_uncurry_lambda</span></span><span> </span><span class="comment1"><span>(* Convert to nicer λ((...,_),_) - form*)</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>result_rel</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>result_rel</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>rpt_uncurry</span></span><span> </span><span class="entity"><span>num_args</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>rew_uncurry_lambda</span></span><span> </span><span class="comment1"><span>(* Convert to nicer λ((...,_),_) - form*)</span></span><span>
                    
        </span><span class="comment1"><span>(* Re-attach leading RETURN/return *)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_RETURN</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> 
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>funpow</span><span> </span><span class="entity"><span>num_args</span></span><span> </span><span>range_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>ahead</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tRETURN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span>Type</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>type_name</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>T</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>Refine_Util.mk_compN</span></span><span> </span><span class="entity"><span>num_args</span></span><span> </span><span class="entity"><span>tRETURN</span></span><span> </span><span class="entity"><span>t</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>  
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>t</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_return</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="var"><span>?t</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>_</span></span><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span><span>
            </span><span class="comment1"><span>(*let
              val T = funpow num_args range_type (fastype_of (fst chead))
              val tRETURN = Const (@{const_name return}, T --&gt; Type(@{type_name llvm_memory},[T]))
            in
              Refine_Util.mk_compN num_args tRETURN t
            end  *)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>t</span></span><span>
          
        </span><span class="comment1"><span>(* Hrmpf!: Gone for good from 2015→2016. Inserting ctxt-based substitute here. *)</span></span><span>  
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>certify_inst</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>instT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
         </span><span class="main"><span>(</span></span><span>TVars.map</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span>Thm.ctyp_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>instT</span></span><span class="main"><span>,</span></span><span>
          </span><span>Vars.map</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="comment1"><span>(*  
        fun mk_RETURN (t,r) = if r then @{mk_term "RETURN o ?t"} else t
        fun mk_return (t,r) = if r then @{mk_term "return o ?t"} else t
        *)</span></span><span>
    
        </span><span class="comment1"><span>(* Uncurry abstract and concrete function, append leading return *)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ahead</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ahead</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_RETURN</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>rpt_uncurry</span></span><span> </span><span class="entity"><span>num_args</span></span><span>  
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>chead</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>chead</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_return</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>rpt_uncurry</span></span><span> </span><span class="entity"><span>num_args</span></span><span> 
    
        </span><span class="comment1"><span>(* Add keep-flags and summarize argument relations to product *)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>argrel</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_keep</span></span><span> </span><span class="entity"><span>argrels</span></span><span> </span><span>|&gt;</span><span> </span><span>rev</span><span> </span><span class="comment1"><span>(* TODO: Why this rev? *)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_hfprods</span></span><span>
    
        </span><span class="comment1"><span>(* Produce final result statement *)</span></span><span>
        
        </span><span class="comment1"><span>(*val _ = @{print} chead
        val _ = @{print} (fastype_of chead)*)</span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="var"><span>?chead</span></span><span class="main"><span>,</span></span><span class="var"><span>?ahead</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="var"><span>?precond</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>a</sub></span></a></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="var"><span>?ccond</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span> </span><span class="var"><span>?argrel</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>→<span class="hidden">⇩</span><sub>d</sub></span></a></span><span> </span><span class="var"><span>?result_rel</span></span><span> </span><span class="main"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>[</span></a></span><span class="var"><span>?cpcond</span></span><span class="keyword1"><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref|const"><span>]<span class="hidden">⇩</span><sub>c</sub></span></a></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span class="entity"><span>result</span></span><span class="main"><span>)</span></span><span>
    
        </span><span class="comment1"><span>(********************************)</span></span><span>
        </span><span class="comment1"><span>(* Prove theorem *)</span></span><span>
    
        </span><span class="comment1"><span>(* Create context and import result statement and original theorem *)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>orig_ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="comment1"><span>(*val thy = Proof_Context.theory_of ctxt*)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>insts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.import_inst</span><span> </span><span>true</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>result</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>insts'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>certify_inst</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>insts</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term_Subst.instantiate</span><span> </span><span class="entity"><span>insts</span></span><span> </span><span class="entity"><span>result</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.instantiate</span><span> </span><span class="entity"><span>insts'</span></span><span> </span><span class="entity"><span>thm</span></span><span>
    
        </span><span class="comment1"><span>(* Unfold APP tags. This is required as some APP-tags have also been unfolded by analysis *)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP_def|fact"><span>APP_def</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>thm</span></span><span>
    
        </span><span class="comment1"><span>(* Tactic to prove the theorem. 
          A first step uses hfrefI to get a hnr-goal.
          This is then normalized in several consecutive steps, which 
            get rid of uncurrying. Finally, the original theorem is used for resolution,
            where the pre- and postcondition, and result relation are connected with 
            a consequence rule, to handle unfolded hn_ctxt-tags, re-ordered relations,
            and introduced unit-parameters (TODO: 
              Mark artificially introduced unit-parameter specially, it may get confused 
              with intentional unit-parameter, e.g., functional empty_set ()!)
    
          *)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> 
                </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfrefI|fact"><span>hfrefI</span></a><span class="antiquote"><span>}</span></span></span></span><span>
          </span><span>THEN'</span><span> </span><span class="entity"><span>gsimp_only</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>c</span></span><span> 
            </span><span>addsimps</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.uncurry_def|fact"><span>uncurry_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span> </span><a class="entity_ref" href="Sepref_Misc.html#Sepref_Misc.uncurry0_def|fact"><span>uncurry0_def</span></a><span>
                            </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.keep_drop_sels|fact"><span>keep_drop_sels</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.uc_hfprod_sel|fact"><span>uc_hfprod_sel</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.o_apply|fact"><span>o_apply</span></a><span>
                            </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP_def|fact"><span>APP_def</span></a><span class="antiquote"><span>}</span></span></span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>Splitter.add_split</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.split|fact"><span>prod.split</span></a><span class="antiquote"><span>}</span></span></span></span><span>
          </span><span class="main"><span>)</span></span><span> 
    
          </span><span>THEN'</span><span> </span><span>TRY</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>
            </span><span>REPEAT_ALL_NEW</span><span> </span><span class="main"><span>(</span></span><span>match_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.allI|fact"><span>allI</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.impI|fact"><span>impI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
            </span><span>THEN'</span><span> </span><span class="entity"><span>simp_only</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.split|fact"><span>Product_Type.split</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.inject|fact"><span>prod.inject</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
    
          </span><span>THEN'</span><span> </span><span>TRY</span><span> </span><span>o</span><span> </span><span>REPEAT_ALL_NEW</span><span> </span><span class="main"><span>(</span></span><span>ematch_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjE|fact"><span>conjE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
          </span><span>THEN'</span><span> </span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
          </span><span>THEN'</span><span> </span><span class="entity"><span>simp_only</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><span>triv_forall_equality</span><span class="antiquote"><span>}</span></span></span></span><span>
          </span><span>THEN'</span><span> </span><span class="main"><span>(</span></span><span>
            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_cons|fact"><span>hn_refine_cons</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> 
            </span><span>THEN'</span><span> </span><span class="main"><span>(</span></span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span> </span><span>THEN_ALL_NEW</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>THEN_ALL_NEW</span><span> </span><span class="entity"><span>simp_only</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span> </span><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails_refl|fact"><span>entails_refl</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.pure_unit_rel_eq_empty|fact"><span>pure_unit_rel_eq_empty</span></a><span>
              </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.mult_ac|fact"><span>mult_ac</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.mult_1|fact"><span>mult_1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.monoid_mult_class.mult_1_right|fact"><span>mult_1_right</span></a><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.keep_drop_sels|fact"><span>keep_drop_sels</span></a><span class="antiquote"><span>}</span></span></span></span><span>  
    
        </span><span class="comment1"><span>(* Prove theorem *)</span></span><span>  
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>result</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rthm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Goal.prove_internal</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    
        </span><span class="comment1"><span>(* Export statement to original context *)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rthm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>singleton</span><span> </span><span class="main"><span>(</span></span><span>Variable.export</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>orig_ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rthm</span></span><span>
    
        </span><span class="comment1"><span>(* Post-processing *)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rthm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> to_hfref_post</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rthm</span></span><span>

      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>rthm</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>to_hfref</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>analyze_hnr</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>mk_hfref_thm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>




      </span><span class="comment1"><span>(***********************************)</span></span><span>
      </span><span class="comment1"><span>(* Composition *)</span></span><span>

      </span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>norm_set_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
          trans_rules </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> fcomp_norm_trans</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span>
          cong_rules </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> fcomp_norm_cong</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span>
          norm_rules </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> fcomp_norm_norm</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span>
          refl_rules </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> fcomp_norm_refl</span><span class="antiquote"><span>}</span></span></span><span>
        </span><span class="main"><span>}</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>init_rules_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> fcomp_norm_init</span><span class="antiquote"><span>}</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unfold_rules_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> fcomp_norm_unfold</span><span class="antiquote"><span>}</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>simp_rules_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> fcomp_norm_simps</span><span class="antiquote"><span>}</span></span></span><span>

      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>  
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>norm_fcomp_rule</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>PO_Normalizer</span><span> </span><span>Refine_Util</span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>norm1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_norm_rule</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>init_rules_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>norm_set_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>norm2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_rules_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>norm3</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Conv.fconv_rule</span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="entity"><span>Simplifier.asm_full_rewrite</span></span><span> 
              </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="entity"><span>simp_rules_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>norm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>changed_rule</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>try_rule</span></span><span> </span><span class="entity"><span>norm1</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>try_rule</span></span><span> </span><span class="entity"><span>norm2</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>try_rule</span></span><span> </span><span class="entity"><span>norm3</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="entity"><span>repeat_rule</span></span><span> </span><span class="entity"><span>norm</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>  

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_pure_constraints_rule</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>orig_ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.prop_of</span><span> </span><span class="entity"><span>thm</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> 
          </span><span class="entity"><span>cnv</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="main"><span>(</span></span><span class="quasi_keyword"><span>typs</span></span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure|const"><span>pure</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Mpat_Antiquot.html#Mpat_Antiquot.mpaq_STRUCT|const"><span>mpaq_STRUCT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Mpat_Antiquot.html#Mpat_Antiquot.mpaq_Var|const"><span>mpaq_Var</span></a><span> </span><span class="var"><span>?x</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>(</span></span><span class="tvar"><span>?'v_c</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span class="tvar"><span>?'v_a</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> 
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>c</span></span><span> </span><span>--&gt;</span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>typ</span></span><span> </span><span class="quoted"><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.assn|type"><span>assn</span></a></span><span class="antiquote"><span>}</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.the_pure|const"><span>the_pure</span></a><span> </span><span class="var"><span>?t</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>cnv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span>$</span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>union</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cnv</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cnv</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>cnv</span></span><span> </span><span class="main"><span>(</span></span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>cnv</span></span><span> </span><span class="entity"><span>t</span></span><span>  
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>cnv</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>cnv</span></span><span> </span><span class="entity"><span>t</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pvars</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>|&gt;</span><span> </span><span>has_duplicates</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> 
          </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Duplicate indexname with different type"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="comment1"><span>(* This should not happen *)</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>substs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pvars</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>subst_Vars</span><span> </span><span class="entity"><span>substs</span></span><span> </span><span class="entity"><span>t</span></span><span>  
    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_asm</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT|const"><span>CONSTRAINT</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.is_pure|const"><span>is_pure</span></a><span> </span><span class="var"><span>?t</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="entity"><span>t</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>assms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_asm</span></span><span> </span><span class="entity"><span>pvars</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_prems</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.strip_imp_prems</span><span> </span><span class="entity"><span>t</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.strip_imp_concl</span><span> </span><span class="entity"><span>t</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span>@</span><span class="entity"><span>prems'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>add_prems</span></span><span> </span><span class="entity"><span>assms</span></span><span> </span><span class="entity"><span>t'</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t'</span></span><span class="main"><span>,</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span>Variable.import_terms</span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Goal.prove_internal</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> 
          </span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span> </span><span>THEN_ALL_NEW</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>norm_fcomp_rule</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm'</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>singleton</span><span> </span><span class="main"><span>(</span></span><span>Variable.export</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>orig_ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm'</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>thm'</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>  


      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cfg_simp_precond</span></span><span> </span><span class="main"><span>=</span></span><span> 
        </span><span class="entity"><span>Attrib.setup_config_bool</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> </span><span class="entity_def" id="Sepref_Rules.fcomp_simp_precond|attribute"><span>fcomp_simp_precond</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>true</span><span class="main"><span>)</span></span><span>

      </span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_simp_thm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Goal.init</span><span>
      
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Context_Position.set_visible</span><span> </span><span>false</span><span> </span><span class="entity"><span>ctxt</span></span><span>  
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>refine_pw_simps.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
            </span><span>@</span><span> </span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> fcomp_prenorm_simps</span><span class="antiquote"><span>}</span></span></span><span>
            </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.split_tupled_all|fact"><span>split_tupled_all</span></a><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/Misc.html#Misc.cnv_conj_to_meta|fact"><span>cnv_conj_to_meta</span></a><span class="antiquote"><span>}</span></span></span></span><span>  
            </span><span class="main"><span>)</span></span><span>
          
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>trace_incomplete_transfer_tac</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span>COND</span><span> </span><span class="main"><span>(</span></span><span>Thm.prems_of</span><span> </span><span>#&gt;</span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span>strip_all_body</span><span> </span><span>#&gt;</span><span> </span><span>Logic.strip_imp_concl</span><span> </span><span>#&gt;</span><span> </span><span>Term.is_open</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span>print_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="inner_quoted"><span>"Failed transfer from intermediate level:"</span></span><span class="main"><span>)</span></span><span> </span><span>all_tac</span><span>
    
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=</span></span><span> 
            </span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.auto_weaken_pre_comp_PRE_I|fact"><span>auto_weaken_pre_comp_PRE_I</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>)</span></span><span>
            </span><span>THEN</span><span> </span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Simplifier.asm_full_simp_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
            </span><span>THEN</span><span> </span><span class="entity"><span>trace_incomplete_transfer_tac</span></span><span>
            </span><span>THEN</span><span> </span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span>TRY</span><span> </span><span>o</span><span> </span><span>filter_prems_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>false</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>THEN</span><span> </span><span>Local_Defs.unfold0_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>Drule.triv_forall_equality</span><span class="main"><span>]</span></span><span>
      
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>st'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span>|&gt;</span><span> </span><span>Seq.take</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>|&gt;</span><span> </span><span>Seq.list_of</span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>st'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>st'</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.conclude</span><span> </span><span class="entity"><span>st'</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Simp_Precond: Simp-Tactic failed"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>st</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    
          </span><span class="comment1"><span>(* Check generated premises for leftover intermediate stuff *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span>Logic.is_all</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.prems_of</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> 
            </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Simp_Precond: Transfer from intermediate level failed"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> 
             </span><span class="entity"><span>thm</span></span><span>
          </span><span class="comment1"><span>(*|&gt; map (Simplifier.asm_full_simplify ctxt)*)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Conv.fconv_rule</span><span> </span><span class="main"><span>(</span></span><span>Object_Logic.atomize</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.auto_weaken_pre_to_imp_nf|fact"><span>auto_weaken_pre_to_imp_nf</span></a><span class="antiquote"><span>}</span></span></span></span><span>
    
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.concl_of</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.auto_weaken_pre_add_dummy_imp|fact"><span>auto_weaken_pre_add_dummy_imp</span></a><span class="antiquote"><span>}</span></span></span></span><span>  
          </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Simp_Precond: Generated odd theorem, expected form 'P⟶Q'"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    
    
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="entity"><span>thm</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>  
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>simplify_precond</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>orig_ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Refine_Util.OF_fst</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.auto_weaken_pre_init|fact"><span>auto_weaken_pre_init</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>[</span></span><span>asm_rl</span><span class="main"><span>,</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> 
            </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.split_tupled_all|fact"><span>split_tupled_all</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>thm</span></span><span>
            </span><span>OF</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.auto_weaken_pre_uncurry_start|fact"><span>auto_weaken_pre_uncurry_start</span></a><span class="antiquote"><span>}</span></span></span></span><span>
      
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rec_uncurry</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.auto_weaken_pre_uncurry_step|fact"><span>auto_weaken_pre_uncurry_step</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
              </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.auto_weaken_pre_uncurry_finish|fact"><span>auto_weaken_pre_uncurry_finish</span></a><span class="antiquote"><span>}</span></span></span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>rec_uncurry</span></span><span> </span><span class="entity"><span>thm</span></span><span>  
      
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rec_uncurry</span></span><span> </span><span class="entity"><span>thm</span></span><span>  
            </span><span>|&gt;</span><span> </span><span>Conv.fconv_rule</span><span> </span><span>Thm.eta_conversion</span><span>
      
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.prems_of</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span class="entity"><span>t</span></span><span>::</span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Simp-Precond: Expected at least one premise"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span>Variable.import_terms</span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.focus</span><span> </span><span>NONE</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="var"><span>?t</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Simp_Precond: Expected implication"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>simpthm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_simp_thm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span>  
            </span><span>|&gt;</span><span> </span><span>singleton</span><span> </span><span class="main"><span>(</span></span><span>Variable.export</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>orig_ctxt</span></span><span class="main"><span>)</span></span><span>
            
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>simpthm</span></span><span class="main"><span>]</span></span><span>  
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.prod_casesK|fact"><span>prod_casesK</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>thm</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="entity"><span>thm</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>simplify_precond_if_cfg</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>cfg_simp_precond</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="entity"><span>simplify_precond</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>I</span><span>

      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>  

      </span><span class="comment1"><span>(* fref O fref *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>compose_ff</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="main"><span>=</span></span><span> 
          </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref_compI_PRE|fact"><span>fref_compI_PRE</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>A</span></span><span class="main"><span>,</span></span><span class="entity"><span>B</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>norm_fcomp_rule</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>simplify_precond_if_cfg</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Conv.fconv_rule</span><span> </span><span>Thm.eta_conversion</span><span>

      </span><span class="comment1"><span>(* hfref O fref *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>compose_hf</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.hfref_compI_PRE|fact"><span>hfref_compI_PRE</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>A</span></span><span class="main"><span>,</span></span><span class="entity"><span>B</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>norm_fcomp_rule</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>simplify_precond_if_cfg</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Conv.fconv_rule</span><span> </span><span>Thm.eta_conversion</span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>add_pure_constraints_rule</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Conv.fconv_rule</span><span> </span><span>Thm.eta_conversion</span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ensure_fref</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>rthm_type</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span class="entity"><span>RT_HOPARAM</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>to_fref</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>RT_FREF</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Expected parametricity or fref theorem"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ensure_fref_nres</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ensure_fref</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.concl_of</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="main"><span>(</span></span><span class="quasi_keyword"><span>typs</span></span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>::</span></span><span class="main"><span>_</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nres|type"><span>nres</span></a><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.fref|const"><span>fref</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> 
            </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.ensure_fref_nresI|fact"><span>ensure_fref_nresI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.ensure_fref_nres_unfold|fact"><span>ensure_fref_nres_unfold</span></a><span class="antiquote"><span>}</span></span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Expected fref-theorem"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ensure_hfref</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>rthm_type</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span class="entity"><span>RT_HNR</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>to_hfref</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>RT_HFREF</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Expected hnr or hfref theorem"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ensure_hnr</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>rthm_type</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span class="entity"><span>RT_HNR</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>RT_HFREF</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>to_hnr</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Expected hnr or hfref theorem"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_compose</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rtA</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rthm_type</span></span><span> </span><span class="entity"><span>A</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>rtA</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>RT_HOPARAM</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>rtA</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>RT_FREF</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="entity"><span>compose_ff</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ensure_fref</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ensure_fref</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>  
          </span><span class="entity"><span>compose_hf</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ensure_hfref</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ensure_fref_nres</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_fcomp_flags</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Refine_Util.parse_paren_lists</span></span><span> 
        </span><span class="main"><span>(</span></span><span class="entity"><span>Refine_Util.parse_bool_config</span></span><span> </span><span class="inner_quoted"><span>"prenorm"</span></span><span> </span><span class="entity"><span>cfg_simp_precond</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fcomp_attrib</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>parse_fcomp_flags</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>Attrib.thm</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Thm.rule_attribute</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> 
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Context.proof_of</span><span> </span><span class="entity"><span>context</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>  
        </span><span class="entity"><span>gen_compose</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>B</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  ›</span></span><span>

  </span><span class="keyword1"><span class="command"><span>attribute_setup</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.to_fref|attribute"><span>to_fref</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹
    </span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span>Thm.rule_attribute</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sepref_Rules.to_fref</span></span><span> </span><span>o</span><span> </span><span>Context.proof_of</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  ›</span></span><span> </span><span class="quoted"><span>"Convert parametricity theorem to uncurried fref-form"</span></span><span> 

  </span><span class="keyword1"><span class="command"><span>attribute_setup</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.to_foparam|attribute"><span>to_foparam</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹
      </span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span>Thm.rule_attribute</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sepref_Rules.to_foparam</span></span><span> </span><span>o</span><span> </span><span>Context.proof_of</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  ›</span></span><span> </span><span class="quoted"><span>‹Convert param or fref rule to first order rule›</span></span><span>
  </span><span class="comment1"><span>(* Overloading existing param_fo - attribute from Parametricity.thy *)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>attribute_setup</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.param_fo|attribute"><span>param_fo</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹
      </span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span>Thm.rule_attribute</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sepref_Rules.to_foparam</span></span><span> </span><span>o</span><span> </span><span>Context.proof_of</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  ›</span></span><span> </span><span class="quoted"><span>‹Convert param or fref rule to first order rule›</span></span><span>

  </span><span class="keyword1"><span class="command"><span>attribute_setup</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.to_hnr|attribute"><span>to_hnr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹
    </span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span>Thm.rule_attribute</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sepref_Rules.to_hnr</span></span><span> </span><span>o</span><span> </span><span>Context.proof_of</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  ›</span></span><span> </span><span class="quoted"><span>"Convert hfref-rule to hnr-rule"</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>attribute_setup</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.to_hfref|attribute"><span>to_hfref</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span>
      </span><span>Thm.rule_attribute</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Context.proof_of</span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>Sepref_Rules.to_hfref</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span>›</span></span><span> </span><span class="quoted"><span>‹Convert hnr to hfref theorem›</span></span><span>


  </span><span class="keyword1"><span class="command"><span>attribute_setup</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.ensure_fref_nres|attribute"><span>ensure_fref_nres</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span>
      </span><span>Thm.rule_attribute</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Context.proof_of</span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>Sepref_Rules.ensure_fref_nres</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span>›</span></span><span>

  </span><span class="keyword1"><span class="command"><span>attribute_setup</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.sepref_dbg_norm_fcomp_rule|attribute"><span>sepref_dbg_norm_fcomp_rule</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span>
      </span><span>Thm.rule_attribute</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Context.proof_of</span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>Sepref_Rules.norm_fcomp_rule</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span>›</span></span><span>

  </span><span class="keyword1"><span class="command"><span>attribute_setup</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.sepref_simplify_precond|attribute"><span>sepref_simplify_precond</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span>
      </span><span>Thm.rule_attribute</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Context.proof_of</span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>Sepref_Rules.simplify_precond</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span>›</span></span><span> </span><span class="quoted"><span>‹Simplify precondition of fref/hfref-theorem›</span></span><span>

  </span><span class="keyword1"><span class="command"><span>attribute_setup</span></span></span><span> </span><span class="entity_def" id="Sepref_Rules.FCOMP|attribute"><span>FCOMP</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sepref_Rules.fcomp_attrib</span></span><span> </span><span class="quoted"><span>"Composition of refinement rules"</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>