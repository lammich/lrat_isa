<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Sepref_Constraints</title>
</head>


<body>
<div class="head">
<h1>Theory Sepref_Constraints</h1>
</div>

<pre class="source"><span class="comment1"><span>(* TODO: Redundancy with Defer-Slot from llvm-lib!  *)</span></span><span>
</span><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><a href="Sepref_Constraints.html"><span>Sepref_Constraints</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> </span><a href="../../HOL/HOL/Main.html"><span>Main</span></a><span> </span><a href="../../AFP/Automatic_Refinement/Refine_Lib.html"><span>Automatic_Refinement.Refine_Lib</span></a><span> </span><a href="Sepref_Basic.html"><span>Sepref_Basic</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Constraints.CONSTRAINT_SLOT_def|fact"><span class="entity_def" id="Sepref_Constraints.CONSTRAINT_SLOT_def|thm"><span class="entity_def" id="Sepref_Constraints.CONSTRAINT_SLOT_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Sepref_Constraints.CONSTRAINT_SLOT|const"><span>CONSTRAINT_SLOT</span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>::</span></span><span>prop</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span>"</span></span></span><span>

</span><span class="comment1"><span>(* TODO: Find something better than True to put in empty slot! Perhaps "A⟹A" *)</span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_271..276">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Constraints.insert_slot_rl1|fact"><span class="entity_def" id="Sepref_Constraints.insert_slot_rl1|thm"><span>insert_slot_rl1</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT_SLOT|const"><span>CONSTRAINT_SLOT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>Q</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT_SLOT|const"><span>CONSTRAINT_SLOT</span></a><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>P</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>Q</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Constraints.html#offset_271..276"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT_SLOT_def|fact"><span>CONSTRAINT_SLOT_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_467..472">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Constraints.insert_slot_rl2|fact"><span class="entity_def" id="Sepref_Constraints.insert_slot_rl2|thm"><span>insert_slot_rl2</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT_SLOT|const"><span>CONSTRAINT_SLOT</span></a><span> </span><span class="free"><span>S</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>Q</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT_SLOT|const"><span>CONSTRAINT_SLOT</span></a><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>&amp;&amp;&amp;</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>P</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="free"><span>Q</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Constraints.html#offset_467..472"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT_SLOT_def|fact"><span>CONSTRAINT_SLOT_def</span></a><span> </span><span>conjunction_def</span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Constraints.remove_slot|fact"><span class="entity_def" id="Sepref_Constraints.remove_slot|thm"><span>remove_slot</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT_SLOT|const"><span>CONSTRAINT_SLOT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT_SLOT_def|fact"><span>CONSTRAINT_SLOT_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Constraints.CONSTRAINT_def|fact"><span class="entity_def" id="Sepref_Constraints.CONSTRAINT_def|thm"><span class="entity_def" id="Sepref_Constraints.CONSTRAINT_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Constraints.CONSTRAINT|const"><span>CONSTRAINT</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>CONSTRAINT</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_839..844">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Constraints.CONSTRAINT_D|fact"><span class="entity_def" id="Sepref_Constraints.CONSTRAINT_D|thm"><span>CONSTRAINT_D</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT|const"><span>CONSTRAINT</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>P</span></span><span class="main"><span>::</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Constraints.html#offset_839..844"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT_def|fact"><span>CONSTRAINT_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_962..967">lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Constraints.CONSTRAINT_I|fact"><span class="entity_def" id="Sepref_Constraints.CONSTRAINT_I|thm"><span>CONSTRAINT_I</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT|const"><span>CONSTRAINT</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>P</span></span><span class="main"><span>::</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Sepref_Constraints.html#offset_962..967"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT_def|fact"><span>CONSTRAINT_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Special predicate to indicate unsolvable constraint.
  The constraint solver refuses to put those into slot.
  Thus, adding safe rules introducing this can be used to indicate 
  unsolvable constraints early.
›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Sepref_Constraints.CN_FALSE_def|fact"><span class="entity_def" id="Sepref_Constraints.CN_FALSE_def|thm"><span class="entity_def" id="Sepref_Constraints.CN_FALSE_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Sepref_Constraints.CN_FALSE|const"><span>CN_FALSE</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span class="main"><span>⇒</span></span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>CN_FALSE</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span>"</span></span></span><span>  
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Sepref_Constraints.CN_FALSEI|fact"><span class="entity_def" id="Sepref_Constraints.CN_FALSEI|thm"><span>CN_FALSEI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CN_FALSE|const"><span>CN_FALSE</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>


</span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Sepref_Constraints.constraint_simps|attribute"><span class="entity_def" id="Sepref_Constraints.constraint_simps|fact"><span>constraint_simps</span></span></span><span> </span><span class="quoted"><span>‹Simplification of constraints›</span></span><span>

</span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Sepref_Constraints.constraint_abbrevs|attribute"><span class="entity_def" id="Sepref_Constraints.constraint_abbrevs|fact"><span>constraint_abbrevs</span></span></span><span> </span><span class="quoted"><span>‹Constraint Solver: Abbreviations›</span></span><span>
</span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="Sepref_Constraints.split_constraint_rls|fact"><span class="entity_def" id="Sepref_Constraints.split_constraint_rls(4)|thm"><span class="entity_def" id="Sepref_Constraints.split_constraint_rls(3)|thm"><span class="entity_def" id="Sepref_Constraints.split_constraint_rls(2)|thm"><span class="entity_def" id="Sepref_Constraints.split_constraint_rls(1)|thm"><span>split_constraint_rls</span></span></span></span></span></span><span> 
    </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.atomize_conj|fact"><span>atomize_conj</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../Pure/Pure/Pure.html#Pure.imp_conjunction|fact"><span>imp_conjunction</span></a><span> </span><a class="entity_ref" href="../../Pure/Pure/Pure.html#Pure.all_conjunction|fact"><span>all_conjunction</span></a><span> </span><a class="entity_ref" href="../../Pure/Pure/Pure.html#Pure.conjunction_imp|fact"><span>conjunction_imp</span></a><span>

</span><span class="keyword1"><span class="command"><span>ML</span></span></span><span> </span><span class="quoted"><span>‹
  </span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>SEPREF_CONSTRAINTS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
    </span><span class="comment1"><span>(******** Constraint Slot *)</span></span><span>
    </span><span class="comment1"><span>(* Tactic with slot subgoal *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> WITH_SLOT</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tactic'</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>
    </span><span class="comment1"><span>(* Process all goals in slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> ON_SLOT</span><span class="main"><span>:</span></span><span> </span><span>tactic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>
    </span><span class="comment1"><span>(* Create slot as last subgoal. Fail if slot already present. *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> create_slot_tac</span><span class="main"><span>:</span></span><span> </span><span>tactic</span><span>
    </span><span class="comment1"><span>(* Create slot if there isn't one already *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> ensure_slot_tac</span><span class="main"><span>:</span></span><span> </span><span>tactic</span><span>
    </span><span class="comment1"><span>(* Remove empty slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> remove_slot_tac</span><span class="main"><span>:</span></span><span> </span><span>tactic</span><span>
    </span><span class="comment1"><span>(* Move slot to first subgoal *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> prefer_slot_tac</span><span class="main"><span>:</span></span><span> </span><span>tactic</span><span>
    </span><span class="comment1"><span>(* Destruct slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> dest_slot_tac</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tactic'</span></span><span>
    </span><span class="comment1"><span>(* Check if goal state has slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> has_slot</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
    </span><span class="comment1"><span>(* Defer subgoal to slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> to_slot_tac</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tactic'</span></span><span>
    </span><span class="comment1"><span>(* Print slot constraints *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> print_slot_tac</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>

    </span><span class="comment1"><span>(* Focus on goals in slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> focus</span><span class="main"><span>:</span></span><span> </span><span>tactic</span><span>
    </span><span class="comment1"><span>(* Unfocus goals in slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> unfocus</span><span class="main"><span>:</span></span><span> </span><span>tactic</span><span>
    </span><span class="comment1"><span>(* Unfocus goals, and insert them as first subgoals *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> unfocus_ins</span><span class="main"><span>:</span></span><span>tactic</span><span>

    </span><span class="comment1"><span>(* Focus on some goals in slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> cond_focus</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>
    </span><span class="comment1"><span>(* Move some goals to slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> some_to_slot_tac</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>


    </span><span class="comment1"><span>(******** Constraints *)</span></span><span>
    </span><span class="comment1"><span>(* Check if subgoal is a constraint. To be used with COND' *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_constraint_goal</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
    </span><span class="comment1"><span>(* Identity on constraint subgoal, no_tac otherwise *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_constraint_tac</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tactic'</span></span><span>
    </span><span class="comment1"><span>(* Defer constraint to slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> slot_constraint_tac</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>

    </span><span class="comment1"><span>(******** Constraint solving *)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> add_constraint_rule</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Context.generic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Context.generic</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> del_constraint_rule</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Context.generic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Context.generic</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> get_constraint_rules</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> add_safe_constraint_rule</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Context.generic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Context.generic</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> del_safe_constraint_rule</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Context.generic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Context.generic</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> get_safe_constraint_rules</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span>

    </span><span class="comment1"><span>(* Solve constraint subgoal *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> solve_constraint_tac</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tactic'</span></span><span>
    </span><span class="comment1"><span>(* Solve constraint subgoal if solvable, fail if definitely unsolvable, 
      apply simplification and unique rules otherwise. *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> safe_constraint_tac</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tactic'</span></span><span>

    </span><span class="comment1"><span>(* CONSTRAINT tag on goal is optional *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> solve_constraint'_tac</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tactic'</span></span><span>
    </span><span class="comment1"><span>(* CONSTRAINT tag on goal is optional *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> safe_constraint'_tac</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tactic'</span></span><span>
    
    </span><span class="comment1"><span>(* Solve, or apply safe-rules and defer to constraint slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> constraint_tac</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tactic'</span></span><span>

    </span><span class="comment1"><span>(* Apply safe rules to all constraint goals in slot *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> process_constraint_slot</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>

    </span><span class="comment1"><span>(* Solve all constraint goals in slot, insert unsolved ones as first subgoals *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> solve_constraint_slot</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>


    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> setup</span><span class="main"><span>:</span></span><span> </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>theory</span><span>

  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


  </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Sepref_Constraints</span></span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>SEPREF_CONSTRAINTS</span></span><span>  </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_slot_goal</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT_SLOT|const"><span>CONSTRAINT_SLOT</span></a><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_slot_goal</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>slot_goal_num</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>find_index</span><span> </span><span class="entity"><span>is_slot_goal</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.prems_of</span><span> </span><span class="entity"><span>st</span></span><span class="main"><span>)</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="entity"><span>i</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>has_slot</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>slot_goal_num</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>WITH_SLOT</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>si</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>slot_goal_num</span></span><span> </span><span class="entity"><span>st</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>si</span></span><span>&gt;</span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>si</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span>warning</span><span> </span><span class="inner_quoted"><span>"Constraints: No slot"</span></span><span class="main"><span>;</span></span><span> </span><span>Seq.empty</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>to_slot_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>IF_EXGOAL</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>WITH_SLOT</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>si</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> 
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span>&lt;</span><span class="entity"><span>si</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="entity"><span>prefer_tac</span></span><span> </span><span class="entity"><span>si</span></span><span> </span><span>THEN</span><span> </span><span class="entity"><span>prefer_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
        </span><span>THEN</span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>PRIMITIVE</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Drule.comp_no_flatten</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>st</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.insert_slot_rl1|fact"><span>insert_slot_rl1</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> 
          </span><span>ORELSE</span><span> </span><span>PRIMITIVE</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Drule.comp_no_flatten</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>st</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.insert_slot_rl2|fact"><span>insert_slot_rl2</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span>
        </span><span>THEN</span><span> </span><span>defer_tac</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>no_tac</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>create_slot_tac</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span>COND</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>has_slot</span></span><span class="main"><span>)</span></span><span> </span><span>no_tac</span><span>
        </span><span class="main"><span>(</span></span><span>PRIMITIVE</span><span> </span><span class="main"><span>(</span></span><span>Thm.implies_intr</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>cterm</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT_SLOT|const"><span>CONSTRAINT_SLOT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> 
        </span><span>THEN</span><span> </span><span>defer_tac</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
        
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ensure_slot_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>TRY</span><span> </span><span class="entity"><span>create_slot_tac</span></span><span>
          
      
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prefer_slot_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>WITH_SLOT</span></span><span> </span><span class="entity"><span>prefer_tac</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dest_slot_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>
      </span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span>CONVERSION</span><span> </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT_SLOT_def|fact"><span>CONSTRAINT_SLOT_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> 
        </span><span>THEN'</span><span> </span><span>Goal.conjunction_tac</span><span>
        </span><span>THEN'</span><span> </span><span>TRY</span><span> </span><span>o</span><span> </span><span>resolve0_tac</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
      </span><span>THEN</span><span> </span><span>distinct_subgoals_tac</span><span>
    </span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>remove_slot_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>WITH_SLOT</span></span><span> </span><span class="main"><span>(</span></span><span>resolve0_tac</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.remove_slot|fact"><span>remove_slot</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>focus</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>WITH_SLOT</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> 
      </span><span>PRIMITIVE</span><span> </span><span class="main"><span>(</span></span><span>Goal.restrict</span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> 
      </span><span>THEN</span><span> </span><span>ALLGOALS</span><span> </span><span class="entity"><span>dest_slot_tac</span></span><span>
      </span><span>THEN</span><span> </span><span class="entity"><span>create_slot_tac</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unfocus_ins</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span>PRIMITIVE</span><span> </span><span class="main"><span>(</span></span><span>Goal.unrestrict</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
      </span><span>THEN</span><span> </span><span class="entity"><span>WITH_SLOT</span></span><span> </span><span>defer_tac</span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>some_to_slot_tac</span></span><span> </span><span class="entity"><span>cond</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>COND'</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>is_slot_goal</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cond</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>ORELSE'</span><span> </span><span class="entity"><span>to_slot_tac</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unfocus</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span class="entity"><span>some_to_slot_tac</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
      </span><span>THEN</span><span> </span><span class="entity"><span>unfocus_ins</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cond_focus</span></span><span> </span><span class="entity"><span>cond</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>focus</span></span><span> 
      </span><span>THEN</span><span> </span><span class="entity"><span>some_to_slot_tac</span></span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span>o</span><span> </span><span class="entity"><span>cond</span></span><span class="main"><span>)</span></span><span>


    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ON_SLOT</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>focus</span></span><span> </span><span>THEN</span><span> </span><span class="entity"><span>tac</span></span><span> </span><span>THEN</span><span> </span><span class="entity"><span>unfocus</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_slot_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ON_SLOT</span></span><span> </span><span class="main"><span>(</span></span><span>print_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="inner_quoted"><span>"SLOT:"</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
      </span><span class="comment1"><span>(*fun prepare_constraint_conv ctxt = let
        open Conv 
        fun CONSTRAINT_conv ct = case Thm.term_of ct of
          @{mpat "Trueprop (_ _)"} =&gt; 
            HOLogic.Trueprop_conv 
              (rewr_conv @{thm CONSTRAINT_def[symmetric]}) ct
          | _ =&gt; raise CTERM ("CONSTRAINT_conv", [ct])

        fun rec_conv ctxt ct = (
          CONSTRAINT_conv
          else_conv 
          implies_conv (rec_conv ctxt) (rec_conv ctxt)
          else_conv
          forall_conv (rec_conv o #2) ctxt
        ) ct
      in
        rec_conv ctxt
      end*)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unfold_abbrevs</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> 
        </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.split_constraint_rls|fact"><span>split_constraint_rls</span></a><span> </span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT_def|fact"><span>CONSTRAINT_def</span></a><span class="antiquote"><span>}</span></span></span></span><span> 
          </span><span>@</span><span> </span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> constraint_abbrevs</span><span class="antiquote"><span>}</span></span></span><span>
          </span><span>@</span><span> </span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> constraint_simps</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span>
        </span><span>#&gt;</span><span> </span><span>Conjunction.elim_conjunctions</span><span>
  
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>check_constraint_rl</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ck</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="var"><span>?C</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> 
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>is_Var</span><span> </span><span class="main"><span>(</span></span><span>Term.head_of</span><span> </span><span class="entity"><span>C</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Schematic head in constraint rule"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span>Thm.prop_of</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ck</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="var"><span>?t</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ck</span></span><span> </span><span class="entity"><span>t</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ck</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><span class="keyword1"><span>PROP</span></span><span> </span><span class="var"><span>?s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="keyword1"><span>PROP</span></span><span> </span><span class="var"><span>?t</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ck</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>ck</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ck</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Invalid part of constraint rule"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span>Thm.prop_of</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
  
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>ck</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.prop_of</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>thm</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>check_unsafe_constraint_rl</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.nprems_of</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> 
          </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Unconditional constraint rule must be safe (register this as safe rule)"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span>Thm.prop_of</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>thm</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>constraint_rules</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Sorted_Thms</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> </span><span class="entity_def" id="Sepref_Constraints.constraint_rules|attribute"><span class="entity_def" id="Sepref_Constraints.constraint_rules|fact"><span>constraint_rules</span></span></span><span class="antiquote"><span>}</span></span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>description</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Constraint rules"</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sort</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>K</span><span> </span><span>I</span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>transform</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Conv</span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Context.proof_of</span><span> </span><span class="entity"><span>context</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="entity"><span>unfold_abbrevs</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>#&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>check_constraint_rl</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>check_unsafe_constraint_rl</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>safe_constraint_rules</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Sorted_Thms</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> </span><span class="entity_def" id="Sepref_Constraints.safe_constraint_rules|attribute"><span class="entity_def" id="Sepref_Constraints.safe_constraint_rules|fact"><span>safe_constraint_rules</span></span></span><span class="antiquote"><span>}</span></span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>description</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Safe Constraint rules"</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sort</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>K</span><span> </span><span>I</span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>transform</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Conv</span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Context.proof_of</span><span> </span><span class="entity"><span>context</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="entity"><span>unfold_abbrevs</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>#&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>check_constraint_rl</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>)</span></span><span>

    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>  

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>add_constraint_rule</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>constraint_rules.add_thm</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>del_constraint_rule</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>constraint_rules.del_thm</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>get_constraint_rules</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>constraint_rules.get</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>add_safe_constraint_rule</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>safe_constraint_rules.add_thm</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>del_safe_constraint_rule</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>safe_constraint_rules.del_thm</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>get_safe_constraint_rules</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>safe_constraint_rules.get</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_constraint_goal</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Logic.strip_assums_concl</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT|const"><span>CONSTRAINT</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_constraint_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>COND'</span></span><span> </span><span class="entity"><span>is_constraint_goal</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_slottable_constraint_goal</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Logic.strip_assums_concl</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT|const"><span>CONSTRAINT</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CN_FALSE|const"><span>CN_FALSE</span></a><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT|const"><span>CONSTRAINT</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>slot_constraint_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>COND'</span></span><span> </span><span class="entity"><span>is_slottable_constraint_goal</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>to_slot_tac</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> 'a </span><span class="entity"><span>seq_cases</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>SC_NONE</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SC_SINGLE</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> 'a Seq.seq </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SC_MULTIPLE</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> 'a Seq.seq

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>seq_cases</span></span><span> </span><span class="entity"><span>seq</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Seq.pull</span><span> </span><span class="entity"><span>seq</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SC_NONE</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>st1</span></span><span class="main"><span>,</span></span><span class="entity"><span>seq</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Seq.pull</span><span> </span><span class="entity"><span>seq</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SC_SINGLE</span></span><span> </span><span class="main"><span>(</span></span><span>Seq.single</span><span> </span><span class="entity"><span>st1</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>st2</span></span><span class="main"><span>,</span></span><span class="entity"><span>seq</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SC_MULTIPLE</span></span><span> </span><span class="main"><span>(</span></span><span>Seq.cons</span><span> </span><span class="entity"><span>st1</span></span><span> </span><span class="main"><span>(</span></span><span>Seq.cons</span><span> </span><span class="entity"><span>st2</span></span><span> </span><span class="entity"><span>seq</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>  

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>SEQ_CASES</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>single_tac</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>multiple_tac</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>res</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>st</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>seq_cases</span></span><span> </span><span class="entity"><span>res</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span class="entity"><span>SC_NONE</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Seq.empty</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SC_SINGLE</span></span><span> </span><span class="entity"><span>res</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Seq.maps</span><span> </span><span class="entity"><span>single_tac</span></span><span> </span><span class="entity"><span>res</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SC_MULTIPLE</span></span><span> </span><span class="entity"><span>res</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Seq.maps</span><span> </span><span class="entity"><span>multiple_tac</span></span><span> </span><span class="entity"><span>res</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>SAFE</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>SEQ_CASES</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>(</span></span><span>all_tac</span><span class="main"><span>,</span></span><span> </span><span>no_tac</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>SAFE'</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>SAFE</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>tac</span></span><span>

    </span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>simp_constraints_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
          </span><span>addsimps</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> constraint_simps</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>simp_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unfold_abbrevs_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
          </span><span>addsimps</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> constraint_abbrevs</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ethms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjE|fact"><span>conjE</span></a><span class="antiquote"><span>}</span></span></span></span><span>  
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ithms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="antiquote"><span>}</span></span></span></span><span>  
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>full_simp_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
        </span><span>THEN_ALL_NEW</span><span> </span><span>TRY</span><span> </span><span>o</span><span> </span><span>REPEAT_ALL_NEW</span><span> </span><span class="main"><span>(</span></span><span>ematch_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ethms</span></span><span class="main"><span>)</span></span><span>
        </span><span>THEN_ALL_NEW</span><span> </span><span>TRY</span><span> </span><span>o</span><span> </span><span>REPEAT_ALL_NEW</span><span> </span><span class="main"><span>(</span></span><span>match_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ithms</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>WITH_RULE_NETS</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>scn_net</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>safe_constraint_rules.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>|&gt;</span><span> </span><span>Tactic.build_net</span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cn_net</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>constraint_rules.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>|&gt;</span><span> </span><span>Tactic.build_net</span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>scn_net</span></span><span class="main"><span>,</span></span><span class="entity"><span>cn_net</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>wrap_tac</span></span><span> </span><span class="entity"><span>step_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>REPEAT_ALL_NEW</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>simp_constraints_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
        </span><span>THEN_ALL_NEW</span><span> </span><span class="entity"><span>unfold_abbrevs_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span>THEN_ALL_NEW</span><span> </span><span class="entity"><span>step_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>solve_step_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>scn_net</span></span><span class="main"><span>,</span></span><span class="entity"><span>cn_net</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>REPEAT_ALL_NEW</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span>DETERM</span><span> </span><span>o</span><span> </span><span>resolve_from_net_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>scn_net</span></span><span>
        </span><span>ORELSE'</span><span> </span><span>resolve_from_net_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>cn_net</span></span><span>
      </span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>safe_step_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>scn_net</span></span><span class="main"><span>,</span></span><span class="entity"><span>cn_net</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>REPEAT_ALL_NEW</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span>DETERM</span><span> </span><span>o</span><span> </span><span>resolve_from_net_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>scn_net</span></span><span>
        </span><span>ORELSE'</span><span> </span><span class="entity"><span>SAFE'</span></span><span> </span><span class="main"><span>(</span></span><span>resolve_from_net_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>cn_net</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>solve_tac</span></span><span> </span><span class="entity"><span>cn_nets</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOLVED'</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wrap_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>solve_step_tac</span></span><span> </span><span class="entity"><span>cn_nets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>safe_tac</span></span><span> </span><span class="entity"><span>cn_nets</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>  
        </span><span class="entity"><span>simp_constraints_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span>THEN_ALL_NEW</span><span> </span><span class="entity"><span>unfold_abbrevs_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span>THEN_ALL_NEW</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>solve_tac</span></span><span> </span><span class="entity"><span>cn_nets</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>ORELSE'</span><span> </span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>wrap_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>safe_step_tac</span></span><span> </span><span class="entity"><span>cn_nets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>solve_constraint_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>TRADE</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="entity"><span>is_constraint_tac</span></span><span>
        </span><span>THEN'</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT_I|fact"><span>CONSTRAINT_I</span></a><span class="antiquote"><span>}</span></span></span></span><span>
        </span><span>THEN'</span><span> </span><span class="entity"><span>WITH_RULE_NETS</span></span><span> </span><span class="entity"><span>solve_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>safe_constraint_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>TRADE</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="entity"><span>is_constraint_tac</span></span><span>
        </span><span>THEN'</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT_I|fact"><span>CONSTRAINT_I</span></a><span class="antiquote"><span>}</span></span></span></span><span>
        </span><span>THEN'</span><span> </span><span class="entity"><span>WITH_RULE_NETS</span></span><span> </span><span class="entity"><span>safe_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span>THEN_ALL_NEW</span><span> </span><span class="entity"><span>fo_resolve_tac</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT_D|fact"><span>CONSTRAINT_D</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="comment1"><span>(* TODO/FIXME: fo_resolve_tac has non-canonical parameter order *)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>solve_constraint'_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>TRADE</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span>TRY</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT_I|fact"><span>CONSTRAINT_I</span></a><span class="antiquote"><span>}</span></span></span></span><span>
        </span><span>THEN'</span><span> </span><span class="entity"><span>WITH_RULE_NETS</span></span><span> </span><span class="entity"><span>solve_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>safe_constraint'_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>TRADE</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span>TRY</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Sepref_Constraints.html#Sepref_Constraints.CONSTRAINT_I|fact"><span>CONSTRAINT_I</span></a><span class="antiquote"><span>}</span></span></span></span><span>
        </span><span>THEN'</span><span> </span><span class="entity"><span>WITH_RULE_NETS</span></span><span> </span><span class="entity"><span>safe_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>


    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>  

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>constraint_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span class="entity"><span>safe_constraint_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN_ALL_NEW</span><span> </span><span class="entity"><span>slot_constraint_tac</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>process_constraint_slot</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ON_SLOT</span></span><span> </span><span class="main"><span>(</span></span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>safe_constraint_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>solve_constraint_slot</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span class="entity"><span>cond_focus</span></span><span> </span><span class="entity"><span>is_constraint_goal</span></span><span> 
        </span><span>THEN</span><span> </span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>COND'</span></span><span> </span><span class="entity"><span>is_slot_goal</span></span><span>
          </span><span>ORELSE'</span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="entity"><span>solve_constraint_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
            </span><span>ORELSE'</span><span> </span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>safe_constraint_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
          </span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span>
      </span><span>THEN</span><span> </span><span class="entity"><span>unfocus_ins</span></span><span>


    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>setup</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>I</span><span>
      </span><span>#&gt;</span><span> </span><span class="entity"><span>constraint_rules.setup</span></span><span>
      </span><span>#&gt;</span><span> </span><span class="entity"><span>safe_constraint_rules.setup</span></span><span>

  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
›</span></span><span>

</span><span class="keyword1"><span class="command"><span>setup</span></span></span><span> </span><span class="entity"><span>Sepref_Constraints.setup</span></span><span>

</span><span class="keyword1"><span class="command"><span>method_setup</span></span></span><span> </span><span class="entity_def" id="Sepref_Constraints.print_slot|method"><span>print_slot</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SIMPLE_METHOD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sepref_Constraints.print_slot_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>

</span><span class="keyword1"><span class="command"><span>method_setup</span></span></span><span> </span><span class="entity_def" id="Sepref_Constraints.solve_constraint|method"><span>solve_constraint</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SIMPLE_METHOD'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sepref_Constraints.solve_constraint'_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>
</span><span class="keyword1"><span class="command"><span>method_setup</span></span></span><span> </span><span class="entity_def" id="Sepref_Constraints.safe_constraint|method"><span>safe_constraint</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SIMPLE_METHOD'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sepref_Constraints.safe_constraint'_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>


</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>