<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Proto_Sepref_Borrow</title>
</head>


<body>
<div class="head">
<h1>Theory Proto_Sepref_Borrow</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><a href="Proto_Sepref_Borrow.html"><span>Proto_Sepref_Borrow</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> </span><a href="Sepref.html"><span>Sepref</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

  </span><span class="comment1"><span>(* Simple-Minded borrowing for sepref.
  
    Idea: When we can prove that we have not changed an object abstractly, 
      and its concrete value is still the same, we can reinstantiate it 
      after it has been invalidated.
      
  *)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Operation to reinstantiate dst, by moving source. 
    Implementations will also require a proof that the concrete objects are equal!
  ›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Proto_Sepref_Borrow.unborrow_def|fact"><span class="entity_def" id="Proto_Sepref_Borrow.unborrow_def|thm"><span class="entity_def" id="Proto_Sepref_Borrow.unborrow_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Proto_Sepref_Borrow.unborrow|const"><span>unborrow</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>src</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>dst</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doN</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.ASSERT|const"><span>ASSERT</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>src</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span class="bound"><span class="entity"><span>dst</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.RETURN|const"><span>RETURN</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Unity|const"><span>()</span></a></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Proto_Sepref_Borrow.unborrow.mcomb|fact"><span class="entity_def" id="Proto_Sepref_Borrow.unborrow.arity|fact"><span class="entity_def" id="Proto_Sepref_Borrow.unborrow.itype|fact"><span class="entity_def" id="Proto_Sepref_Borrow.unborrow.mcomb|thm"><span class="entity_def" id="Proto_Sepref_Borrow.unborrow.arity|thm"><span class="entity_def" id="Proto_Sepref_Borrow.unborrow.itype|thm"><span>sepref_register</span></span></span></span></span></span></span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="Proto_Sepref_Borrow.html#Proto_Sepref_Borrow.unborrow|const"><span>unborrow</span></a></span><span>

  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Proto_Sepref_Borrow.unborrow_correct|fact"><span class="entity_def" id="Proto_Sepref_Borrow.unborrow_correct|thm"><span>unborrow_correct</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_vcg|attribute"><span class="operator"><span>refine_vcg</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>s</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>d</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Proto_Sepref_Borrow.html#Proto_Sepref_Borrow.unborrow|const"><span>unborrow</span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>d</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.SPEC|const"><span>SPEC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Unity|const"><span>()</span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Proto_Sepref_Borrow.html#Proto_Sepref_Borrow.unborrow_def|fact"><span>unborrow_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Proto_Sepref_Borrow.unborrow_rule|fact"><span class="entity_def" id="Proto_Sepref_Borrow.unborrow_rule|thm"><span>unborrow_rule</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.sepref_comb_rules|attribute"><span class="operator"><span>sepref_comb_rules</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_704..709">FRAME</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Γ</span></span><span> </span><span class="main"><a class="entity_ref" href="Frame_Infer.html#Frame_Infer.entails|const"><span>⊢</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>src</span></span><span> </span><span class="free"><span>srci</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_invalid|const"><span>hn_invalid</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>dst</span></span><span> </span><span class="free"><span>dsti</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_778..781">EQI</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.vassn_tag|const"><span>vassn_tag</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Sepref_Conc_Post.html#Sepref_Conc_Post.CP_cond|const"><span>CP_cond</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>srci</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>dsti</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Unity|const"><span>()</span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_invalid|const"><span>hn_invalid</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>src</span></span><span> </span><span class="free"><span>srci</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt|const"><span>hn_ctxt</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>dst</span></span><span> </span><span class="free"><span>dsti</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Sepref_Rules.html#Sepref_Rules.unit_assn|const"><span>unit_assn</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Proto_Sepref_Borrow.html#Proto_Sepref_Borrow.unborrow|const"><span>unborrow</span></a><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>src</span></span><span class="main"><a class="entity_ref" href="../../AFP/Automatic_Refinement/Autoref_Tagging.html#Autoref_Tagging.APP|const"><span>$</span></a></span><span class="free"><span>dst</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Translate.html#Sepref_Translate.hn_refine_vassn_tagI|fact"><span>hn_refine_vassn_tagI</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_cons_pre|fact"><span>hn_refine_cons_pre</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Proto_Sepref_Borrow.html#offset_704..709"><span>FRAME</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refineI|fact"><span>hn_refineI</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Proto_Sepref_Borrow.html#offset_778..781"><span>EQI</span></a><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Proto_Sepref_Borrow.html#Proto_Sepref_Borrow.unborrow_def|fact"><span>unborrow_def</span></a><span> </span><a class="entity_ref" href="Sepref_Conc_Post.html#Sepref_Conc_Post.CP_defs|fact"><span class="dynamic"><span class="dynamic"><span>CP_defs</span></span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_ctxt_def|fact"><span>hn_ctxt_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.invalid_assn_def|fact"><span>invalid_assn_def</span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.pure_def|fact"><span>pure_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg&apos;|method"><span class="operator"><span>vcg'</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Proto_Sepref_Borrow.unborrow_nofail|fact"><span class="entity_def" id="Proto_Sepref_Borrow.unborrow_nofail|thm"><span>unborrow_nofail</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_pw_simps|attribute"><span class="operator"><span>refine_pw_simps</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nofail|const"><span>nofail</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Proto_Sepref_Borrow.html#Proto_Sepref_Borrow.unborrow|const"><span>unborrow</span></a><span> </span><span class="free"><span>a</span></span><span> </span><span class="free"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="free"><span>a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="free"><span>b</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Proto_Sepref_Borrow.html#Proto_Sepref_Borrow.unborrow_def|fact"><span>unborrow_def</span></a><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.refine_pw_simps|fact"><span class="dynamic"><span class="dynamic"><span>refine_pw_simps</span></span></span></a><span class="main"><span>)</span></span><span>  
  
  </span><span class="comment1"><span>(*
  text ‹Assertion that adds constraint on concrete value. Used to carry through concrete equalities.›
  definition "cnc_assn φ A a c ≡ ↑(φ c) ** A a c"
    
  lemma norm_ceq_assn[named_ss sepref_frame_normrel]: "hn_ctxt (cnc_assn φ A) a c = (↑(φ c) ** hn_ctxt A a c)"
    unfolding hn_ctxt_def cnc_assn_def by simp
  
  lemma cnc_assn_prod_conv[named_ss sepref_frame_normrel]:
    shows "⋀A B φ. A ×<span class="hidden">⇩</span><sub>a</sub> cnc_assn φ B = cnc_assn (φ o snd) (A×<span class="hidden">⇩</span><sub>a</sub>B)"
      and "⋀A B φ. cnc_assn φ A ×<span class="hidden">⇩</span><sub>a</sub> B = cnc_assn (φ o fst) (A×<span class="hidden">⇩</span><sub>a</sub>B)"
    unfolding cnc_assn_def
    by (auto simp: sep_algebra_simps fun_eq_iff)
  *)</span></span><span>
    
  </span><span class="comment1"><span>(* TODO: Move *)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Proto_Sepref_Borrow.wpa_comm_conjI|fact"><span class="entity_def" id="Proto_Sepref_Borrow.wpa_comm_conjI|thm"><span>wpa_comm_conjI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><a class="entity_ref" href="LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.wpa|const"><span>wpa</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="free"><span>s</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.wpa|const"><span>wpa</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Q'</span></span><span> </span><span class="free"><span>s</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.wpa|const"><span>wpa</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>r</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>r</span></span><span> </span><span class="bound"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Q'</span></span><span> </span><span class="bound"><span>r</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.wpa_def|fact"><span>wpa_def</span></a><span> 
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>drule</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Sep_Generic_Wp.html#Sep_Generic_Wp.wp_comm_conjI|fact"><span>wp_comm_conjI</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>erule</span></span><span> </span><a class="entity_ref" href="Sep_Generic_Wp.html#Sep_Generic_Wp.wp_monoI|fact"><span>wp_monoI</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span>)</span></span><span> 
  
  </span><span class="comment1"><span>(* TODO: Move *)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_2175..2180">lemma</span></span></span><span> </span><span class="entity_def" id="Proto_Sepref_Borrow.htriple_conj_pure|fact"><span class="entity_def" id="Proto_Sepref_Borrow.htriple_conj_pure|thm"><span>htriple_conj_pure</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.htriple|const"><span>htriple</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Q</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.htriple|const"><span>htriple</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>r</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_true|const"><span>sep_true</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.htriple|const"><span>htriple</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>r</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.htripleI|fact"><span>htripleI</span></a><span class="main"><span>)</span></span><span>  
    </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>asf</span></span><span> </span><span class="skolem"><span>s</span></span><span>
    </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_2363..2369">assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.STATE|const"><span>STATE</span></a><span> </span><span class="skolem"><span>asf</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="skolem"><span>s</span></span><span>"</span></span></span><span>
    
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Proto_Sepref_Borrow.html#Proto_Sepref_Borrow.wpa_comm_conjI|fact"><span>wpa_comm_conjI</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Proto_Sepref_Borrow.html#offset_2175..2180"><span>assms</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.htripleD|fact"><a class="entity_ref" href="LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.htripleD|fact"><span>htripleD</span></a></a><span class="main"><span class="main"><span>,</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Proto_Sepref_Borrow.html#offset_2363..2369"><a class="entity_ref" href="Proto_Sepref_Borrow.html#offset_2363..2369"><span>this</span></a></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.wpa|const"><span>wpa</span></a><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>asf</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>r</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.STATE|const"><span>STATE</span></a><span> </span><span class="skolem"><span>asf</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="free"><span>Φ</span></span><span> </span><span class="bound"><span>r</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>∧*</span></a></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>s</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.wpa_monoI|fact"><span>wpa_monoI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.STATE_extract|fact"><span>STATE_extract</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
      
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>    
  
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Rule to prove a-posteriori constraint (Only useful for simple programs.
    TODO: More partial Hoare-triples would make this more useful, e.g., 
      we could assume assertions, preconditions, and even termination!
  )›</span></span></span><span>    
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Proto_Sepref_Borrow.hnr_ceq_assnI|fact"><span class="entity_def" id="Proto_Sepref_Borrow.hnr_ceq_assnI|thm"><span>hnr_ceq_assnI</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_2875..2878">HNR</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Γ'</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>CP<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_2920..2922">HT</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Shallow_RS.html#LLVM_Shallow_RS.llvm_htriple|const"><span>llvm_htriple</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x'</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.pred_lift|const"><span>↑</span></a></span><span class="main"><span>(</span></span><span class="free"><span>CP<span class="hidden">⇩</span><sub>2</sub></span></span><span> </span><span class="bound"><span>x'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_conj|const"><span>**</span></a></span><span> </span><a class="entity_ref" href="Separation_Algebra.Separation_Algebra.html#Separation_Algebra.sep_algebra_class.sep_true|const"><span>sep_true</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_2985..2988">IMP</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x'</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>CP<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>CP<span class="hidden">⇩</span><sub>2</sub></span></span><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="bound"><span>x'</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine|const"><span>hn_refine</span></a><span> </span><span class="free"><span>Γ</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>Γ'</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>CP</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refine_nofailI|fact"><span>hn_refine_nofailI</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="entity_def" id="offset_3103..3105">NF</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../AFP/Refine_Monadic/Refine_Basic.html#Refine_Basic.nofail|const"><span>nofail</span></a><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
  
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refineI|fact"><span>hn_refineI</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="LLVM_Simple_Memory_RS.html#LLVM_Simple_Memory_RS.cons_post_rule|fact"><span>cons_post_rule</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Proto_Sepref_Borrow.html#Proto_Sepref_Borrow.htriple_conj_pure|fact"><span>htriple_conj_pure</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Proto_Sepref_Borrow.html#offset_2875..2878"><span>HNR</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="Sepref_Basic.html#Sepref_Basic.hn_refineD|fact"><span>hn_refineD</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="Proto_Sepref_Borrow.html#offset_3103..3105"><span>NF</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span> </span><a class="entity_ref" href="Proto_Sepref_Borrow.html#offset_2920..2922"><span>HT</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Sep_Algebra_Add.html#Sep_Algebra_Add.sep_algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>sep_algebra_simps</span></span></span></a><span> </span><a class="entity_ref" href="Proto_Sepref_Borrow.html#offset_2985..2988"><span>IMP</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
      
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>    
  

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>